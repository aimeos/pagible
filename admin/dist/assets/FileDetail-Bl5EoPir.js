import{_ as Vt,L as _,a3 as Pt,b as k,w as u,aB as Pe,o as v,a as d,aC as Be,a6 as hi,d as O,a9 as Ft,aa as Wt,l as y,t as b,ag as zt,aD as jt,f as g,c as E,F as z,a5 as G,ax as Bt,a4 as le,aE as qt,aF as we,h as Gt,I as _e,k as w,n as J,i as dt,aG as di,j as $,m as Et,ab as Ue,ac as he,ad as He,ae as Fe,ah as ui,aH as ci,a2 as ye,aI as It,a7 as We,ay as fi,r as pt,az as pi,a1 as Jt,aJ as vt,aK as ut,aL as mi,aM as gi,T as ze,V as St,e as yt,an as vi,aN as Zt,aO as Lt,aP as bi,aQ as wi,aR as yi,aS as xi,Z as Ci,aT as Di}from"./index-BPV2UoEN.js";import{H as ki,A as Ei}from"./ElementListItems-BnqIwooF.js";import{P as Ti}from"./PageDetail-ByP3ZtmX.js";import{E as Mi}from"./ElementDetail-KNdoDRFn.js";const Oi={props:{item:{type:Object,required:!0}},emits:[],inject:["openView"],data:()=>({panel:[0,1,2],versions:{},file:{}}),setup(){return{auth:Pt()}},methods:{openElement(e){this.openView(Mi,{item:{...e}})},openPage(e){this.openView(Ti,{item:{...e}})}},watch:{item:{immediate:!0,handler(e){!e.id||!this.auth.can("file:view")||this.$apollo.query({query:_`query ($id: ID!) {
              file(id: $id) {
                id
                bypages {
                  id
                  path
                  name
                }
                byelements {
                  id
                  type
                  name
                }
                byversions {
                  id
                  versionable_id
                  versionable_type
                  published
                  publish_at
                }
              }
            }`,variables:{id:e.id}}).then(t=>{var i,a,s;if(t.errors)throw t.errors;this.file=((i=t.data)==null?void 0:i.file)||{},this.versions=(((s=(a=t.data)==null?void 0:a.file)==null?void 0:s.byversions)||[]).map(r=>({id:r.versionable_id,type:r.versionable_type.split("\\").at(-1),published:r.published?this.$gettext("yes"):r.publish_at?new Date(r.publish_at).toLocaleDateString():this.$gettext("no")})).filter(r=>this.auth.can(r.type.toLowerCase()+":view"))}).catch(t=>{this.$log("FileDetailRef::watch(item): Error fetching file",e,t)})}}}},Vi=["onClick"],$i=["onClick"];function Si(e,t,i,a,s,r){return v(),k(Pe,null,{default:u(()=>[d(Be,{class:"scroll"},{default:u(()=>[d(hi,{modelValue:e.panel,"onUpdate:modelValue":t[0]||(t[0]=n=>e.panel=n),elevation:"0",multiple:""},{default:u(()=>{var n,o,p;return[(n=e.file.bypages)!=null&&n.length&&a.auth.can("page:view")?(v(),k(Ft,{key:0},{default:u(()=>[d(Wt,null,{default:u(()=>[y(b(e.$gettext("Pages")),1)]),_:1}),d(zt,null,{default:u(()=>[d(jt,{class:"pages",density:"comfortable",hover:""},{default:u(()=>[g("thead",null,[g("tr",null,[g("th",null,b(e.$gettext("ID")),1),g("th",null,b(e.$gettext("URL")),1),g("th",null,b(e.$gettext("Name")),1)])]),g("tbody",null,[(v(!0),E(z,null,G(e.file.bypages,l=>(v(),E("tr",{key:l.id,onClick:h=>r.openPage(l)},[g("td",null,b(l.id),1),g("td",null,b("/"+l.path),1),g("td",null,b(l.name),1)],8,Vi))),128))])]),_:1})]),_:1})]),_:1})):O("",!0),(o=e.file.byelements)!=null&&o.length&&a.auth.can("element:view")?(v(),k(Ft,{key:1},{default:u(()=>[d(Wt,null,{default:u(()=>[y(b(e.$gettext("Elements")),1)]),_:1}),d(zt,null,{default:u(()=>[d(jt,{class:"elements",density:"comfortable",hover:""},{default:u(()=>[g("thead",null,[g("tr",null,[g("th",null,b(e.$gettext("ID")),1),g("th",null,b(e.$gettext("Type")),1),g("th",null,b(e.$gettext("Name")),1)])]),g("tbody",null,[(v(!0),E(z,null,G(e.file.byelements,l=>(v(),E("tr",{key:l.id,onClick:h=>r.openElement(l)},[g("td",null,b(l.id),1),g("td",null,b(l.type),1),g("td",null,b(l.name),1)],8,$i))),128))])]),_:1})]),_:1})]),_:1})):O("",!0),(p=e.versions)!=null&&p.length?(v(),k(Ft,{key:2},{default:u(()=>[d(Wt,null,{default:u(()=>[y(b(e.$gettext("Versions")),1)]),_:1}),d(zt,null,{default:u(()=>[d(jt,{density:"comfortable",hover:""},{default:u(()=>[g("thead",null,[g("tr",null,[g("th",null,b(e.$gettext("ID")),1),g("th",null,b(e.$gettext("Type")),1),g("th",null,b(e.$gettext("Published")),1)])]),g("tbody",null,[(v(!0),E(z,null,G(e.versions,l=>(v(),E("tr",{key:l.id},[g("td",null,b(l.id),1),g("td",null,b(l.type),1),g("td",null,b(l.published),1)]))),128))])]),_:1})]),_:1})]),_:1})):O("",!0)]}),_:1},8,["modelValue"])]),_:1})]),_:1})}const Ni=Vt(Oi,[["render",Si],["__scopeId","data-v-791df981"]]);/*!
 * Cropper.js v1.6.2
 * https://fengyuanchen.github.io/cropperjs
 *
 * Copyright 2015-present Chen Fengyuan
 * Released under the MIT license
 *
 * Date: 2024-04-21T07:43:05.335Z
 */function xe(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),i.push.apply(i,a)}return i}function je(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?xe(Object(i),!0).forEach(function(a){Ri(e,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):xe(Object(i)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(i,a))})}return e}function Ai(e,t){if(typeof e!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function Ye(e){var t=Ai(e,"string");return typeof t=="symbol"?t:t+""}function Qt(e){"@babel/helpers - typeof";return Qt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Qt(e)}function Ii(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ce(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,Ye(a.key),a)}}function Li(e,t,i){return t&&Ce(e.prototype,t),i&&Ce(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ri(e,t,i){return t=Ye(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Xe(e){return Pi(e)||Bi(e)||_i(e)||Ui()}function Pi(e){if(Array.isArray(e))return Kt(e)}function Bi(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function _i(e,t){if(e){if(typeof e=="string")return Kt(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Kt(e,t)}}function Kt(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function Ui(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var _t=typeof window<"u"&&typeof window.document<"u",Q=_t?window:{},de=_t&&Q.document.documentElement?"ontouchstart"in Q.document.documentElement:!1,ue=_t?"PointerEvent"in Q:!1,S="cropper",ce="all",qe="crop",Ge="move",Je="zoom",lt="e",ht="w",ft="s",it="n",xt="ne",Ct="nw",Dt="se",kt="sw",te="".concat(S,"-crop"),De="".concat(S,"-disabled"),F="".concat(S,"-hidden"),ke="".concat(S,"-hide"),Hi="".concat(S,"-invisible"),Rt="".concat(S,"-modal"),ee="".concat(S,"-move"),Mt="".concat(S,"Action"),Nt="".concat(S,"Preview"),fe="crop",Ze="move",Qe="none",ie="crop",ae="cropend",re="cropmove",se="cropstart",Ee="dblclick",Fi=de?"touchstart":"mousedown",Wi=de?"touchmove":"mousemove",zi=de?"touchend touchcancel":"mouseup",Te=ue?"pointerdown":Fi,Me=ue?"pointermove":Wi,Oe=ue?"pointerup pointercancel":zi,Ve="ready",$e="resize",Se="wheel",ne="zoom",Ne="image/jpeg",ji=/^e|w|s|n|se|sw|ne|nw|all|crop|move|zoom$/,Yi=/^data:/,Xi=/^data:image\/jpeg;base64,/,qi=/^img|canvas$/i,Ke=200,ti=100,Ae={viewMode:0,dragMode:fe,initialAspectRatio:NaN,aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:Ke,minContainerHeight:ti,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},Gi='<div class="cropper-container" touch-action="none"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-cropper-action="e"></span><span class="cropper-line line-n" data-cropper-action="n"></span><span class="cropper-line line-w" data-cropper-action="w"></span><span class="cropper-line line-s" data-cropper-action="s"></span><span class="cropper-point point-e" data-cropper-action="e"></span><span class="cropper-point point-n" data-cropper-action="n"></span><span class="cropper-point point-w" data-cropper-action="w"></span><span class="cropper-point point-s" data-cropper-action="s"></span><span class="cropper-point point-ne" data-cropper-action="ne"></span><span class="cropper-point point-nw" data-cropper-action="nw"></span><span class="cropper-point point-sw" data-cropper-action="sw"></span><span class="cropper-point point-se" data-cropper-action="se"></span></div></div>',Ji=Number.isNaN||Q.isNaN;function D(e){return typeof e=="number"&&!Ji(e)}var Ie=function(t){return t>0&&t<1/0};function Yt(e){return typeof e>"u"}function ct(e){return Qt(e)==="object"&&e!==null}var Zi=Object.prototype.hasOwnProperty;function mt(e){if(!ct(e))return!1;try{var t=e.constructor,i=t.prototype;return t&&i&&Zi.call(i,"isPrototypeOf")}catch{return!1}}function H(e){return typeof e=="function"}var Qi=Array.prototype.slice;function ei(e){return Array.from?Array.from(e):Qi.call(e)}function I(e,t){return e&&H(t)&&(Array.isArray(e)||D(e.length)?ei(e).forEach(function(i,a){t.call(e,i,a,e)}):ct(e)&&Object.keys(e).forEach(function(i){t.call(e,e[i],i,e)})),e}var N=Object.assign||function(t){for(var i=arguments.length,a=new Array(i>1?i-1:0),s=1;s<i;s++)a[s-1]=arguments[s];return ct(t)&&a.length>0&&a.forEach(function(r){ct(r)&&Object.keys(r).forEach(function(n){t[n]=r[n]})}),t},Ki=/\.\d*(?:0|9){12}\d*$/;function bt(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e11;return Ki.test(e)?Math.round(e*t)/t:e}var ta=/^width|height|left|top|marginLeft|marginTop$/;function at(e,t){var i=e.style;I(t,function(a,s){ta.test(s)&&D(a)&&(a="".concat(a,"px")),i[s]=a})}function ea(e,t){return e.classList?e.classList.contains(t):e.className.indexOf(t)>-1}function B(e,t){if(t){if(D(e.length)){I(e,function(a){B(a,t)});return}if(e.classList){e.classList.add(t);return}var i=e.className.trim();i?i.indexOf(t)<0&&(e.className="".concat(i," ").concat(t)):e.className=t}}function Z(e,t){if(t){if(D(e.length)){I(e,function(i){Z(i,t)});return}if(e.classList){e.classList.remove(t);return}e.className.indexOf(t)>=0&&(e.className=e.className.replace(t,""))}}function gt(e,t,i){if(t){if(D(e.length)){I(e,function(a){gt(a,t,i)});return}i?B(e,t):Z(e,t)}}var ia=/([a-z\d])([A-Z])/g;function pe(e){return e.replace(ia,"$1-$2").toLowerCase()}function oe(e,t){return ct(e[t])?e[t]:e.dataset?e.dataset[t]:e.getAttribute("data-".concat(pe(t)))}function Ot(e,t,i){ct(i)?e[t]=i:e.dataset?e.dataset[t]=i:e.setAttribute("data-".concat(pe(t)),i)}function aa(e,t){if(ct(e[t]))try{delete e[t]}catch{e[t]=void 0}else if(e.dataset)try{delete e.dataset[t]}catch{e.dataset[t]=void 0}else e.removeAttribute("data-".concat(pe(t)))}var ii=/\s\s*/,ai=(function(){var e=!1;if(_t){var t=!1,i=function(){},a=Object.defineProperty({},"once",{get:function(){return e=!0,t},set:function(r){t=r}});Q.addEventListener("test",i,a),Q.removeEventListener("test",i,a)}return e})();function X(e,t,i){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},s=i;t.trim().split(ii).forEach(function(r){if(!ai){var n=e.listeners;n&&n[r]&&n[r][i]&&(s=n[r][i],delete n[r][i],Object.keys(n[r]).length===0&&delete n[r],Object.keys(n).length===0&&delete e.listeners)}e.removeEventListener(r,s,a)})}function Y(e,t,i){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},s=i;t.trim().split(ii).forEach(function(r){if(a.once&&!ai){var n=e.listeners,o=n===void 0?{}:n;s=function(){delete o[r][i],e.removeEventListener(r,s,a);for(var l=arguments.length,h=new Array(l),c=0;c<l;c++)h[c]=arguments[c];i.apply(e,h)},o[r]||(o[r]={}),o[r][i]&&e.removeEventListener(r,o[r][i],a),o[r][i]=s,e.listeners=o}e.addEventListener(r,s,a)})}function wt(e,t,i){var a;return H(Event)&&H(CustomEvent)?a=new CustomEvent(t,{detail:i,bubbles:!0,cancelable:!0}):(a=document.createEvent("CustomEvent"),a.initCustomEvent(t,!0,!0,i)),e.dispatchEvent(a)}function ri(e){var t=e.getBoundingClientRect();return{left:t.left+(window.pageXOffset-document.documentElement.clientLeft),top:t.top+(window.pageYOffset-document.documentElement.clientTop)}}var Xt=Q.location,ra=/^(\w+:)\/\/([^:/?#]*):?(\d*)/i;function Le(e){var t=e.match(ra);return t!==null&&(t[1]!==Xt.protocol||t[2]!==Xt.hostname||t[3]!==Xt.port)}function Re(e){var t="timestamp=".concat(new Date().getTime());return e+(e.indexOf("?")===-1?"?":"&")+t}function Tt(e){var t=e.rotate,i=e.scaleX,a=e.scaleY,s=e.translateX,r=e.translateY,n=[];D(s)&&s!==0&&n.push("translateX(".concat(s,"px)")),D(r)&&r!==0&&n.push("translateY(".concat(r,"px)")),D(t)&&t!==0&&n.push("rotate(".concat(t,"deg)")),D(i)&&i!==1&&n.push("scaleX(".concat(i,")")),D(a)&&a!==1&&n.push("scaleY(".concat(a,")"));var o=n.length?n.join(" "):"none";return{WebkitTransform:o,msTransform:o,transform:o}}function sa(e){var t=je({},e),i=0;return I(e,function(a,s){delete t[s],I(t,function(r){var n=Math.abs(a.startX-r.startX),o=Math.abs(a.startY-r.startY),p=Math.abs(a.endX-r.endX),l=Math.abs(a.endY-r.endY),h=Math.sqrt(n*n+o*o),c=Math.sqrt(p*p+l*l),f=(c-h)/h;Math.abs(f)>Math.abs(i)&&(i=f)})}),i}function At(e,t){var i=e.pageX,a=e.pageY,s={endX:i,endY:a};return t?s:je({startX:i,startY:a},s)}function na(e){var t=0,i=0,a=0;return I(e,function(s){var r=s.startX,n=s.startY;t+=r,i+=n,a+=1}),t/=a,i/=a,{pageX:t,pageY:i}}function rt(e){var t=e.aspectRatio,i=e.height,a=e.width,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"contain",r=Ie(a),n=Ie(i);if(r&&n){var o=i*t;s==="contain"&&o>a||s==="cover"&&o<a?i=a/t:a=i*t}else r?i=a/t:n&&(a=i*t);return{width:a,height:i}}function oa(e){var t=e.width,i=e.height,a=e.degree;if(a=Math.abs(a)%180,a===90)return{width:i,height:t};var s=a%90*Math.PI/180,r=Math.sin(s),n=Math.cos(s),o=t*n+i*r,p=t*r+i*n;return a>90?{width:p,height:o}:{width:o,height:p}}function la(e,t,i,a){var s=t.aspectRatio,r=t.naturalWidth,n=t.naturalHeight,o=t.rotate,p=o===void 0?0:o,l=t.scaleX,h=l===void 0?1:l,c=t.scaleY,f=c===void 0?1:c,C=i.aspectRatio,x=i.naturalWidth,V=i.naturalHeight,T=a.fillColor,L=T===void 0?"transparent":T,P=a.imageSmoothingEnabled,A=P===void 0?!0:P,K=a.imageSmoothingQuality,W=K===void 0?"low":K,m=a.maxWidth,M=m===void 0?1/0:m,R=a.maxHeight,j=R===void 0?1/0:R,tt=a.minWidth,st=tt===void 0?0:tt,nt=a.minHeight,et=nt===void 0?0:nt,q=document.createElement("canvas"),U=q.getContext("2d"),ot=rt({aspectRatio:C,width:M,height:j}),$t=rt({aspectRatio:C,width:st,height:et},"cover"),Ut=Math.min(ot.width,Math.max($t.width,x)),Ht=Math.min(ot.height,Math.max($t.height,V)),me=rt({aspectRatio:s,width:M,height:j}),ge=rt({aspectRatio:s,width:st,height:et},"cover"),ve=Math.min(me.width,Math.max(ge.width,r)),be=Math.min(me.height,Math.max(ge.height,n)),oi=[-ve/2,-be/2,ve,be];return q.width=bt(Ut),q.height=bt(Ht),U.fillStyle=L,U.fillRect(0,0,Ut,Ht),U.save(),U.translate(Ut/2,Ht/2),U.rotate(p*Math.PI/180),U.scale(h,f),U.imageSmoothingEnabled=A,U.imageSmoothingQuality=W,U.drawImage.apply(U,[e].concat(Xe(oi.map(function(li){return Math.floor(bt(li))})))),U.restore(),q}var si=String.fromCharCode;function ha(e,t,i){var a="";i+=t;for(var s=t;s<i;s+=1)a+=si(e.getUint8(s));return a}var da=/^data:.*,/;function ua(e){var t=e.replace(da,""),i=atob(t),a=new ArrayBuffer(i.length),s=new Uint8Array(a);return I(s,function(r,n){s[n]=i.charCodeAt(n)}),a}function ca(e,t){for(var i=[],a=8192,s=new Uint8Array(e);s.length>0;)i.push(si.apply(null,ei(s.subarray(0,a)))),s=s.subarray(a);return"data:".concat(t,";base64,").concat(btoa(i.join("")))}function fa(e){var t=new DataView(e),i;try{var a,s,r;if(t.getUint8(0)===255&&t.getUint8(1)===216)for(var n=t.byteLength,o=2;o+1<n;){if(t.getUint8(o)===255&&t.getUint8(o+1)===225){s=o;break}o+=1}if(s){var p=s+4,l=s+10;if(ha(t,p,4)==="Exif"){var h=t.getUint16(l);if(a=h===18761,(a||h===19789)&&t.getUint16(l+2,a)===42){var c=t.getUint32(l+4,a);c>=8&&(r=l+c)}}}if(r){var f=t.getUint16(r,a),C,x;for(x=0;x<f;x+=1)if(C=r+x*12+2,t.getUint16(C,a)===274){C+=8,i=t.getUint16(C,a),t.setUint16(C,1,a);break}}}catch{i=1}return i}function pa(e){var t=0,i=1,a=1;switch(e){case 2:i=-1;break;case 3:t=-180;break;case 4:a=-1;break;case 5:t=90,a=-1;break;case 6:t=90;break;case 7:t=90,i=-1;break;case 8:t=-90;break}return{rotate:t,scaleX:i,scaleY:a}}var ma={render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var t=this.element,i=this.options,a=this.container,s=this.cropper,r=Number(i.minContainerWidth),n=Number(i.minContainerHeight);B(s,F),Z(t,F);var o={width:Math.max(a.offsetWidth,r>=0?r:Ke),height:Math.max(a.offsetHeight,n>=0?n:ti)};this.containerData=o,at(s,{width:o.width,height:o.height}),B(t,F),Z(s,F)},initCanvas:function(){var t=this.containerData,i=this.imageData,a=this.options.viewMode,s=Math.abs(i.rotate)%180===90,r=s?i.naturalHeight:i.naturalWidth,n=s?i.naturalWidth:i.naturalHeight,o=r/n,p=t.width,l=t.height;t.height*o>t.width?a===3?p=t.height*o:l=t.width/o:a===3?l=t.width/o:p=t.height*o;var h={aspectRatio:o,naturalWidth:r,naturalHeight:n,width:p,height:l};this.canvasData=h,this.limited=a===1||a===2,this.limitCanvas(!0,!0),h.width=Math.min(Math.max(h.width,h.minWidth),h.maxWidth),h.height=Math.min(Math.max(h.height,h.minHeight),h.maxHeight),h.left=(t.width-h.width)/2,h.top=(t.height-h.height)/2,h.oldLeft=h.left,h.oldTop=h.top,this.initialCanvasData=N({},h)},limitCanvas:function(t,i){var a=this.options,s=this.containerData,r=this.canvasData,n=this.cropBoxData,o=a.viewMode,p=r.aspectRatio,l=this.cropped&&n;if(t){var h=Number(a.minCanvasWidth)||0,c=Number(a.minCanvasHeight)||0;o>1?(h=Math.max(h,s.width),c=Math.max(c,s.height),o===3&&(c*p>h?h=c*p:c=h/p)):o>0&&(h?h=Math.max(h,l?n.width:0):c?c=Math.max(c,l?n.height:0):l&&(h=n.width,c=n.height,c*p>h?h=c*p:c=h/p));var f=rt({aspectRatio:p,width:h,height:c});h=f.width,c=f.height,r.minWidth=h,r.minHeight=c,r.maxWidth=1/0,r.maxHeight=1/0}if(i)if(o>(l?0:1)){var C=s.width-r.width,x=s.height-r.height;r.minLeft=Math.min(0,C),r.minTop=Math.min(0,x),r.maxLeft=Math.max(0,C),r.maxTop=Math.max(0,x),l&&this.limited&&(r.minLeft=Math.min(n.left,n.left+(n.width-r.width)),r.minTop=Math.min(n.top,n.top+(n.height-r.height)),r.maxLeft=n.left,r.maxTop=n.top,o===2&&(r.width>=s.width&&(r.minLeft=Math.min(0,C),r.maxLeft=Math.max(0,C)),r.height>=s.height&&(r.minTop=Math.min(0,x),r.maxTop=Math.max(0,x))))}else r.minLeft=-r.width,r.minTop=-r.height,r.maxLeft=s.width,r.maxTop=s.height},renderCanvas:function(t,i){var a=this.canvasData,s=this.imageData;if(i){var r=oa({width:s.naturalWidth*Math.abs(s.scaleX||1),height:s.naturalHeight*Math.abs(s.scaleY||1),degree:s.rotate||0}),n=r.width,o=r.height,p=a.width*(n/a.naturalWidth),l=a.height*(o/a.naturalHeight);a.left-=(p-a.width)/2,a.top-=(l-a.height)/2,a.width=p,a.height=l,a.aspectRatio=n/o,a.naturalWidth=n,a.naturalHeight=o,this.limitCanvas(!0,!1)}(a.width>a.maxWidth||a.width<a.minWidth)&&(a.left=a.oldLeft),(a.height>a.maxHeight||a.height<a.minHeight)&&(a.top=a.oldTop),a.width=Math.min(Math.max(a.width,a.minWidth),a.maxWidth),a.height=Math.min(Math.max(a.height,a.minHeight),a.maxHeight),this.limitCanvas(!1,!0),a.left=Math.min(Math.max(a.left,a.minLeft),a.maxLeft),a.top=Math.min(Math.max(a.top,a.minTop),a.maxTop),a.oldLeft=a.left,a.oldTop=a.top,at(this.canvas,N({width:a.width,height:a.height},Tt({translateX:a.left,translateY:a.top}))),this.renderImage(t),this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage:function(t){var i=this.canvasData,a=this.imageData,s=a.naturalWidth*(i.width/i.naturalWidth),r=a.naturalHeight*(i.height/i.naturalHeight);N(a,{width:s,height:r,left:(i.width-s)/2,top:(i.height-r)/2}),at(this.image,N({width:a.width,height:a.height},Tt(N({translateX:a.left,translateY:a.top},a)))),t&&this.output()},initCropBox:function(){var t=this.options,i=this.canvasData,a=t.aspectRatio||t.initialAspectRatio,s=Number(t.autoCropArea)||.8,r={width:i.width,height:i.height};a&&(i.height*a>i.width?r.height=r.width/a:r.width=r.height*a),this.cropBoxData=r,this.limitCropBox(!0,!0),r.width=Math.min(Math.max(r.width,r.minWidth),r.maxWidth),r.height=Math.min(Math.max(r.height,r.minHeight),r.maxHeight),r.width=Math.max(r.minWidth,r.width*s),r.height=Math.max(r.minHeight,r.height*s),r.left=i.left+(i.width-r.width)/2,r.top=i.top+(i.height-r.height)/2,r.oldLeft=r.left,r.oldTop=r.top,this.initialCropBoxData=N({},r)},limitCropBox:function(t,i){var a=this.options,s=this.containerData,r=this.canvasData,n=this.cropBoxData,o=this.limited,p=a.aspectRatio;if(t){var l=Number(a.minCropBoxWidth)||0,h=Number(a.minCropBoxHeight)||0,c=o?Math.min(s.width,r.width,r.width+r.left,s.width-r.left):s.width,f=o?Math.min(s.height,r.height,r.height+r.top,s.height-r.top):s.height;l=Math.min(l,s.width),h=Math.min(h,s.height),p&&(l&&h?h*p>l?h=l/p:l=h*p:l?h=l/p:h&&(l=h*p),f*p>c?f=c/p:c=f*p),n.minWidth=Math.min(l,c),n.minHeight=Math.min(h,f),n.maxWidth=c,n.maxHeight=f}i&&(o?(n.minLeft=Math.max(0,r.left),n.minTop=Math.max(0,r.top),n.maxLeft=Math.min(s.width,r.left+r.width)-n.width,n.maxTop=Math.min(s.height,r.top+r.height)-n.height):(n.minLeft=0,n.minTop=0,n.maxLeft=s.width-n.width,n.maxTop=s.height-n.height))},renderCropBox:function(){var t=this.options,i=this.containerData,a=this.cropBoxData;(a.width>a.maxWidth||a.width<a.minWidth)&&(a.left=a.oldLeft),(a.height>a.maxHeight||a.height<a.minHeight)&&(a.top=a.oldTop),a.width=Math.min(Math.max(a.width,a.minWidth),a.maxWidth),a.height=Math.min(Math.max(a.height,a.minHeight),a.maxHeight),this.limitCropBox(!1,!0),a.left=Math.min(Math.max(a.left,a.minLeft),a.maxLeft),a.top=Math.min(Math.max(a.top,a.minTop),a.maxTop),a.oldLeft=a.left,a.oldTop=a.top,t.movable&&t.cropBoxMovable&&Ot(this.face,Mt,a.width>=i.width&&a.height>=i.height?Ge:ce),at(this.cropBox,N({width:a.width,height:a.height},Tt({translateX:a.left,translateY:a.top}))),this.cropped&&this.limited&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),wt(this.element,ie,this.getData())}},ga={initPreview:function(){var t=this.element,i=this.crossOrigin,a=this.options.preview,s=i?this.crossOriginUrl:this.url,r=t.alt||"The image to preview",n=document.createElement("img");if(i&&(n.crossOrigin=i),n.src=s,n.alt=r,this.viewBox.appendChild(n),this.viewBoxImage=n,!!a){var o=a;typeof a=="string"?o=t.ownerDocument.querySelectorAll(a):a.querySelector&&(o=[a]),this.previews=o,I(o,function(p){var l=document.createElement("img");Ot(p,Nt,{width:p.offsetWidth,height:p.offsetHeight,html:p.innerHTML}),i&&(l.crossOrigin=i),l.src=s,l.alt=r,l.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"',p.innerHTML="",p.appendChild(l)})}},resetPreview:function(){I(this.previews,function(t){var i=oe(t,Nt);at(t,{width:i.width,height:i.height}),t.innerHTML=i.html,aa(t,Nt)})},preview:function(){var t=this.imageData,i=this.canvasData,a=this.cropBoxData,s=a.width,r=a.height,n=t.width,o=t.height,p=a.left-i.left-t.left,l=a.top-i.top-t.top;!this.cropped||this.disabled||(at(this.viewBoxImage,N({width:n,height:o},Tt(N({translateX:-p,translateY:-l},t)))),I(this.previews,function(h){var c=oe(h,Nt),f=c.width,C=c.height,x=f,V=C,T=1;s&&(T=f/s,V=r*T),r&&V>C&&(T=C/r,x=s*T,V=C),at(h,{width:x,height:V}),at(h.getElementsByTagName("img")[0],N({width:n*T,height:o*T},Tt(N({translateX:-p*T,translateY:-l*T},t))))}))}},va={bind:function(){var t=this.element,i=this.options,a=this.cropper;H(i.cropstart)&&Y(t,se,i.cropstart),H(i.cropmove)&&Y(t,re,i.cropmove),H(i.cropend)&&Y(t,ae,i.cropend),H(i.crop)&&Y(t,ie,i.crop),H(i.zoom)&&Y(t,ne,i.zoom),Y(a,Te,this.onCropStart=this.cropStart.bind(this)),i.zoomable&&i.zoomOnWheel&&Y(a,Se,this.onWheel=this.wheel.bind(this),{passive:!1,capture:!0}),i.toggleDragModeOnDblclick&&Y(a,Ee,this.onDblclick=this.dblclick.bind(this)),Y(t.ownerDocument,Me,this.onCropMove=this.cropMove.bind(this)),Y(t.ownerDocument,Oe,this.onCropEnd=this.cropEnd.bind(this)),i.responsive&&Y(window,$e,this.onResize=this.resize.bind(this))},unbind:function(){var t=this.element,i=this.options,a=this.cropper;H(i.cropstart)&&X(t,se,i.cropstart),H(i.cropmove)&&X(t,re,i.cropmove),H(i.cropend)&&X(t,ae,i.cropend),H(i.crop)&&X(t,ie,i.crop),H(i.zoom)&&X(t,ne,i.zoom),X(a,Te,this.onCropStart),i.zoomable&&i.zoomOnWheel&&X(a,Se,this.onWheel,{passive:!1,capture:!0}),i.toggleDragModeOnDblclick&&X(a,Ee,this.onDblclick),X(t.ownerDocument,Me,this.onCropMove),X(t.ownerDocument,Oe,this.onCropEnd),i.responsive&&X(window,$e,this.onResize)}},ba={resize:function(){if(!this.disabled){var t=this.options,i=this.container,a=this.containerData,s=i.offsetWidth/a.width,r=i.offsetHeight/a.height,n=Math.abs(s-1)>Math.abs(r-1)?s:r;if(n!==1){var o,p;t.restore&&(o=this.getCanvasData(),p=this.getCropBoxData()),this.render(),t.restore&&(this.setCanvasData(I(o,function(l,h){o[h]=l*n})),this.setCropBoxData(I(p,function(l,h){p[h]=l*n})))}}},dblclick:function(){this.disabled||this.options.dragMode===Qe||this.setDragMode(ea(this.dragBox,te)?Ze:fe)},wheel:function(t){var i=this,a=Number(this.options.wheelZoomRatio)||.1,s=1;this.disabled||(t.preventDefault(),!this.wheeling&&(this.wheeling=!0,setTimeout(function(){i.wheeling=!1},50),t.deltaY?s=t.deltaY>0?1:-1:t.wheelDelta?s=-t.wheelDelta/120:t.detail&&(s=t.detail>0?1:-1),this.zoom(-s*a,t)))},cropStart:function(t){var i=t.buttons,a=t.button;if(!(this.disabled||(t.type==="mousedown"||t.type==="pointerdown"&&t.pointerType==="mouse")&&(D(i)&&i!==1||D(a)&&a!==0||t.ctrlKey))){var s=this.options,r=this.pointers,n;t.changedTouches?I(t.changedTouches,function(o){r[o.identifier]=At(o)}):r[t.pointerId||0]=At(t),Object.keys(r).length>1&&s.zoomable&&s.zoomOnTouch?n=Je:n=oe(t.target,Mt),ji.test(n)&&wt(this.element,se,{originalEvent:t,action:n})!==!1&&(t.preventDefault(),this.action=n,this.cropping=!1,n===qe&&(this.cropping=!0,B(this.dragBox,Rt)))}},cropMove:function(t){var i=this.action;if(!(this.disabled||!i)){var a=this.pointers;t.preventDefault(),wt(this.element,re,{originalEvent:t,action:i})!==!1&&(t.changedTouches?I(t.changedTouches,function(s){N(a[s.identifier]||{},At(s,!0))}):N(a[t.pointerId||0]||{},At(t,!0)),this.change(t))}},cropEnd:function(t){if(!this.disabled){var i=this.action,a=this.pointers;t.changedTouches?I(t.changedTouches,function(s){delete a[s.identifier]}):delete a[t.pointerId||0],i&&(t.preventDefault(),Object.keys(a).length||(this.action=""),this.cropping&&(this.cropping=!1,gt(this.dragBox,Rt,this.cropped&&this.options.modal)),wt(this.element,ae,{originalEvent:t,action:i}))}}},wa={change:function(t){var i=this.options,a=this.canvasData,s=this.containerData,r=this.cropBoxData,n=this.pointers,o=this.action,p=i.aspectRatio,l=r.left,h=r.top,c=r.width,f=r.height,C=l+c,x=h+f,V=0,T=0,L=s.width,P=s.height,A=!0,K;!p&&t.shiftKey&&(p=c&&f?c/f:1),this.limited&&(V=r.minLeft,T=r.minTop,L=V+Math.min(s.width,a.width,a.left+a.width),P=T+Math.min(s.height,a.height,a.top+a.height));var W=n[Object.keys(n)[0]],m={x:W.endX-W.startX,y:W.endY-W.startY},M=function(j){switch(j){case lt:C+m.x>L&&(m.x=L-C);break;case ht:l+m.x<V&&(m.x=V-l);break;case it:h+m.y<T&&(m.y=T-h);break;case ft:x+m.y>P&&(m.y=P-x);break}};switch(o){case ce:l+=m.x,h+=m.y;break;case lt:if(m.x>=0&&(C>=L||p&&(h<=T||x>=P))){A=!1;break}M(lt),c+=m.x,c<0&&(o=ht,c=-c,l-=c),p&&(f=c/p,h+=(r.height-f)/2);break;case it:if(m.y<=0&&(h<=T||p&&(l<=V||C>=L))){A=!1;break}M(it),f-=m.y,h+=m.y,f<0&&(o=ft,f=-f,h-=f),p&&(c=f*p,l+=(r.width-c)/2);break;case ht:if(m.x<=0&&(l<=V||p&&(h<=T||x>=P))){A=!1;break}M(ht),c-=m.x,l+=m.x,c<0&&(o=lt,c=-c,l-=c),p&&(f=c/p,h+=(r.height-f)/2);break;case ft:if(m.y>=0&&(x>=P||p&&(l<=V||C>=L))){A=!1;break}M(ft),f+=m.y,f<0&&(o=it,f=-f,h-=f),p&&(c=f*p,l+=(r.width-c)/2);break;case xt:if(p){if(m.y<=0&&(h<=T||C>=L)){A=!1;break}M(it),f-=m.y,h+=m.y,c=f*p}else M(it),M(lt),m.x>=0?C<L?c+=m.x:m.y<=0&&h<=T&&(A=!1):c+=m.x,m.y<=0?h>T&&(f-=m.y,h+=m.y):(f-=m.y,h+=m.y);c<0&&f<0?(o=kt,f=-f,c=-c,h-=f,l-=c):c<0?(o=Ct,c=-c,l-=c):f<0&&(o=Dt,f=-f,h-=f);break;case Ct:if(p){if(m.y<=0&&(h<=T||l<=V)){A=!1;break}M(it),f-=m.y,h+=m.y,c=f*p,l+=r.width-c}else M(it),M(ht),m.x<=0?l>V?(c-=m.x,l+=m.x):m.y<=0&&h<=T&&(A=!1):(c-=m.x,l+=m.x),m.y<=0?h>T&&(f-=m.y,h+=m.y):(f-=m.y,h+=m.y);c<0&&f<0?(o=Dt,f=-f,c=-c,h-=f,l-=c):c<0?(o=xt,c=-c,l-=c):f<0&&(o=kt,f=-f,h-=f);break;case kt:if(p){if(m.x<=0&&(l<=V||x>=P)){A=!1;break}M(ht),c-=m.x,l+=m.x,f=c/p}else M(ft),M(ht),m.x<=0?l>V?(c-=m.x,l+=m.x):m.y>=0&&x>=P&&(A=!1):(c-=m.x,l+=m.x),m.y>=0?x<P&&(f+=m.y):f+=m.y;c<0&&f<0?(o=xt,f=-f,c=-c,h-=f,l-=c):c<0?(o=Dt,c=-c,l-=c):f<0&&(o=Ct,f=-f,h-=f);break;case Dt:if(p){if(m.x>=0&&(C>=L||x>=P)){A=!1;break}M(lt),c+=m.x,f=c/p}else M(ft),M(lt),m.x>=0?C<L?c+=m.x:m.y>=0&&x>=P&&(A=!1):c+=m.x,m.y>=0?x<P&&(f+=m.y):f+=m.y;c<0&&f<0?(o=Ct,f=-f,c=-c,h-=f,l-=c):c<0?(o=kt,c=-c,l-=c):f<0&&(o=xt,f=-f,h-=f);break;case Ge:this.move(m.x,m.y),A=!1;break;case Je:this.zoom(sa(n),t),A=!1;break;case qe:if(!m.x||!m.y){A=!1;break}K=ri(this.cropper),l=W.startX-K.left,h=W.startY-K.top,c=r.minWidth,f=r.minHeight,m.x>0?o=m.y>0?Dt:xt:m.x<0&&(l-=c,o=m.y>0?kt:Ct),m.y<0&&(h-=f),this.cropped||(Z(this.cropBox,F),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0));break}A&&(r.width=c,r.height=f,r.left=l,r.top=h,this.action=o,this.renderCropBox()),I(n,function(R){R.startX=R.endX,R.startY=R.endY})}},ya={crop:function(){return this.ready&&!this.cropped&&!this.disabled&&(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&B(this.dragBox,Rt),Z(this.cropBox,F),this.setCropBoxData(this.initialCropBoxData)),this},reset:function(){return this.ready&&!this.disabled&&(this.imageData=N({},this.initialImageData),this.canvasData=N({},this.initialCanvasData),this.cropBoxData=N({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox()),this},clear:function(){return this.cropped&&!this.disabled&&(N(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),Z(this.dragBox,Rt),B(this.cropBox,F)),this},replace:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return!this.disabled&&t&&(this.isImg&&(this.element.src=t),i?(this.url=t,this.image.src=t,this.ready&&(this.viewBoxImage.src=t,I(this.previews,function(a){a.getElementsByTagName("img")[0].src=t}))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.uncreate(),this.load(t))),this},enable:function(){return this.ready&&this.disabled&&(this.disabled=!1,Z(this.cropper,De)),this},disable:function(){return this.ready&&!this.disabled&&(this.disabled=!0,B(this.cropper,De)),this},destroy:function(){var t=this.element;return t[S]?(t[S]=void 0,this.isImg&&this.replaced&&(t.src=this.originalUrl),this.uncreate(),this):this},move:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,a=this.canvasData,s=a.left,r=a.top;return this.moveTo(Yt(t)?t:s+Number(t),Yt(i)?i:r+Number(i))},moveTo:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,a=this.canvasData,s=!1;return t=Number(t),i=Number(i),this.ready&&!this.disabled&&this.options.movable&&(D(t)&&(a.left=t,s=!0),D(i)&&(a.top=i,s=!0),s&&this.renderCanvas(!0)),this},zoom:function(t,i){var a=this.canvasData;return t=Number(t),t<0?t=1/(1-t):t=1+t,this.zoomTo(a.width*t/a.naturalWidth,null,i)},zoomTo:function(t,i,a){var s=this.options,r=this.canvasData,n=r.width,o=r.height,p=r.naturalWidth,l=r.naturalHeight;if(t=Number(t),t>=0&&this.ready&&!this.disabled&&s.zoomable){var h=p*t,c=l*t;if(wt(this.element,ne,{ratio:t,oldRatio:n/p,originalEvent:a})===!1)return this;if(a){var f=this.pointers,C=ri(this.cropper),x=f&&Object.keys(f).length?na(f):{pageX:a.pageX,pageY:a.pageY};r.left-=(h-n)*((x.pageX-C.left-r.left)/n),r.top-=(c-o)*((x.pageY-C.top-r.top)/o)}else mt(i)&&D(i.x)&&D(i.y)?(r.left-=(h-n)*((i.x-r.left)/n),r.top-=(c-o)*((i.y-r.top)/o)):(r.left-=(h-n)/2,r.top-=(c-o)/2);r.width=h,r.height=c,this.renderCanvas(!0)}return this},rotate:function(t){return this.rotateTo((this.imageData.rotate||0)+Number(t))},rotateTo:function(t){return t=Number(t),D(t)&&this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=t%360,this.renderCanvas(!0,!0)),this},scaleX:function(t){var i=this.imageData.scaleY;return this.scale(t,D(i)?i:1)},scaleY:function(t){var i=this.imageData.scaleX;return this.scale(D(i)?i:1,t)},scale:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,a=this.imageData,s=!1;return t=Number(t),i=Number(i),this.ready&&!this.disabled&&this.options.scalable&&(D(t)&&(a.scaleX=t,s=!0),D(i)&&(a.scaleY=i,s=!0),s&&this.renderCanvas(!0,!0)),this},getData:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,i=this.options,a=this.imageData,s=this.canvasData,r=this.cropBoxData,n;if(this.ready&&this.cropped){n={x:r.left-s.left,y:r.top-s.top,width:r.width,height:r.height};var o=a.width/a.naturalWidth;if(I(n,function(h,c){n[c]=h/o}),t){var p=Math.round(n.y+n.height),l=Math.round(n.x+n.width);n.x=Math.round(n.x),n.y=Math.round(n.y),n.width=l-n.x,n.height=p-n.y}}else n={x:0,y:0,width:0,height:0};return i.rotatable&&(n.rotate=a.rotate||0),i.scalable&&(n.scaleX=a.scaleX||1,n.scaleY=a.scaleY||1),n},setData:function(t){var i=this.options,a=this.imageData,s=this.canvasData,r={};if(this.ready&&!this.disabled&&mt(t)){var n=!1;i.rotatable&&D(t.rotate)&&t.rotate!==a.rotate&&(a.rotate=t.rotate,n=!0),i.scalable&&(D(t.scaleX)&&t.scaleX!==a.scaleX&&(a.scaleX=t.scaleX,n=!0),D(t.scaleY)&&t.scaleY!==a.scaleY&&(a.scaleY=t.scaleY,n=!0)),n&&this.renderCanvas(!0,!0);var o=a.width/a.naturalWidth;D(t.x)&&(r.left=t.x*o+s.left),D(t.y)&&(r.top=t.y*o+s.top),D(t.width)&&(r.width=t.width*o),D(t.height)&&(r.height=t.height*o),this.setCropBoxData(r)}return this},getContainerData:function(){return this.ready?N({},this.containerData):{}},getImageData:function(){return this.sized?N({},this.imageData):{}},getCanvasData:function(){var t=this.canvasData,i={};return this.ready&&I(["left","top","width","height","naturalWidth","naturalHeight"],function(a){i[a]=t[a]}),i},setCanvasData:function(t){var i=this.canvasData,a=i.aspectRatio;return this.ready&&!this.disabled&&mt(t)&&(D(t.left)&&(i.left=t.left),D(t.top)&&(i.top=t.top),D(t.width)?(i.width=t.width,i.height=t.width/a):D(t.height)&&(i.height=t.height,i.width=t.height*a),this.renderCanvas(!0)),this},getCropBoxData:function(){var t=this.cropBoxData,i;return this.ready&&this.cropped&&(i={left:t.left,top:t.top,width:t.width,height:t.height}),i||{}},setCropBoxData:function(t){var i=this.cropBoxData,a=this.options.aspectRatio,s,r;return this.ready&&this.cropped&&!this.disabled&&mt(t)&&(D(t.left)&&(i.left=t.left),D(t.top)&&(i.top=t.top),D(t.width)&&t.width!==i.width&&(s=!0,i.width=t.width),D(t.height)&&t.height!==i.height&&(r=!0,i.height=t.height),a&&(s?i.height=i.width/a:r&&(i.width=i.height*a)),this.renderCropBox()),this},getCroppedCanvas:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!this.ready||!window.HTMLCanvasElement)return null;var i=this.canvasData,a=la(this.image,this.imageData,i,t);if(!this.cropped)return a;var s=this.getData(t.rounded),r=s.x,n=s.y,o=s.width,p=s.height,l=a.width/Math.floor(i.naturalWidth);l!==1&&(r*=l,n*=l,o*=l,p*=l);var h=o/p,c=rt({aspectRatio:h,width:t.maxWidth||1/0,height:t.maxHeight||1/0}),f=rt({aspectRatio:h,width:t.minWidth||0,height:t.minHeight||0},"cover"),C=rt({aspectRatio:h,width:t.width||(l!==1?a.width:o),height:t.height||(l!==1?a.height:p)}),x=C.width,V=C.height;x=Math.min(c.width,Math.max(f.width,x)),V=Math.min(c.height,Math.max(f.height,V));var T=document.createElement("canvas"),L=T.getContext("2d");T.width=bt(x),T.height=bt(V),L.fillStyle=t.fillColor||"transparent",L.fillRect(0,0,x,V);var P=t.imageSmoothingEnabled,A=P===void 0?!0:P,K=t.imageSmoothingQuality;L.imageSmoothingEnabled=A,K&&(L.imageSmoothingQuality=K);var W=a.width,m=a.height,M=r,R=n,j,tt,st,nt,et,q;M<=-o||M>W?(M=0,j=0,st=0,et=0):M<=0?(st=-M,M=0,j=Math.min(W,o+M),et=j):M<=W&&(st=0,j=Math.min(o,W-M),et=j),j<=0||R<=-p||R>m?(R=0,tt=0,nt=0,q=0):R<=0?(nt=-R,R=0,tt=Math.min(m,p+R),q=tt):R<=m&&(nt=0,tt=Math.min(p,m-R),q=tt);var U=[M,R,j,tt];if(et>0&&q>0){var ot=x/o;U.push(st*ot,nt*ot,et*ot,q*ot)}return L.drawImage.apply(L,[a].concat(Xe(U.map(function($t){return Math.floor(bt($t))})))),T},setAspectRatio:function(t){var i=this.options;return!this.disabled&&!Yt(t)&&(i.aspectRatio=Math.max(0,t)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox())),this},setDragMode:function(t){var i=this.options,a=this.dragBox,s=this.face;if(this.ready&&!this.disabled){var r=t===fe,n=i.movable&&t===Ze;t=r||n?t:Qe,i.dragMode=t,Ot(a,Mt,t),gt(a,te,r),gt(a,ee,n),i.cropBoxMovable||(Ot(s,Mt,t),gt(s,te,r),gt(s,ee,n))}return this}},xa=Q.Cropper,ni=(function(){function e(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Ii(this,e),!t||!qi.test(t.tagName))throw new Error("The first argument is required and must be an <img> or <canvas> element.");this.element=t,this.options=N({},Ae,mt(i)&&i),this.cropped=!1,this.disabled=!1,this.pointers={},this.ready=!1,this.reloading=!1,this.replaced=!1,this.sized=!1,this.sizing=!1,this.init()}return Li(e,[{key:"init",value:function(){var i=this.element,a=i.tagName.toLowerCase(),s;if(!i[S]){if(i[S]=this,a==="img"){if(this.isImg=!0,s=i.getAttribute("src")||"",this.originalUrl=s,!s)return;s=i.src}else a==="canvas"&&window.HTMLCanvasElement&&(s=i.toDataURL());this.load(s)}}},{key:"load",value:function(i){var a=this;if(i){this.url=i,this.imageData={};var s=this.element,r=this.options;if(!r.rotatable&&!r.scalable&&(r.checkOrientation=!1),!r.checkOrientation||!window.ArrayBuffer){this.clone();return}if(Yi.test(i)){Xi.test(i)?this.read(ua(i)):this.clone();return}var n=new XMLHttpRequest,o=this.clone.bind(this);this.reloading=!0,this.xhr=n,n.onabort=o,n.onerror=o,n.ontimeout=o,n.onprogress=function(){n.getResponseHeader("content-type")!==Ne&&n.abort()},n.onload=function(){a.read(n.response)},n.onloadend=function(){a.reloading=!1,a.xhr=null},r.checkCrossOrigin&&Le(i)&&s.crossOrigin&&(i=Re(i)),n.open("GET",i,!0),n.responseType="arraybuffer",n.withCredentials=s.crossOrigin==="use-credentials",n.send()}}},{key:"read",value:function(i){var a=this.options,s=this.imageData,r=fa(i),n=0,o=1,p=1;if(r>1){this.url=ca(i,Ne);var l=pa(r);n=l.rotate,o=l.scaleX,p=l.scaleY}a.rotatable&&(s.rotate=n),a.scalable&&(s.scaleX=o,s.scaleY=p),this.clone()}},{key:"clone",value:function(){var i=this.element,a=this.url,s=i.crossOrigin,r=a;this.options.checkCrossOrigin&&Le(a)&&(s||(s="anonymous"),r=Re(a)),this.crossOrigin=s,this.crossOriginUrl=r;var n=document.createElement("img");s&&(n.crossOrigin=s),n.src=r||a,n.alt=i.alt||"The image to crop",this.image=n,n.onload=this.start.bind(this),n.onerror=this.stop.bind(this),B(n,ke),i.parentNode.insertBefore(n,i.nextSibling)}},{key:"start",value:function(){var i=this,a=this.image;a.onload=null,a.onerror=null,this.sizing=!0;var s=Q.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(Q.navigator.userAgent),r=function(l,h){N(i.imageData,{naturalWidth:l,naturalHeight:h,aspectRatio:l/h}),i.initialImageData=N({},i.imageData),i.sizing=!1,i.sized=!0,i.build()};if(a.naturalWidth&&!s){r(a.naturalWidth,a.naturalHeight);return}var n=document.createElement("img"),o=document.body||document.documentElement;this.sizingImage=n,n.onload=function(){r(n.width,n.height),s||o.removeChild(n)},n.src=a.src,s||(n.style.cssText="left:0;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;opacity:0;position:absolute;top:0;z-index:-1;",o.appendChild(n))}},{key:"stop",value:function(){var i=this.image;i.onload=null,i.onerror=null,i.parentNode.removeChild(i),this.image=null}},{key:"build",value:function(){if(!(!this.sized||this.ready)){var i=this.element,a=this.options,s=this.image,r=i.parentNode,n=document.createElement("div");n.innerHTML=Gi;var o=n.querySelector(".".concat(S,"-container")),p=o.querySelector(".".concat(S,"-canvas")),l=o.querySelector(".".concat(S,"-drag-box")),h=o.querySelector(".".concat(S,"-crop-box")),c=h.querySelector(".".concat(S,"-face"));this.container=r,this.cropper=o,this.canvas=p,this.dragBox=l,this.cropBox=h,this.viewBox=o.querySelector(".".concat(S,"-view-box")),this.face=c,p.appendChild(s),B(i,F),r.insertBefore(o,i.nextSibling),Z(s,ke),this.initPreview(),this.bind(),a.initialAspectRatio=Math.max(0,a.initialAspectRatio)||NaN,a.aspectRatio=Math.max(0,a.aspectRatio)||NaN,a.viewMode=Math.max(0,Math.min(3,Math.round(a.viewMode)))||0,B(h,F),a.guides||B(h.getElementsByClassName("".concat(S,"-dashed")),F),a.center||B(h.getElementsByClassName("".concat(S,"-center")),F),a.background&&B(o,"".concat(S,"-bg")),a.highlight||B(c,Hi),a.cropBoxMovable&&(B(c,ee),Ot(c,Mt,ce)),a.cropBoxResizable||(B(h.getElementsByClassName("".concat(S,"-line")),F),B(h.getElementsByClassName("".concat(S,"-point")),F)),this.render(),this.ready=!0,this.setDragMode(a.dragMode),a.autoCrop&&this.crop(),this.setData(a.data),H(a.ready)&&Y(i,Ve,a.ready,{once:!0}),wt(i,Ve)}}},{key:"unbuild",value:function(){if(this.ready){this.ready=!1,this.unbind(),this.resetPreview();var i=this.cropper.parentNode;i&&i.removeChild(this.cropper),Z(this.element,F)}}},{key:"uncreate",value:function(){this.ready?(this.unbuild(),this.ready=!1,this.cropped=!1):this.sizing?(this.sizingImage.onload=null,this.sizing=!1,this.sized=!1):this.reloading?(this.xhr.onabort=null,this.xhr.abort()):this.image&&this.stop()}}],[{key:"noConflict",value:function(){return window.Cropper=xa,e}},{key:"setDefaults",value:function(i){N(Ae,mt(i)&&i)}}])})();N(ni.prototype,ma,ga,va,ba,wa,ya);const Ca={props:{grid:{type:Boolean,default:!1},embed:{type:Boolean,default:!1},filter:{type:Object,default:()=>({})}},emits:["select"],inject:["debounce","url","srcset"],data(){return{items:[],menu:[],term:"",sort:{column:"ID",order:"DESC"},page:1,last:1,limit:100,checked:!1,loading:!0,vgrid:!1}},setup(){const e=Bt(),t=Pt();return{app:le(),auth:t,messages:e}},created(){this.searchd=this.debounce(this.search,500),this.vgrid=this.grid,this.search()},computed:{canTrash(){return this.items.some(e=>e._checked&&!e.deleted_at)},isChecked(){return this.items.some(e=>e._checked)},isTrashed(){return this.items.some(e=>e._checked&&e.deleted_at)},order(){var e,t,i,a;return((e=this.sort)==null?void 0:e.column)==="ID"?((t=this.sort)==null?void 0:t.order)==="DESC"?this.$gettext("latest"):this.$gettext("oldest"):((i=this.sort)==null?void 0:i.column)==="BYVERSIONS_COUNT"?this.$gettext("usage"):((a=this.sort)==null?void 0:a.column)||""}},methods:{add(e){if(this.embed||!this.auth.can("file:add")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=[],i=e.target.files||e.dataTransfer.files||[];if(i.length)return Array.from(i).forEach(a=>{t.push(this.$apollo.mutate({mutation:_`mutation($file: Upload!) {
              addFile(file: $file) {
                id
                lang
                mime
                name
                path
                previews
                description
                transcription
                editor
                created_at
                updated_at
                deleted_at
              }
            }`,variables:{file:a},context:{hasUpload:!0}}).then(s=>{var n;if(s.errors)throw s.errors;const r=((n=s.data)==null?void 0:n.addFile)||{};return r.previews=JSON.parse(r.previews)||{},r.description=JSON.parse(r.description)||{},r.transcription=JSON.parse(r.transcription)||{},r.published=!0,this.items.unshift(r),this.$emit("select",r),r}).catch(s=>{this.messages.add(this.$gettext("Error adding file %{path}",{path:a.name})+`:
`+s,"error"),this.$log("FileListItems::add(): Error adding file",e,s)}))}),Promise.all(t).then(()=>{this.invalidate()})},drop(e){if(!this.auth.can("file:drop")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.items.filter(i=>i._checked);t.length&&this.$apollo.mutate({mutation:_`
            mutation($id: [ID!]!) {
              dropFile(id: $id) {
                id
              }
            }
          `,variables:{id:t.map(i=>i.id)}}).then(i=>{if(i.errors)throw i.errors;this.invalidate(),this.search()}).catch(i=>{this.messages.add(this.$gettext("Error trashing file")+`:
`+i,"error"),this.$log("FileListItems::drop(): Error trashing file",e,i)})},invalidate(){const e=this.$apollo.provider.defaultClient.cache;e.evict({id:"ROOT_QUERY",fieldName:"files"}),e.gc()},keep(e){if(!this.auth.can("file:keep")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.items.filter(i=>i._checked);t.length&&this.$apollo.mutate({mutation:_`
            mutation($id: [ID!]!) {
              keepFile(id: $id) {
                id
              }
            }
          `,variables:{id:t.map(i=>i.id)}}).then(i=>{if(i.errors)throw i.errors;t.forEach(a=>{a.deleted_at=null}),this.invalidate(),this.search()}).catch(i=>{this.messages.add(this.$gettext("Error restoring file")+`:
`+i,"error"),this.$log("FileListItems::keep(): Error restoring file",e,i)})},publish(e){if(!this.auth.can("file:publish")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.items.filter(i=>i._checked&&i.id&&!i.published);t.length&&this.$apollo.mutate({mutation:_`mutation ($id: [ID!]!) {
            pubFile(id: $id) {
              id
            }
          }`,variables:{id:t.map(i=>i.id)}}).then(i=>{if(i.errors)throw i.errors;t.forEach(a=>{a.published=!0,a._checked=!1}),this.invalidate(),this.search()}).catch(i=>{this.messages.add(this.$gettext("Error publishing file")+`:
`+i,"error"),this.$log("FileListItems::publish(): Error publishing file",e,i)})},purge(e){if(!this.auth.can("file:purge")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.items.filter(i=>i._checked);t.length&&this.$apollo.mutate({mutation:_`
            mutation($id: [ID!]!) {
              purgeFile(id: $id) {
                id
              }
            }
          `,variables:{id:t.map(i=>i.id)}}).then(i=>{if(i.errors)throw i.errors;this.invalidate(),this.search()}).catch(i=>{this.messages.add(this.$gettext("Error purging file")+`:
`+i,"error"),this.$log("FileListItems::purge(): Error purging file",e,i)})},search(){if(!this.auth.can("file:view"))return this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve([]);const e=this.filter.publish||null,t=this.filter.trashed||"WITHOUT",i={...this.filter};return delete i.trashed,delete i.publish,this.term&&(i.any=this.term),this.loading=!0,this.$apollo.query({query:_`
            query($filter: FileFilter, $sort: [QueryFilesSortOrderByClause!], $limit: Int!, $page: Int!, $trashed: Trashed, $publish: Publish) {
              files(filter: $filter, sort: $sort, first: $limit, page: $page, trashed: $trashed, publish: $publish) {
                data {
                  id
                  lang
                  name
                  mime
                  path
                  previews
                  description
                  transcription
                  editor
                  created_at
                  updated_at
                  deleted_at
                  latest {
                    id
                    published
                    publish_at
                    data
                    editor
                    created_at
                  }
                  byversions_count
                }
                paginatorInfo {
                  lastPage
                }
              }
            }
          `,variables:{filter:i,page:this.page,limit:this.limit,sort:[this.sort],trashed:t,publish:e}}).then(a=>{var n;if(a.errors)throw a.errors;const s=a.data.files||{},r=["previews","description","transcription"];return this.last=((n=s.paginatorInfo)==null?void 0:n.lastPage)||1,this.items=[...s.data||[]].map(o=>{var l,h,c,f,C,x;const p=(l=o.latest)!=null&&l.data?JSON.parse((h=o.latest)==null?void 0:h.data):{...o,previews:JSON.parse(o.previews||"{}"),description:JSON.parse(o.description||"{}"),transcription:JSON.parse(o.transcription||"{}")};return r.forEach(V=>p[V]??(p[V]={})),Object.assign(p,{id:o.id,deleted_at:o.deleted_at,created_at:o.created_at,updated_at:((c=o.latest)==null?void 0:c.created_at)||o.updated_at,editor:((f=o.latest)==null?void 0:f.editor)||o.editor,published:((C=o.latest)==null?void 0:C.published)??!0,publish_at:((x=o.latest)==null?void 0:x.publish_at)||null,latest:o.latest,usage:o.byversions_count})}),this.checked=!1,this.loading=!1,this.items}).catch(a=>{this.messages.add(this.$gettext("Error fetching files")+`:
`+a,"error"),this.$log("FileListItems::search(): Error fetching files",a)})},title(e){const t=[];return e.publish_at&&t.push("Publish at: "+new Date(e.publish_at).toLocaleDateString()),t.join(`
`)},toggle(){this.items.forEach(e=>{e._checked=!e._checked})}},watch:{filter:{deep:!0,handler(){this.search()}},term(){this.searchd()},page(){this.search()},sort(){this.search()}}},Da={class:"header"},ka={class:"bulk"},Ea={class:"search"},Ta={class:"layout"},Ma=["onClick","title"],Oa=["onClick","title"],Va={key:2,viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},$a={key:3,fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Sa={key:4,width:"24",height:"24",viewBox:"0 0 16 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},Na=["onClick","title"],Aa={class:"item-text"},Ia={class:"item-head"},La={key:0,class:"item-lang"},Ra={class:"item-title"},Pa={class:"item-mime item-subtitle"},Ba={class:"item-aux"},_a={class:"item-editor"},Ua={class:"item-modified item-subtitle"},Ha={key:0,class:"loading"},Fa={key:1,class:"notfound"},Wa={key:3,class:"btn-group"};function za(e,t,i,a,s,r){return v(),E(z,null,[g("div",Da,[g("div",ka,[d(we,{modelValue:s.checked,"onUpdate:modelValue":t[0]||(t[0]=n=>s.checked=n),onClick:t[1]||(t[1]=qt(n=>r.toggle(),["stop"]))},null,8,["modelValue"]),d(Gt,null,{activator:u(({props:n})=>[d(w,Et(n,{disabled:!r.isChecked&&(i.embed||!a.auth.can("file:add")),"append-icon":"mdi-menu-down",variant:"text"}),{default:u(()=>[y(b(e.$gettext("Actions")),1)]),_:1},16,["disabled"])]),default:u(()=>[d(dt,null,{default:u(()=>[!i.embed&&a.auth.can("file:add")?(v(),k($,{key:0},{default:u(()=>[d(w,{"prepend-icon":"mdi-folder-plus",variant:"text",onClick:t[2]||(t[2]=n=>e.$refs.upload.click())},{default:u(()=>[y(b(e.$gettext("Add files")),1)]),_:1})]),_:1})):O("",!0),r.isChecked&&a.auth.can("file:publish")?(v(),k($,{key:1},{default:u(()=>[d(w,{"prepend-icon":"mdi-publish",variant:"text",onClick:t[3]||(t[3]=n=>r.publish())},{default:u(()=>[y(b(e.$gettext("Publish")),1)]),_:1})]),_:1})):O("",!0),r.canTrash&&a.auth.can("file:drop")?(v(),k($,{key:2},{default:u(()=>[d(w,{"prepend-icon":"mdi-delete",variant:"text",onClick:t[4]||(t[4]=n=>r.drop())},{default:u(()=>[y(b(e.$gettext("Delete")),1)]),_:1})]),_:1})):O("",!0),r.isTrashed&&a.auth.can("file:keep")?(v(),k($,{key:3},{default:u(()=>[d(w,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:t[5]||(t[5]=n=>r.keep())},{default:u(()=>[y(b(e.$gettext("Restore")),1)]),_:1})]),_:1})):O("",!0),r.isChecked&&a.auth.can("file:purge")?(v(),k($,{key:4},{default:u(()=>[d(w,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:t[6]||(t[6]=n=>r.purge())},{default:u(()=>[y(b(e.$gettext("Purge")),1)]),_:1})]),_:1})):O("",!0)]),_:1})]),_:1})]),g("div",Ea,[d(_e,{modelValue:s.term,"onUpdate:modelValue":t[7]||(t[7]=n=>s.term=n),label:e.$gettext("Search for"),"prepend-inner-icon":"mdi-magnify",variant:"underlined","hide-details":"",clearable:""},null,8,["modelValue","label"])]),g("div",Ta,[s.vgrid?O("",!0):(v(),k(w,{key:0,onClick:t[8]||(t[8]=n=>s.vgrid=!0),title:e.$gettext("Grid view"),icon:"mdi-view-grid-outline",variant:"text"},null,8,["title"])),s.vgrid?(v(),k(w,{key:1,onClick:t[9]||(t[9]=n=>s.vgrid=!1),title:e.$gettext("List view"),icon:"mdi-format-list-bulleted-square",variant:"text"},null,8,["title"])):O("",!0),d(Gt,null,{activator:u(({props:n})=>[d(w,Et(n,{title:e.$gettext("Sort by"),"append-icon":"mdi-menu-down","prepend-icon":"mdi-sort",variant:"text"}),{default:u(()=>[y(b(r.order),1)]),_:1},16,["title"])]),default:u(()=>[d(dt,null,{default:u(()=>[d($,null,{default:u(()=>[d(w,{variant:"text",onClick:t[10]||(t[10]=n=>s.sort={column:"ID",order:"DESC"})},{default:u(()=>[y(b(e.$gettext("latest")),1)]),_:1})]),_:1}),d($,null,{default:u(()=>[d(w,{variant:"text",onClick:t[11]||(t[11]=n=>s.sort={column:"ID",order:"ASC"})},{default:u(()=>[y(b(e.$gettext("oldest")),1)]),_:1})]),_:1}),d($,null,{default:u(()=>[d(w,{variant:"text",onClick:t[12]||(t[12]=n=>s.sort={column:"NAME",order:"ASC"})},{default:u(()=>[y(b(e.$gettext("name")),1)]),_:1})]),_:1}),d($,null,{default:u(()=>[d(w,{variant:"text",onClick:t[13]||(t[13]=n=>s.sort={column:"MIME",order:"ASC"})},{default:u(()=>[y(b(e.$gettext("mime")),1)]),_:1})]),_:1}),d($,null,{default:u(()=>[d(w,{variant:"text",onClick:t[14]||(t[14]=n=>s.sort={column:"LANG",order:"ASC"})},{default:u(()=>[y(b(e.$gettext("language")),1)]),_:1})]),_:1}),d($,null,{default:u(()=>[d(w,{variant:"text",onClick:t[15]||(t[15]=n=>s.sort={column:"EDITOR",order:"ASC"})},{default:u(()=>[y(b(e.$gettext("editor")),1)]),_:1})]),_:1}),d($,null,{default:u(()=>[d(w,{variant:"text",onClick:t[16]||(t[16]=n=>s.sort={column:"BYVERSIONS_COUNT",order:"ASC"})},{default:u(()=>[y(b(e.$gettext("usage")),1)]),_:1})]),_:1})]),_:1})]),_:1})])]),d(dt,{class:J(["items",{grid:s.vgrid,list:!s.vgrid}])},{default:u(()=>[(v(!0),E(z,null,G(s.items,(n,o)=>(v(),k($,{key:o},{default:u(()=>{var p,l,h,c;return[d(we,{modelValue:n._checked,"onUpdate:modelValue":f=>n._checked=f,class:J([{draft:!n.published},"item-check"])},null,8,["modelValue","onUpdate:modelValue","class"]),(v(),k(Ue(e.$vuetify.display.xs?"v-dialog":"v-menu"),{modelValue:s.menu[o],"onUpdate:modelValue":f=>s.menu[o]=f,transition:"scale-transition",location:s.vgrid?"start":"end center","max-width":"300"},{activator:u(({props:f})=>[d(w,Et({ref_for:!0},f,{title:e.$gettext("Actions"),icon:"mdi-dots-vertical",class:"item-menu",variant:"text"}),null,16,["title"])]),default:u(()=>[d(he,null,{default:u(()=>[d(He,{density:"compact"},{default:u(()=>[d(Fe,null,{default:u(()=>[y(b(e.$gettext("Actions")),1)]),_:1}),d(w,{icon:"mdi-close",onClick:f=>s.menu[o]=!1},null,8,["onClick"])]),_:2},1024),d(dt,{onClick:f=>s.menu[o]=!1},{default:u(()=>[ui(d($,null,{default:u(()=>[d(w,{"prepend-icon":"mdi-publish",variant:"text",onClick:f=>r.publish(n)},{default:u(()=>[y(b(e.$gettext("Publish")),1)]),_:1},8,["onClick"])]),_:2},1536),[[ci,!n.deleted_at&&!n.published&&a.auth.can("file:publish")]]),!n.deleted_at&&a.auth.can("file:drop")?(v(),k($,{key:0},{default:u(()=>[d(w,{"prepend-icon":"mdi-delete",variant:"text",onClick:f=>r.drop(n)},{default:u(()=>[y(b(e.$gettext("Delete")),1)]),_:1},8,["onClick"])]),_:2},1024)):O("",!0),n.deleted_at&&a.auth.can("file:keep")?(v(),k($,{key:1},{default:u(()=>[d(w,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:f=>r.keep(n)},{default:u(()=>[y(b(e.$gettext("Restore")),1)]),_:1},8,["onClick"])]),_:2},1024)):O("",!0),a.auth.can("file:purge")?(v(),k($,{key:2},{default:u(()=>[d(w,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:f=>r.purge(n)},{default:u(()=>[y(b(e.$gettext("Purge")),1)]),_:1},8,["onClick"])]),_:2},1024)):O("",!0)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue","location"])),g("div",{class:J(["item-usage",{notused:!n.usage}]),onClick:f=>e.$emit("select",n),title:r.title(n)},b(n.usage),11,Ma),g("div",{class:"item-preview",onClick:f=>e.$emit("select",n),title:r.title(n)},[(p=n.mime)!=null&&p.startsWith("image/")?(v(),k(ye,{key:0,src:r.url(n.path),srcset:r.srcset(n.previews),title:n.name},null,8,["src","srcset","title"])):(l=n.mime)!=null&&l.startsWith("video/")&&Object.values(n.previews).length?(v(),k(ye,{key:1,src:r.url(Object.values(n.previews)[0]??""),srcset:r.srcset(n.previews),title:n.name},null,8,["src","srcset","title"])):(h=n.mime)!=null&&h.startsWith("video/")&&!Object.values(n.previews).length?(v(),E("svg",Va,[...t[20]||(t[20]=[g("path",{d:"M10,15L15.19,12L10,9V15M21.56,7.17C21.69,7.64 21.78,8.27 21.84,9.07C21.91,9.87 21.94,10.56 21.94,11.16L22,12C22,14.19 21.84,15.8 21.56,16.83C21.31,17.73 20.73,18.31 19.83,18.56C19.36,18.69 18.5,18.78 17.18,18.84C15.88,18.91 14.69,18.94 13.59,18.94L12,19C7.81,19 5.2,18.84 4.17,18.56C3.27,18.31 2.69,17.73 2.44,16.83C2.31,16.36 2.22,15.73 2.16,14.93C2.09,14.13 2.06,13.44 2.06,12.84L2,12C2,9.81 2.16,8.2 2.44,7.17C2.69,6.27 3.27,5.69 4.17,5.44C4.64,5.31 5.5,5.22 6.82,5.16C8.12,5.09 9.31,5.06 10.41,5.06L12,5C16.19,5 18.8,5.16 19.83,5.44C20.73,5.69 21.31,6.27 21.56,7.17Z"},null,-1)])])):(c=n.mime)!=null&&c.startsWith("audio/")?(v(),E("svg",$a,[...t[21]||(t[21]=[g("path",{d:"M21,3V15.5A3.5,3.5 0 0,1 17.5,19A3.5,3.5 0 0,1 14,15.5A3.5,3.5 0 0,1 17.5,12C18.04,12 18.55,12.12 19,12.34V6.47L9,8.6V17.5A3.5,3.5 0 0,1 5.5,21A3.5,3.5 0 0,1 2,17.5A3.5,3.5 0 0,1 5.5,14C6.04,14 6.55,14.12 7,14.34V6L21,3Z"},null,-1)])])):(v(),E("svg",Sa,[...t[22]||(t[22]=[g("path",{d:"M7.05 11.885c0 1.415-.548 2.206-1.524 2.206C4.548 14.09 4 13.3 4 11.885c0-1.412.548-2.203 1.526-2.203.976 0 1.524.79 1.524 2.203m-1.524-1.612c-.542 0-.832.563-.832 1.612q0 .133.006.252l1.559-1.143c-.126-.474-.375-.72-.733-.72zm-.732 2.508c.126.472.372.718.732.718.54 0 .83-.563.83-1.614q0-.129-.006-.25zm6.061.624V14h-3v-.595h1.181V10.5h-.05l-1.136.747v-.688l1.19-.786h.69v3.633z"},null,-1),g("path",{d:"M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2M9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"},null,-1)])]))],8,Oa),g("div",{class:J(["item-content",{trashed:n.deleted_at}]),onClick:f=>e.$emit("select",n),title:r.title(n)},[g("div",Aa,[g("div",Ia,[n.lang?(v(),E("span",La,b(n.lang),1)):O("",!0),n.publish_at?(v(),k(It,{key:1,class:"publish-at",icon:"mdi-clock-outline"})):O("",!0),g("span",Ra,b(n.name),1)]),g("div",Pa,b(n.mime),1)]),g("div",Ba,[g("div",_a,b(n.editor),1),g("div",Ua,b(new Date(n.updated_at).toLocaleString()),1)])],10,Na)]}),_:2},1024))),128))]),_:1},8,["class"]),s.loading?(v(),E("p",Ha,[y(b(e.$gettext("Loading"))+" ",1),t[23]||(t[23]=g("svg",{class:"spinner",width:"32",height:"32",fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[g("circle",{class:"spin1",cx:"4",cy:"12",r:"3"}),g("circle",{class:"spin1 spin2",cx:"12",cy:"12",r:"3"}),g("circle",{class:"spin1 spin3",cx:"20",cy:"12",r:"3"})],-1))])):O("",!0),!s.loading&&!s.items.length?(v(),E("p",Fa,b(e.$gettext("No entries found")),1)):O("",!0),s.last>1?(v(),k(di,{key:2,modelValue:s.page,"onUpdate:modelValue":t[17]||(t[17]=n=>s.page=n),length:s.last},null,8,["modelValue","length"])):O("",!0),!this.embed&&a.auth.can("file:add")?(v(),E("div",Wa,[g("input",{onChange:t[18]||(t[18]=n=>r.add(n)),ref:"upload",type:"file",multiple:"",hidden:""},null,544),d(w,{onClick:t[19]||(t[19]=n=>e.$refs.upload.click()),title:e.$gettext("Add files"),icon:"mdi-folder-plus",color:"primary",variant:"flat"},null,8,["title"])])):O("",!0)],64)}const ja=Vt(Ca,[["render",za],["__scopeId","data-v-930ce461"]]),Ya={components:{FileListItems:ja},props:{modelValue:{type:Boolean,required:!0},context:{type:[Object,null],default:null},files:{type:Array,default:()=>[]}},emits:["update:modelValue","add"],inject:["transcribe","url"],setup(){const e=Bt();return{app:le(),messages:e}},data(){return{audio:null,chat:"",items:[],errors:[],similar:[],loading:!1,dictating:!1}},beforeUpdate(){var e,t,i;this.chat=[(e=this.context)==null?void 0:e.title,(t=this.context)==null?void 0:t.text,(i=this.context)==null?void 0:i.description].filter(Boolean).join(`
`),this.similar=this.files||[]},unmounted(){this.items.forEach(e=>{e.path.startsWith("blob:")&&URL.revokeObjectURL(e.path)}),this.similar=[],this.items=[]},methods:{add(e){if(!e.path.startsWith("blob:")){this.$emit("add",[e]);return}this.loading=!0,fetch(e.path).then(t=>t.blob()).then(t=>{const i="ai-image_"+new Date().toISOString().replace(/[^0-9]/g,"")+".png";return this.$apollo.mutate({mutation:_`mutation($input: FileInput, $file: Upload) {
              addFile(input: $input, file: $file) {
                id
                mime
                name
                path
                previews
                updated_at
                editor
              }
            }`,variables:{input:{name:e.name},file:new File([t],i,{type:e.mime})},context:{hasUpload:!0}})}).then(t=>{if(t.errors)throw t.errors;Object.assign(e,t.data.addFile,{previews:JSON.parse(t.data.addFile.previews||"{}")}),this.$refs.filelist.invalidate(),this.$emit("add",[e])}).catch(t=>{this.messages.add(this.$gettext("Error adding file %{path}",{path:e==null?void 0:e.path})+`:
`+t,"error"),this.$log("FileAiDialog::add(): Error adding file",t)}).finally(()=>{this.loading=!1})},base64ToBlob(e,t="image/png"){if(!e)return null;const i=atob(e),a=new Uint8Array(i.length);for(let s=0;s<i.length;s++)a[s]=i.charCodeAt(s);return new Blob([a],{type:t})},create(){!this.chat||this.loading||(this.loading=!0,this.original=this.chat,this.$apollo.mutate({mutation:_`mutation($prompt: String!, $context: String, $files: [String!]) {
            imagine(prompt: $prompt, context: $context, files: $files)
          }`,variables:{prompt:this.chat||this.$gettext("Create a suitable image based on the context"),context:this.context?`Context in JSON format:
`+JSON.stringify(this.context):"",files:this.similar.map(e=>e.id)}}).then(e=>{if(e.errors)throw e.errors;const t=this.chat,i=e.data.imagine;this.chat=i.shift()||this.chat,i.forEach(a=>{this.items.unshift({path:URL.createObjectURL(this.base64ToBlob(a)),name:t.slice(0,t.length>250?t.lastIndexOf(" ",250):250),mime:"image/png"})})}).catch(e=>{this.messages.add(this.$gettext("Error creating file")+`:
`+e,"error"),this.$log("FileAiDialog::create(): Error creating file",e)}).finally(()=>{this.loading=!1}))},record(){if(!this.audio)return this.audio=We().start();this.audio.then(e=>{this.dictating=!0,this.audio=null,e.stop().then(t=>{this.transcribe(t).then(i=>{this.chat=i.asText()}).finally(()=>{this.dictating=!1})})})},remove(e){this.items.splice(e,1)},removeSimilar(e){this.similar.splice(e,1)},use(e){this.similar.find(t=>t.path===e.path)||this.similar.push(e)}}},Xa={key:0},qa=["onClick"],Ga=["src"],Ja={key:1},Za={class:"item-preview"},Qa=["src"];function Ka(e,t,i,a,s,r){const n=pt("FileListItems");return v(),k(fi,{modelValue:i.modelValue,onAfterLeave:t[5]||(t[5]=o=>e.$emit("update:modelValue",!1)),"max-width":"1200",scrollable:""},{default:u(()=>[d(he,{loading:s.loading?"primary":!1},{append:u(()=>[d(w,{onClick:t[0]||(t[0]=o=>r.record()),class:J({dictating:s.audio}),icon:s.audio?"mdi-microphone-outline":"mdi-microphone",title:e.$gettext("Dictate"),loading:s.dictating,variant:"text"},null,8,["class","icon","title","loading"]),d(w,{onClick:t[1]||(t[1]=o=>e.$emit("update:modelValue",!1)),title:e.$gettext("Close"),icon:"mdi-close",variant:"text"},null,8,["title"])]),title:u(()=>[y(b(e.$gettext("Create or alter image")),1)]),default:u(()=>[d(pi,null,{default:u(()=>[d(Jt,{modelValue:s.chat,"onUpdate:modelValue":t[2]||(t[2]=o=>s.chat=o),label:s.similar.length?e.$gettext("Describe the scene changes"):e.$gettext("Describe the image"),variant:"underlined",autofocus:"",clearable:""},null,8,["modelValue","label"]),d(w,{loading:s.loading,disabled:!s.chat,onClick:t[3]||(t[3]=o=>r.create()),variant:"outlined",class:"create"},{default:u(()=>[y(b(e.$gettext("New image")),1)]),_:1},8,["loading","disabled"]),s.items.length?(v(),E("div",Xa,[d(vt,null,{default:u(()=>[d(ut,null,{default:u(()=>[y(b(e.$gettext("Current images")),1)]),_:1})]),_:1}),d(dt,{class:"items grid"},{default:u(()=>[(v(!0),E(z,null,G(s.items,(o,p)=>(v(),k($,{key:p},{default:u(()=>[d(w,{onClick:l=>r.remove(p),title:e.$gettext("Remove"),class:"btn-overlay",icon:"mdi-delete"},null,8,["onClick","title"]),g("div",{class:"item-preview",onClick:l=>r.add(o)},[g("img",{src:r.url(o.path)},null,8,Ga)],8,qa)]),_:2},1024))),128))]),_:1})])):O("",!0),s.similar.length?(v(),E("div",Ja,[d(vt,null,{default:u(()=>[d(ut,null,{default:u(()=>[y(b(e.$gettext("Images used")),1)]),_:1})]),_:1}),d(dt,{class:"items grid"},{default:u(()=>[(v(!0),E(z,null,G(s.similar,(o,p)=>(v(),k($,{key:p},{default:u(()=>[d(w,{icon:"mdi-delete",onClick:l=>r.removeSimilar(p),class:"btn-overlay",title:e.$gettext("Remove")},null,8,["onClick","title"]),g("div",Za,[g("img",{src:r.url(o.path)},null,8,Qa)])]),_:2},1024))),128))]),_:1})])):O("",!0),d(vt,null,{default:u(()=>[d(ut,null,{default:u(()=>[y(b(e.$gettext("Select images")),1)]),_:1})]),_:1}),d(n,{ref:"filelist",filter:{mime:"image/"},onSelect:t[4]||(t[4]=o=>r.use(o))},null,512)]),_:1})]),_:1},8,["loading"])]),_:1},8,["modelValue"])}const tr=Vt(Ya,[["render",Ka],["__scopeId","data-v-261e222d"]]),er={components:{FileAiDialog:tr},props:{item:{type:Object,required:!0},save:{type:Object,required:!0}},emits:["update:item","update:file","error"],inject:["compose","locales","transcribe","translate","txlocales","url"],data(){return{vedit:!1,transcribing:!1,translating:!1,dictating:!1,composing:!1,cropping:!1,covering:!1,tabtrans:null,tabdesc:null,cropLabel:null,cropper:null,audio:null,scaleX:1,scaleY:1,menu:{}}},setup(){const e=mi(),t=Bt(),i=gi(),a=Pt();return{app:le(),auth:a,languages:e,messages:t,side:i}},mounted(){this.init()},beforeUnmount(){this.cropper&&this.cropper.destroy()},computed:{desclangs(){return this.languages.available.concat(Object.keys(this.item.description||{})).filter((e,t,i)=>i.indexOf(e)===t)},ratio(){if(!this.cropper)return NaN;const e=this.cropper.getImageData();return e.naturalWidth/e.naturalHeight},readonly(){return!this.auth.can("file:save")}},methods:{addCover(){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");const e=this,t=this.$refs.video;if(!t)return this.messages.add(this.$gettext("No video element found"),"error");const i=this.item.path.replace(/\.[A-Za-z0-9]+$/,".png").split("/").pop(),a=document.createElement("canvas"),s=a.getContext("2d");a.width=t.videoWidth,a.height=t.videoHeight,s.drawImage(t,0,0,t.videoWidth,t.videoHeight),a.toBlob(function(r){const n=new File([r],i,{type:"image/png"});e.covering=!0,e.$apollo.mutate({mutation:_`mutation($id: ID!, $preview: Upload) {
              saveFile(id: $id, input: {}, preview: $preview) {
                id
                latest {
                  data
                  created_at
                }
              }
            }`,variables:{id:e.item.id,preview:n},context:{hasUpload:!0}}).then(o=>{var l,h,c;if(o.errors)throw o.errors;const p=(h=(l=o.data)==null?void 0:l.saveFile)==null?void 0:h.latest;p&&(e.item.previews=((c=JSON.parse(p.data||"{}"))==null?void 0:c.previews)||{},e.item.updated_at=p.created_at)}).catch(o=>{e.messages.add(this.$gettext("Error saving video cover")+`:
`+o,"error"),this.$log("FileDetailItem::addCover(): Error saving video cover",o)}).finally(()=>{e.covering=!1})},"image/png",1)},aspect(e){this.cropper.setAspectRatio(e),this.cropper.setDragMode("crop"),this.cropping=!0,this.$nextTick(()=>{const t=this.cropper.cropper.querySelector(".cropper-crop-box");if(t&&!this.cropLabel){const i=document.createElement("div");i.className="crop-label",t.appendChild(i),this.cropLabel=i}})},composeText(){const e=this.desclangs.shift()||this.item.lang||"en",t=`Summarize the content of the file in a few words in plain text format for a title tag in the language with the ISO code "${e}":`;this.composing=!0,this.compose(t,null,[this.item.id]).then(i=>{this.update("description",Object.assign(this.item.description||{},{[e]:i}))}).finally(()=>{this.composing=!1})},crop(){this.cropping=!1,this.cropper.setDragMode("none"),this.cropper.getCroppedCanvas().toBlob(e=>{this.$emit("update:file",e)})},download(){this.cropper.getCroppedCanvas().toBlob(e=>{const t=URL.createObjectURL(e),i=document.createElement("a");i.href=t,i.download=this.item.name||"download",i.click(),URL.revokeObjectURL(t)})},flipX(){this.scaleX=-this.scaleX,this.cropper.scaleX(this.scaleX),this.updateFile()},flipY(){this.scaleY=-this.scaleY,this.cropper.scaleY(this.scaleY),this.updateFile()},init(){var e;if(!this.readonly&&((e=this.item.mime)!=null&&e.startsWith("image/"))){this.cropper&&(this.cropper.destroy(),this.cropper=null);const t=this;this.cropper=new ni(this.$refs.image,{aspectRatio:NaN,background:!0,responsive:!0,dragMode:"none",movable:!1,autoCrop:!1,zoomable:!1,zoomOnWheel:!1,zoomOnTouch:!1,touchDragZoom:!1,checkCrossOrigin:!1,checkOrientation:!1,viewMode:1,crop(i){if(!t.cropLabel)return;const{width:a,height:s}=i.detail;t.cropLabel.textContent=`${Math.round(a)}  ${Math.round(s)}`}})}},record(){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");if(!this.audio)return this.audio=We().start();this.audio.then(e=>{this.dictating=!0,this.audio=null,e.stop().then(t=>{this.transcribe(t).then(i=>{const a=this.desclangs[0]||this.item.lang||"en";this.update("description",Object.assign(this.item.description||{},{[a]:i.asText()}))}).finally(()=>{this.dictating=!1})})})},removeCover(){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");this.covering=!0,this.item.previews={},this.$apollo.mutate({mutation:_`mutation($id: ID!, $preview: Boolean) {
            saveFile(id: $id, input: {}, preview: $preview) {
              id
              latest {
                data
                created_at
              }
            }
          }`,variables:{id:this.item.id,preview:!1}}).then(e=>{var i,a,s;if(e.errors)throw e.errors;const t=(a=(i=e.data)==null?void 0:i.saveFile)==null?void 0:a.latest;t&&(this.item.previews=((s=JSON.parse(t.data||"{}"))==null?void 0:s.previews)||{},this.item.updated_at=t.created_at)}).catch(e=>{this.messages.add(this.$gettext("Error removing video cover")+`:
`+e,"error"),this.$log("FileDetailItem::removeCover(): Error removing video cover",e)}).finally(()=>{this.covering=!1})},reset(){this.cropping=!1,this.$emit("update:file",null),this.cropper.reset(),this.cropper.clear(),this.scaleX=1,this.scaleY=1},rotate(e){this.cropper.rotate(e),this.updateFile(),this.$nextTick(()=>{const t=this.cropper.getContainerData(),i=this.cropper.getImageData();let a,s;Math.abs(Math.abs(i.rotate)-180)===90?(a=t.width/i.naturalHeight,s=t.height/i.naturalWidth):(a=t.width/i.naturalWidth,s=t.height/i.naturalHeight),this.cropper.zoomTo(Math.min(a,s))})},transcribeFile(){var e,t;if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");if(!((e=this.item.mime)!=null&&e.startsWith("audio/"))&&!((t=this.item.mime)!=null&&t.startsWith("video/")))return this.messages.add(this.$gettext("Transcription is only available for audio and video files"),"error");this.transcribing=!0,this.transcribe(this.item.path).then(i=>{const a=this.desclangs[0]||this.item.lang||"en";this.update("transcription",Object.assign(this.item.transcription||{},{[a]:i.asText()}))}).finally(()=>{this.transcribing=!1})},translateText(e){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");if(!e||typeof e!="object"){this.$log("FileDetailItem::translateText(): Invalid map object",e);return}const t=[],[i,a]=Object.entries(e||{}).find(([s,r])=>!!r);return this.translating=!0,this.txlocales(i).map(s=>s.code).forEach(s=>{t.push(this.translate(a,s).then(r=>{r[0]&&(e[s]=r[0])}).catch(r=>{this.$log("FileDetailItem::translateText(): Error translating text",r)}))}),Promise.all(t).then(()=>(this.$emit("update:item",this.item),this.translating=!1,e))},translateVTT(e){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");if(!e||typeof e!="object"){this.$log("FileDetailItem::translateVTT(): Invalid map object",e);return}const t=/^\d{2}:\d{2}:\d{2}\.\d{3} --\> \d{2}:\d{2}:\d{2}\.\d{3}(?: .*)?$/,i={...e};for(const[a,s]of Object.entries(i))s&&(i[a]=s.split(`
`).map(r=>r.startsWith("WEBVTT")||t.test(r)?`<x>${r}</x>`:r).filter(r=>r.trim()!=="").join(""));this.translateText(i).then(a=>{for(const[s,r]of Object.entries(a))a[s]&&(e[s]=a[s].replaceAll(/\<x\>/g,`

`).replaceAll(/\<\/x\>/g,`
`).trim());this.$emit("update:item",this.item)}).catch(a=>{this.$log("FileDetailItem::translateVTT(): Error translating VTT",a)})},update(e,t){this.item[e]=t,this.$emit("update:item",this.item)},updateFile(){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");this.cropper.getCroppedCanvas().toBlob(e=>{this.$emit("update:file",e)})},uploadCover(e){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");const t=e.target.files[0];if(!t)return this.messages.add(this.$gettext("No file selected"),"error");this.covering=!0,this.$apollo.mutate({mutation:_`mutation($id: ID!, $preview: Upload) {
            saveFile(id: $id, input: {}, preview: $preview) {
              id
              latest {
                data
                created_at
              }
            }
          }`,variables:{id:this.item.id,preview:t},context:{hasUpload:!0}}).then(i=>{var s,r,n;if(i.errors)throw i.errors;const a=(r=(s=i.data)==null?void 0:s.saveFile)==null?void 0:r.latest;a&&(this.item.previews=((n=JSON.parse(a.data||"{}"))==null?void 0:n.previews)||{},this.item.updated_at=a.created_at)}).catch(i=>{this.messages.add(this.$gettext("Error uploading video cover")+`:
`+i,"error"),this.$log("FileDetailItem::uploadCover(): Error uploading video cover",i)}).finally(()=>{this.covering=!1})},use(e){e!=null&&e.length&&(this.vedit=!1,this.item.path=e[0].path,this.item.mime=e[0].mime,this.cropper.replace(this.url(this.item.path,!0)))}},watch:{"save.count":function(){this.save.count>0&&this.$nextTick(()=>{this.init()})}}},ir={key:0,ref:"editorContainer",class:"editor-container"},ar=["src"],rr={key:0,class:"toolbar"},sr={class:"toolbar-group"},nr={class:"toolbar-group"},or={class:"toolbar-group"},lr={class:"toolbar-group"},hr={key:1,class:"editor-container"},dr=["src"],ur={key:0,class:"toolbar"},cr={class:"toolbar-group"},fr=["src"],pr={key:1,class:"toolbar-group"},mr=["src"],gr={key:3,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 16 16",fill:"currentColor"},vr={class:"label"},br={key:0,class:"actions"},wr={class:"label"},yr={key:0,class:"actions"};function xr(e,t,i,a,s,r){const n=pt("FileAiDialog");return v(),E(z,null,[d(Pe,null,{default:u(()=>[d(Be,{class:"scroll"},{default:u(()=>{var o,p;return[d(St,null,{default:u(()=>[d(yt,{cols:"12",md:"6"},{default:u(()=>[d(_e,{ref:"name",readonly:r.readonly,modelValue:i.item.name,"onUpdate:modelValue":t[0]||(t[0]=l=>r.update("name",l)),variant:"underlined",label:e.$gettext("Name"),counter:"255",maxlength:"255"},null,8,["readonly","modelValue","label"])]),_:1}),d(yt,{cols:"12",md:"6"},{default:u(()=>[d(vi,{ref:"lang",items:r.locales(!0),readonly:r.readonly,modelValue:i.item.lang,"onUpdate:modelValue":t[1]||(t[1]=l=>r.update("lang",l)),variant:"underlined",label:e.$gettext("Language")},null,8,["items","readonly","modelValue","label"])]),_:1})]),_:1}),d(St,null,{default:u(()=>[i.item?(v(),k(yt,{key:0,cols:"12",class:"preview"},{default:u(()=>{var l,h,c;return[(l=i.item.mime)!=null&&l.startsWith("image/")?(v(),E("div",ir,[g("img",{ref:"image",src:r.url(i.item.path,!0),class:"element",crossorigin:"anonymous"},null,8,ar),r.readonly?O("",!0):(v(),E("div",rr,[g("div",sr,[s.cropping?(v(),k(w,{key:0,onClick:t[2]||(t[2]=f=>r.crop()),title:e.$gettext("Use cropped image"),icon:"mdi-image-check",class:"no-rtl"},null,8,["title"])):(v(),k(Ue(e.$vuetify.display.xs?"v-dialog":"v-menu"),{key:1,modelValue:s.menu.crop,"onUpdate:modelValue":t[12]||(t[12]=f=>s.menu.crop=f),transition:"scale-transition",location:"end center","max-width":"300"},{activator:u(({props:f})=>[d(w,Et(f,{title:e.$gettext("Crop image"),icon:"mdi-crop",class:"no-rtl"}),null,16,["title"])]),default:u(()=>[d(he,null,{default:u(()=>[d(He,{density:"compact"},{default:u(()=>[d(Fe,null,{default:u(()=>[y(b(e.$gettext("Crop image")),1)]),_:1}),d(w,{icon:"mdi-close",onClick:t[3]||(t[3]=f=>s.menu.crop=!1)})]),_:1}),d(dt,{onClick:t[11]||(t[11]=f=>s.menu.crop=!1)},{default:u(()=>[d($,null,{default:u(()=>[d(w,{"prepend-icon":"mdi-crop",class:"no-rtl",variant:"text",onClick:t[4]||(t[4]=f=>r.aspect(r.ratio))},{default:u(()=>[y(b(e.$gettext("Original ratio")),1)]),_:1})]),_:1}),d($,null,{default:u(()=>[d(w,{"prepend-icon":"mdi-crop",class:"no-rtl",variant:"text",onClick:t[5]||(t[5]=f=>r.aspect(NaN))},{default:u(()=>[y(b(e.$gettext("No ratio")),1)]),_:1})]),_:1}),d($,null,{default:u(()=>[d(w,{"prepend-icon":"mdi-crop",class:"no-rtl",variant:"text",onClick:t[6]||(t[6]=f=>r.aspect(1))},{default:u(()=>[y(b(e.$gettext("Square")),1)]),_:1})]),_:1}),d($,null,{default:u(()=>[d(w,{"prepend-icon":"mdi-crop",class:"no-rtl",variant:"text",onClick:t[7]||(t[7]=f=>r.aspect(3/2))},{default:u(()=>[...t[33]||(t[33]=[y("3:2",-1)])]),_:1})]),_:1}),d($,null,{default:u(()=>[d(w,{"prepend-icon":"mdi-crop",class:"no-rtl",variant:"text",onClick:t[8]||(t[8]=f=>r.aspect(4/3))},{default:u(()=>[...t[34]||(t[34]=[y("4:3",-1)])]),_:1})]),_:1}),d($,null,{default:u(()=>[d(w,{"prepend-icon":"mdi-crop",class:"no-rtl",variant:"text",onClick:t[9]||(t[9]=f=>r.aspect(5/3))},{default:u(()=>[...t[35]||(t[35]=[y("5:3",-1)])]),_:1})]),_:1}),d($,null,{default:u(()=>[d(w,{"prepend-icon":"mdi-crop",class:"no-rtl",variant:"text",onClick:t[10]||(t[10]=f=>r.aspect(16/9))},{default:u(()=>[...t[36]||(t[36]=[y("16:9",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])),d(w,{icon:"mdi-image-edit",class:"no-rtl",onClick:t[13]||(t[13]=f=>s.vedit=!0),title:e.$gettext("Edit image")},null,8,["title"])]),g("div",nr,[d(w,{icon:"mdi-rotate-left",class:"no-rtl",onClick:t[14]||(t[14]=f=>r.rotate(-90)),title:e.$gettext("Rotate counter-clockwise")},null,8,["title"]),d(w,{icon:"mdi-rotate-right",class:"no-rtl",onClick:t[15]||(t[15]=f=>r.rotate(90)),title:e.$gettext("Rotate clockwise")},null,8,["title"])]),g("div",or,[d(w,{icon:"mdi-flip-horizontal",class:"no-rtl",onClick:r.flipX,title:e.$gettext("Flip horizontally")},null,8,["onClick","title"]),d(w,{icon:"mdi-flip-vertical",class:"no-rtl",onClick:r.flipY,title:e.$gettext("Flip vertically")},null,8,["onClick","title"])]),g("div",lr,[d(w,{icon:"mdi-download",class:"no-rtl",onClick:t[16]||(t[16]=f=>r.download()),title:e.$gettext("Download")},null,8,["title"]),d(w,{icon:"mdi-history",class:"no-rtl",onClick:t[17]||(t[17]=f=>r.reset()),title:e.$gettext("Reset")},null,8,["title"])])]))],512)):(h=i.item.mime)!=null&&h.startsWith("video/")?(v(),E("div",hr,[g("video",{ref:"video",src:r.url(i.item.path),crossorigin:"anonymous",class:"element",controls:""},null,8,dr),r.readonly?O("",!0):(v(),E("div",ur,[g("div",cr,[Object.values(i.item.previews).length?(v(),E("img",{key:0,class:"video-preview",src:r.url(Object.values(i.item.previews).shift()),onClick:t[18]||(t[18]=f=>r.removeCover())},null,8,fr)):(v(),E("div",pr,[d(w,{icon:"mdi-tooltip-image",loading:s.covering,title:e.$gettext("Use as cover image"),onClick:t[19]||(t[19]=f=>r.addCover())},null,8,["loading","title"]),d(w,{icon:"",loading:s.covering,title:e.$gettext("Upload cover image"),onClick:t[21]||(t[21]=f=>e.$refs.coverInput.click())},{default:u(()=>[d(It,null,{default:u(()=>[...t[37]||(t[37]=[y("mdi-image-plus",-1)])]),_:1}),g("input",{ref:"coverInput",type:"file",class:"cover-input",onChange:t[20]||(t[20]=f=>r.uploadCover(f))},null,544)]),_:1},8,["loading","title"])]))])]))])):(c=i.item.mime)!=null&&c.startsWith("audio/")?(v(),E("audio",{key:2,src:r.url(i.item.path),crossorigin:"anonymous",class:"element",controls:""},null,8,mr)):(v(),E("svg",gr,[...t[38]||(t[38]=[g("path",{d:"M7.05 11.885c0 1.415-.548 2.206-1.524 2.206C4.548 14.09 4 13.3 4 11.885c0-1.412.548-2.203 1.526-2.203.976 0 1.524.79 1.524 2.203m-1.524-1.612c-.542 0-.832.563-.832 1.612q0 .133.006.252l1.559-1.143c-.126-.474-.375-.72-.733-.72zm-.732 2.508c.126.472.372.718.732.718.54 0 .83-.563.83-1.614q0-.129-.006-.25zm6.061.624V14h-3v-.595h1.181V10.5h-.05l-1.136.747v-.688l1.19-.786h.69v3.633z"},null,-1),g("path",{d:"M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2M9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"},null,-1)])]))]}),_:1})):O("",!0)]),_:1}),d(St,null,{default:u(()=>[d(yt,{cols:"12",class:"description"},{default:u(()=>[g("div",vr,[y(b(e.$gettext("Descriptions"))+" ",1),r.readonly?O("",!0):(v(),E("div",br,[Object.values(i.item.description||{}).find(l=>!!l)?(v(),k(w,{key:0,onClick:t[22]||(t[22]=l=>r.translateText(i.item.description)),title:e.$gettext("Translate text"),loading:s.translating,icon:"mdi-translate",variant:"text"},null,8,["title","loading"])):O("",!0),d(w,{onClick:t[23]||(t[23]=l=>r.composeText()),title:e.$gettext("Generate description"),loading:s.composing,icon:"mdi-creation",variant:"text"},null,8,["title","loading"]),d(w,{onClick:t[24]||(t[24]=l=>r.record()),class:J({dictating:s.audio}),icon:s.audio?"mdi-microphone-outline":"mdi-microphone",title:e.$gettext("Dictate"),loading:s.dictating,variant:"text"},null,8,["class","icon","title","loading"])]))]),d(vt,{modelValue:s.tabdesc,"onUpdate:modelValue":t[25]||(t[25]=l=>s.tabdesc=l)},{default:u(()=>[(v(!0),E(z,null,G(r.locales(),l=>(v(),k(ut,{value:l.value},{default:u(()=>[y(b(l.title),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"]),d(Zt,{modelValue:s.tabdesc,"onUpdate:modelValue":t[26]||(t[26]=l=>s.tabdesc=l),touch:!1},{default:u(()=>[(v(!0),E(z,null,G(r.locales(),l=>(v(),k(Lt,{value:l.value},{default:u(()=>{var h;return[d(Jt,{ref_for:!0,ref:"description","onUpdate:modelValue":c=>{i.item.description[l.value]=c,e.$emit("update:item",i.item)},label:e.$gettext("Description (%{lang})",{lang:l.value}),modelValue:((h=i.item.description)==null?void 0:h[l.value])||"",readonly:r.readonly,variant:"underlined",counter:"500",rows:"2","auto-grow":"",clearable:""},null,8,["onUpdate:modelValue","label","modelValue","readonly"])]}),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1}),(o=i.item.mime)!=null&&o.startsWith("audio/")||(p=i.item.mime)!=null&&p.startsWith("video/")?(v(),k(St,{key:0},{default:u(()=>[d(yt,{cols:"12",class:"transcription"},{default:u(()=>[g("div",wr,[y(b(e.$gettext("Transcriptions"))+" ",1),r.readonly?O("",!0):(v(),E("div",yr,[Object.values(i.item.transcription||{}).find(l=>!!l)?(v(),k(w,{key:0,onClick:t[27]||(t[27]=l=>r.translateVTT(i.item.transcription)),title:e.$gettext("Translate text"),loading:s.translating,icon:"mdi-translate",variant:"text"},null,8,["title","loading"])):O("",!0),d(w,{onClick:t[28]||(t[28]=l=>r.transcribeFile()),title:e.$gettext("Transcribe file content"),loading:s.transcribing,icon:"mdi-creation",variant:"text"},null,8,["title","loading"])]))]),d(vt,{modelValue:s.tabtrans,"onUpdate:modelValue":t[29]||(t[29]=l=>s.tabtrans=l)},{default:u(()=>[(v(!0),E(z,null,G(r.locales(),l=>(v(),k(ut,{value:l.value},{default:u(()=>[y(b(l.title),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"]),d(Zt,{modelValue:s.tabtrans,"onUpdate:modelValue":t[30]||(t[30]=l=>s.tabtrans=l),touch:!1},{default:u(()=>[(v(!0),E(z,null,G(r.locales(),l=>(v(),k(Lt,{value:l.value},{default:u(()=>{var h;return[d(Jt,{ref_for:!0,ref:"transcription","onUpdate:modelValue":c=>{i.item.transcription[l.value]=c,e.$emit("update:item",i.item)},label:e.$gettext("Transcription (%{lang})",{lang:l.value}),modelValue:((h=i.item.transcription)==null?void 0:h[l.value])||"",readonly:r.readonly,variant:"underlined",rows:"10","auto-grow":"",clearable:""},null,8,["onUpdate:modelValue","label","modelValue","readonly"])]}),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1})):O("",!0)]}),_:1})]),_:1}),(v(),k(ze,{to:"body"},[d(n,{modelValue:s.vedit,"onUpdate:modelValue":t[31]||(t[31]=o=>s.vedit=o),files:[i.item],onAdd:t[32]||(t[32]=o=>r.use(o))},null,8,["modelValue","files"])]))],64)}const Cr=Vt(er,[["render",xr],["__scopeId","data-v-3a3f89b3"]]),Dr={components:{AsideMeta:Ei,HistoryDialog:ki,FileDetailItem:Cr,FileDetailRefs:Ni},inject:["closeView"],props:{item:{type:Object,required:!0}},data:()=>({file:null,error:!1,changed:!1,publishAt:null,pubmenu:!1,vhistory:!1,tab:"file",savecnt:0}),setup(){const e=Bt(),t=bi();return{auth:Pt(),drawer:t,messages:e}},methods:{publish(e=null){if(!this.auth.can("file:publish")){this.messages.add(this.$gettext("Permission denied"),"error");return}this.save(!0).then(t=>{var i,a;t&&this.$apollo.mutate({mutation:_`mutation ($id: [ID!]!, $at: DateTime) {
              pubFile(id: $id, at: $at) {
                id
              }
            }`,variables:{id:[this.item.id],at:(a=(i=e==null?void 0:e.toISOString())==null?void 0:i.substring(0,19))==null?void 0:a.replace("T"," ")}}).then(s=>{if(s.errors)throw s.errors;e?(this.item.publish_at=e,this.messages.add(this.$gettext("File scheduled for publishing at %{date}",{date:e.toLocaleDateString()}),"info")):(this.item.published=!0,this.messages.add(this.$gettext("File published successfully"),"success")),this.closeView()}).catch(s=>{this.messages.add(this.$gettext("Error publishing file")+`:
`+s,"error"),this.$log("FileDetail::publish(): Error publishing file",e,s)})})},reset(){this.changed=!1,this.error=!1},save(e=!1){return this.auth.can("file:save")?this.error?(this.messages.add(this.$gettext("There are invalid fields, please resolve the errors first"),"error"),Promise.resolve(!1)):this.changed?this.$apollo.mutate({mutation:_`mutation ($id: ID!, $input: FileInput!, $file: Upload) {
            saveFile(id: $id, input: $input, file: $file) {
              id
              latest {
                id
                data
                created_at
              }
            }
          }`,variables:{id:this.item.id,input:{transcription:JSON.stringify(this.item.transcription||{}),description:JSON.stringify(this.item.description||{}),previews:JSON.stringify(this.item.previews||{}),path:this.item.path,name:this.item.name,lang:this.item.lang},file:this.file},context:{hasUpload:!0}}).then(t=>{var a,s;if(t.errors)throw t.errors;const i=(s=(a=t.data)==null?void 0:a.saveFile)==null?void 0:s.latest;return Object.assign(this.item,JSON.parse((i==null?void 0:i.data)||"{}")),this.item.updated_at=i==null?void 0:i.created_at,this.item.published=!1,this.reset(),e||this.messages.add(this.$gettext("File saved successfully"),"success"),this.savecnt++,!0}).catch(t=>{this.messages.add(this.$gettext("Error saving file")+`:
`+t,"error"),this.$log("FileDetail::save(): Error saving file",t)}):Promise.resolve(!0):(this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve(!1))},use(e){Object.assign(this.item,e.data),this.vhistory=!1,this.changed=!0,this.savecnt++},versions(e){return this.auth.can("file:view")?e?this.$apollo.query({query:_`query($id: ID!) {
            file(id: $id) {
              id
              versions {
                id
                published
                publish_at
                data
                editor
                created_at
              }
            }
          }`,variables:{id:e}}).then(t=>{if(t.errors||!t.data.file)throw t;const i=["previews","description","transcription"];return(t.data.file.versions||[]).map(a=>{const s={...a,data:JSON.parse(a.data||"{}")};return i.forEach(r=>s[r]??(s[r]={})),s}).reverse()}).catch(t=>{this.messages.add(this.$gettext("Error fetching file versions")+`:
`+t,"error"),this.$log("FileDetail::versions(): Error fetching file versions",e,t)}):Promise.resolve([]):(this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve([]))}}},kr={class:"app-title"},Er={class:"menu-content"};function Tr(e,t,i,a,s,r){const n=pt("FileDetailItem"),o=pt("FileDetailRefs"),p=pt("AsideMeta"),l=pt("HistoryDialog");return v(),E(z,null,[d(wi,{elevation:0,density:"compact"},{prepend:u(()=>[d(w,{onClick:t[0]||(t[0]=h=>r.closeView()),title:e.$gettext("Back to list view"),icon:"mdi-keyboard-backspace"},null,8,["title"])]),append:u(()=>[d(w,{onClick:t[1]||(t[1]=h=>e.vhistory=!0),class:J([{hidden:i.item.published&&!e.changed&&!i.item.latest},"no-rtl"]),title:e.$gettext("View history"),icon:"mdi-history"},null,8,["class","title"]),d(w,{onClick:t[2]||(t[2]=h=>r.save()),title:e.$gettext("Save"),class:J([{error:e.error},"menu-save"]),disabled:!e.changed||e.error||!a.auth.can("file:save"),variant:!e.changed||e.error||!a.auth.can("file:save")?"plain":"flat",color:!e.changed||e.error||!a.auth.can("file:save")?"":"blue-darken-1",icon:"mdi-database-arrow-down"},null,8,["title","class","disabled","variant","color"]),d(Gt,{modelValue:e.pubmenu,"onUpdate:modelValue":t[5]||(t[5]=h=>e.pubmenu=h),"close-on-content-click":!1},{activator:u(({props:h})=>[d(w,Et(h,{icon:"",title:e.$gettext("Schedule publishing"),class:[{error:e.error},"menu-publish"],disabled:i.item.published&&!e.changed||e.error||!a.auth.can("file:publish"),variant:i.item.published&&!e.changed||e.error||!a.auth.can("file:publish")?"plain":"flat",color:i.item.published&&!e.changed||e.error||!a.auth.can("file:publish")?"":"blue-darken-2"}),{default:u(()=>[d(It,null,{default:u(()=>[...t[17]||(t[17]=[g("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},[g("path",{d:"M2,1V3H16V1H2 M2,10H6V19H12V10H16L9,3L2,10Z"}),g("path",{d:"M16.7 11.4C16.7 11.4 16.61 11.4 16.7 11.4C13.19 11.49 10.4 14.28 10.4 17.7C10.4 21.21 13.19 24 16.7 24S23 21.21 23 17.7 20.21 11.4 16.7 11.4M16.7 22.2C14.18 22.2 12.2 20.22 12.2 17.7S14.18 13.2 16.7 13.2 21.2 15.18 21.2 17.7 19.22 22.2 16.7 22.2M15.6 13.1V17.6L18.84 19.58L19.56 18.5L16.95 16.97V13.1H15.6Z"})],-1)])]),_:1})]),_:1},16,["title","class","disabled","variant","color"])]),default:u(()=>[g("div",Er,[d(Ci,{modelValue:e.publishAt,"onUpdate:modelValue":t[3]||(t[3]=h=>e.publishAt=h),"hide-header":"","show-adjacent-months":""},null,8,["modelValue"]),d(w,{onClick:t[4]||(t[4]=h=>{r.publish(e.publishAt),e.pubmenu=!1}),disabled:!e.publishAt||e.error,color:e.publishAt?"primary":"",variant:"text"},{default:u(()=>[y(b(e.$gettext("Publish")),1)]),_:1},8,["disabled","color"])])]),_:1},8,["modelValue"]),d(w,{icon:"",onClick:t[6]||(t[6]=h=>r.publish()),title:e.$gettext("Publish"),class:J([{error:e.error},"menu-publish"]),disabled:i.item.published&&!e.changed||e.error||!a.auth.can("file:publish"),variant:i.item.published&&!e.changed||e.error||!a.auth.can("file:publish")?"plain":"flat",color:i.item.published&&!e.changed||e.error||!a.auth.can("file:publish")?"":"blue-darken-2"},{default:u(()=>[d(It,null,{default:u(()=>[...t[18]||(t[18]=[g("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},[g("path",{d:"M5,2V4H19V2H5 M5,12H9V21H15V12H19L12,5L5,12Z"})],-1)])]),_:1})]),_:1},8,["title","class","disabled","variant","color"]),d(w,{onClick:t[7]||(t[7]=qt(h=>a.drawer.toggle("aside"),["stop"])),title:e.$gettext("Toggle side menu"),icon:a.drawer.aside?"mdi-chevron-right":"mdi-chevron-left"},null,8,["title","icon"])]),default:u(()=>[d(xi,null,{default:u(()=>[g("div",kr,b(e.$gettext("File"))+": "+b(i.item.name),1)]),_:1})]),_:1}),d(yi,{class:"file-details"},{default:u(()=>[d(Di,{onSubmit:t[13]||(t[13]=qt(()=>{},["prevent"]))},{default:u(()=>[d(vt,{"fixed-tabs":"",modelValue:e.tab,"onUpdate:modelValue":t[8]||(t[8]=h=>e.tab=h)},{default:u(()=>[d(ut,{value:"file",class:J({changed:e.changed,error:e.error})},{default:u(()=>[y(b(e.$gettext("File")),1)]),_:1},8,["class"]),d(ut,{value:"refs"},{default:u(()=>[y(b(e.$gettext("Used by")),1)]),_:1})]),_:1},8,["modelValue"]),d(Zt,{modelValue:e.tab,"onUpdate:modelValue":t[12]||(t[12]=h=>e.tab=h),touch:!1},{default:u(()=>[d(Lt,{value:"file"},{default:u(()=>[d(n,{"onUpdate:item":t[9]||(t[9]=h=>{this.$emit("update:item",i.item),e.changed=!0}),"onUpdate:file":t[10]||(t[10]=h=>{this.file=h,e.changed=!0}),onError:t[11]||(t[11]=h=>e.error=h),save:{count:e.savecnt},item:i.item},null,8,["save","item"])]),_:1}),d(Lt,{value:"refs"},{default:u(()=>[d(o,{item:i.item},null,8,["item"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),d(p,{item:i.item},null,8,["item"]),(v(),k(ze,{to:"body"},[d(l,{modelValue:e.vhistory,"onUpdate:modelValue":t[14]||(t[14]=h=>e.vhistory=h),current:{data:{lang:i.item.lang,name:i.item.name,mime:i.item.mime,path:i.item.path,previews:i.item.previews,description:i.item.description,transcription:i.item.transcription}},load:()=>r.versions(i.item.id),onUse:t[15]||(t[15]=h=>r.use(h)),onRevert:t[16]||(t[16]=h=>{r.use(h),r.reset()})},null,8,["modelValue","current","load"])]))],64)}const Sr=Vt(Dr,[["render",Tr],["__scopeId","data-v-50e4612e"]]);export{tr as F,ja as a,Sr as b};
