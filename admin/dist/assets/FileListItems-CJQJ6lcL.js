import{_ as Rt,L as z,a3 as Pt,b as k,o as v,w as f,aA as Le,a as c,aB as Re,ad as ai,d as V,ae as Ut,af as Wt,l as C,t as b,ag as zt,aC as Yt,f as g,c as M,F as q,a5 as it,a6 as ri,aD as si,a7 as ne,aE as ni,a4 as Pe,V as Ot,e as gt,I as Be,ao as oi,k as w,h as Ct,i as xt,j as N,m as Dt,aF as At,n as K,ab as Xt,ac as $t,aG as qt,aH as It,a1 as ge,aI as li,aJ as hi,aK as di,r as Vt,T as ui,aL as ci,Z as fi,aM as Gt,aN as pi,aO as ve,aP as mi,ai as gi,aQ as vi,a2 as be}from"./index-DK-pS6py.js";import{H as bi,A as wi}from"./ElementListItems-wFFDb7bw.js";import{P as yi}from"./PageDetail-Ch-FRslY.js";import{E as xi}from"./ElementDetail-0nx-rypx.js";const Ci={props:{item:{type:Object,required:!0}},emits:[],inject:["openView"],data:()=>({panel:[0,1,2],versions:{},file:{}}),setup(){return{auth:Pt()}},methods:{openElement(e){this.openView(xi,{item:{...e}})},openPage(e){this.openView(yi,{item:{...e}})}},watch:{item:{immediate:!0,handler(e){!e.id||!this.auth.can("file:view")||this.$apollo.query({query:z`query ($id: ID!) {
              file(id: $id) {
                id
                bypages {
                  id
                  path
                  name
                }
                byelements {
                  id
                  type
                  name
                }
                byversions {
                  id
                  versionable_id
                  versionable_type
                  published
                  publish_at
                }
              }
            }`,variables:{id:e.id}}).then(t=>{var i,a,s;if(t.errors)throw t.errors;this.file=((i=t.data)==null?void 0:i.file)||{},this.versions=(((s=(a=t.data)==null?void 0:a.file)==null?void 0:s.byversions)||[]).map(r=>({id:r.versionable_id,type:r.versionable_type.split("\\").at(-1),published:r.published?this.$gettext("yes"):r.publish_at?new Date(r.publish_at).toLocaleDateString():this.$gettext("no")})).filter(r=>this.auth.can(r.type.toLowerCase()+":view"))}).catch(t=>{this.$log("FileDetailRef::watch(item): Error fetching file",e,t)})}}}},Di=["onClick"],ki=["onClick"];function Ei(e,t,i,a,s,r){return v(),k(Le,null,{default:f(()=>[c(Re,{class:"scroll"},{default:f(()=>[c(ai,{modelValue:e.panel,"onUpdate:modelValue":t[0]||(t[0]=n=>e.panel=n),elevation:"0",multiple:""},{default:f(()=>{var n,l,d;return[(n=e.file.bypages)!=null&&n.length&&a.auth.can("page:view")?(v(),k(Ut,{key:0},{default:f(()=>[c(Wt,null,{default:f(()=>[C(b(e.$gettext("Pages")),1)]),_:1}),c(zt,null,{default:f(()=>[c(Yt,{class:"pages",density:"comfortable",hover:""},{default:f(()=>[g("thead",null,[g("tr",null,[g("th",null,b(e.$gettext("ID")),1),g("th",null,b(e.$gettext("URL")),1),g("th",null,b(e.$gettext("Name")),1)])]),g("tbody",null,[(v(!0),M(q,null,it(e.file.bypages,u=>(v(),M("tr",{key:u.id,onClick:o=>r.openPage(u)},[g("td",null,b(u.id),1),g("td",null,b("/"+u.path),1),g("td",null,b(u.name),1)],8,Di))),128))])]),_:1})]),_:1})]),_:1})):V("",!0),(l=e.file.byelements)!=null&&l.length&&a.auth.can("element:view")?(v(),k(Ut,{key:1},{default:f(()=>[c(Wt,null,{default:f(()=>[C(b(e.$gettext("Elements")),1)]),_:1}),c(zt,null,{default:f(()=>[c(Yt,{class:"elements",density:"comfortable",hover:""},{default:f(()=>[g("thead",null,[g("tr",null,[g("th",null,b(e.$gettext("ID")),1),g("th",null,b(e.$gettext("Type")),1),g("th",null,b(e.$gettext("Name")),1)])]),g("tbody",null,[(v(!0),M(q,null,it(e.file.byelements,u=>(v(),M("tr",{key:u.id,onClick:o=>r.openElement(u)},[g("td",null,b(u.id),1),g("td",null,b(u.type),1),g("td",null,b(u.name),1)],8,ki))),128))])]),_:1})]),_:1})]),_:1})):V("",!0),(d=e.versions)!=null&&d.length?(v(),k(Ut,{key:2},{default:f(()=>[c(Wt,null,{default:f(()=>[C(b(e.$gettext("Versions")),1)]),_:1}),c(zt,null,{default:f(()=>[c(Yt,{density:"comfortable",hover:""},{default:f(()=>[g("thead",null,[g("tr",null,[g("th",null,b(e.$gettext("ID")),1),g("th",null,b(e.$gettext("Type")),1),g("th",null,b(e.$gettext("Published")),1)])]),g("tbody",null,[(v(!0),M(q,null,it(e.versions,u=>(v(),M("tr",{key:u.id},[g("td",null,b(u.id),1),g("td",null,b(u.type),1),g("td",null,b(u.published),1)]))),128))])]),_:1})]),_:1})]),_:1})):V("",!0)]}),_:1},8,["modelValue"])]),_:1})]),_:1})}const Ti=Rt(Ci,[["render",Ei],["__scopeId","data-v-791df981"]]);/*!
 * Cropper.js v1.6.2
 * https://fengyuanchen.github.io/cropperjs
 *
 * Copyright 2015-present Chen Fengyuan
 * Released under the MIT license
 *
 * Date: 2024-04-21T07:43:05.335Z
 */function we(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),i.push.apply(i,a)}return i}function _e(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?we(Object(i),!0).forEach(function(a){Ni(e,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):we(Object(i)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(i,a))})}return e}function Mi(e,t){if(typeof e!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function He(e){var t=Mi(e,"string");return typeof t=="symbol"?t:t+""}function Jt(e){"@babel/helpers - typeof";return Jt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Jt(e)}function Oi(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ye(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,He(a.key),a)}}function Vi(e,t,i){return t&&ye(e.prototype,t),i&&ye(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ni(e,t,i){return t=He(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Ue(e){return Si(e)||Ai(e)||$i(e)||Ii()}function Si(e){if(Array.isArray(e))return Zt(e)}function Ai(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function $i(e,t){if(e){if(typeof e=="string")return Zt(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Zt(e,t)}}function Zt(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function Ii(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Bt=typeof window<"u"&&typeof window.document<"u",J=Bt?window:{},oe=Bt&&J.document.documentElement?"ontouchstart"in J.document.documentElement:!1,le=Bt?"PointerEvent"in J:!1,S="cropper",he="all",We="crop",ze="move",Ye="zoom",lt="e",ht="w",ut="s",et="n",vt="ne",bt="nw",wt="se",yt="sw",Qt="".concat(S,"-crop"),xe="".concat(S,"-disabled"),U="".concat(S,"-hidden"),Ce="".concat(S,"-hide"),Li="".concat(S,"-invisible"),Lt="".concat(S,"-modal"),Kt="".concat(S,"-move"),Et="".concat(S,"Action"),Nt="".concat(S,"Preview"),de="crop",Fe="move",je="none",te="crop",ee="cropend",ie="cropmove",ae="cropstart",De="dblclick",Ri=oe?"touchstart":"mousedown",Pi=oe?"touchmove":"mousemove",Bi=oe?"touchend touchcancel":"mouseup",ke=le?"pointerdown":Ri,Ee=le?"pointermove":Pi,Te=le?"pointerup pointercancel":Bi,Me="ready",Oe="resize",Ve="wheel",re="zoom",Ne="image/jpeg",_i=/^e|w|s|n|se|sw|ne|nw|all|crop|move|zoom$/,Hi=/^data:/,Ui=/^data:image\/jpeg;base64,/,Wi=/^img|canvas$/i,Xe=200,qe=100,Se={viewMode:0,dragMode:de,initialAspectRatio:NaN,aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:Xe,minContainerHeight:qe,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},zi='<div class="cropper-container" touch-action="none"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-cropper-action="e"></span><span class="cropper-line line-n" data-cropper-action="n"></span><span class="cropper-line line-w" data-cropper-action="w"></span><span class="cropper-line line-s" data-cropper-action="s"></span><span class="cropper-point point-e" data-cropper-action="e"></span><span class="cropper-point point-n" data-cropper-action="n"></span><span class="cropper-point point-w" data-cropper-action="w"></span><span class="cropper-point point-s" data-cropper-action="s"></span><span class="cropper-point point-ne" data-cropper-action="ne"></span><span class="cropper-point point-nw" data-cropper-action="nw"></span><span class="cropper-point point-sw" data-cropper-action="sw"></span><span class="cropper-point point-se" data-cropper-action="se"></span></div></div>',Yi=Number.isNaN||J.isNaN;function D(e){return typeof e=="number"&&!Yi(e)}var Ae=function(t){return t>0&&t<1/0};function Ft(e){return typeof e>"u"}function dt(e){return Jt(e)==="object"&&e!==null}var Fi=Object.prototype.hasOwnProperty;function ct(e){if(!dt(e))return!1;try{var t=e.constructor,i=t.prototype;return t&&i&&Fi.call(i,"isPrototypeOf")}catch{return!1}}function H(e){return typeof e=="function"}var ji=Array.prototype.slice;function Ge(e){return Array.from?Array.from(e):ji.call(e)}function I(e,t){return e&&H(t)&&(Array.isArray(e)||D(e.length)?Ge(e).forEach(function(i,a){t.call(e,i,a,e)}):dt(e)&&Object.keys(e).forEach(function(i){t.call(e,e[i],i,e)})),e}var A=Object.assign||function(t){for(var i=arguments.length,a=new Array(i>1?i-1:0),s=1;s<i;s++)a[s-1]=arguments[s];return dt(t)&&a.length>0&&a.forEach(function(r){dt(r)&&Object.keys(r).forEach(function(n){t[n]=r[n]})}),t},Xi=/\.\d*(?:0|9){12}\d*$/;function pt(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e11;return Xi.test(e)?Math.round(e*t)/t:e}var qi=/^width|height|left|top|marginLeft|marginTop$/;function at(e,t){var i=e.style;I(t,function(a,s){qi.test(s)&&D(a)&&(a="".concat(a,"px")),i[s]=a})}function Gi(e,t){return e.classList?e.classList.contains(t):e.className.indexOf(t)>-1}function B(e,t){if(t){if(D(e.length)){I(e,function(a){B(a,t)});return}if(e.classList){e.classList.add(t);return}var i=e.className.trim();i?i.indexOf(t)<0&&(e.className="".concat(i," ").concat(t)):e.className=t}}function G(e,t){if(t){if(D(e.length)){I(e,function(i){G(i,t)});return}if(e.classList){e.classList.remove(t);return}e.className.indexOf(t)>=0&&(e.className=e.className.replace(t,""))}}function ft(e,t,i){if(t){if(D(e.length)){I(e,function(a){ft(a,t,i)});return}i?B(e,t):G(e,t)}}var Ji=/([a-z\d])([A-Z])/g;function ue(e){return e.replace(Ji,"$1-$2").toLowerCase()}function se(e,t){return dt(e[t])?e[t]:e.dataset?e.dataset[t]:e.getAttribute("data-".concat(ue(t)))}function Tt(e,t,i){dt(i)?e[t]=i:e.dataset?e.dataset[t]=i:e.setAttribute("data-".concat(ue(t)),i)}function Zi(e,t){if(dt(e[t]))try{delete e[t]}catch{e[t]=void 0}else if(e.dataset)try{delete e.dataset[t]}catch{e.dataset[t]=void 0}else e.removeAttribute("data-".concat(ue(t)))}var Je=/\s\s*/,Ze=(function(){var e=!1;if(Bt){var t=!1,i=function(){},a=Object.defineProperty({},"once",{get:function(){return e=!0,t},set:function(r){t=r}});J.addEventListener("test",i,a),J.removeEventListener("test",i,a)}return e})();function j(e,t,i){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},s=i;t.trim().split(Je).forEach(function(r){if(!Ze){var n=e.listeners;n&&n[r]&&n[r][i]&&(s=n[r][i],delete n[r][i],Object.keys(n[r]).length===0&&delete n[r],Object.keys(n).length===0&&delete e.listeners)}e.removeEventListener(r,s,a)})}function F(e,t,i){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},s=i;t.trim().split(Je).forEach(function(r){if(a.once&&!Ze){var n=e.listeners,l=n===void 0?{}:n;s=function(){delete l[r][i],e.removeEventListener(r,s,a);for(var u=arguments.length,o=new Array(u),h=0;h<u;h++)o[h]=arguments[h];i.apply(e,o)},l[r]||(l[r]={}),l[r][i]&&e.removeEventListener(r,l[r][i],a),l[r][i]=s,e.listeners=l}e.addEventListener(r,s,a)})}function mt(e,t,i){var a;return H(Event)&&H(CustomEvent)?a=new CustomEvent(t,{detail:i,bubbles:!0,cancelable:!0}):(a=document.createEvent("CustomEvent"),a.initCustomEvent(t,!0,!0,i)),e.dispatchEvent(a)}function Qe(e){var t=e.getBoundingClientRect();return{left:t.left+(window.pageXOffset-document.documentElement.clientLeft),top:t.top+(window.pageYOffset-document.documentElement.clientTop)}}var jt=J.location,Qi=/^(\w+:)\/\/([^:/?#]*):?(\d*)/i;function $e(e){var t=e.match(Qi);return t!==null&&(t[1]!==jt.protocol||t[2]!==jt.hostname||t[3]!==jt.port)}function Ie(e){var t="timestamp=".concat(new Date().getTime());return e+(e.indexOf("?")===-1?"?":"&")+t}function kt(e){var t=e.rotate,i=e.scaleX,a=e.scaleY,s=e.translateX,r=e.translateY,n=[];D(s)&&s!==0&&n.push("translateX(".concat(s,"px)")),D(r)&&r!==0&&n.push("translateY(".concat(r,"px)")),D(t)&&t!==0&&n.push("rotate(".concat(t,"deg)")),D(i)&&i!==1&&n.push("scaleX(".concat(i,")")),D(a)&&a!==1&&n.push("scaleY(".concat(a,")"));var l=n.length?n.join(" "):"none";return{WebkitTransform:l,msTransform:l,transform:l}}function Ki(e){var t=_e({},e),i=0;return I(e,function(a,s){delete t[s],I(t,function(r){var n=Math.abs(a.startX-r.startX),l=Math.abs(a.startY-r.startY),d=Math.abs(a.endX-r.endX),u=Math.abs(a.endY-r.endY),o=Math.sqrt(n*n+l*l),h=Math.sqrt(d*d+u*u),p=(h-o)/o;Math.abs(p)>Math.abs(i)&&(i=p)})}),i}function St(e,t){var i=e.pageX,a=e.pageY,s={endX:i,endY:a};return t?s:_e({startX:i,startY:a},s)}function ta(e){var t=0,i=0,a=0;return I(e,function(s){var r=s.startX,n=s.startY;t+=r,i+=n,a+=1}),t/=a,i/=a,{pageX:t,pageY:i}}function rt(e){var t=e.aspectRatio,i=e.height,a=e.width,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"contain",r=Ae(a),n=Ae(i);if(r&&n){var l=i*t;s==="contain"&&l>a||s==="cover"&&l<a?i=a/t:a=i*t}else r?i=a/t:n&&(a=i*t);return{width:a,height:i}}function ea(e){var t=e.width,i=e.height,a=e.degree;if(a=Math.abs(a)%180,a===90)return{width:i,height:t};var s=a%90*Math.PI/180,r=Math.sin(s),n=Math.cos(s),l=t*n+i*r,d=t*r+i*n;return a>90?{width:d,height:l}:{width:l,height:d}}function ia(e,t,i,a){var s=t.aspectRatio,r=t.naturalWidth,n=t.naturalHeight,l=t.rotate,d=l===void 0?0:l,u=t.scaleX,o=u===void 0?1:u,h=t.scaleY,p=h===void 0?1:h,x=i.aspectRatio,y=i.naturalWidth,O=i.naturalHeight,E=a.fillColor,L=E===void 0?"transparent":E,P=a.imageSmoothingEnabled,$=P===void 0?!0:P,Z=a.imageSmoothingQuality,W=Z===void 0?"low":Z,m=a.maxWidth,T=m===void 0?1/0:m,R=a.maxHeight,Y=R===void 0?1/0:R,Q=a.minWidth,st=Q===void 0?0:Q,nt=a.minHeight,tt=nt===void 0?0:nt,X=document.createElement("canvas"),_=X.getContext("2d"),ot=rt({aspectRatio:x,width:T,height:Y}),Mt=rt({aspectRatio:x,width:st,height:tt},"cover"),_t=Math.min(ot.width,Math.max(Mt.width,y)),Ht=Math.min(ot.height,Math.max(Mt.height,O)),ce=rt({aspectRatio:s,width:T,height:Y}),fe=rt({aspectRatio:s,width:st,height:tt},"cover"),pe=Math.min(ce.width,Math.max(fe.width,r)),me=Math.min(ce.height,Math.max(fe.height,n)),ei=[-pe/2,-me/2,pe,me];return X.width=pt(_t),X.height=pt(Ht),_.fillStyle=L,_.fillRect(0,0,_t,Ht),_.save(),_.translate(_t/2,Ht/2),_.rotate(d*Math.PI/180),_.scale(o,p),_.imageSmoothingEnabled=$,_.imageSmoothingQuality=W,_.drawImage.apply(_,[e].concat(Ue(ei.map(function(ii){return Math.floor(pt(ii))})))),_.restore(),X}var Ke=String.fromCharCode;function aa(e,t,i){var a="";i+=t;for(var s=t;s<i;s+=1)a+=Ke(e.getUint8(s));return a}var ra=/^data:.*,/;function sa(e){var t=e.replace(ra,""),i=atob(t),a=new ArrayBuffer(i.length),s=new Uint8Array(a);return I(s,function(r,n){s[n]=i.charCodeAt(n)}),a}function na(e,t){for(var i=[],a=8192,s=new Uint8Array(e);s.length>0;)i.push(Ke.apply(null,Ge(s.subarray(0,a)))),s=s.subarray(a);return"data:".concat(t,";base64,").concat(btoa(i.join("")))}function oa(e){var t=new DataView(e),i;try{var a,s,r;if(t.getUint8(0)===255&&t.getUint8(1)===216)for(var n=t.byteLength,l=2;l+1<n;){if(t.getUint8(l)===255&&t.getUint8(l+1)===225){s=l;break}l+=1}if(s){var d=s+4,u=s+10;if(aa(t,d,4)==="Exif"){var o=t.getUint16(u);if(a=o===18761,(a||o===19789)&&t.getUint16(u+2,a)===42){var h=t.getUint32(u+4,a);h>=8&&(r=u+h)}}}if(r){var p=t.getUint16(r,a),x,y;for(y=0;y<p;y+=1)if(x=r+y*12+2,t.getUint16(x,a)===274){x+=8,i=t.getUint16(x,a),t.setUint16(x,1,a);break}}}catch{i=1}return i}function la(e){var t=0,i=1,a=1;switch(e){case 2:i=-1;break;case 3:t=-180;break;case 4:a=-1;break;case 5:t=90,a=-1;break;case 6:t=90;break;case 7:t=90,i=-1;break;case 8:t=-90;break}return{rotate:t,scaleX:i,scaleY:a}}var ha={render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var t=this.element,i=this.options,a=this.container,s=this.cropper,r=Number(i.minContainerWidth),n=Number(i.minContainerHeight);B(s,U),G(t,U);var l={width:Math.max(a.offsetWidth,r>=0?r:Xe),height:Math.max(a.offsetHeight,n>=0?n:qe)};this.containerData=l,at(s,{width:l.width,height:l.height}),B(t,U),G(s,U)},initCanvas:function(){var t=this.containerData,i=this.imageData,a=this.options.viewMode,s=Math.abs(i.rotate)%180===90,r=s?i.naturalHeight:i.naturalWidth,n=s?i.naturalWidth:i.naturalHeight,l=r/n,d=t.width,u=t.height;t.height*l>t.width?a===3?d=t.height*l:u=t.width/l:a===3?u=t.width/l:d=t.height*l;var o={aspectRatio:l,naturalWidth:r,naturalHeight:n,width:d,height:u};this.canvasData=o,this.limited=a===1||a===2,this.limitCanvas(!0,!0),o.width=Math.min(Math.max(o.width,o.minWidth),o.maxWidth),o.height=Math.min(Math.max(o.height,o.minHeight),o.maxHeight),o.left=(t.width-o.width)/2,o.top=(t.height-o.height)/2,o.oldLeft=o.left,o.oldTop=o.top,this.initialCanvasData=A({},o)},limitCanvas:function(t,i){var a=this.options,s=this.containerData,r=this.canvasData,n=this.cropBoxData,l=a.viewMode,d=r.aspectRatio,u=this.cropped&&n;if(t){var o=Number(a.minCanvasWidth)||0,h=Number(a.minCanvasHeight)||0;l>1?(o=Math.max(o,s.width),h=Math.max(h,s.height),l===3&&(h*d>o?o=h*d:h=o/d)):l>0&&(o?o=Math.max(o,u?n.width:0):h?h=Math.max(h,u?n.height:0):u&&(o=n.width,h=n.height,h*d>o?o=h*d:h=o/d));var p=rt({aspectRatio:d,width:o,height:h});o=p.width,h=p.height,r.minWidth=o,r.minHeight=h,r.maxWidth=1/0,r.maxHeight=1/0}if(i)if(l>(u?0:1)){var x=s.width-r.width,y=s.height-r.height;r.minLeft=Math.min(0,x),r.minTop=Math.min(0,y),r.maxLeft=Math.max(0,x),r.maxTop=Math.max(0,y),u&&this.limited&&(r.minLeft=Math.min(n.left,n.left+(n.width-r.width)),r.minTop=Math.min(n.top,n.top+(n.height-r.height)),r.maxLeft=n.left,r.maxTop=n.top,l===2&&(r.width>=s.width&&(r.minLeft=Math.min(0,x),r.maxLeft=Math.max(0,x)),r.height>=s.height&&(r.minTop=Math.min(0,y),r.maxTop=Math.max(0,y))))}else r.minLeft=-r.width,r.minTop=-r.height,r.maxLeft=s.width,r.maxTop=s.height},renderCanvas:function(t,i){var a=this.canvasData,s=this.imageData;if(i){var r=ea({width:s.naturalWidth*Math.abs(s.scaleX||1),height:s.naturalHeight*Math.abs(s.scaleY||1),degree:s.rotate||0}),n=r.width,l=r.height,d=a.width*(n/a.naturalWidth),u=a.height*(l/a.naturalHeight);a.left-=(d-a.width)/2,a.top-=(u-a.height)/2,a.width=d,a.height=u,a.aspectRatio=n/l,a.naturalWidth=n,a.naturalHeight=l,this.limitCanvas(!0,!1)}(a.width>a.maxWidth||a.width<a.minWidth)&&(a.left=a.oldLeft),(a.height>a.maxHeight||a.height<a.minHeight)&&(a.top=a.oldTop),a.width=Math.min(Math.max(a.width,a.minWidth),a.maxWidth),a.height=Math.min(Math.max(a.height,a.minHeight),a.maxHeight),this.limitCanvas(!1,!0),a.left=Math.min(Math.max(a.left,a.minLeft),a.maxLeft),a.top=Math.min(Math.max(a.top,a.minTop),a.maxTop),a.oldLeft=a.left,a.oldTop=a.top,at(this.canvas,A({width:a.width,height:a.height},kt({translateX:a.left,translateY:a.top}))),this.renderImage(t),this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage:function(t){var i=this.canvasData,a=this.imageData,s=a.naturalWidth*(i.width/i.naturalWidth),r=a.naturalHeight*(i.height/i.naturalHeight);A(a,{width:s,height:r,left:(i.width-s)/2,top:(i.height-r)/2}),at(this.image,A({width:a.width,height:a.height},kt(A({translateX:a.left,translateY:a.top},a)))),t&&this.output()},initCropBox:function(){var t=this.options,i=this.canvasData,a=t.aspectRatio||t.initialAspectRatio,s=Number(t.autoCropArea)||.8,r={width:i.width,height:i.height};a&&(i.height*a>i.width?r.height=r.width/a:r.width=r.height*a),this.cropBoxData=r,this.limitCropBox(!0,!0),r.width=Math.min(Math.max(r.width,r.minWidth),r.maxWidth),r.height=Math.min(Math.max(r.height,r.minHeight),r.maxHeight),r.width=Math.max(r.minWidth,r.width*s),r.height=Math.max(r.minHeight,r.height*s),r.left=i.left+(i.width-r.width)/2,r.top=i.top+(i.height-r.height)/2,r.oldLeft=r.left,r.oldTop=r.top,this.initialCropBoxData=A({},r)},limitCropBox:function(t,i){var a=this.options,s=this.containerData,r=this.canvasData,n=this.cropBoxData,l=this.limited,d=a.aspectRatio;if(t){var u=Number(a.minCropBoxWidth)||0,o=Number(a.minCropBoxHeight)||0,h=l?Math.min(s.width,r.width,r.width+r.left,s.width-r.left):s.width,p=l?Math.min(s.height,r.height,r.height+r.top,s.height-r.top):s.height;u=Math.min(u,s.width),o=Math.min(o,s.height),d&&(u&&o?o*d>u?o=u/d:u=o*d:u?o=u/d:o&&(u=o*d),p*d>h?p=h/d:h=p*d),n.minWidth=Math.min(u,h),n.minHeight=Math.min(o,p),n.maxWidth=h,n.maxHeight=p}i&&(l?(n.minLeft=Math.max(0,r.left),n.minTop=Math.max(0,r.top),n.maxLeft=Math.min(s.width,r.left+r.width)-n.width,n.maxTop=Math.min(s.height,r.top+r.height)-n.height):(n.minLeft=0,n.minTop=0,n.maxLeft=s.width-n.width,n.maxTop=s.height-n.height))},renderCropBox:function(){var t=this.options,i=this.containerData,a=this.cropBoxData;(a.width>a.maxWidth||a.width<a.minWidth)&&(a.left=a.oldLeft),(a.height>a.maxHeight||a.height<a.minHeight)&&(a.top=a.oldTop),a.width=Math.min(Math.max(a.width,a.minWidth),a.maxWidth),a.height=Math.min(Math.max(a.height,a.minHeight),a.maxHeight),this.limitCropBox(!1,!0),a.left=Math.min(Math.max(a.left,a.minLeft),a.maxLeft),a.top=Math.min(Math.max(a.top,a.minTop),a.maxTop),a.oldLeft=a.left,a.oldTop=a.top,t.movable&&t.cropBoxMovable&&Tt(this.face,Et,a.width>=i.width&&a.height>=i.height?ze:he),at(this.cropBox,A({width:a.width,height:a.height},kt({translateX:a.left,translateY:a.top}))),this.cropped&&this.limited&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),mt(this.element,te,this.getData())}},da={initPreview:function(){var t=this.element,i=this.crossOrigin,a=this.options.preview,s=i?this.crossOriginUrl:this.url,r=t.alt||"The image to preview",n=document.createElement("img");if(i&&(n.crossOrigin=i),n.src=s,n.alt=r,this.viewBox.appendChild(n),this.viewBoxImage=n,!!a){var l=a;typeof a=="string"?l=t.ownerDocument.querySelectorAll(a):a.querySelector&&(l=[a]),this.previews=l,I(l,function(d){var u=document.createElement("img");Tt(d,Nt,{width:d.offsetWidth,height:d.offsetHeight,html:d.innerHTML}),i&&(u.crossOrigin=i),u.src=s,u.alt=r,u.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"',d.innerHTML="",d.appendChild(u)})}},resetPreview:function(){I(this.previews,function(t){var i=se(t,Nt);at(t,{width:i.width,height:i.height}),t.innerHTML=i.html,Zi(t,Nt)})},preview:function(){var t=this.imageData,i=this.canvasData,a=this.cropBoxData,s=a.width,r=a.height,n=t.width,l=t.height,d=a.left-i.left-t.left,u=a.top-i.top-t.top;!this.cropped||this.disabled||(at(this.viewBoxImage,A({width:n,height:l},kt(A({translateX:-d,translateY:-u},t)))),I(this.previews,function(o){var h=se(o,Nt),p=h.width,x=h.height,y=p,O=x,E=1;s&&(E=p/s,O=r*E),r&&O>x&&(E=x/r,y=s*E,O=x),at(o,{width:y,height:O}),at(o.getElementsByTagName("img")[0],A({width:n*E,height:l*E},kt(A({translateX:-d*E,translateY:-u*E},t))))}))}},ua={bind:function(){var t=this.element,i=this.options,a=this.cropper;H(i.cropstart)&&F(t,ae,i.cropstart),H(i.cropmove)&&F(t,ie,i.cropmove),H(i.cropend)&&F(t,ee,i.cropend),H(i.crop)&&F(t,te,i.crop),H(i.zoom)&&F(t,re,i.zoom),F(a,ke,this.onCropStart=this.cropStart.bind(this)),i.zoomable&&i.zoomOnWheel&&F(a,Ve,this.onWheel=this.wheel.bind(this),{passive:!1,capture:!0}),i.toggleDragModeOnDblclick&&F(a,De,this.onDblclick=this.dblclick.bind(this)),F(t.ownerDocument,Ee,this.onCropMove=this.cropMove.bind(this)),F(t.ownerDocument,Te,this.onCropEnd=this.cropEnd.bind(this)),i.responsive&&F(window,Oe,this.onResize=this.resize.bind(this))},unbind:function(){var t=this.element,i=this.options,a=this.cropper;H(i.cropstart)&&j(t,ae,i.cropstart),H(i.cropmove)&&j(t,ie,i.cropmove),H(i.cropend)&&j(t,ee,i.cropend),H(i.crop)&&j(t,te,i.crop),H(i.zoom)&&j(t,re,i.zoom),j(a,ke,this.onCropStart),i.zoomable&&i.zoomOnWheel&&j(a,Ve,this.onWheel,{passive:!1,capture:!0}),i.toggleDragModeOnDblclick&&j(a,De,this.onDblclick),j(t.ownerDocument,Ee,this.onCropMove),j(t.ownerDocument,Te,this.onCropEnd),i.responsive&&j(window,Oe,this.onResize)}},ca={resize:function(){if(!this.disabled){var t=this.options,i=this.container,a=this.containerData,s=i.offsetWidth/a.width,r=i.offsetHeight/a.height,n=Math.abs(s-1)>Math.abs(r-1)?s:r;if(n!==1){var l,d;t.restore&&(l=this.getCanvasData(),d=this.getCropBoxData()),this.render(),t.restore&&(this.setCanvasData(I(l,function(u,o){l[o]=u*n})),this.setCropBoxData(I(d,function(u,o){d[o]=u*n})))}}},dblclick:function(){this.disabled||this.options.dragMode===je||this.setDragMode(Gi(this.dragBox,Qt)?Fe:de)},wheel:function(t){var i=this,a=Number(this.options.wheelZoomRatio)||.1,s=1;this.disabled||(t.preventDefault(),!this.wheeling&&(this.wheeling=!0,setTimeout(function(){i.wheeling=!1},50),t.deltaY?s=t.deltaY>0?1:-1:t.wheelDelta?s=-t.wheelDelta/120:t.detail&&(s=t.detail>0?1:-1),this.zoom(-s*a,t)))},cropStart:function(t){var i=t.buttons,a=t.button;if(!(this.disabled||(t.type==="mousedown"||t.type==="pointerdown"&&t.pointerType==="mouse")&&(D(i)&&i!==1||D(a)&&a!==0||t.ctrlKey))){var s=this.options,r=this.pointers,n;t.changedTouches?I(t.changedTouches,function(l){r[l.identifier]=St(l)}):r[t.pointerId||0]=St(t),Object.keys(r).length>1&&s.zoomable&&s.zoomOnTouch?n=Ye:n=se(t.target,Et),_i.test(n)&&mt(this.element,ae,{originalEvent:t,action:n})!==!1&&(t.preventDefault(),this.action=n,this.cropping=!1,n===We&&(this.cropping=!0,B(this.dragBox,Lt)))}},cropMove:function(t){var i=this.action;if(!(this.disabled||!i)){var a=this.pointers;t.preventDefault(),mt(this.element,ie,{originalEvent:t,action:i})!==!1&&(t.changedTouches?I(t.changedTouches,function(s){A(a[s.identifier]||{},St(s,!0))}):A(a[t.pointerId||0]||{},St(t,!0)),this.change(t))}},cropEnd:function(t){if(!this.disabled){var i=this.action,a=this.pointers;t.changedTouches?I(t.changedTouches,function(s){delete a[s.identifier]}):delete a[t.pointerId||0],i&&(t.preventDefault(),Object.keys(a).length||(this.action=""),this.cropping&&(this.cropping=!1,ft(this.dragBox,Lt,this.cropped&&this.options.modal)),mt(this.element,ee,{originalEvent:t,action:i}))}}},fa={change:function(t){var i=this.options,a=this.canvasData,s=this.containerData,r=this.cropBoxData,n=this.pointers,l=this.action,d=i.aspectRatio,u=r.left,o=r.top,h=r.width,p=r.height,x=u+h,y=o+p,O=0,E=0,L=s.width,P=s.height,$=!0,Z;!d&&t.shiftKey&&(d=h&&p?h/p:1),this.limited&&(O=r.minLeft,E=r.minTop,L=O+Math.min(s.width,a.width,a.left+a.width),P=E+Math.min(s.height,a.height,a.top+a.height));var W=n[Object.keys(n)[0]],m={x:W.endX-W.startX,y:W.endY-W.startY},T=function(Y){switch(Y){case lt:x+m.x>L&&(m.x=L-x);break;case ht:u+m.x<O&&(m.x=O-u);break;case et:o+m.y<E&&(m.y=E-o);break;case ut:y+m.y>P&&(m.y=P-y);break}};switch(l){case he:u+=m.x,o+=m.y;break;case lt:if(m.x>=0&&(x>=L||d&&(o<=E||y>=P))){$=!1;break}T(lt),h+=m.x,h<0&&(l=ht,h=-h,u-=h),d&&(p=h/d,o+=(r.height-p)/2);break;case et:if(m.y<=0&&(o<=E||d&&(u<=O||x>=L))){$=!1;break}T(et),p-=m.y,o+=m.y,p<0&&(l=ut,p=-p,o-=p),d&&(h=p*d,u+=(r.width-h)/2);break;case ht:if(m.x<=0&&(u<=O||d&&(o<=E||y>=P))){$=!1;break}T(ht),h-=m.x,u+=m.x,h<0&&(l=lt,h=-h,u-=h),d&&(p=h/d,o+=(r.height-p)/2);break;case ut:if(m.y>=0&&(y>=P||d&&(u<=O||x>=L))){$=!1;break}T(ut),p+=m.y,p<0&&(l=et,p=-p,o-=p),d&&(h=p*d,u+=(r.width-h)/2);break;case vt:if(d){if(m.y<=0&&(o<=E||x>=L)){$=!1;break}T(et),p-=m.y,o+=m.y,h=p*d}else T(et),T(lt),m.x>=0?x<L?h+=m.x:m.y<=0&&o<=E&&($=!1):h+=m.x,m.y<=0?o>E&&(p-=m.y,o+=m.y):(p-=m.y,o+=m.y);h<0&&p<0?(l=yt,p=-p,h=-h,o-=p,u-=h):h<0?(l=bt,h=-h,u-=h):p<0&&(l=wt,p=-p,o-=p);break;case bt:if(d){if(m.y<=0&&(o<=E||u<=O)){$=!1;break}T(et),p-=m.y,o+=m.y,h=p*d,u+=r.width-h}else T(et),T(ht),m.x<=0?u>O?(h-=m.x,u+=m.x):m.y<=0&&o<=E&&($=!1):(h-=m.x,u+=m.x),m.y<=0?o>E&&(p-=m.y,o+=m.y):(p-=m.y,o+=m.y);h<0&&p<0?(l=wt,p=-p,h=-h,o-=p,u-=h):h<0?(l=vt,h=-h,u-=h):p<0&&(l=yt,p=-p,o-=p);break;case yt:if(d){if(m.x<=0&&(u<=O||y>=P)){$=!1;break}T(ht),h-=m.x,u+=m.x,p=h/d}else T(ut),T(ht),m.x<=0?u>O?(h-=m.x,u+=m.x):m.y>=0&&y>=P&&($=!1):(h-=m.x,u+=m.x),m.y>=0?y<P&&(p+=m.y):p+=m.y;h<0&&p<0?(l=vt,p=-p,h=-h,o-=p,u-=h):h<0?(l=wt,h=-h,u-=h):p<0&&(l=bt,p=-p,o-=p);break;case wt:if(d){if(m.x>=0&&(x>=L||y>=P)){$=!1;break}T(lt),h+=m.x,p=h/d}else T(ut),T(lt),m.x>=0?x<L?h+=m.x:m.y>=0&&y>=P&&($=!1):h+=m.x,m.y>=0?y<P&&(p+=m.y):p+=m.y;h<0&&p<0?(l=bt,p=-p,h=-h,o-=p,u-=h):h<0?(l=yt,h=-h,u-=h):p<0&&(l=vt,p=-p,o-=p);break;case ze:this.move(m.x,m.y),$=!1;break;case Ye:this.zoom(Ki(n),t),$=!1;break;case We:if(!m.x||!m.y){$=!1;break}Z=Qe(this.cropper),u=W.startX-Z.left,o=W.startY-Z.top,h=r.minWidth,p=r.minHeight,m.x>0?l=m.y>0?wt:vt:m.x<0&&(u-=h,l=m.y>0?yt:bt),m.y<0&&(o-=p),this.cropped||(G(this.cropBox,U),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0));break}$&&(r.width=h,r.height=p,r.left=u,r.top=o,this.action=l,this.renderCropBox()),I(n,function(R){R.startX=R.endX,R.startY=R.endY})}},pa={crop:function(){return this.ready&&!this.cropped&&!this.disabled&&(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&B(this.dragBox,Lt),G(this.cropBox,U),this.setCropBoxData(this.initialCropBoxData)),this},reset:function(){return this.ready&&!this.disabled&&(this.imageData=A({},this.initialImageData),this.canvasData=A({},this.initialCanvasData),this.cropBoxData=A({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox()),this},clear:function(){return this.cropped&&!this.disabled&&(A(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),G(this.dragBox,Lt),B(this.cropBox,U)),this},replace:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return!this.disabled&&t&&(this.isImg&&(this.element.src=t),i?(this.url=t,this.image.src=t,this.ready&&(this.viewBoxImage.src=t,I(this.previews,function(a){a.getElementsByTagName("img")[0].src=t}))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.uncreate(),this.load(t))),this},enable:function(){return this.ready&&this.disabled&&(this.disabled=!1,G(this.cropper,xe)),this},disable:function(){return this.ready&&!this.disabled&&(this.disabled=!0,B(this.cropper,xe)),this},destroy:function(){var t=this.element;return t[S]?(t[S]=void 0,this.isImg&&this.replaced&&(t.src=this.originalUrl),this.uncreate(),this):this},move:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,a=this.canvasData,s=a.left,r=a.top;return this.moveTo(Ft(t)?t:s+Number(t),Ft(i)?i:r+Number(i))},moveTo:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,a=this.canvasData,s=!1;return t=Number(t),i=Number(i),this.ready&&!this.disabled&&this.options.movable&&(D(t)&&(a.left=t,s=!0),D(i)&&(a.top=i,s=!0),s&&this.renderCanvas(!0)),this},zoom:function(t,i){var a=this.canvasData;return t=Number(t),t<0?t=1/(1-t):t=1+t,this.zoomTo(a.width*t/a.naturalWidth,null,i)},zoomTo:function(t,i,a){var s=this.options,r=this.canvasData,n=r.width,l=r.height,d=r.naturalWidth,u=r.naturalHeight;if(t=Number(t),t>=0&&this.ready&&!this.disabled&&s.zoomable){var o=d*t,h=u*t;if(mt(this.element,re,{ratio:t,oldRatio:n/d,originalEvent:a})===!1)return this;if(a){var p=this.pointers,x=Qe(this.cropper),y=p&&Object.keys(p).length?ta(p):{pageX:a.pageX,pageY:a.pageY};r.left-=(o-n)*((y.pageX-x.left-r.left)/n),r.top-=(h-l)*((y.pageY-x.top-r.top)/l)}else ct(i)&&D(i.x)&&D(i.y)?(r.left-=(o-n)*((i.x-r.left)/n),r.top-=(h-l)*((i.y-r.top)/l)):(r.left-=(o-n)/2,r.top-=(h-l)/2);r.width=o,r.height=h,this.renderCanvas(!0)}return this},rotate:function(t){return this.rotateTo((this.imageData.rotate||0)+Number(t))},rotateTo:function(t){return t=Number(t),D(t)&&this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=t%360,this.renderCanvas(!0,!0)),this},scaleX:function(t){var i=this.imageData.scaleY;return this.scale(t,D(i)?i:1)},scaleY:function(t){var i=this.imageData.scaleX;return this.scale(D(i)?i:1,t)},scale:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,a=this.imageData,s=!1;return t=Number(t),i=Number(i),this.ready&&!this.disabled&&this.options.scalable&&(D(t)&&(a.scaleX=t,s=!0),D(i)&&(a.scaleY=i,s=!0),s&&this.renderCanvas(!0,!0)),this},getData:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,i=this.options,a=this.imageData,s=this.canvasData,r=this.cropBoxData,n;if(this.ready&&this.cropped){n={x:r.left-s.left,y:r.top-s.top,width:r.width,height:r.height};var l=a.width/a.naturalWidth;if(I(n,function(o,h){n[h]=o/l}),t){var d=Math.round(n.y+n.height),u=Math.round(n.x+n.width);n.x=Math.round(n.x),n.y=Math.round(n.y),n.width=u-n.x,n.height=d-n.y}}else n={x:0,y:0,width:0,height:0};return i.rotatable&&(n.rotate=a.rotate||0),i.scalable&&(n.scaleX=a.scaleX||1,n.scaleY=a.scaleY||1),n},setData:function(t){var i=this.options,a=this.imageData,s=this.canvasData,r={};if(this.ready&&!this.disabled&&ct(t)){var n=!1;i.rotatable&&D(t.rotate)&&t.rotate!==a.rotate&&(a.rotate=t.rotate,n=!0),i.scalable&&(D(t.scaleX)&&t.scaleX!==a.scaleX&&(a.scaleX=t.scaleX,n=!0),D(t.scaleY)&&t.scaleY!==a.scaleY&&(a.scaleY=t.scaleY,n=!0)),n&&this.renderCanvas(!0,!0);var l=a.width/a.naturalWidth;D(t.x)&&(r.left=t.x*l+s.left),D(t.y)&&(r.top=t.y*l+s.top),D(t.width)&&(r.width=t.width*l),D(t.height)&&(r.height=t.height*l),this.setCropBoxData(r)}return this},getContainerData:function(){return this.ready?A({},this.containerData):{}},getImageData:function(){return this.sized?A({},this.imageData):{}},getCanvasData:function(){var t=this.canvasData,i={};return this.ready&&I(["left","top","width","height","naturalWidth","naturalHeight"],function(a){i[a]=t[a]}),i},setCanvasData:function(t){var i=this.canvasData,a=i.aspectRatio;return this.ready&&!this.disabled&&ct(t)&&(D(t.left)&&(i.left=t.left),D(t.top)&&(i.top=t.top),D(t.width)?(i.width=t.width,i.height=t.width/a):D(t.height)&&(i.height=t.height,i.width=t.height*a),this.renderCanvas(!0)),this},getCropBoxData:function(){var t=this.cropBoxData,i;return this.ready&&this.cropped&&(i={left:t.left,top:t.top,width:t.width,height:t.height}),i||{}},setCropBoxData:function(t){var i=this.cropBoxData,a=this.options.aspectRatio,s,r;return this.ready&&this.cropped&&!this.disabled&&ct(t)&&(D(t.left)&&(i.left=t.left),D(t.top)&&(i.top=t.top),D(t.width)&&t.width!==i.width&&(s=!0,i.width=t.width),D(t.height)&&t.height!==i.height&&(r=!0,i.height=t.height),a&&(s?i.height=i.width/a:r&&(i.width=i.height*a)),this.renderCropBox()),this},getCroppedCanvas:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!this.ready||!window.HTMLCanvasElement)return null;var i=this.canvasData,a=ia(this.image,this.imageData,i,t);if(!this.cropped)return a;var s=this.getData(t.rounded),r=s.x,n=s.y,l=s.width,d=s.height,u=a.width/Math.floor(i.naturalWidth);u!==1&&(r*=u,n*=u,l*=u,d*=u);var o=l/d,h=rt({aspectRatio:o,width:t.maxWidth||1/0,height:t.maxHeight||1/0}),p=rt({aspectRatio:o,width:t.minWidth||0,height:t.minHeight||0},"cover"),x=rt({aspectRatio:o,width:t.width||(u!==1?a.width:l),height:t.height||(u!==1?a.height:d)}),y=x.width,O=x.height;y=Math.min(h.width,Math.max(p.width,y)),O=Math.min(h.height,Math.max(p.height,O));var E=document.createElement("canvas"),L=E.getContext("2d");E.width=pt(y),E.height=pt(O),L.fillStyle=t.fillColor||"transparent",L.fillRect(0,0,y,O);var P=t.imageSmoothingEnabled,$=P===void 0?!0:P,Z=t.imageSmoothingQuality;L.imageSmoothingEnabled=$,Z&&(L.imageSmoothingQuality=Z);var W=a.width,m=a.height,T=r,R=n,Y,Q,st,nt,tt,X;T<=-l||T>W?(T=0,Y=0,st=0,tt=0):T<=0?(st=-T,T=0,Y=Math.min(W,l+T),tt=Y):T<=W&&(st=0,Y=Math.min(l,W-T),tt=Y),Y<=0||R<=-d||R>m?(R=0,Q=0,nt=0,X=0):R<=0?(nt=-R,R=0,Q=Math.min(m,d+R),X=Q):R<=m&&(nt=0,Q=Math.min(d,m-R),X=Q);var _=[T,R,Y,Q];if(tt>0&&X>0){var ot=y/l;_.push(st*ot,nt*ot,tt*ot,X*ot)}return L.drawImage.apply(L,[a].concat(Ue(_.map(function(Mt){return Math.floor(pt(Mt))})))),E},setAspectRatio:function(t){var i=this.options;return!this.disabled&&!Ft(t)&&(i.aspectRatio=Math.max(0,t)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox())),this},setDragMode:function(t){var i=this.options,a=this.dragBox,s=this.face;if(this.ready&&!this.disabled){var r=t===de,n=i.movable&&t===Fe;t=r||n?t:je,i.dragMode=t,Tt(a,Et,t),ft(a,Qt,r),ft(a,Kt,n),i.cropBoxMovable||(Tt(s,Et,t),ft(s,Qt,r),ft(s,Kt,n))}return this}},ma=J.Cropper,ti=(function(){function e(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Oi(this,e),!t||!Wi.test(t.tagName))throw new Error("The first argument is required and must be an <img> or <canvas> element.");this.element=t,this.options=A({},Se,ct(i)&&i),this.cropped=!1,this.disabled=!1,this.pointers={},this.ready=!1,this.reloading=!1,this.replaced=!1,this.sized=!1,this.sizing=!1,this.init()}return Vi(e,[{key:"init",value:function(){var i=this.element,a=i.tagName.toLowerCase(),s;if(!i[S]){if(i[S]=this,a==="img"){if(this.isImg=!0,s=i.getAttribute("src")||"",this.originalUrl=s,!s)return;s=i.src}else a==="canvas"&&window.HTMLCanvasElement&&(s=i.toDataURL());this.load(s)}}},{key:"load",value:function(i){var a=this;if(i){this.url=i,this.imageData={};var s=this.element,r=this.options;if(!r.rotatable&&!r.scalable&&(r.checkOrientation=!1),!r.checkOrientation||!window.ArrayBuffer){this.clone();return}if(Hi.test(i)){Ui.test(i)?this.read(sa(i)):this.clone();return}var n=new XMLHttpRequest,l=this.clone.bind(this);this.reloading=!0,this.xhr=n,n.onabort=l,n.onerror=l,n.ontimeout=l,n.onprogress=function(){n.getResponseHeader("content-type")!==Ne&&n.abort()},n.onload=function(){a.read(n.response)},n.onloadend=function(){a.reloading=!1,a.xhr=null},r.checkCrossOrigin&&$e(i)&&s.crossOrigin&&(i=Ie(i)),n.open("GET",i,!0),n.responseType="arraybuffer",n.withCredentials=s.crossOrigin==="use-credentials",n.send()}}},{key:"read",value:function(i){var a=this.options,s=this.imageData,r=oa(i),n=0,l=1,d=1;if(r>1){this.url=na(i,Ne);var u=la(r);n=u.rotate,l=u.scaleX,d=u.scaleY}a.rotatable&&(s.rotate=n),a.scalable&&(s.scaleX=l,s.scaleY=d),this.clone()}},{key:"clone",value:function(){var i=this.element,a=this.url,s=i.crossOrigin,r=a;this.options.checkCrossOrigin&&$e(a)&&(s||(s="anonymous"),r=Ie(a)),this.crossOrigin=s,this.crossOriginUrl=r;var n=document.createElement("img");s&&(n.crossOrigin=s),n.src=r||a,n.alt=i.alt||"The image to crop",this.image=n,n.onload=this.start.bind(this),n.onerror=this.stop.bind(this),B(n,Ce),i.parentNode.insertBefore(n,i.nextSibling)}},{key:"start",value:function(){var i=this,a=this.image;a.onload=null,a.onerror=null,this.sizing=!0;var s=J.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(J.navigator.userAgent),r=function(u,o){A(i.imageData,{naturalWidth:u,naturalHeight:o,aspectRatio:u/o}),i.initialImageData=A({},i.imageData),i.sizing=!1,i.sized=!0,i.build()};if(a.naturalWidth&&!s){r(a.naturalWidth,a.naturalHeight);return}var n=document.createElement("img"),l=document.body||document.documentElement;this.sizingImage=n,n.onload=function(){r(n.width,n.height),s||l.removeChild(n)},n.src=a.src,s||(n.style.cssText="left:0;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;opacity:0;position:absolute;top:0;z-index:-1;",l.appendChild(n))}},{key:"stop",value:function(){var i=this.image;i.onload=null,i.onerror=null,i.parentNode.removeChild(i),this.image=null}},{key:"build",value:function(){if(!(!this.sized||this.ready)){var i=this.element,a=this.options,s=this.image,r=i.parentNode,n=document.createElement("div");n.innerHTML=zi;var l=n.querySelector(".".concat(S,"-container")),d=l.querySelector(".".concat(S,"-canvas")),u=l.querySelector(".".concat(S,"-drag-box")),o=l.querySelector(".".concat(S,"-crop-box")),h=o.querySelector(".".concat(S,"-face"));this.container=r,this.cropper=l,this.canvas=d,this.dragBox=u,this.cropBox=o,this.viewBox=l.querySelector(".".concat(S,"-view-box")),this.face=h,d.appendChild(s),B(i,U),r.insertBefore(l,i.nextSibling),G(s,Ce),this.initPreview(),this.bind(),a.initialAspectRatio=Math.max(0,a.initialAspectRatio)||NaN,a.aspectRatio=Math.max(0,a.aspectRatio)||NaN,a.viewMode=Math.max(0,Math.min(3,Math.round(a.viewMode)))||0,B(o,U),a.guides||B(o.getElementsByClassName("".concat(S,"-dashed")),U),a.center||B(o.getElementsByClassName("".concat(S,"-center")),U),a.background&&B(l,"".concat(S,"-bg")),a.highlight||B(h,Li),a.cropBoxMovable&&(B(h,Kt),Tt(h,Et,he)),a.cropBoxResizable||(B(o.getElementsByClassName("".concat(S,"-line")),U),B(o.getElementsByClassName("".concat(S,"-point")),U)),this.render(),this.ready=!0,this.setDragMode(a.dragMode),a.autoCrop&&this.crop(),this.setData(a.data),H(a.ready)&&F(i,Me,a.ready,{once:!0}),mt(i,Me)}}},{key:"unbuild",value:function(){if(this.ready){this.ready=!1,this.unbind(),this.resetPreview();var i=this.cropper.parentNode;i&&i.removeChild(this.cropper),G(this.element,U)}}},{key:"uncreate",value:function(){this.ready?(this.unbuild(),this.ready=!1,this.cropped=!1):this.sizing?(this.sizingImage.onload=null,this.sizing=!1,this.sized=!1):this.reloading?(this.xhr.onabort=null,this.xhr.abort()):this.image&&this.stop()}}],[{key:"noConflict",value:function(){return window.Cropper=ma,e}},{key:"setDefaults",value:function(i){A(Se,ct(i)&&i)}}])})();A(ti.prototype,ha,da,ua,ca,fa,pa);const ga={props:{item:{type:Object,required:!0},save:{type:Object,required:!0}},emits:["update:item","update:file","error"],inject:["compose","locales","transcribe","translate","txlocales","url"],data(){return{transcribing:!1,translating:!1,dictating:!1,composing:!1,cropping:!1,covering:!1,tabtrans:null,tabdesc:null,cropLabel:null,cropper:null,audio:null,scaleX:1,scaleY:1}},setup(){const e=si(),t=ne(),i=ni(),a=Pt();return{app:Pe(),auth:a,languages:e,messages:t,side:i}},mounted(){this.init()},beforeUnmount(){this.cropper&&this.cropper.destroy()},computed:{desclangs(){return this.languages.available.concat(Object.keys(this.item.description||{})).filter((e,t,i)=>i.indexOf(e)===t)},ratio(){if(!this.cropper)return NaN;const e=this.cropper.getImageData();return e.naturalWidth/e.naturalHeight},readonly(){return!this.auth.can("file:save")}},methods:{addCover(){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");const e=this,t=this.$refs.video;if(!t)return this.messages.add(this.$gettext("No video element found"),"error");const i=this.item.path.replace(/\.[A-Za-z0-9]+$/,".png").split("/").pop(),a=document.createElement("canvas"),s=a.getContext("2d");a.width=t.videoWidth,a.height=t.videoHeight,s.drawImage(t,0,0,t.videoWidth,t.videoHeight),a.toBlob(function(r){const n=new File([r],i,{type:"image/png"});e.covering=!0,e.$apollo.mutate({mutation:z`mutation($id: ID!, $preview: Upload) {
              saveFile(id: $id, input: {}, preview: $preview) {
                id
                latest {
                  data
                  created_at
                }
              }
            }`,variables:{id:e.item.id,preview:n},context:{hasUpload:!0}}).then(l=>{var u,o,h;if(l.errors)throw l.errors;const d=(o=(u=l.data)==null?void 0:u.saveFile)==null?void 0:o.latest;d&&(e.item.previews=((h=JSON.parse(d.data||"{}"))==null?void 0:h.previews)||{},e.item.updated_at=d.created_at)}).catch(l=>{e.messages.add(this.$gettext("Error saving video cover")+`:
`+l,"error"),this.$log("FileDetailItem::addCover(): Error saving video cover",l)}).finally(()=>{e.covering=!1})},"image/png",1)},aspect(e){this.cropper.setAspectRatio(e),this.cropper.setDragMode("crop"),this.cropping=!0,this.$nextTick(()=>{const t=this.cropper.cropper.querySelector(".cropper-crop-box");if(t&&!this.cropLabel){const i=document.createElement("div");i.className="crop-label",t.appendChild(i),this.cropLabel=i}})},composeText(){const e=this.desclangs.shift()||this.item.lang||"en",t=`Summarize the content of the file in a few words in plain text format for a title tag in the language with the ISO code "${e}":`;this.composing=!0,this.compose(t,null,[this.item.id]).then(i=>{this.update("description",Object.assign(this.item.description||{},{[e]:i}))}).finally(()=>{this.composing=!1})},crop(){this.cropping=!1,this.cropper.setDragMode("none"),this.cropper.getCroppedCanvas().toBlob(e=>{this.$emit("update:file",e)})},download(){this.cropper.getCroppedCanvas().toBlob(e=>{const t=URL.createObjectURL(e),i=document.createElement("a");i.href=t,i.download=this.item.name||"download",i.click(),URL.revokeObjectURL(t)})},flipX(){this.scaleX=-this.scaleX,this.cropper.scaleX(this.scaleX),this.updateFile()},flipY(){this.scaleY=-this.scaleY,this.cropper.scaleY(this.scaleY),this.updateFile()},init(){var e;if(!this.readonly&&((e=this.item.mime)!=null&&e.startsWith("image/"))){this.cropper&&(this.cropper.destroy(),this.cropper=null);const t=this;this.cropper=new ti(this.$refs.image,{aspectRatio:NaN,background:!0,responsive:!0,dragMode:"none",movable:!1,autoCrop:!1,zoomable:!1,zoomOnWheel:!1,zoomOnTouch:!1,touchDragZoom:!1,checkCrossOrigin:!1,checkOrientation:!1,viewMode:1,crop(i){if(!t.cropLabel)return;const{width:a,height:s}=i.detail;t.cropLabel.textContent=`${Math.round(a)} × ${Math.round(s)}`}})}},record(){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");if(!this.audio)return this.audio=ri().start();this.audio.then(e=>{this.dictating=!0,this.audio=null,e.stop().then(t=>{this.transcribe(t).then(i=>{const a=this.desclangs[0]||this.item.lang||"en";this.update("description",Object.assign(this.item.description||{},{[a]:i.asText()}))}).finally(()=>{this.dictating=!1})})})},removeCover(){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");this.covering=!0,this.item.previews={},this.$apollo.mutate({mutation:z`mutation($id: ID!, $preview: Boolean) {
            saveFile(id: $id, input: {}, preview: $preview) {
              id
              latest {
                data
                created_at
              }
            }
          }`,variables:{id:this.item.id,preview:!1}}).then(e=>{var i,a,s;if(e.errors)throw e.errors;const t=(a=(i=e.data)==null?void 0:i.saveFile)==null?void 0:a.latest;t&&(this.item.previews=((s=JSON.parse(t.data||"{}"))==null?void 0:s.previews)||{},this.item.updated_at=t.created_at)}).catch(e=>{this.messages.add(this.$gettext("Error removing video cover")+`:
`+e,"error"),this.$log("FileDetailItem::removeCover(): Error removing video cover",e)}).finally(()=>{this.covering=!1})},reset(){this.cropping=!1,this.$emit("update:file",null),this.cropper.reset(),this.cropper.clear(),this.scaleX=1,this.scaleY=1},rotate(e){this.cropper.rotate(e),this.updateFile(),this.$nextTick(()=>{const t=this.cropper.getContainerData(),i=this.cropper.getImageData();let a,s;Math.abs(Math.abs(i.rotate)-180)===90?(a=t.width/i.naturalHeight,s=t.height/i.naturalWidth):(a=t.width/i.naturalWidth,s=t.height/i.naturalHeight),this.cropper.zoomTo(Math.min(a,s))})},transcribeFile(){var e,t;if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");if(!((e=this.item.mime)!=null&&e.startsWith("audio/"))&&!((t=this.item.mime)!=null&&t.startsWith("video/")))return this.messages.add(this.$gettext("Transcription is only available for audio and video files"),"error");this.transcribing=!0,this.transcribe(this.item.path).then(i=>{const a=this.desclangs[0]||this.item.lang||"en";this.update("transcription",Object.assign(this.item.transcription||{},{[a]:i.asText()}))}).finally(()=>{this.transcribing=!1})},translateText(e){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");if(!e||typeof e!="object"){this.$log("FileDetailItem::translateText(): Invalid map object",e);return}const t=[],[i,a]=Object.entries(e||{}).find(([s,r])=>!!r);return this.translating=!0,this.txlocales(i).map(s=>s.code).forEach(s=>{t.push(this.translate(a,s).then(r=>{r[0]&&(e[s]=r[0])}).catch(r=>{this.$log("FileDetailItem::translateText(): Error translating text",r)}))}),Promise.all(t).then(()=>(this.$emit("update:item",this.item),this.translating=!1,e))},translateVTT(e){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");if(!e||typeof e!="object"){this.$log("FileDetailItem::translateVTT(): Invalid map object",e);return}const t=/^\d{2}:\d{2}:\d{2}\.\d{3} --\> \d{2}:\d{2}:\d{2}\.\d{3}(?: .*)?$/,i={...e};for(const[a,s]of Object.entries(i))s&&(i[a]=s.split(`
`).map(r=>r.startsWith("WEBVTT")||t.test(r)?`<x>${r}</x>`:r).filter(r=>r.trim()!=="").join(""));this.translateText(i).then(a=>{for(const[s,r]of Object.entries(a))a[s]&&(e[s]=a[s].replaceAll(/\<x\>/g,`

`).replaceAll(/\<\/x\>/g,`
`).trim());this.$emit("update:item",this.item)}).catch(a=>{this.$log("FileDetailItem::translateVTT(): Error translating VTT",a)})},update(e,t){this.item[e]=t,this.$emit("update:item",this.item)},updateFile(){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");this.cropper.getCroppedCanvas().toBlob(e=>{this.$emit("update:file",e)})},uploadCover(e){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");const t=e.target.files[0];if(!t)return this.messages.add(this.$gettext("No file selected"),"error");this.covering=!0,this.$apollo.mutate({mutation:z`mutation($id: ID!, $preview: Upload) {
            saveFile(id: $id, input: {}, preview: $preview) {
              id
              latest {
                data
                created_at
              }
            }
          }`,variables:{id:this.item.id,preview:t},context:{hasUpload:!0}}).then(i=>{var s,r,n;if(i.errors)throw i.errors;const a=(r=(s=i.data)==null?void 0:s.saveFile)==null?void 0:r.latest;a&&(this.item.previews=((n=JSON.parse(a.data||"{}"))==null?void 0:n.previews)||{},this.item.updated_at=a.created_at)}).catch(i=>{this.messages.add(this.$gettext("Error uploading video cover")+`:
`+i,"error"),this.$log("FileDetailItem::uploadCover(): Error uploading video cover",i)}).finally(()=>{this.covering=!1})}},watch:{"save.count":function(){this.save.count>0&&this.$nextTick(()=>{this.init()})}}},va={key:0,ref:"editorContainer",class:"editor-container"},ba=["src"],wa={key:0,class:"toolbar"},ya={class:"toolbar-group"},xa={class:"toolbar-group"},Ca={class:"toolbar-group"},Da={class:"toolbar-group"},ka={key:1,class:"editor-container"},Ea=["src"],Ta={key:0,class:"toolbar"},Ma={class:"toolbar-group"},Oa=["src"],Va={key:1,class:"toolbar-group"},Na=["src"],Sa={key:3,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 16 16",fill:"currentColor"},Aa={class:"label"},$a={key:0,class:"actions"},Ia={class:"label"},La={key:0,class:"actions"};function Ra(e,t,i,a,s,r){return v(),k(Le,null,{default:f(()=>[c(Re,{class:"scroll"},{default:f(()=>{var n,l;return[c(Ot,null,{default:f(()=>[c(gt,{cols:"12",md:"6"},{default:f(()=>[c(Be,{ref:"name",readonly:r.readonly,modelValue:i.item.name,"onUpdate:modelValue":t[0]||(t[0]=d=>r.update("name",d)),variant:"underlined",label:e.$gettext("Name"),counter:"255",maxlength:"255"},null,8,["readonly","modelValue","label"])]),_:1}),c(gt,{cols:"12",md:"6"},{default:f(()=>[c(oi,{ref:"lang",items:r.locales(!0),readonly:r.readonly,modelValue:i.item.lang,"onUpdate:modelValue":t[1]||(t[1]=d=>r.update("lang",d)),variant:"underlined",label:e.$gettext("Language")},null,8,["items","readonly","modelValue","label"])]),_:1})]),_:1}),c(Ot,null,{default:f(()=>[i.item?(v(),k(gt,{key:0,cols:"12",class:"preview"},{default:f(()=>{var d,u,o;return[(d=i.item.mime)!=null&&d.startsWith("image/")?(v(),M("div",va,[g("img",{ref:"image",src:r.url(i.item.path,!0),class:"element",crossorigin:"anonymous"},null,8,ba),r.readonly?V("",!0):(v(),M("div",wa,[g("div",ya,[s.cropping?(v(),k(w,{key:0,onClick:t[2]||(t[2]=h=>r.crop()),title:e.$gettext("Use cropped image"),icon:"mdi-image-check",class:"no-rtl"},null,8,["title"])):(v(),k(Ct,{key:1,location:"center"},{activator:f(({props:h})=>[c(w,Dt(h,{icon:"mdi-crop",class:"no-rtl",title:e.$gettext("Crop image")}),null,16,["title"])]),default:f(()=>[c(xt,null,{default:f(()=>[c(N,null,{default:f(()=>[c(w,{"prepend-icon":"mdi-crop",class:"no-rtl",variant:"text",onClick:t[3]||(t[3]=h=>r.aspect(r.ratio))},{default:f(()=>[C(b(e.$gettext("Original ratio")),1)]),_:1})]),_:1}),c(N,null,{default:f(()=>[c(w,{"prepend-icon":"mdi-crop",class:"no-rtl",variant:"text",onClick:t[4]||(t[4]=h=>r.aspect(NaN))},{default:f(()=>[C(b(e.$gettext("No ratio")),1)]),_:1})]),_:1}),c(N,null,{default:f(()=>[c(w,{"prepend-icon":"mdi-crop",class:"no-rtl",variant:"text",onClick:t[5]||(t[5]=h=>r.aspect(1))},{default:f(()=>[C(b(e.$gettext("Square")),1)]),_:1})]),_:1}),c(N,null,{default:f(()=>[c(w,{"prepend-icon":"mdi-crop",class:"no-rtl",variant:"text",onClick:t[6]||(t[6]=h=>r.aspect(3/2))},{default:f(()=>[...t[27]||(t[27]=[C("3:2",-1)])]),_:1})]),_:1}),c(N,null,{default:f(()=>[c(w,{"prepend-icon":"mdi-crop",class:"no-rtl",variant:"text",onClick:t[7]||(t[7]=h=>r.aspect(4/3))},{default:f(()=>[...t[28]||(t[28]=[C("4:3",-1)])]),_:1})]),_:1}),c(N,null,{default:f(()=>[c(w,{"prepend-icon":"mdi-crop",class:"no-rtl",variant:"text",onClick:t[8]||(t[8]=h=>r.aspect(5/3))},{default:f(()=>[...t[29]||(t[29]=[C("5:3",-1)])]),_:1})]),_:1}),c(N,null,{default:f(()=>[c(w,{"prepend-icon":"mdi-crop",class:"no-rtl",variant:"text",onClick:t[9]||(t[9]=h=>r.aspect(16/9))},{default:f(()=>[...t[30]||(t[30]=[C("16:9",-1)])]),_:1})]),_:1})]),_:1})]),_:1}))]),g("div",xa,[c(w,{icon:"mdi-rotate-left",class:"no-rtl",onClick:t[10]||(t[10]=h=>r.rotate(-90)),title:e.$gettext("Rotate counter-clockwise")},null,8,["title"]),c(w,{icon:"mdi-rotate-right",class:"no-rtl",onClick:t[11]||(t[11]=h=>r.rotate(90)),title:e.$gettext("Rotate clockwise")},null,8,["title"])]),g("div",Ca,[c(w,{icon:"mdi-flip-horizontal",class:"no-rtl",onClick:r.flipX,title:e.$gettext("Flip horizontally")},null,8,["onClick","title"]),c(w,{icon:"mdi-flip-vertical",class:"no-rtl",onClick:r.flipY,title:e.$gettext("Flip vertically")},null,8,["onClick","title"])]),g("div",Da,[c(w,{icon:"mdi-download",class:"no-rtl",onClick:t[12]||(t[12]=h=>r.download()),title:e.$gettext("Download")},null,8,["title"]),c(w,{icon:"mdi-history",class:"no-rtl",onClick:t[13]||(t[13]=h=>r.reset()),title:e.$gettext("Reset")},null,8,["title"])])]))],512)):(u=i.item.mime)!=null&&u.startsWith("video/")?(v(),M("div",ka,[g("video",{ref:"video",src:r.url(i.item.path),crossorigin:"anonymous",class:"element",controls:""},null,8,Ea),r.readonly?V("",!0):(v(),M("div",Ta,[g("div",Ma,[Object.values(i.item.previews).length?(v(),M("img",{key:0,class:"video-preview",src:r.url(Object.values(i.item.previews).shift()),onClick:t[14]||(t[14]=h=>r.removeCover())},null,8,Oa)):(v(),M("div",Va,[c(w,{icon:"mdi-tooltip-image",loading:s.covering,title:e.$gettext("Use as cover image"),onClick:t[15]||(t[15]=h=>r.addCover())},null,8,["loading","title"]),c(w,{icon:"",loading:s.covering,title:e.$gettext("Upload cover image"),onClick:t[17]||(t[17]=h=>e.$refs.coverInput.click())},{default:f(()=>[c(At,null,{default:f(()=>[...t[31]||(t[31]=[C("mdi-image-plus",-1)])]),_:1}),g("input",{ref:"coverInput",type:"file",class:"cover-input",onChange:t[16]||(t[16]=h=>r.uploadCover(h))},null,544)]),_:1},8,["loading","title"])]))])]))])):(o=i.item.mime)!=null&&o.startsWith("audio/")?(v(),M("audio",{key:2,src:r.url(i.item.path),crossorigin:"anonymous",class:"element",controls:""},null,8,Na)):(v(),M("svg",Sa,[...t[32]||(t[32]=[g("path",{d:"M7.05 11.885c0 1.415-.548 2.206-1.524 2.206C4.548 14.09 4 13.3 4 11.885c0-1.412.548-2.203 1.526-2.203.976 0 1.524.79 1.524 2.203m-1.524-1.612c-.542 0-.832.563-.832 1.612q0 .133.006.252l1.559-1.143c-.126-.474-.375-.72-.733-.72zm-.732 2.508c.126.472.372.718.732.718.54 0 .83-.563.83-1.614q0-.129-.006-.25zm6.061.624V14h-3v-.595h1.181V10.5h-.05l-1.136.747v-.688l1.19-.786h.69v3.633z"},null,-1),g("path",{d:"M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2M9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"},null,-1)])]))]}),_:1})):V("",!0)]),_:1}),c(Ot,null,{default:f(()=>[c(gt,{cols:"12",class:"description"},{default:f(()=>[g("div",Aa,[C(b(e.$gettext("Descriptions"))+" ",1),r.readonly?V("",!0):(v(),M("div",$a,[Object.values(i.item.description||{}).find(d=>!!d)?(v(),k(w,{key:0,onClick:t[18]||(t[18]=d=>r.translateText(i.item.description)),title:e.$gettext("Translate text"),loading:s.translating,icon:"mdi-translate",variant:"text"},null,8,["title","loading"])):V("",!0),c(w,{onClick:t[19]||(t[19]=d=>r.composeText()),title:e.$gettext("Generate description"),loading:s.composing,icon:"mdi-creation",variant:"text"},null,8,["title","loading"]),c(w,{onClick:t[20]||(t[20]=d=>r.record()),class:K({dictating:s.audio}),icon:s.audio?"mdi-microphone-outline":"mdi-microphone",title:e.$gettext("Dictate"),loading:s.dictating,variant:"text"},null,8,["class","icon","title","loading"])]))]),c(Xt,{modelValue:s.tabdesc,"onUpdate:modelValue":t[21]||(t[21]=d=>s.tabdesc=d)},{default:f(()=>[(v(!0),M(q,null,it(r.locales(),d=>(v(),k($t,{value:d.value},{default:f(()=>[C(b(d.title),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"]),c(qt,{modelValue:s.tabdesc,"onUpdate:modelValue":t[22]||(t[22]=d=>s.tabdesc=d),touch:!1},{default:f(()=>[(v(!0),M(q,null,it(r.locales(),d=>(v(),k(It,{value:d.value},{default:f(()=>{var u;return[c(ge,{ref_for:!0,ref:"description","onUpdate:modelValue":o=>{i.item.description[d.value]=o,e.$emit("update:item",i.item)},label:e.$gettext("Description (%{lang})",{lang:d.value}),modelValue:((u=i.item.description)==null?void 0:u[d.value])||"",readonly:r.readonly,variant:"underlined",counter:"500",rows:"2","auto-grow":"",clearable:""},null,8,["onUpdate:modelValue","label","modelValue","readonly"])]}),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1}),(n=i.item.mime)!=null&&n.startsWith("audio/")||(l=i.item.mime)!=null&&l.startsWith("video/")?(v(),k(Ot,{key:0},{default:f(()=>[c(gt,{cols:"12",class:"transcription"},{default:f(()=>[g("div",Ia,[C(b(e.$gettext("Transcriptions"))+" ",1),r.readonly?V("",!0):(v(),M("div",La,[Object.values(i.item.transcription||{}).find(d=>!!d)?(v(),k(w,{key:0,onClick:t[23]||(t[23]=d=>r.translateVTT(i.item.transcription)),title:e.$gettext("Translate text"),loading:s.translating,icon:"mdi-translate",variant:"text"},null,8,["title","loading"])):V("",!0),c(w,{onClick:t[24]||(t[24]=d=>r.transcribeFile()),title:e.$gettext("Transcribe file content"),loading:s.transcribing,icon:"mdi-creation",variant:"text"},null,8,["title","loading"])]))]),c(Xt,{modelValue:s.tabtrans,"onUpdate:modelValue":t[25]||(t[25]=d=>s.tabtrans=d)},{default:f(()=>[(v(!0),M(q,null,it(r.locales(),d=>(v(),k($t,{value:d.value},{default:f(()=>[C(b(d.title),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"]),c(qt,{modelValue:s.tabtrans,"onUpdate:modelValue":t[26]||(t[26]=d=>s.tabtrans=d),touch:!1},{default:f(()=>[(v(!0),M(q,null,it(r.locales(),d=>(v(),k(It,{value:d.value},{default:f(()=>{var u;return[c(ge,{ref_for:!0,ref:"transcription","onUpdate:modelValue":o=>{i.item.transcription[d.value]=o,e.$emit("update:item",i.item)},label:e.$gettext("Transcription (%{lang})",{lang:d.value}),modelValue:((u=i.item.transcription)==null?void 0:u[d.value])||"",readonly:r.readonly,variant:"underlined",rows:"10","auto-grow":"",clearable:""},null,8,["onUpdate:modelValue","label","modelValue","readonly"])]}),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1})):V("",!0)]}),_:1})]),_:1})}const Pa=Rt(ga,[["render",Ra],["__scopeId","data-v-0049debb"]]),Ba={components:{AsideMeta:wi,HistoryDialog:bi,FileDetailItem:Pa,FileDetailRefs:Ti},inject:["closeView"],props:{item:{type:Object,required:!0}},data:()=>({file:null,error:!1,changed:!1,publishAt:null,pubmenu:!1,vhistory:!1,tab:"file",savecnt:0}),setup(){const e=ne(),t=li();return{auth:Pt(),drawer:t,messages:e}},methods:{publish(e=null){if(!this.auth.can("file:publish")){this.messages.add(this.$gettext("Permission denied"),"error");return}this.save(!0).then(t=>{var i,a;t&&this.$apollo.mutate({mutation:z`mutation ($id: [ID!]!, $at: DateTime) {
              pubFile(id: $id, at: $at) {
                id
              }
            }`,variables:{id:[this.item.id],at:(a=(i=e==null?void 0:e.toISOString())==null?void 0:i.substring(0,19))==null?void 0:a.replace("T"," ")}}).then(s=>{if(s.errors)throw s.errors;e?(this.item.publish_at=e,this.messages.add(this.$gettext("File scheduled for publishing at %{date}",{date:e.toLocaleDateString()}),"info")):(this.item.published=!0,this.messages.add(this.$gettext("File published successfully"),"success")),this.closeView()}).catch(s=>{this.messages.add(this.$gettext("Error publishing file")+`:
`+s,"error"),this.$log("FileDetail::publish(): Error publishing file",e,s)})})},reset(){this.changed=!1,this.error=!1},save(e=!1){return this.auth.can("file:save")?this.error?(this.messages.add(this.$gettext("There are invalid fields, please resolve the errors first"),"error"),Promise.resolve(!1)):this.changed?this.$apollo.mutate({mutation:z`mutation ($id: ID!, $input: FileInput!, $file: Upload) {
            saveFile(id: $id, input: $input, file: $file) {
              id
              latest {
                id
                data
                created_at
              }
            }
          }`,variables:{id:this.item.id,input:{transcription:JSON.stringify(this.item.transcription||{}),description:JSON.stringify(this.item.description||{}),previews:JSON.stringify(this.item.previews||{}),path:this.item.path,name:this.item.name,lang:this.item.lang},file:this.file},context:{hasUpload:!0}}).then(t=>{var a,s;if(t.errors)throw t.errors;const i=(s=(a=t.data)==null?void 0:a.saveFile)==null?void 0:s.latest;return Object.assign(this.item,JSON.parse((i==null?void 0:i.data)||"{}")),this.item.updated_at=i==null?void 0:i.created_at,this.item.published=!1,this.reset(),e||this.messages.add(this.$gettext("File saved successfully"),"success"),this.savecnt++,!0}).catch(t=>{this.messages.add(this.$gettext("Error saving file")+`:
`+t,"error"),this.$log("FileDetail::save(): Error saving file",t)}):Promise.resolve(!0):(this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve(!1))},use(e){Object.assign(this.item,e.data),this.vhistory=!1,this.changed=!0,this.savecnt++},versions(e){return this.auth.can("file:view")?e?this.$apollo.query({query:z`query($id: ID!) {
            file(id: $id) {
              id
              versions {
                id
                published
                publish_at
                data
                editor
                created_at
              }
            }
          }`,variables:{id:e}}).then(t=>{if(t.errors||!t.data.file)throw t;const i=["previews","description","transcription"];return(t.data.file.versions||[]).map(a=>{const s={...a,data:JSON.parse(a.data||"{}")};return i.forEach(r=>s[r]??(s[r]={})),s}).reverse()}).catch(t=>{this.messages.add(this.$gettext("Error fetching file versions")+`:
`+t,"error"),this.$log("FileDetail::versions(): Error fetching file versions",e,t)}):Promise.resolve([]):(this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve([]))}}},_a={class:"app-title"},Ha={class:"menu-content"};function Ua(e,t,i,a,s,r){const n=Vt("FileDetailItem"),l=Vt("FileDetailRefs"),d=Vt("AsideMeta"),u=Vt("HistoryDialog");return v(),M(q,null,[c(hi,{elevation:0,density:"compact"},{prepend:f(()=>[c(w,{onClick:t[0]||(t[0]=o=>r.closeView()),title:e.$gettext("Back to list view"),icon:"mdi-keyboard-backspace"},null,8,["title"])]),append:f(()=>[c(w,{onClick:t[1]||(t[1]=o=>e.vhistory=!0),class:K([{hidden:i.item.published&&!e.changed&&!i.item.latest},"no-rtl"]),title:e.$gettext("View history"),icon:"mdi-history"},null,8,["class","title"]),c(w,{onClick:t[2]||(t[2]=o=>r.save()),title:e.$gettext("Save"),class:K([{error:e.error},"menu-save"]),disabled:!e.changed||e.error||!a.auth.can("file:save"),variant:!e.changed||e.error||!a.auth.can("file:save")?"plain":"flat",color:!e.changed||e.error||!a.auth.can("file:save")?"":"blue-darken-1",icon:"mdi-database-arrow-down"},null,8,["title","class","disabled","variant","color"]),c(Ct,{modelValue:e.pubmenu,"onUpdate:modelValue":t[5]||(t[5]=o=>e.pubmenu=o),"close-on-content-click":!1},{activator:f(({props:o})=>[c(w,Dt(o,{icon:"",title:e.$gettext("Schedule publishing"),class:[{error:e.error},"menu-publish"],disabled:i.item.published&&!e.changed||e.error||!a.auth.can("file:publish"),variant:i.item.published&&!e.changed||e.error||!a.auth.can("file:publish")?"plain":"flat",color:i.item.published&&!e.changed||e.error||!a.auth.can("file:publish")?"":"blue-darken-2"}),{default:f(()=>[c(At,null,{default:f(()=>[...t[17]||(t[17]=[g("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},[g("path",{d:"M2,1V3H16V1H2 M2,10H6V19H12V10H16L9,3L2,10Z"}),g("path",{d:"M16.7 11.4C16.7 11.4 16.61 11.4 16.7 11.4C13.19 11.49 10.4 14.28 10.4 17.7C10.4 21.21 13.19 24 16.7 24S23 21.21 23 17.7 20.21 11.4 16.7 11.4M16.7 22.2C14.18 22.2 12.2 20.22 12.2 17.7S14.18 13.2 16.7 13.2 21.2 15.18 21.2 17.7 19.22 22.2 16.7 22.2M15.6 13.1V17.6L18.84 19.58L19.56 18.5L16.95 16.97V13.1H15.6Z"})],-1)])]),_:1})]),_:1},16,["title","class","disabled","variant","color"])]),default:f(()=>[g("div",Ha,[c(fi,{modelValue:e.publishAt,"onUpdate:modelValue":t[3]||(t[3]=o=>e.publishAt=o),"hide-header":"","show-adjacent-months":""},null,8,["modelValue"]),c(w,{onClick:t[4]||(t[4]=o=>{r.publish(e.publishAt),e.pubmenu=!1}),disabled:!e.publishAt||e.error,color:e.publishAt?"primary":"",variant:"text"},{default:f(()=>[C(b(e.$gettext("Publish")),1)]),_:1},8,["disabled","color"])])]),_:1},8,["modelValue"]),c(w,{icon:"",onClick:t[6]||(t[6]=o=>r.publish()),title:e.$gettext("Publish"),class:K([{error:e.error},"menu-publish"]),disabled:i.item.published&&!e.changed||e.error||!a.auth.can("file:publish"),variant:i.item.published&&!e.changed||e.error||!a.auth.can("file:publish")?"plain":"flat",color:i.item.published&&!e.changed||e.error||!a.auth.can("file:publish")?"":"blue-darken-2"},{default:f(()=>[c(At,null,{default:f(()=>[...t[18]||(t[18]=[g("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},[g("path",{d:"M5,2V4H19V2H5 M5,12H9V21H15V12H19L12,5L5,12Z"})],-1)])]),_:1})]),_:1},8,["title","class","disabled","variant","color"]),c(w,{onClick:t[7]||(t[7]=Gt(o=>a.drawer.toggle("aside"),["stop"])),title:e.$gettext("Toggle side menu"),icon:a.drawer.aside?"mdi-chevron-right":"mdi-chevron-left"},null,8,["title","icon"])]),default:f(()=>[c(ci,null,{default:f(()=>[g("div",_a,b(e.$gettext("File"))+": "+b(i.item.name),1)]),_:1})]),_:1}),c(di,{class:"file-details"},{default:f(()=>[c(pi,{onSubmit:t[13]||(t[13]=Gt(()=>{},["prevent"]))},{default:f(()=>[c(Xt,{"fixed-tabs":"",modelValue:e.tab,"onUpdate:modelValue":t[8]||(t[8]=o=>e.tab=o)},{default:f(()=>[c($t,{value:"file",class:K({changed:e.changed,error:e.error})},{default:f(()=>[C(b(e.$gettext("File")),1)]),_:1},8,["class"]),c($t,{value:"refs"},{default:f(()=>[C(b(e.$gettext("Used by")),1)]),_:1})]),_:1},8,["modelValue"]),c(qt,{modelValue:e.tab,"onUpdate:modelValue":t[12]||(t[12]=o=>e.tab=o),touch:!1},{default:f(()=>[c(It,{value:"file"},{default:f(()=>[c(n,{"onUpdate:item":t[9]||(t[9]=o=>{this.$emit("update:item",i.item),e.changed=!0}),"onUpdate:file":t[10]||(t[10]=o=>{this.file=o,e.changed=!0}),onError:t[11]||(t[11]=o=>e.error=o),save:{count:e.savecnt},item:i.item},null,8,["save","item"])]),_:1}),c(It,{value:"refs"},{default:f(()=>[c(l,{item:i.item},null,8,["item"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),c(d,{item:i.item},null,8,["item"]),(v(),k(ui,{to:"body"},[c(u,{modelValue:e.vhistory,"onUpdate:modelValue":t[14]||(t[14]=o=>e.vhistory=o),current:{data:{lang:i.item.lang,name:i.item.name,mime:i.item.mime,path:i.item.path,previews:i.item.previews,description:i.item.description,transcription:i.item.transcription}},load:()=>r.versions(i.item.id),onUse:t[15]||(t[15]=o=>r.use(o)),onRevert:t[16]||(t[16]=o=>{r.use(o),r.reset()})},null,8,["modelValue","current","load"])]))],64)}const mr=Rt(Ba,[["render",Ua],["__scopeId","data-v-50e4612e"]]),Wa={props:{grid:{type:Boolean,default:!1},embed:{type:Boolean,default:!1},filter:{type:Object,default:()=>({})}},emits:["select"],inject:["debounce","url","srcset"],data(){return{items:[],term:"",sort:{column:"ID",order:"DESC"},page:1,last:1,limit:100,checked:!1,loading:!0,vgrid:!1}},setup(){const e=ne(),t=Pt();return{app:Pe(),auth:t,messages:e}},created(){this.searchd=this.debounce(this.search,500),this.vgrid=this.grid,this.search()},computed:{canTrash(){return this.items.some(e=>e._checked&&!e.deleted_at)},isChecked(){return this.items.some(e=>e._checked)},isTrashed(){return this.items.some(e=>e._checked&&e.deleted_at)},order(){var e,t,i,a;return((e=this.sort)==null?void 0:e.column)==="ID"?((t=this.sort)==null?void 0:t.order)==="DESC"?this.$gettext("latest"):this.$gettext("oldest"):((i=this.sort)==null?void 0:i.column)==="BYVERSIONS_COUNT"?this.$gettext("usage"):((a=this.sort)==null?void 0:a.column)||""}},methods:{add(e){if(this.embed||!this.auth.can("file:add")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=[],i=e.target.files||e.dataTransfer.files||[];if(i.length)return Array.from(i).forEach(a=>{t.push(this.$apollo.mutate({mutation:z`mutation($file: Upload!) {
              addFile(file: $file) {
                id
                lang
                mime
                name
                path
                previews
                description
                transcription
                editor
                created_at
                updated_at
                deleted_at
              }
            }`,variables:{file:a},context:{hasUpload:!0}}).then(s=>{var n;if(s.errors)throw s.errors;const r=((n=s.data)==null?void 0:n.addFile)||{};return r.previews=JSON.parse(r.previews)||{},r.description=JSON.parse(r.description)||{},r.transcription=JSON.parse(r.transcription)||{},r.published=!0,this.items.unshift(r),this.$emit("select",r),r}).catch(s=>{this.messages.add(this.$gettext("Error adding file %{path}",{path:a.name})+`:
`+s,"error"),this.$log("FileListItems::add(): Error adding file",e,s)}))}),Promise.all(t).then(()=>{this.invalidate()})},drop(e){if(!this.auth.can("file:drop")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.items.filter(i=>i._checked);t.length&&this.$apollo.mutate({mutation:z`
            mutation($id: [ID!]!) {
              dropFile(id: $id) {
                id
              }
            }
          `,variables:{id:t.map(i=>i.id)}}).then(i=>{if(i.errors)throw i.errors;this.invalidate(),this.search()}).catch(i=>{this.messages.add(this.$gettext("Error trashing file")+`:
`+i,"error"),this.$log("FileListItems::drop(): Error trashing file",e,i)})},invalidate(){const e=this.$apollo.provider.defaultClient.cache;e.evict({id:"ROOT_QUERY",fieldName:"files"}),e.gc()},keep(e){if(!this.auth.can("file:keep")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.items.filter(i=>i._checked);t.length&&this.$apollo.mutate({mutation:z`
            mutation($id: [ID!]!) {
              keepFile(id: $id) {
                id
              }
            }
          `,variables:{id:t.map(i=>i.id)}}).then(i=>{if(i.errors)throw i.errors;t.forEach(a=>{a.deleted_at=null}),this.invalidate(),this.search()}).catch(i=>{this.messages.add(this.$gettext("Error restoring file")+`:
`+i,"error"),this.$log("FileListItems::keep(): Error restoring file",e,i)})},publish(e){if(!this.auth.can("file:publish")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.items.filter(i=>i._checked&&i.id&&!i.published);t.length&&this.$apollo.mutate({mutation:z`mutation ($id: [ID!]!) {
            pubFile(id: $id) {
              id
            }
          }`,variables:{id:t.map(i=>i.id)}}).then(i=>{if(i.errors)throw i.errors;t.forEach(a=>{a.published=!0,a._checked=!1}),this.invalidate(),this.search()}).catch(i=>{this.messages.add(this.$gettext("Error publishing file")+`:
`+i,"error"),this.$log("FileListItems::publish(): Error publishing file",e,i)})},purge(e){if(!this.auth.can("file:purge")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.items.filter(i=>i._checked);t.length&&this.$apollo.mutate({mutation:z`
            mutation($id: [ID!]!) {
              purgeFile(id: $id) {
                id
              }
            }
          `,variables:{id:t.map(i=>i.id)}}).then(i=>{if(i.errors)throw i.errors;this.invalidate(),this.search()}).catch(i=>{this.messages.add(this.$gettext("Error purging file")+`:
`+i,"error"),this.$log("FileListItems::purge(): Error purging file",e,i)})},search(){if(!this.auth.can("file:view"))return this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve([]);const e=this.filter.publish||null,t=this.filter.trashed||"WITHOUT",i={...this.filter};return delete i.trashed,delete i.publish,this.term&&(i.any=this.term),this.loading=!0,this.$apollo.query({query:z`
            query($filter: FileFilter, $sort: [QueryFilesSortOrderByClause!], $limit: Int!, $page: Int!, $trashed: Trashed, $publish: Publish) {
              files(filter: $filter, sort: $sort, first: $limit, page: $page, trashed: $trashed, publish: $publish) {
                data {
                  id
                  lang
                  name
                  mime
                  path
                  previews
                  description
                  transcription
                  editor
                  created_at
                  updated_at
                  deleted_at
                  latest {
                    id
                    published
                    publish_at
                    data
                    editor
                    created_at
                  }
                  byversions_count
                }
                paginatorInfo {
                  lastPage
                }
              }
            }
          `,variables:{filter:i,page:this.page,limit:this.limit,sort:[this.sort],trashed:t,publish:e}}).then(a=>{var n;if(a.errors)throw a.errors;const s=a.data.files||{},r=["previews","description","transcription"];return this.last=((n=s.paginatorInfo)==null?void 0:n.lastPage)||1,this.items=[...s.data||[]].map(l=>{var u,o,h,p,x,y;const d=(u=l.latest)!=null&&u.data?JSON.parse((o=l.latest)==null?void 0:o.data):{...l,previews:JSON.parse(l.previews||"{}"),description:JSON.parse(l.description||"{}"),transcription:JSON.parse(l.transcription||"{}")};return r.forEach(O=>d[O]??(d[O]={})),Object.assign(d,{id:l.id,deleted_at:l.deleted_at,created_at:l.created_at,updated_at:((h=l.latest)==null?void 0:h.created_at)||l.updated_at,editor:((p=l.latest)==null?void 0:p.editor)||l.editor,published:((x=l.latest)==null?void 0:x.published)??!0,publish_at:((y=l.latest)==null?void 0:y.publish_at)||null,latest:l.latest,usage:l.byversions_count})}),this.checked=!1,this.loading=!1,this.items}).catch(a=>{this.messages.add(this.$gettext("Error fetching files")+`:
`+a,"error"),this.$log("FileListItems::search(): Error fetching files",a)})},title(e){const t=[];return e.publish_at&&t.push("Publish at: "+new Date(e.publish_at).toLocaleDateString()),t.join(`
`)},toggle(){this.items.forEach(e=>{e._checked=!e._checked})}},watch:{filter:{deep:!0,handler(){this.search()}},term(){this.searchd()},page(){this.search()},sort(){this.search()}}},za={class:"header"},Ya={class:"bulk"},Fa={class:"search"},ja={class:"layout"},Xa=["onClick","title"],qa=["onClick","title"],Ga={key:2,viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},Ja={key:3,fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Za={key:4,width:"24",height:"24",viewBox:"0 0 16 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},Qa=["onClick","title"],Ka={class:"item-text"},tr={class:"item-head"},er={key:0,class:"item-lang"},ir={class:"item-title"},ar={class:"item-mime item-subtitle"},rr={class:"item-aux"},sr={class:"item-editor"},nr={class:"item-modified item-subtitle"},or={key:0,class:"loading"},lr={key:1,class:"notfound"},hr={key:3,class:"btn-group"};function dr(e,t,i,a,s,r){return v(),M(q,null,[g("div",za,[g("div",Ya,[c(ve,{modelValue:s.checked,"onUpdate:modelValue":t[0]||(t[0]=n=>s.checked=n),onClick:t[1]||(t[1]=Gt(n=>r.toggle(),["stop"]))},null,8,["modelValue"]),c(Ct,null,{activator:f(({props:n})=>[c(w,Dt(n,{disabled:!r.isChecked&&(i.embed||!a.auth.can("file:add")),"append-icon":"mdi-menu-down",variant:"text"}),{default:f(()=>[C(b(e.$gettext("Actions")),1)]),_:1},16,["disabled"])]),default:f(()=>[c(xt,null,{default:f(()=>[!i.embed&&a.auth.can("file:add")?(v(),k(N,{key:0},{default:f(()=>[c(w,{"prepend-icon":"mdi-folder-plus",variant:"text",onClick:t[2]||(t[2]=n=>e.$refs.upload.click())},{default:f(()=>[C(b(e.$gettext("Add files")),1)]),_:1})]),_:1})):V("",!0),r.isChecked&&a.auth.can("file:publish")?(v(),k(N,{key:1},{default:f(()=>[c(w,{"prepend-icon":"mdi-publish",variant:"text",onClick:t[3]||(t[3]=n=>r.publish())},{default:f(()=>[C(b(e.$gettext("Publish")),1)]),_:1})]),_:1})):V("",!0),r.canTrash&&a.auth.can("file:drop")?(v(),k(N,{key:2},{default:f(()=>[c(w,{"prepend-icon":"mdi-delete",variant:"text",onClick:t[4]||(t[4]=n=>r.drop())},{default:f(()=>[C(b(e.$gettext("Delete")),1)]),_:1})]),_:1})):V("",!0),r.isTrashed&&a.auth.can("file:keep")?(v(),k(N,{key:3},{default:f(()=>[c(w,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:t[5]||(t[5]=n=>r.keep())},{default:f(()=>[C(b(e.$gettext("Restore")),1)]),_:1})]),_:1})):V("",!0),r.isChecked&&a.auth.can("file:purge")?(v(),k(N,{key:4},{default:f(()=>[c(w,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:t[6]||(t[6]=n=>r.purge())},{default:f(()=>[C(b(e.$gettext("Purge")),1)]),_:1})]),_:1})):V("",!0)]),_:1})]),_:1})]),g("div",Fa,[c(Be,{modelValue:s.term,"onUpdate:modelValue":t[7]||(t[7]=n=>s.term=n),label:e.$gettext("Search for"),"prepend-inner-icon":"mdi-magnify",variant:"underlined","hide-details":"",clearable:""},null,8,["modelValue","label"])]),g("div",ja,[s.vgrid?V("",!0):(v(),k(w,{key:0,onClick:t[8]||(t[8]=n=>s.vgrid=!0),title:e.$gettext("Grid view"),icon:"mdi-view-grid-outline",variant:"text"},null,8,["title"])),s.vgrid?(v(),k(w,{key:1,onClick:t[9]||(t[9]=n=>s.vgrid=!1),title:e.$gettext("List view"),icon:"mdi-format-list-bulleted-square",variant:"text"},null,8,["title"])):V("",!0),c(Ct,null,{activator:f(({props:n})=>[c(w,Dt(n,{title:e.$gettext("Sort by"),"append-icon":"mdi-menu-down","prepend-icon":"mdi-sort",variant:"text"}),{default:f(()=>[C(b(r.order),1)]),_:1},16,["title"])]),default:f(()=>[c(xt,null,{default:f(()=>[c(N,null,{default:f(()=>[c(w,{variant:"text",onClick:t[10]||(t[10]=n=>s.sort={column:"ID",order:"DESC"})},{default:f(()=>[C(b(e.$gettext("latest")),1)]),_:1})]),_:1}),c(N,null,{default:f(()=>[c(w,{variant:"text",onClick:t[11]||(t[11]=n=>s.sort={column:"ID",order:"ASC"})},{default:f(()=>[C(b(e.$gettext("oldest")),1)]),_:1})]),_:1}),c(N,null,{default:f(()=>[c(w,{variant:"text",onClick:t[12]||(t[12]=n=>s.sort={column:"NAME",order:"ASC"})},{default:f(()=>[C(b(e.$gettext("name")),1)]),_:1})]),_:1}),c(N,null,{default:f(()=>[c(w,{variant:"text",onClick:t[13]||(t[13]=n=>s.sort={column:"MIME",order:"ASC"})},{default:f(()=>[C(b(e.$gettext("mime")),1)]),_:1})]),_:1}),c(N,null,{default:f(()=>[c(w,{variant:"text",onClick:t[14]||(t[14]=n=>s.sort={column:"LANG",order:"ASC"})},{default:f(()=>[C(b(e.$gettext("language")),1)]),_:1})]),_:1}),c(N,null,{default:f(()=>[c(w,{variant:"text",onClick:t[15]||(t[15]=n=>s.sort={column:"EDITOR",order:"ASC"})},{default:f(()=>[C(b(e.$gettext("editor")),1)]),_:1})]),_:1}),c(N,null,{default:f(()=>[c(w,{variant:"text",onClick:t[16]||(t[16]=n=>s.sort={column:"BYVERSIONS_COUNT",order:"ASC"})},{default:f(()=>[C(b(e.$gettext("usage")),1)]),_:1})]),_:1})]),_:1})]),_:1})])]),c(xt,{class:K(["items",{grid:s.vgrid,list:!s.vgrid}])},{default:f(()=>[(v(!0),M(q,null,it(s.items,(n,l)=>(v(),k(N,{key:l},{default:f(()=>{var d,u,o,h;return[c(ve,{modelValue:n._checked,"onUpdate:modelValue":p=>n._checked=p,class:K([{draft:!n.published},"item-check"])},null,8,["modelValue","onUpdate:modelValue","class"]),c(Ct,{location:"center"},{activator:f(({props:p})=>[c(w,Dt({ref_for:!0},p,{title:e.$gettext("Actions"),icon:"mdi-dots-vertical",class:"item-menu",variant:"text"}),null,16,["title"])]),default:f(()=>[c(xt,null,{default:f(()=>[gi(c(N,null,{default:f(()=>[c(w,{"prepend-icon":"mdi-publish",variant:"text",onClick:p=>r.publish(n)},{default:f(()=>[C(b(e.$gettext("Publish")),1)]),_:1},8,["onClick"])]),_:2},1536),[[vi,!n.deleted_at&&!n.published&&a.auth.can("file:publish")]]),!n.deleted_at&&a.auth.can("file:drop")?(v(),k(N,{key:0},{default:f(()=>[c(w,{"prepend-icon":"mdi-delete",variant:"text",onClick:p=>r.drop(n)},{default:f(()=>[C(b(e.$gettext("Delete")),1)]),_:1},8,["onClick"])]),_:2},1024)):V("",!0),n.deleted_at&&a.auth.can("file:keep")?(v(),k(N,{key:1},{default:f(()=>[c(w,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:p=>r.keep(n)},{default:f(()=>[C(b(e.$gettext("Restore")),1)]),_:1},8,["onClick"])]),_:2},1024)):V("",!0),a.auth.can("file:purge")?(v(),k(N,{key:2},{default:f(()=>[c(w,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:p=>r.purge(n)},{default:f(()=>[C(b(e.$gettext("Purge")),1)]),_:1},8,["onClick"])]),_:2},1024)):V("",!0)]),_:2},1024)]),_:2},1024),g("div",{class:K(["item-usage",{notused:!n.usage}]),onClick:p=>e.$emit("select",n),title:r.title(n)},b(n.usage),11,Xa),g("div",{class:"item-preview",onClick:p=>e.$emit("select",n),title:r.title(n)},[(d=n.mime)!=null&&d.startsWith("image/")?(v(),k(be,{key:0,src:r.url(n.path),srcset:r.srcset(n.previews),title:n.name},null,8,["src","srcset","title"])):(u=n.mime)!=null&&u.startsWith("video/")&&Object.values(n.previews).length?(v(),k(be,{key:1,src:r.url(Object.values(n.previews)[0]??""),srcset:r.srcset(n.previews),title:n.name},null,8,["src","srcset","title"])):(o=n.mime)!=null&&o.startsWith("video/")&&!Object.values(n.previews).length?(v(),M("svg",Ga,[...t[20]||(t[20]=[g("path",{d:"M10,15L15.19,12L10,9V15M21.56,7.17C21.69,7.64 21.78,8.27 21.84,9.07C21.91,9.87 21.94,10.56 21.94,11.16L22,12C22,14.19 21.84,15.8 21.56,16.83C21.31,17.73 20.73,18.31 19.83,18.56C19.36,18.69 18.5,18.78 17.18,18.84C15.88,18.91 14.69,18.94 13.59,18.94L12,19C7.81,19 5.2,18.84 4.17,18.56C3.27,18.31 2.69,17.73 2.44,16.83C2.31,16.36 2.22,15.73 2.16,14.93C2.09,14.13 2.06,13.44 2.06,12.84L2,12C2,9.81 2.16,8.2 2.44,7.17C2.69,6.27 3.27,5.69 4.17,5.44C4.64,5.31 5.5,5.22 6.82,5.16C8.12,5.09 9.31,5.06 10.41,5.06L12,5C16.19,5 18.8,5.16 19.83,5.44C20.73,5.69 21.31,6.27 21.56,7.17Z"},null,-1)])])):(h=n.mime)!=null&&h.startsWith("audio/")?(v(),M("svg",Ja,[...t[21]||(t[21]=[g("path",{d:"M21,3V15.5A3.5,3.5 0 0,1 17.5,19A3.5,3.5 0 0,1 14,15.5A3.5,3.5 0 0,1 17.5,12C18.04,12 18.55,12.12 19,12.34V6.47L9,8.6V17.5A3.5,3.5 0 0,1 5.5,21A3.5,3.5 0 0,1 2,17.5A3.5,3.5 0 0,1 5.5,14C6.04,14 6.55,14.12 7,14.34V6L21,3Z"},null,-1)])])):(v(),M("svg",Za,[...t[22]||(t[22]=[g("path",{d:"M7.05 11.885c0 1.415-.548 2.206-1.524 2.206C4.548 14.09 4 13.3 4 11.885c0-1.412.548-2.203 1.526-2.203.976 0 1.524.79 1.524 2.203m-1.524-1.612c-.542 0-.832.563-.832 1.612q0 .133.006.252l1.559-1.143c-.126-.474-.375-.72-.733-.72zm-.732 2.508c.126.472.372.718.732.718.54 0 .83-.563.83-1.614q0-.129-.006-.25zm6.061.624V14h-3v-.595h1.181V10.5h-.05l-1.136.747v-.688l1.19-.786h.69v3.633z"},null,-1),g("path",{d:"M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2M9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"},null,-1)])]))],8,qa),g("div",{class:K(["item-content",{trashed:n.deleted_at}]),onClick:p=>e.$emit("select",n),title:r.title(n)},[g("div",Ka,[g("div",tr,[n.lang?(v(),M("span",er,b(n.lang),1)):V("",!0),n.publish_at?(v(),k(At,{key:1,class:"publish-at",icon:"mdi-clock-outline"})):V("",!0),g("span",ir,b(n.name),1)]),g("div",ar,b(n.mime),1)]),g("div",rr,[g("div",sr,b(n.editor),1),g("div",nr,b(new Date(n.updated_at).toLocaleString()),1)])],10,Qa)]}),_:2},1024))),128))]),_:1},8,["class"]),s.loading?(v(),M("p",or,[C(b(e.$gettext("Loading"))+" ",1),t[23]||(t[23]=g("svg",{class:"spinner",width:"32",height:"32",fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[g("circle",{class:"spin1",cx:"4",cy:"12",r:"3"}),g("circle",{class:"spin1 spin2",cx:"12",cy:"12",r:"3"}),g("circle",{class:"spin1 spin3",cx:"20",cy:"12",r:"3"})],-1))])):V("",!0),!s.loading&&!s.items.length?(v(),M("p",lr,b(e.$gettext("No entries found")),1)):V("",!0),s.last>1?(v(),k(mi,{key:2,modelValue:s.page,"onUpdate:modelValue":t[17]||(t[17]=n=>s.page=n),length:s.last},null,8,["modelValue","length"])):V("",!0),!this.embed&&a.auth.can("file:add")?(v(),M("div",hr,[g("input",{onChange:t[18]||(t[18]=n=>r.add(n)),ref:"upload",type:"file",multiple:"",hidden:""},null,544),c(w,{onClick:t[19]||(t[19]=n=>e.$refs.upload.click()),title:e.$gettext("Add files"),icon:"mdi-folder-plus",color:"primary",variant:"flat"},null,8,["title"])])):V("",!0)],64)}const gr=Rt(Wa,[["render",dr],["__scopeId","data-v-a327a93a"]]);export{gr as F,mr as a};
