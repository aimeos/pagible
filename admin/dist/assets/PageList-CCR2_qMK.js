var mt=Object.defineProperty;var vt=(e,t,n)=>t in e?mt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var ge=(e,t,n)=>vt(e,typeof t!="symbol"?t+"":t,n);import{as as xe,r as re,c as T,o as $,a as f,w as g,F as ue,a5 as je,bj as V,bk as de,R as ve,y as Y,bf as we,U as We,av as yt,b9 as Ve,f as E,b as N,n as me,l as P,t as D,d as S,_ as lt,L as U,aD as bt,a6 as ot,a3 as dt,a4 as kt,aM as $t,aO as qe,h as fe,I as wt,k as C,i as pe,j as I,aA as xt,m as Je,aF as ae,aJ as Dt,aK as Ct,aI as St,aL as _t,aB as Et,aC as Ot,a1 as Pt,az as Lt}from"./index-qpWCrkU6.js";import{U as Tt,A as It,N as Nt}from"./Navigation-CMhGB-FL.js";import{P as Ze}from"./PageDetail-B5VKHwFC.js";import"./ElementListItems-C8-aF-jx.js";import"./vue-draggable-plus-fZ9LdmPx.js";var Ft=!1,At=!0;/*!
 * helper-js v3.1.6
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: null
 * Released under the MIT License.
 */function Te(e){return Object.prototype.toString.call(e)==="[object Array]"}function Ge(e){return Object.prototype.toString.call(e)==="[object Object]"}function Bt(e){return typeof e=="function"}function Vt(e,t){return e<t?e:t}function ut(e,t){let n,r=0;for(;(n=e.indexOf(t))>-1;)e.splice(n,1),r++;return r}function ct(e){return e[e.length-1]}function Ht(e){return Te(e)?e:[e]}function Kt(e,t){let n=new Set(t);const r={};return n.forEach(s=>{r[s]=e[s]}),r}function Ut(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(function*(){if(t.reverse)if(e.length!=null)for(let n=e.length-1;n>=0;n--){const r={value:e[n],index:n};(!t.exclude||!t.exclude(r))&&(yield r)}else if(Ge(e)){const n=Object.keys(e);n.reverse();for(const r of n){const s={value:e[r],key:r};(!t.exclude||!t.exclude(s))&&(yield s)}}else throw"Unsupported type";else if(e.length!=null)for(let n=0;n<e.length;n++){const r={value:e[n],index:n};(!t.exclude||!t.exclude(r))&&(yield r)}else if(Ge(e))for(const n of Object.keys(e)){const r={value:e[n],key:n};(!t.exclude||!t.exclude(r))&&(yield r)}else throw"Unsupported type"})()}function zt(e,t,n){e.hasOwnProperty(t)||(e[t]=n)}function ht(e,t){return Object.keys(t).forEach(n=>{zt(e,n,t[n])}),e}function Mt(e){const t={};return Object.keys(e).forEach(n=>{e[n]!==void 0&&(t[n]=e[n])}),t}function J(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};n=ht({...n},{childrenKey:"children"});const{childrenKey:r}=n,s=Te(e)?e:[e];class a{}const l=(i,d,o)=>{n.reverse&&(i=i.slice(),i.reverse());const u=i.length;for(let h=0;h<u;h++){const c=i[h],p=n.reverse?u-h-1:h,v=o?[...o,p]:[];n.childFirst&&c[r]!=null&&l(c[r],c,v);const k=t(c,p,d,v);if(k===!1)throw new a;if(k==="skip children")continue;if(k==="skip siblings")break;n.childFirst||c[r]!=null&&l(c[r],c,v)}};try{l(s,null,Te(e)?[]:null)}catch(i){if(!(i instanceof a))throw i}}function Rt(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r;return J(e,function(){if(t(...arguments))return r={node:arguments.length<=0?void 0:arguments[0],index:arguments.length<=1?void 0:arguments[1],parent:arguments.length<=2?void 0:arguments[2],path:arguments.length<=3?void 0:arguments[3]},!1},n),r}function jt(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=Rt(e,t,n);return r==null?void 0:r.node}function gt(e,t){const n={childrenKey:"children"};t&&Object.assign(n,t);const{childrenKey:r,nodeHandler:s}=n,a=new Ye;return a.childrenKey=r,J(e,(l,i,d,o)=>{let u=Object.assign({},l);u[r]&&(u[r]=[]),s&&(u=s(u,{oldNode:l,index:i,parent:d,path:o})),a.set(o,u)},{childrenKey:r}),a.data}class Ye{constructor(){ge(this,"data");ge(this,"childrenKey","children");let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this.data=t}get rootChildren(){const{childrenKey:t}=this,{data:n}=this;return Te(n)?n:n[t]}iteratePath(t){var n=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(function*(){const{childrenKey:s,rootChildren:a}=n;if(r.reverse){const l=[...n.iteratePath(t,{...r,reverse:!1})];l.reverse();for(const{path:i,node:d}of l)yield{path:i,node:d}}else{let l=[],i=a;for(const d of t){const o=[...l,d],u=i[d];yield{path:o,node:u},l=o,i=u[s]}}})()}getFamily(t){const n=[];for(const{node:r}of this.iteratePath(t))n.push(r);return n}get(t){return ct(this.getFamily(t))}getParentAndIndex(t){const n=t.slice(),r=n.pop();return{parent:this.get(n),index:r,parentPath:n}}getParent(t){return this.getParentAndIndex(t).parent}set(t,n){if(t==null||t.length===0)this.data=n;else{const{childrenKey:r}=this;let{rootChildren:s}=this;const{parent:a,index:l}=this.getParentAndIndex(t);let i;t.length===1?(s||(this.data?this.data[r]=[]:this.data=[]),i=s):(a[r]||(a[r]=[]),i=a[r]),i[l]=n}}delete(t){const{childrenKey:n,rootChildren:r}=this,{parent:s,index:a}=this.getParentAndIndex(t),l=t.length===1?r:s[n],i=l[a];return l.splice(a,1),i}walk(t,n){const{childrenKey:r,data:s}=this;return J(s,t,r,n)}clone(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return gt(this.data),Mt({childrenKey:this.childrenKey,nodeHandler:t.nodeHandler||void 0})}}function Qe(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return Bt(e)?e(...t):e}function Wt(e,t){return function(){let r,s;try{r=e(...arguments)}catch(a){s=a}finally{}if(s)throw s;return r}}function ye(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=[];let r;const s={};let a=s;return{action:function(){for(var d=arguments.length,o=new Array(d),u=0;u<d;u++)o[u]=arguments[u];if(o.length===0)return a===s&&(a=e()),a;if(r||(r=new Jt),!r.has(o)&&(r.set(o,e(...o)),t.capacity!=null)){n.push(o);const h=n.splice(0,n.length-t.capacity);for(const c of h)r.delete(c)}return r.get(o)},clearCache:()=>{r=null,n.splice(0,n.length)}}}function Yt(){let e,t;return{promise:new Promise((r,s)=>{e=r,t=s}),resolve:e,reject:t}}function Xt(e,t){for(;;){if(e.parentNode==null)return!1;if(e.parentNode===t)return!0;e=e.parentNode}}function He(e){let t=e.getBoundingClientRect();if(document.documentElement.clientTop>0){const n=t.top-document.documentElement.clientTop,r=t.bottom,s=t.left-document.documentElement.clientLeft,a=t.right,l=t.width||a-s,i=t.height||r-n,u={top:n,right:a,bottom:r,left:s,width:l,height:i,x:s,y:n};t={...u,toJSON:()=>u}}return t}function et(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=n&&n.withSelf?e:e.parentElement;for(;r;){const s=n.until&&r===n.until;if(s&&!n.withUntil)return;const a=t(r);if(a==="break")return;if(a)return r;if(s)return;r=r.parentElement}}function Ie(e,t){return e.classList?e.classList.contains(t):new RegExp("(^| )"+t+"( |$)","gi").test(e.className)}function tt(e,t){for(const n of t)if(Ie(e,n))return!0;return!1}function Z(e,t,n,r){e.addEventListener?e.addEventListener(t,n,r):e.attachEvent&&e.attachEvent(`on${t}`,n,r)}function G(e,t,n,r){e.removeEventListener?e.removeEventListener(t,n,r):e.detachEvent&&e.detachEvent(`on${t}`,n,r)}function qt(e){let t=[];const n=()=>{if(!s.listening){for(const a of e){Z.apply(this,a);const l=()=>G.apply(this,a);t.push(l)}s.listening=!0}},s={listening:!1,stop:()=>{if(s.listening){for(const a of t)a();t=[],s.listening=!1}},resume:n,start:n};return s.start(),s}function Ne(e,t){return getComputedStyle(e)[t]}function Xe(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};n={start:0,end:e.length-1,maxTimes:1e3,...n};let{start:r,end:s}=n;const{returnNearestIfNoHit:a,maxTimes:l}=n;let i,d;r==null&&(r=0,s=e.length-1);let o=0,u;for(;r>=0&&r<=s;){if(o>=l)throw Error(`binarySearch: loop times is over ${l}, you can increase the limit.`);i=Math.floor((s-r)/2+r),d=e[i];const h=o+1;if(u=t(d,i,h),u>0)s=i-1;else if(u<0)r=i+1;else return{index:i,value:d,count:h,hit:!0};o++}return a?{index:i,value:d,count:o+1,hit:!1,greater:u>0}:null}class Jt{constructor(){ge(this,"_map",new Map);ge(this,"_values",{});ge(this,"_objCount",0)}_keysToString(t){const{_map:n}=this;let r=[];for(const s of t){if(!n.has(s))return null;r.push(n.get(s)[0])}return r.toString()}has(t){return this._keysToString(t)!=null}get(t){const{_values:n}=this,r=this._keysToString(t);if(r==null)throw"Value not found by specified keys";return n[r][1]}set(t,n){const{_map:r,_values:s}=this;let a=[];for(const l of t){let i,d=1;r.has(l)?([i,d]=r.get(l),d++):(this._objCount++,i=this._objCount.toString()),r.set(l,[i,d]),a.push(i)}s[a.toString()]=[t.slice(),n]}delete(t){const{_values:n,_map:r}=this,s=this._keysToString(t);if(s==null)throw"Value not found by specified keys";delete n[s];for(const a of t){let[l,i]=r.get(a);i--,i===0?r.delete(a):r.set(a,[l,i])}}clear(){this._map.clear(),this._values={}}*entries(){const{_values:t}=this;for(const n in t){const[r,s]=t[n];yield[r,s]}}count(){return[...this.entries()].length}}/*!
 * @virtual-list/vue
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: https://virtual-list.phphe.com
 * Released under the MIT License.
 */const Zt=xe({props:{table:Boolean}}),ft=(e,t)=>{const n=e.__vccOpts||e;for(const[r,s]of t)n[r]=s;return n},Gt={key:0},Qt={key:1};function en(e,t,n,r,s,a){return e.table?($(),T("table",Gt,[V(e.$slots,"prepend"),E("tbody",null,[V(e.$slots,"default")]),V(e.$slots,"append")])):($(),T("div",Qt,[V(e.$slots,"prepend"),V(e.$slots,"default"),V(e.$slots,"append")]))}const tn=ft(Zt,[["render",en]]),nn=xe({components:{VirtualListTable:tn},props:{items:Array,disabled:Boolean,horizontal:Boolean,firstRender:{type:Number,default:10},buffer:{type:Number,default:100},itemKey:{type:[String,Function]},itemSize:{type:Function},table:Boolean},setup(e){const t=ve(0),n=ve(e.firstRender-1),r=Y(()=>{var x;return Vt(n.value,(((x=e.items)==null?void 0:x.length)||1)-1)}),s=ve(0),a=Y(()=>c.value[t.value]?he(t.value):0),l=Y(()=>c.value.length>0?he(c.value.length-1)+ct(h.value):0),i=Y(()=>c.value[r.value]?l.value-he(r.value)-h.value[r.value]:0),d=Y(()=>e.disabled?{}:{overflow:"auto"}),o=Y(()=>{const x={display:"flex"};return e.disabled||(e.horizontal?Object.assign(x,{"margin-left":a.value+"px","margin-right":i.value+"px",width:l.value-i.value-a.value+"px"}):Object.assign(x,{"margin-top":a.value+"px","margin-bottom":i.value+"px"})),x["flex-direction"]=e.horizontal?"row":"column",e.table&&(delete x.display,delete x["flex-direction"]),x}),u=Y(()=>we((e.items||[]).map(()=>null))),h=Y(()=>(e.items||[]).map((x,b)=>{var y;if(u[b]!=null)return u[b];let B=(y=e.itemSize)==null?void 0:y.call(e,x,b);return B==null&&(B=s.value),B})),c=Y(()=>{const x=[];return h.value.reduce((b,y)=>(x.push(b),b+y),0),x});We(()=>e.items,F);const p=Y(()=>{if(!e.items||e.disabled)return;const x=[];for(let b=t.value;b<=r.value;b++){const y=e.items[b];if(!y)break;x.push({item:y,index:b})}return x}),v=ve(),k=ve();yt(async()=>{F();try{Be()}catch{await Ve(),F()}});let _;function A(){const x=v.value;if(!x)return;const b=ne(x);_!=null&&e.buffer-Math.abs(b-_)>=10||(_=b,F())}let H=!1,Q=!1;async function F(){var x;if(H){Q=!0;return}if(!e.items||e.disabled)return;H=!0;const b=v.value,y=(x=k.value)==null?void 0:x.$el;if(!b||!y)return;s.value||(s.value=_e()),t.value=Ce(),n.value=Se(),await Ve();let B,X=0;const M={},ie=e.table?y.querySelector("tbody").children:y.children;for(let O=0;O<ie.length;O++){const L=ie[O],K=Ne(L,"position");if(K&&["absolute","fixed"].includes(K))continue;const ee=Ne(L,"display")!=="none"?ce(L):0,se=L.getAttribute("vt-index"),Ee=se?parseInt(se):t.value+X;M[Ee]=(M[Ee]||0)+ee,X++}for(const O of Object.keys(M)){const L=parseInt(O);u.value[L]!==M[L]&&(u.value[L]=M[L],B=!0)}B&&await Ve(),H=!1,Q&&(Q=!1,F());function Ce(){const O=ne(b)-z(b)-e.buffer;return Xe(c.value,L=>L-O,{returnNearestIfNoHit:!0}).index}function Se(){const O=ne(b)-z(b)+q(b)+e.buffer;return Xe(c.value,L=>L-O,{returnNearestIfNoHit:!0}).index}function _e(){const O=[],L=e.table?y.querySelector("tbody").children:y.children;for(let K=0;K<L.length;K++){const ee=L[K],se=getComputedStyle(ee);if(["absolute","fixed"].includes(se.position))continue;const Ee=ce(ee);if(O.push(Ee),O.length>=10)break}return O.length===0?0:O.reduce((K,ee)=>K+ee,0)/O.length}}function q(x){const b=getComputedStyle(x);let y=parseFloat(e.horizontal?b.width:b.height);return b.boxSizing==="border-box"&&(e.horizontal?y=y-parseFloat(b.borderLeftWidth)-parseFloat(b.borderRightWidth):y=y-parseFloat(b.borderTopWidth)-parseFloat(b.borderBottomWidth)),y}function ce(x){let b=q(x);const y=getComputedStyle(x);return e.horizontal?b+=parseFloat(y.borderLeftWidth)+parseFloat(y.borderRightWidth)+parseFloat(y.marginLeft)+parseFloat(y.marginRight):b+=parseFloat(y.borderTopWidth)+parseFloat(y.borderBottomWidth)+parseFloat(y.marginTop)+parseFloat(y.marginBottom),b=Number.isNaN(b)?0:b,b}function ne(x){return e.horizontal?x.scrollLeft:x.scrollTop}function z(x){const b=getComputedStyle(x);return e.horizontal?parseFloat(b.paddingLeft):parseFloat(b.paddingTop)}function he(x){return c.value[x]}function Be(){const x=v.value;new ResizeObserver(b=>{for(let y of b)if(Ie(y.target,"vtlist")){F();break}}).observe(x)}function De(x,b){if(e.itemKey){if(typeof e.itemKey=="string"&&e.itemKey==="index")return b;if(typeof e.itemKey=="function")return e.itemKey(x,b)}}return{listElRef:v,listInnerRef:k,onscroll:A,listStyle:d,listInnerStyle:o,visibleItemsInfo:p,getItemKey:De,update:F,sizes:h,positions:c,runtimeSizes:u}}});function an(e,t,n,r,s,a){const l=re("VirtualListTable");return $(),T("div",{class:"vtlist",ref:"listElRef",style:de(e.listStyle),onScrollPassive:t[0]||(t[0]=(...i)=>e.onscroll&&e.onscroll(...i))},[f(l,{class:"vtlist-inner",ref:"listInnerRef",style:de(e.listInnerStyle),table:e.table},{prepend:g(()=>[V(e.$slots,"prepend")]),append:g(()=>[V(e.$slots,"append")]),default:g(()=>[e.disabled?($(!0),T(ue,{key:0},je(e.items,(i,d)=>V(e.$slots,"default",{key:e.getItemKey(i,d),item:i,index:d})),128)):($(!0),T(ue,{key:1},je(e.visibleItemsInfo,({item:i,index:d})=>V(e.$slots,"default",{key:e.getItemKey(i,d),item:i,index:d})),128))]),_:3},8,["style","table"])],36)}const rn=ft(nn,[["render",an]]);/*!
 * @he-tree/tree-utils v0.1.0-alpha.5
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: null
 * Released under the MIT License.
 */const oe="children";function sn(e){const n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r={...ln,...n,data:e,stats:null,statsFlat:null,_statsMap:null,initialized:!1,init(){const{data:a,childrenKey:l}=this,i=new Ye([]);this._statsMap=new Map,J(a,(o,u,h,c)=>{const p=this.statHandler({...nt(),data:o,open:!!this.defaultOpen,parent:i.getParent(c),children:[],level:c.length});this._statsMap.set(o,p),i.set(c,p)},{childrenKey:l});const d=[];i.walk(o=>{d.push(o)}),this.stats=this.statsHandler(i.rootChildren),this.statsFlat=this.statsFlatHandler(d),this.initialized=!0},getStat(a){let l=this._statsMap.get(a);if(!l)throw new at("Stat not found");return l},has(a){if(a.isStat)return this.statsFlat.indexOf(a)>-1;try{return!!this.getStat(a)}catch(l){if(l instanceof at)return!1;throw l}},_getPathByStat(a){if(a==null)return[];const i=this.getSiblings(a).indexOf(a);return[...a.parent?this._getPathByStat(a.parent):[],i]},afterOneCheckChanged(a){const{checked:l}=a;if(a._ignoreCheckedOnce)return delete a._ignoreCheckedOnce,!1;const i=d=>{const{parent:o}=d;if(o){let u,h,c;for(const v of o.children)v.checked?u=!0:v.checked===0?c=!0:h=!0;const p=c?0:h?u?0:!1:!0;o.checked!==p&&(this._ignoreCheckedOnce(o),o.checked=p),i(o)}};return i(a),J(a.children,d=>{d.checked!==l&&(this._ignoreCheckedOnce(d),d.checked=l)},{childrenKey:oe}),!0},_ignoreCheckedOnce(a){a._ignoreCheckedOnce=!0,setTimeout(()=>{a._ignoreCheckedOnce&&(a._ignoreCheckedOnce=!1)},100)},isVisible(a){const l=a.isStat?a:this.getStat(a),i=d=>!d||!d.hidden&&d.open&&i(d.parent);return!!(!l.hidden&&i(l.parent))},updateCheck(){J(this.stats,a=>{if(a.children&&a.children.length>0){const l=a.children.every(i=>i.checked);a.checked!==l&&(this._ignoreCheckedOnce(a),a.checked=l)}},{childFirst:!0,childrenKey:oe})},getChecked(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return this.statsFlat.filter(l=>l.checked||a&&l.checked===0)},getUnchecked(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this.statsFlat.filter(l=>a?!l.checked:l.checked===!1)},openAll(){for(const a of this.statsFlat)a.open=!0},closeAll(){for(const a of this.statsFlat)a.open=!1},openNodeAndParents(a){const l=a.isStat?a:this.getStat(a);for(const i of this.iterateParent(l,{withSelf:!0}))i.open=!0},_calcFlatIndex(a,l){let i=a?this.statsFlat.indexOf(a)+1:0;const d=a?a.children:this.stats;for(let o=0;o<l;o++)i+=this._count(d[o]);return i},add(a,l,i){if(this.has(a))throw"Can't add because data exists in tree";const d=l?l.children:this.stats;i==null&&(i=d.length);const o=this.statHandler({...nt(),open:!!this.defaultOpen,data:a,parent:l||null,children:[],level:l?l.level+1:1});this._setPosition(o,l||null,i);const u=a[this.childrenKey];if(u){const h=u.slice();for(const c of h)this.add(c,o)}},remove(a){const l=this.getSiblings(a);if(l.includes(a)){ut(l,a);const i=this._flat(a);this.statsFlat.splice(this.statsFlat.indexOf(a),i.length);for(const d of i)this._statsMap.delete(d.data);return this.afterRemoveStat(a),!0}return!1},getSiblings(a){const{parent:l}=a;return l?l.children:this.stats},_setPosition(a,l,i){(l?l.children:this.stats).splice(i,0,a),a.parent=l,a.level=l?l.level+1:1;const o=this._calcFlatIndex(l,i),u=this._flat(a);this.statsFlat.splice(o,0,...u);for(const h of u)this._statsMap.has(h.data)||this._statsMap.set(h.data,h);J(a,(h,c,p)=>{p&&(h.level=p.level+1)},{childrenKey:oe}),this.afterSetStat(a,l,i)},*iterateParent(a,l){let i=l!=null&&l.withSelf?a:a.parent;for(;i;)yield i,i=i.parent},move(a,l,i){if(this.has(a)){if(a.parent===l&&this.getSiblings(a).indexOf(a)===i)return!1;if(a===l)throw new Error("Can't move node to it self");if(l&&a.level<l.level){let d;for(const o of this.iterateParent(l))if(o.level===a.level){d=o;break}if(a===d)throw new Error("Can't move node to its descendant")}this.remove(a)}return this._setPosition(a,l,i),!0},_flat(a){const l=[];return J(a,i=>{l.push(i)},{childrenKey:oe}),l},_count(a){return this._flat(a).length},getData(a,l){const{childrenKey:i}=this,d=new Ye([]);return d.childrenKey=i,J(l||this.stats,(o,u,h,c)=>{let p={...o.data,[i]:[]};a&&(p=a(p)),d.set(c,p)},{childrenKey:oe}),d.data}},s=r;return r.noInitialization||s.init(),s}const ln={childrenKey:"children",defaultOpen:!1,statsHandler(e){return e},statsFlatHandler(e){return e},afterSetStat(e,t,n){},afterRemoveStat(e){},statHandler(e){return e}};function nt(){return{isStat:!0,hidden:!1,checked:!1,style:null,class:null,draggable:null,droppable:null}}class at extends Error{constructor(t){super(t),this.name="StatNotFoundError"}}/*!
 * drag-event-service v2.0.0
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: null
 * Released under the MIT License.
 */const Oe={start:["mousedown","touchstart"],move:["mousemove","touchmove"],end:["mouseup","touchend"]},Ke={isTouch(e){return e.type&&e.type.startsWith("touch")},_getStore(e){return e._wrapperStore||(e._wrapperStore=[]),e._wrapperStore},on(e,t,n,r){const{args:s,mouseArgs:a,touchArgs:l}=rt(r),i=this._getStore(e),d=this,o=function(u){let h;if(d.isTouch(u))h={x:u.changedTouches[0].pageX,y:u.changedTouches[0].pageY,pageX:u.changedTouches[0].pageX,pageY:u.changedTouches[0].pageY,clientX:u.changedTouches[0].clientX,clientY:u.changedTouches[0].clientY,screenX:u.changedTouches[0].screenX,screenY:u.changedTouches[0].screenY};else if(h={x:u.pageX,y:u.pageY,pageX:u.pageX,pageY:u.pageY,clientX:u.clientX,clientY:u.clientY,screenX:u.screenX,screenY:u.screenY},t==="start"&&u.which!==1)return;return n.call(this,u,h)};i.push({handler:n,wrapper:o}),Z.call(null,e,Oe[t][0],o,...s,...a),Z.call(null,e,Oe[t][1],o,...s,...l)},off(e,t,n,r){const{args:s,mouseArgs:a}=rt(r),l=this._getStore(e);for(let i=l.length-1;i>=0;i--){const{handler:d,wrapper:o}=l[i];n===d&&(G.call(null,e,Oe[t][0],o,...s,...a),G.call(null,e,Oe[t][1],o,...s,...a),l.splice(i,1))}}};function rt(e){e||(e={});const t=e.args||[],n=e.mouseArgs||[],r=e.touchArgs||[];return{args:t,mouseArgs:n,touchArgs:r}}/*!
 * @he-tree/dnd-utils v0.1.0-alpha.4
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: null
 * Released under the MIT License.
 */const Ue=new Map,te={triggerElement:null,dragElement:null,internal:!1,dropEffect:"none",preventDefault:!1},W=te;function be(e){e.dataTransfer&&(e.dataTransfer.dropEffect=W.dropEffect)}function on(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Ue.has(e))throw"Already registered on specified element";const n={...t},r=n;ht(n,dn),Ke.on(e,"start",s,{touchArgs:[{passive:!0}]}),Ke.on(e,"end",a);function s(h){var c;const p=h.target;p.nodeType===Node.ELEMENT_NODE&&(W.triggerElement=p);const v=p;if(n.ingoreHTMLTags&&v.tagName&&n.ingoreHTMLTags.find(_=>_.toUpperCase()===v.tagName))return;const k=(c=n.beforeDragStart)===null||c===void 0?void 0:c.call(n,h);k&&(k.setAttribute("draggable","true"),W.dragElement=k)}function a(h){W.dragElement&&W.dragElement.removeAttribute("draggable")}function l(h){var c;W.internal=!0,(c=n.onDragStart)===null||c===void 0||c.call(n,h),be(h)}function i(h){var c;(c=n.onDrag)===null||c===void 0||c.call(n,h),be(h)}function d(h){var c;(c=n.onDragEnd)===null||c===void 0||c.call(n,h),W.internal=!1,W.dragElement&&W.dragElement.removeAttribute("draggable"),W.triggerElement=null,W.dragElement=null,W.dropEffect="none"}const o=cn(e,{onDragLeave(h){var c;(c=n.onDragLeave)===null||c===void 0||c.call(n,h),be(h)},onDragEnter(h){var c;r.ifPreventDefault(h)&&h.preventDefault(),(c=n.onDragEnter)===null||c===void 0||c.call(n,h),be(h)},onDragOver(h){var c;r.ifPreventDefault(h)&&h.preventDefault(),(c=n.onDragOver)===null||c===void 0||c.call(n,h),be(h)},onDrop(h){var c;r.ifPreventDefault(h)&&h.preventDefault(),(c=n.onDrop)===null||c===void 0||c.call(n,h)},onEnter(h){var c;(c=n.onEnter)===null||c===void 0||c.call(n,h)},onLeave(h){var c;(c=n.onLeave)===null||c===void 0||c.call(n,h)}});return Z(e,"dragstart",l),Z(e,"drag",i),Z(e,"dragend",d),Object.assign(n,{root:e,destroy:()=>{Ke.off(e,"start",s,{touchArgs:[{passive:!0}]}),G(e,"dragstart",l),G(e,"drag",i),G(e,"dragend",d),o(),Ue.delete(e)}}),Ue.set(e,r),r}const dn={ingoreHTMLTags:["INPUT","TEXTAREA","SELECT","OPTGROUP","OPTION"],ifPreventDefault(e){return te.dragElement?!0:W.preventDefault},beforeDragStart(e){},onDragStart(e){},onDrag(e){},onDragEnter(e){},onDragLeave(e){},onDragOver(e){},onDragEnd(e){},onDrop(e){}};let Fe=null;const un=e=>{Fe=e,setTimeout(()=>{Fe=null},20)};function cn(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=e;let r=!1;const s=p=>{var v;r=!0,(v=t.onEnter)===null||v===void 0||v.call(t,p),u.resume()},a=p=>{var v;un(p.target),(v=t.onDragEnter)===null||v===void 0||v.call(t,p),r||s(p)},l=p=>{var v;r||s(p),(v=t.onDragOver)===null||v===void 0||v.call(t,p)},i=p=>{var v;(v=t.onDragLeave)===null||v===void 0||v.call(t,p);const k=function(){var A;let H=arguments.length>0&&arguments[0]!==void 0?arguments[0]:p;r=!1,(A=t.onLeave)===null||A===void 0||A.call(t,H),u.stop()},_=Fe;Fe=null,_&&Xt(_,n)||k()},d=p=>{var v;(v=t.onDrop)===null||v===void 0||v.call(t,p)},o=p=>{var v;p instanceof KeyboardEvent&&p.key!=="Escape"||(r=!1,u.stop(),(v=t.onEndBeforeLeave)===null||v===void 0||v.call(t,p))},u=qt([[e,"drop",o],[window,"mouseup",o],[window,"touchend",o],[window,"keydown",o]]);u.stop();const h=()=>{Z(e,"dragenter",a),Z(e,"dragover",l),Z(e,"dragleave",i),Z(e,"drop",d)},c=()=>{G(e,"dragenter",a),G(e,"dragover",l),G(e,"dragleave",i),G(e,"drop",d),u.stop()};return h(),c}/*!
 * @he-tree/vue v2.9.3
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: https://hetree.phphe.com/
 * Released under the MIT License.
 */let Ae=!1;const hn=()=>{Ae=!0,setTimeout(()=>{Ae=!1},100)},gn=xe({props:["stat","rtl","btt","indent","table","treeLine","treeLineOffset","processor"],emits:["open","close","check"],setup(e,{emit:t}){const n=Y(()=>({[e.rtl?"paddingRight":"paddingLeft"]:e.indent*(e.stat.level-1)+"px"}));We(()=>e.stat.checked,a=>{Ae||e.processor.afterOneCheckChanged(e.stat)&&t("check",e.stat)}),We(()=>e.stat.open,a=>{Ae||(t(a?"open":"close",e.stat),hn())});const r=Y(()=>{const a=[],l=u=>{var h;if(u.parent){let c=(h=u.parent)==null?void 0:h.children.indexOf(u);do{c++;let p=u.parent.children[c];if(p){if(!p.hidden)return!0}else break}while(!0)}return!1},i=e.rtl?"right":"left",d=e.btt?"top":"bottom";let o=e.stat;for(;o;){let u=(o.level-2)*e.indent+e.treeLineOffset;const h=l(o),c=()=>{a.push({style:{[i]:u+"px",[d]:h?0:"50%"}})};o===e.stat?o.level>1&&c():h&&c(),o=o.parent}return a}),s=Y(()=>{let a=(e.stat.level-2)*e.indent+e.treeLineOffset;return{[e.rtl?"right":"left"]:a+"px"}});return{indentStyle:n,vLines:r,hLineStyle:s}}}),pt=(e,t)=>{const n=e.__vccOpts||e;for(const[r,s]of t)n[r]=s;return n},fn={class:"tree-node-inner"},pn={key:1,class:"tree-node",ref:"el"};function mn(e,t,n,r,s,a){return e.table?($(),T("tr",pn,[V(e.$slots,"default",{indentStyle:e.indentStyle})],512)):($(),T("div",{key:0,class:me(["tree-node",{"tree-node--with-tree-line":e.treeLine}]),style:de(e.indentStyle),ref:"el"},[e.treeLine?($(),T(ue,{key:0},[($(!0),T(ue,null,je(e.vLines,l=>($(),T("div",{class:"tree-line tree-vline",style:de(l.style)},null,4))),256)),e.stat.level>1?($(),T("div",{key:0,class:"tree-line tree-hline",style:de(e.hLineStyle)},null,4)):S("",!0)],64)):S("",!0),E("div",fn,[V(e.$slots,"default",{indentStyle:e.indentStyle})])],6))}const vn=pt(gn,[["render",mn]]);function yn(e,t={}){const n={...t,statHandler(r){return this._statHandler2&&(r=this._statHandler2(r)),ze(t.statHandler,we(r))},statsHandler(r){return ze(t.statsHandler,we(r))},statsFlatHandler(r){return ze(t.statsFlatHandler,we(r))}};return sn(e,n)}function ze(e,t){return e?e(t):t}const bn=xe({components:{VirtualList:rn,TreeNode:vn},props:{value:{required:Ft,type:Array},modelValue:{required:At,type:Array},updateBehavior:{type:String,default:"modify"},processor:{type:Object,default:()=>yn([],{noInitialization:!0})},childrenKey:{type:String,default:"children"},textKey:{type:String,default:"text"},indent:{type:Number,default:20},virtualization:{type:Boolean,default:!1},virtualizationPrerenderCount:{type:Number,default:20},defaultOpen:{type:Boolean,default:!0},statHandler:{type:Function},rtl:{type:Boolean,default:!1},btt:{type:Boolean,default:!1},table:{type:Boolean,default:!1},watermark:{type:Boolean,default:!1},nodeKey:{type:[String,Function],default:"index"},treeLine:{type:Boolean,default:!1},treeLineOffset:{type:Number,default:8}},emits:["update:modelValue","click:node","open:node","close:node","check:node","beforeDragStart","before-drag-start","after-drop","change","enter","leave"],data(){return{stats:[],statsFlat:[],dragNode:null,dragOvering:!1,placeholderData:{},placeholderColspan:1,batchUpdateWaiting:!1,self:this,_ignoreValueChangeOnce:!1}},computed:{valueComputed(){return this.modelValue||[]},visibleStats(){const{statsFlat:e,isVisible:t}=this;let n=e;return this.btt&&(n=n.slice(),n.reverse()),n.filter(r=>t(r))},rootChildren(){return this.stats}},methods:{_emitValue(e){this.$emit("update:modelValue",e)},_updateValue(e){return this.updateBehavior==="disabled"?!1:(e!==this.valueComputed&&(this._ignoreValueChangeOnce=!0),this._emitValue(e),!0)},getStat:Me(R("getStat")),has:Me(R("has")),updateCheck:R("updateCheck"),getChecked:R("getChecked"),getUnchecked:R("getUnchecked"),openAll:R("openAll"),closeAll:R("closeAll"),openNodeAndParents:R("openNodeAndParents"),isVisible:R("isVisible"),move:it("move"),add:Me(it("add")),addMulti(e,t,n){this.batchUpdate(()=>{let r=n;for(const s of e)this.add(s,t,r),r!=null&&r++})},remove:R("remove"),removeMulti(e){let t=[...e];this.batchUpdate(()=>{for(const n of t)this.remove(n)})},iterateParent:R("iterateParent"),getSiblings:R("getSiblings"),getData:R("getData"),getRootEl(){return this.$refs.vtlist.listElRef},batchUpdate(e){const t=this.ignoreUpdate(e);return this.batchUpdateWaiting||this._updateValue(this.updateBehavior==="new"?this.getData():this.valueComputed),t},ignoreUpdate(e){const t=this.batchUpdateWaiting;this.batchUpdateWaiting=!0;const n=e();return this.batchUpdateWaiting=t,n}},watch:{processor:{immediate:!0,handler(e){if(e){const t=n=>{if(n){const{childrenKey:r}=this;return n[r]||(n[r]=[]),n[r]}else return this.valueComputed};e._statHandler2=this.statHandler?n=>n.data===this.placeholderData?n:this.statHandler(n):null,e.afterSetStat=(n,r,s)=>{const{childrenKey:a,updateBehavior:l}=this;let i=this.valueComputed;if(l==="new"){if(this.batchUpdateWaiting)return;i=this.getData()}else if(l==="modify"){const d=t(r==null?void 0:r.data);d.includes(n.data)||d.splice(s,0,n.data)}this.batchUpdateWaiting||this._updateValue(i)},e.afterRemoveStat=n=>{var r;const{childrenKey:s,updateBehavior:a}=this;let l=this.valueComputed;if(a==="new"){if(this.batchUpdateWaiting)return;l=this.getData()}else if(a==="modify"){const i=t((r=n.parent)==null?void 0:r.data);ut(i,n.data)}this.batchUpdateWaiting||this._updateValue(l)}}e.initialized||(e.data=this.valueComputed,Object.assign(e,Kt(this,["childrenKey","defaultOpen"])),e.init(),e.updateCheck()),this.stats=e.stats,this.statsFlat=e.statsFlat,e.data!==this.valueComputed&&this._updateValue(e.data)}},valueComputed:{handler(e){if(this.dragOvering||this.dragNode||this._ignoreValueChangeOnce)this._ignoreValueChangeOnce=!1;else{const{processor:t}=this;t.data=e,t.init(),this.stats=t.stats,this.statsFlat=t.statsFlat}}}},created(){},mounted(){typeof window<"u"&&(this.watermark===!1&&(window._heTreeWatermarkDisabled=!0),this.watermark&&!window._heTreeWatermarkDisabled&&(window._heTreeWatermark||(window._heTreeWatermark=!0,console.log("%c[he-tree] Vue tree component:  https://hetree.phphe.com","color:#0075ff; font-size:14px;"))))}});function R(e){return function(...t){return this.processor[e](...t)}}function it(e){return function(...t){return this.batchUpdate(()=>this.processor[e](...t))}}function Me(e){return function(t,...n){return t&&(t=we(t)),e.call(this,t,...n)}}const kn={key:0,class:"drag-placeholder he-tree-drag-placeholder"},$n=["colspan"],wn={class:"drag-placeholder he-tree-drag-placeholder"};function xn(e,t,n,r,s,a){const l=re("TreeNode"),i=re("VirtualList");return $(),N(i,{class:me(["he-tree",{"he-tree--rtl rtl":e.rtl,"he-tree--drag-overing drag-overing":e.dragOvering}]),ref:"vtlist",items:e.visibleStats,disabled:!e.virtualization,table:e.table,itemKey:e.nodeKey},{prepend:g(()=>[V(e.$slots,"prepend",{tree:e.self})]),default:g(({item:d,index:o})=>[f(l,{"vt-index":o,class:me([d.class,{"drag-placeholder-wrapper":d.data===e.placeholderData,"dragging-node":d===e.dragNode}]),style:de(d.style),stat:d,rtl:e.rtl,btt:e.btt,indent:e.indent,table:e.table,treeLine:e.treeLine,treeLineOffset:e.treeLineOffset,processor:e.processor,onClick:u=>e.$emit("click:node",d),onOpen:t[0]||(t[0]=u=>e.$emit("open:node",u)),onClose:t[1]||(t[1]=u=>e.$emit("close:node",u)),onCheck:t[2]||(t[2]=u=>e.$emit("check:node",u))},{default:g(({indentStyle:u})=>[d.data===e.placeholderData?($(),T(ue,{key:0},[e.table?($(),T("td",{key:1,style:de(u),colspan:e.placeholderColspan},[E("div",wn,[V(e.$slots,"placeholder",{tree:e.self})])],12,$n)):($(),T("div",kn,[V(e.$slots,"placeholder",{tree:e.self})]))],64)):V(e.$slots,"default",{key:1,node:d.data,stat:d,indentStyle:u,tree:e.self},()=>[P(D(d.data[e.textKey]),1)])]),_:2},1032,["vt-index","class","style","stat","rtl","btt","indent","table","treeLine","treeLineOffset","processor","onClick"])]),append:g(()=>[V(e.$slots,"append",{tree:e.self})]),_:3},8,["class","items","disabled","table","itemKey"])}const Dn=pt(bn,[["render",xn]]);let w=null,m=null,Le,$e,le,Pe,Re,j,st;const ke={get startInfo(){return Le},get targetInfo(){return $e}},Cn=xe({extends:Dn,props:{triggerClass:{type:[String,Array]},disableDrag:Boolean,disableDrop:Boolean,eachDraggable:{type:Function},eachDroppable:{type:Function},rootDroppable:{type:[Boolean,Function],default:!0},dragOpen:{type:Boolean,default:!0},dragOpenDelay:{type:Number,default:0},beforeDragOpen:{type:Function},resolveStartMovePoint:{type:[String,Function]},keepPlaceholder:{type:Boolean},maxLevel:{type:Number},dragCopy:{type:Boolean},dragCopyDataHandler:{type:Function},onExternalDragOver:{type:Function},externalDataHandler:{type:Function},ondragstart:{type:Function}},data(){return{treeDraggableInstance:null}},computed:{},methods:{getNodeByElement(e){const t=e.getAttribute("vt-index");return t==null?null:this.visibleStats[t]},isDraggable(e){if(this.disableDrag)return!1;if(e.draggable!=null)return e.draggable;if(this.eachDraggable){const n=this.eachDraggable(e);if(n!=null)return n}const{parent:t}=e;return t?this.isDraggable(t):!0},isDroppable(e){if(this.disableDrop)return!1;if(!e)return Qe(this.rootDroppable,[this,w]);if(e.droppable!=null)return e.droppable;if(this.eachDroppable){const n=this.eachDroppable(e);if(n!=null)return n}const{parent:t}=e;return t?this.isDroppable(t):!0},_eachDroppable(){var e;return Qe((e=this._isDragCopy)==null?void 0:e.call(this),[this])}},mounted(){const e=(o,u)=>{let h=!0;return w&&w!==this&&(h=h&&this._isMoved),this.table&&!this._isDragCopy&&(h=h&&this._isDragCopy),h&&(o.x!==u.x||o.y!==u.y)},t=(o,u)=>{m.ignoreUpdate(()=>{if(!m.has(m.placeholderData)){if(m.table){let c=0;const p=m.getRootEl().querySelector("tr");if(p)for(const{value:v}of Ut(p.children))Ne(v,"display")!=="none"&&(c+=v.colSpan||1);c<1&&(c=1),m.placeholderColspan=c}m.add(m.placeholderData)}const h=m.getStat(m.placeholderData);m.move(h,o,u)})},n=()=>{const o=this;if(o.has(o.placeholderData))return o.remove(o.getStat(o.placeholderData)),!0},r=o=>{o?te.dropEffect=w!=null&&w.dragCopy?"copy":"move":te.dropEffect="none"},s=o=>{const u=this;o?r(!0):u.keepPlaceholder?u.has(u.placeholderData)||r(!1):(n(),r(!1))};let a={x:0,y:0};const l=this.getRootEl();let i=null;const d=()=>{m!=null&&m.has(m.placeholderData)&&m.ignoreUpdate(()=>{m.remove(m.getStat(m.placeholderData)),w&&(w.dragNode.hidden=!1,w.dragOvering=!1)})};this.treeDraggableInstance=on(l,{beforeDragStart:o=>{if(!te.triggerElement)return;let u=this.triggerClass;(!u||u.length===0)&&(u="tree-node");let h=Ht(u),c=et(te.triggerElement,p=>{if(tt(p,h))return!0;if(Ie(p,"tree-node"))return"break"},{withSelf:!0,until:l});if(i=et(c,p=>{if(Ie(p,"tree-node"))return!0},{withSelf:!0,until:l}),!!i){if(j=this.getNodeByElement(i),!j)throw"Can't find drag node";if(this.isDraggable(j))return this.$emit("before-drag-start",j),this.$emit("beforeDragStart",j),l}},onDragStart:o=>{var u,h,c;if(!i||!j)return;{const{x:k,y:_}=i.getBoundingClientRect(),{clientX:A,clientY:H}=o;(u=o.dataTransfer)==null||u.setDragImage(i,A-k,H-_)}Re={x:o.clientX,y:o.clientY},w=this,w.dragNode=j,Pe=(()=>{if(this.resolveStartMovePoint==="mouse")return{x:o.clientX,y:o.clientY};if(typeof this.resolveStartMovePoint=="function")return this.resolveStartMovePoint(i);{let k,_=0;if(this.table){let A=i.getBoundingClientRect();k={x:A.x,y:A.y},this.rtl&&(k.x=A.right),_=A.height}else if(!this.rtl)k=i.children[0].getBoundingClientRect().toJSON(),_=k.height;else{const A=i.children[0].getBoundingClientRect();k={x:A.right,y:A.y},_=A.height}return this.btt&&(k.y+=_),k}})(),this.dragOvering=!0;const p=w.getSiblings(w.dragNode),v=p.indexOf(j);Le={tree:w,dragNode:j,parent:j.parent,siblings:p,indexBeforeDrop:v},m=this,(h=o.dataTransfer)==null||h.setData("text",`he-tree drag start at ${new Date().toISOString()}`),w._eachDroppable()||setTimeout(()=>{j.hidden=!0,t(j.parent,v+1)},0),(c=this.ondragstart)==null||c.call(this,o)},onEnter:o=>{this.$emit("enter",o)},onLeave:o=>{le=null,this.dragOvering=!1,te.preventDefault=!1,n(),this.$emit("leave",o)},onDragOver:Wt(o=>{if(!w){if(!this.onExternalDragOver||this.onExternalDragOver(o)===!1)return;te.preventDefault=!0}const u={x:o.clientX,y:o.clientY},h=e(u,a);if(a=u,!h)return;this.dragOvering=!0,m=this;const c=Pe?{x:Pe.x+(u.x-Re.x),y:Pe.y+(u.y-Re.y)}:{...u},{btt:p,rtl:v}=m;if(m.disableDrop){te.dropEffect="none";return}let k,_;const A=m.getRootEl().querySelectorAll(".tree-node"),H=[];A.forEach(y=>{!tt(y,["drag-placeholder-wrapper","dragging-node"])&&Ne(y,"display")!=="none"&&H.push(y)});const Q=Xe(H,y=>He(y)[p?"bottom":"top"]-c.y,{returnNearestIfNoHit:!0});let F=null,q,ce;Q.hit||(Q.greater?p||(F=Q.index-1,H[F]||F++):p&&(F=Q.index+1,H[F]||F--)),F==null&&(F=Q.index),q=H[F],ce=p?H[F-1]:H[F+1],k=q&&m.getNodeByElement(q),_=ce&&m.getNodeByElement(ce);const{indent:ne}=m,z=ye(()=>{if(m.table){let y=He(q).toJSON();const B=ne*(k.level-1);return v?(y.width-=B,y.right-=B):y.x+=B,y}else return He(q.firstElementChild)}).action,he=ye(()=>p?c.y>z().y+z().height/2:c.y<z().y+z().height/2).action,Be=ye(()=>p?!q||F===H.length-1&&he():!q||F===0&&he()).action,De=ye(()=>v?c.x-(z().x+z().width):z().x-c.x).action,x=ye(()=>v?c.x<z().x+z().width-ne:c.x>z().x+ne).action;let b;if(Be())b=1,k=null;else if(k)De()>0?b=k.level-Math.ceil(De()/ne):x()?b=k.level+1:b=k.level;else return;_&&b<_.level&&(b=_.level),(async()=>{let y,B,X=!1,M=null;const ie=async O=>{if(O.open)return!0;if(m.dragOpen)if(m.dragOpenDelay)if(M=O,le===O)X=!0;else{let L=Yt();le=O;const K=O;return setTimeout(async()=>{K!==le?(X=!0,L.resolve(!0)):(m.beforeDragOpen&&await m.beforeDragOpen(O),K!==le?(X=!0,L.resolve(!0)):(O.open=!0,M=null,L.resolve(!0)))},m.dragOpenDelay),await L.promise}else return m.beforeDragOpen&&await m.beforeDragOpen(O),O.open=!0,!0;else return!1},Ce=async()=>{if(m.isDroppable(k)&&await ie(k)){if(X)return;y=k,B=null}else return!1},Se=(O=b)=>{let L=k,K=[];for(;L&&L.level>=O;)L=L.parent||null,K.unshift(L);let ee=0;for(const se of K){if(m.isDroppable(se))return y=se,B=K[ee+1]||k,!0;ee++}return!1};st=k||null,k?b>k.level?await Ce()===!1&&Se(k.level):Se()===!1&&await Ce():m.isDroppable(null)&&(y=null),le=M;const _e=!!(!X&&(y||y===null));return{cancelled:X,success:_e,parent:y,index:_e?B?(y?y.children:m.stats).filter(O=>O.data!==m.placeholderData).indexOf(B)+1:0:-1}})().then(y=>{if(!y.cancelled){if(!y.success){s(!1);return}if(m.maxLevel!=null&&m.maxLevel>0){let B=1;if(w){const X=w.dragNode;let M=0;J(X,ie=>{ie.level>M&&(M=ie.level)},{childrenKey:oe}),B=M-X.level+1}if(B+(y.parent?y.parent.level:0)>m.maxLevel){s(!1);return}}s(!0),t(y.parent,y.index)}})}),onDrop:o=>{m=this;const u=!w;if(!m)return;const h=w==null?void 0:w.dragNode;let c,p=(()=>{var v;let k=!0;if(!m.has(m.placeholderData))k=!1;else if(u)c=(v=this.externalDataHandler)==null?void 0:v.call(this,o),k=c!=null;else if(!w.dragCopy){const _=m.getStat(m.placeholderData);w===m&&_.parent===h.parent&&jt(h,A=>A===_)}return k})();if(p){const v=m.getStat(m.placeholderData),k=m.getSiblings(v);$e={tree:m,dragNode:h,parent:v.parent,siblings:k,indexBeforeDrop:k.indexOf(v)}}(()=>{if(d(),p){let v=$e.indexBeforeDrop;w&&!w.dragCopy&&w===m&&Le.parent==$e.parent&&Le.indexBeforeDrop<v&&v--,w&&w!==m&&!w._eachDroppable()&&w.batchUpdate(()=>{w.remove(h),w.updateCheck()}),m.batchUpdate(()=>{let k=w==null?void 0:w.dragNode,_;c?_=c:w._eachDroppable()&&(_=gt(w.dragNode.data,{childrenKey:w.childrenKey}),w.dragCopyDataHandler&&(_=w.dragCopyDataHandler(_))),_&&(m.add(_),k=m.getStat(_)),m.move(k,$e.parent,v),m.updateCheck()})}m.$emit("after-drop"),p&&(w&&(w.dragCopy||w.$emit("change")),m!==w&&m.$emit("change"))})()},onDragEnd:o=>{d(),w&&(w.dragNode&&(w.dragNode.hidden=!1),w.dragNode=null,w.dragOvering=!1,w=null),m=null,le=null,j=null,st=null}})},unmounted(){var e;(e=this.treeDraggableInstance)==null||e.destroy()}}),Sn={components:{Draggable:Cn},props:{embed:{type:Boolean,default:!1},filter:{type:Object,default:()=>({})}},emits:["select"],inject:["debounce"],data(){return{menu:{},items:[],loading:!0,checked:null,clip:null,term:""}},setup(){const e=bt(),t=ot(),n=dt();return{app:kt(),auth:n,languages:e,messages:t}},created(){this.searchd=this.debounce(this.search,500),this.fetch().then(e=>{this.items=e.data,this.loading=!1})},mounted(){this.checked=!1},computed:{canTrash(){var e;return this.isChecked&&((e=this.$refs.tree)==null?void 0:e.statsFlat.some(t=>t._checked&&!t.data.deleted_at))},isChecked(){var e;return this.checked||((e=this.$refs.tree)==null?void 0:e.statsFlat.some(t=>t._checked))},isTrashed(){var e;return this.isChecked&&((e=this.$refs.tree)==null?void 0:e.statsFlat.some(t=>t._checked&&t.data.deleted_at))}},methods:{add(){if(this.embed||!this.auth.can("page:add")){this.messages.add(this.$gettext("Permission denied"),"error");return}const e=this.create();this.$apollo.mutate({mutation:U`mutation ($input: PageInput!) {
            addPage(input: $input) {
              id
            }
          }`,variables:{input:e}}).then(t=>{if(t.errors)throw t.errors;if(!t.data.addPage)throw new Error("No data in addPage mutation result");const n={...t.data.addPage};this.$refs.tree.add(n),this.$emit("select",n)}).catch(t=>{this.messages.add(this.$gettext("Error adding root page")+`:
`+t,"error"),this.$log("PageList::add(): Error adding root page",t)})},change(){if(!this.auth.can("page:move")){this.messages.add(this.$gettext("Permission denied"),"error");return}const e=ke.targetInfo.parent,n=ke.targetInfo.siblings[ke.targetInfo.indexBeforeDrop+1]||null;this.$apollo.mutate({mutation:U`mutation ($id: ID!, $parent: ID, $ref: ID) {
            movePage(id: $id, parent: $parent, ref: $ref) {
              id
            }
          }`,variables:{id:ke.startInfo.dragNode.data.id,parent:e?e.data.id:null,ref:n?n.data.id:null}}).then(r=>{if(r.errors)throw r.errors;const s=ke.startInfo.parent;s!=null&&s.data&&!(s!=null&&s.children.length)&&(s.data.has=!1),e&&(e.data.has=!0)}).catch(r=>{this.messages.add(this.$gettext("Error moving page")+`:
`+r,"error"),this.$log("PageList::change(): Error moving page",r)})},copy(e,t){this.clip={type:"copy",node:t,stat:e}},create(e={}){return Object.assign({path:"_"+Math.floor(Math.random()*1e4),lang:this.$vuetify.locale.current||this.languages.default(),status:0,cache:5},e)},cut(e,t){this.$refs.tree.statsFlat.forEach(n=>{delete n.cut}),e.cut=!0,this.clip={type:"cut",node:t,stat:e}},drop(e){if(!this.auth.can("page:drop")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.$refs.tree.statsFlat.filter(n=>{var r;return n._checked&&((r=n.data)==null?void 0:r.id)});t.length&&this.$apollo.mutate({mutation:U`mutation ($id: [ID!]!) {
            dropPage(id: $id) {
              id
            }
          }`,variables:{id:t.map(n=>n.data.id)}}).then(n=>{if(n.errors)throw n.errors;for(const r of t)this.update(r,s=>{s.data.deleted_at=new Date().toISOString().replace(/T/," ").substring(0,19),s.check=!1});this.invalidate()}).catch(n=>{this.messages.add(this.$gettext("Error trashing page")+`:
`+n,"error"),this.$log("PageList::drop(): Error trashing page",t,n)})},fetch(e=null,t=1,n=100){if(!this.auth.can("page:view"))return this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve([]);const r=this.filter.publish||null,s=this.filter.trashed||"WITHOUT",a={...this.filter};return delete a.trashed,delete a.publish,delete a.view,a.parent_id=e,this.$apollo.query({query:U`query($filter: PageFilter, $limit: Int!, $page: Int!, $trashed: Trashed, $publish: Publish) {
            pages(filter: $filter, first: $limit, page: $page, trashed: $trashed, publish: $publish) {
              data {
                ${this.fields()}
              }
              paginatorInfo {
                currentPage
                lastPage
              }
            }
          }`,variables:{filter:a,page:t,limit:n,trashed:s,publish:r}}).then(l=>{if(l.errors)throw l.errors;return this.transform(l.data.pages)}).catch(l=>{this.messages.add(this.$gettext("Error fetching pages")+`:
`+l,"error"),this.$log("PageList::fetch(): Error fetching page",e,t,n,l)})},fields(){return`id
          parent_id
          created_at
          deleted_at
          editor
          has
          latest {
            id
            published
            publish_at
            data
            editor
            created_at
          }`},hydrate(e){var n,r,s,a,l;const t=(n=e.latest)!=null&&n.data?JSON.parse(e.latest.data):{...e};return Object.assign(t,{id:e.id,has:e.has,parent_id:e.parent_id,deleted_at:e.deleted_at,created_at:e.created_at,updated_at:((r=e.latest)==null?void 0:r.created_at)||e.updated_at,editor:((s=e.latest)==null?void 0:s.editor)||e.editor,published:((a=e.latest)==null?void 0:a.published)??!0,publish_at:((l=e.latest)==null?void 0:l.publish_at)||null,latest:e.latest})},insert(e,t=null){if(!this.auth.can("page:add")){this.messages.add(this.$gettext("Permission denied"),"error");return}const n=this.$refs.tree.getSiblings(e),r=t!==null?e.parent:e,s=n.indexOf(e),a=this.create();let l=null;switch(t===null&&!e.open&&this.load(e,e.data),t){case 0:l=e.data.id;break;case null:l=e.children&&e.children[0]?e.children[0].data.id:null;break;case 1:l=n[s+1]?n[s+1].data.id:null;break}this.$apollo.mutate({mutation:U`mutation ($input: PageInput!, $parent: ID, $ref: ID) {
            addPage(input: $input, parent: $parent, ref: $ref) {
              id
            }
          }`,variables:{input:a,parent:r?r.data.id:null,ref:l}}).then(i=>{if(i.errors)throw i.errors;a.id=i.data.addPage.id,(t!==null||e.open)&&this.$refs.tree.add(a,r,t!==null?s+t:0),r&&(r.data.has=!0),this.invalidate(),this.submenu()}).catch(i=>{this.messages.add(this.$gettext("Error inserting page")+`:
`+i,"error"),this.$log("PageList::insert(): Error inserting page",i)})},invalidate(){const e=this.$apollo.provider.defaultClient.cache;e.evict({id:"ROOT_QUERY",fieldName:"pages"}),e.gc()},keep(e){if(!this.auth.can("page:keep")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.$refs.tree.statsFlat.filter(s=>s._checked&&s.data.id&&s.data.deleted_at),n=t.filter(s=>t.indexOf(s.parent)===-1),r=e.data.deleted_at||null;n.length&&this.$apollo.mutate({mutation:U`mutation ($id: [ID!]!) {
            keepPage(id: $id) {
              id
            }
          }`,variables:{id:n.map(s=>s.data.id)}}).then(s=>{if(s.errors)throw s.errors;for(const a of n)this.update(a,l=>{r>=l.data.deleted_at&&(l.data.deleted_at=null,l.check=!1)});this.invalidate()}).catch(s=>{this.messages.add(this.$gettext("Error restoring page")+`:
`+s,"error"),this.$log("PageList::keep(): Error restoring page",n,s)})},load(e,t){!e.open&&!t.children&&(e.loading=!0,this.fetch(t.id,e.page?e.page+1:1).then(n=>{this.$refs.tree.addMulti(n.data,e,0),e.page=n.currentPage||1}).finally(()=>{e.loading=!1})),e.open=!e.open},move(e,t=null){if(!this.auth.can("page:move")){this.messages.add(this.$gettext("Permission denied"),"error");return}const n=this.$refs.tree.getSiblings(e),r=t!==null?e.parent:e,s=n.indexOf(e);let a=null;switch(t){case 0:a=e.data.id;break;case null:a=e.children&&e.children[0]?e.children[0].data.id:null;break;case 1:a=n[s+1]?n[s+1].data.id:null;break}this.$apollo.mutate({mutation:U`mutation ($id: ID!, $parent: ID, $ref: ID) {
            movePage(id: $id, parent: $parent, ref: $ref) {
              id
            }
          }`,variables:{id:this.clip.node.id,parent:r?r.data.id:null,ref:a}}).then(l=>{var d;if(l.errors)throw l.errors;const i=t!==null?s<this.$refs.tree.getSiblings(e).indexOf(this.clip.stat)?s+t:s:0;this.$refs.tree.move(this.clip.stat,r,i),r&&((d=this.clip.stat.children)!=null&&d.length||(e.parent.data.has=!1),r.data.has=!0),this.invalidate(),this.submenu()}).catch(l=>{this.messages.add(this.$gettext("Error moving page")+`:
`+l,"error"),this.$log("PageList::move(): Error moving page",e,t,l)})},paste(e,t=null){if(!this.auth.can("page:add")){this.messages.add(this.$gettext("Permission denied"),"error");return}const n=this.$refs.tree.getSiblings(e),r=t!==null?e.parent:e,s=n.indexOf(e),a={...this.clip.node};let l=null;switch(t){case 0:l=e.data.id;break;case null:l=e.children&&e.children[0]?e.children[0].data.id:null;break;case 1:l=n[s+1]?n[s+1].data.id:null;break}return this.$apollo.query({query:U`query($id: ID!) {
            page(id: $id) {
              id
              latest {
                id
                aux
                files {
                  id
                }
                elements {
                  id
                }
              }
            }
          }`,variables:{id:a.id}}).then(i=>{var u,h;if(i.errors)throw i.errors;const d=(h=(u=i==null?void 0:i.data)==null?void 0:u.page)==null?void 0:h.latest,o=JSON.parse((d==null?void 0:d.aux)||"{}");this.$apollo.mutate({mutation:U`mutation ($input: PageInput!, $parent: ID, $ref: ID, $elements: [ID!], $files: [ID!]) {
              addPage(input: $input, parent: $parent, ref: $ref, elements: $elements, files: $files) {
                ${this.fields()}
              }
            }`,variables:{input:{status:0,to:a.to,tag:a.tag,type:a.type,theme:a.theme,lang:a.lang,name:a.name,title:a.title,cache:a.cache,domain:a.domain,related_id:a.id,meta:JSON.stringify((o==null?void 0:o.meta)||{}),config:JSON.stringify((o==null?void 0:o.config)||{}),content:JSON.stringify((o==null?void 0:o.content)||[]),path:a.path+"_"+Math.floor(Math.random()*1e4)},parent:r?r.data.id:null,ref:l,elements:(d==null?void 0:d.elements.map(c=>c.id))||[],files:(d==null?void 0:d.files.map(c=>c.id))||[]}}).then(c=>{if(c.errors)throw c.errors;if(!c.data.addPage)throw new Error("No page data returned");const p=t!==null?this.$refs.tree.getSiblings(e).indexOf(e)+t:0,v=this.hydrate(c.data.addPage);this.$refs.tree.add(v,r,p),this.invalidate(),this.submenu()}).catch(c=>{this.messages.add(this.$gettext("Error copying page")+`:
`+c,"error"),this.$log("PageList::paste(): Error copying page",e,t,c)})}).catch(i=>{this.messages.add(this.$gettext("Error fetching page")+`:
`+i,"error"),this.$log("PageList::paste(): Error fetching page",a.id,i)})},publish(e){if(!this.auth.can("page:publish")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.$refs.tree.statsFlat.filter(n=>n._checked&&n.data.id&&!n.data.published);t.length&&this.$apollo.mutate({mutation:U`mutation ($id: [ID!]!) {
            pubPage(id: $id) {
              id
            }
          }`,variables:{id:t.map(n=>n.data.id)}}).then(n=>{if(n.errors)throw n.errors;for(const r of t)r.data.published=!0,r.check=!1;this.invalidate()}).catch(n=>{this.messages.add(this.$gettext("Error publishing page")+`:
`+n,"error"),this.$log("PageList::publish(): Error publishing page",t,n)})},purge(e){if(!this.auth.can("page:purge")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.$refs.tree.statsFlat.filter(n=>n._checked&&n.data.id);t.length&&this.$apollo.mutate({mutation:U`mutation ($id: [ID!]!) {
            purgePage(id: $id) {
              id
            }
          }`,variables:{id:t.map(n=>n.data.id).reverse()}}).then(n=>{var r;if(n.errors)throw n.errors;for(const s of t)this.$refs.tree.remove(s),s.parent&&!((r=s.parent.children)!=null&&r.length)&&(s.parent.data.has=!1)}).catch(n=>{this.messages.add(this.$gettext("Error purging page")+`:
`+n,"error"),this.$log("PageList::purge(): Error purging page",t,n)})},reload(e=!0){if(this.items=[],this.loading=!0,e){const n=this.$apollo.provider.defaultClient.cache;n.evict({id:"ROOT_QUERY",fieldName:"pages"}),n.gc()}(this.filter.view==="list"?this.search():this.fetch()).then(n=>{this.items=(n==null?void 0:n.data)||[],this.loading=!1})},search(e=1,t=100){if(!this.auth.can("page:view"))return this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve([]);const n=this.filter.publish||null,r=this.filter.trashed||"WITHOUT",s={...this.filter};return delete s.trashed,delete s.publish,delete s.view,this.term&&(s.any=this.term),this.$apollo.query({query:U`query($filter: PageFilter, $limit: Int!, $page: Int!, $trashed: Trashed, $publish: Publish) {
            pages(filter: $filter, first: $limit, page: $page, trashed: $trashed, publish: $publish) {
              data {
                ${this.fields()}
              }
              paginatorInfo {
                currentPage
                lastPage
              }
            }
          }`,variables:{filter:s,page:e,limit:t,trashed:r,publish:n}}).then(a=>{if(a.errors)throw a.errors;return this.transform(a.data.pages)}).catch(a=>{this.messages.add(this.$gettext("Error searching pages")+`:
`+a,"error"),this.$log("PageList::search(): Error searching pages",e,t,a)})},status(e,t){if(!this.auth.can("page:save")){this.messages.add(this.$gettext("Permission denied"),"error");return}(e?[e]:this.$refs.tree.statsFlat.filter(r=>r._checked&&r.data.id)).forEach(r=>{this.$apollo.mutate({mutation:U`mutation ($id: ID!, $input: PageInput!) {
              savePage(id: $id, input: $input) {
                id
              }
            }`,variables:{id:r.data.id,input:{status:t}}}).then(s=>{if(s.errors)throw s.errors;r.data.status=t}).catch(s=>{this.messages.add(this.$gettext("Error saving page")+`:
`+s,"error"),this.$log("PageList::status(): Error saving page",r,t,s)})})},submenu(e=null){e?this.menu[e]=!this.menu[e]:this.menu={}},title(e){const t=[];return e.publish_at&&t.push("Publish at: "+new Date(e.publish_at).toLocaleDateString()),e.theme&&t.push("Theme: "+e.theme),e.type&&t.push("Page type: "+e.type),e.tag&&t.push("Tag: "+e.tag),e.cache&&t.push("Cache: "+e.cache+" min"),t.join(`
`)},toggle(){this.$refs.tree.statsFlat.forEach(e=>{e._checked=!e._checked})},transform(e){return{data:e.data.map(n=>this.hydrate(n)),currentPage:e.paginatorInfo.currentPage,lastPage:e.paginatorInfo.lastPage}},update(e,t){var n;if(typeof t!="function")throw new Error("Second paramter must be a function");t(e),(n=e.children)==null||n.forEach(r=>{t(r,t)})},url(e){return this.app.urlpage.replace(/_domain_/,e.domain||"").replace(/_path_/,e.path||"").replace(/\/+$/,"")}},watch:{filter:{deep:!0,handler(e){this.items=[],this.loading=!0,(e.view==="list"?this.search():this.fetch()).then(n=>{this.items=(n==null?void 0:n.data)||[],this.loading=!1})}},term:{handler(){this.reload(!1)}}}},_n={class:"header"},En={class:"bulk"},On={class:"search"},Pn={class:"actions"},Ln={key:0,class:"spinner",fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Tn=["title"],In=["onClick"],Nn={class:"item-head"},Fn={key:0,class:"item-lang"},An={class:"item-title"},Bn={key:0,class:"item-subtitle"},Vn=["href"],Hn={class:"item-domain"},Kn={class:"item-path item-subtitle"},Un={key:0,class:"item-to item-subtitle"},zn={key:0,class:"loading"},Mn={key:1,class:"notfound"},Rn={key:2,class:"btn-group"};function jn(e,t,n,r,s,a){const l=re("Draggable");return $(),T(ue,null,[E("div",_n,[E("div",En,[f(qe,{modelValue:s.checked,"onUpdate:modelValue":t[0]||(t[0]=i=>s.checked=i),onClick:t[1]||(t[1]=$t(i=>a.toggle(),["stop"]))},null,8,["modelValue"]),f(fe,null,{activator:g(({props:i})=>[f(C,Je({"append-icon":"mdi-menu-down",variant:"text"},i,{disabled:!a.isChecked}),{default:g(()=>[P(D(e.$gettext("Actions")),1)]),_:1},16,["disabled"])]),default:g(()=>[f(pe,null,{default:g(()=>[a.isChecked&&r.auth.can("page:publish")?($(),N(I,{key:0},{default:g(()=>[f(C,{"prepend-icon":"mdi-publish",variant:"text",onClick:t[2]||(t[2]=i=>a.publish())},{default:g(()=>[P(D(e.$gettext("Publish")),1)]),_:1})]),_:1})):S("",!0),a.isChecked&&r.auth.can("page:save")?($(),N(I,{key:1},{default:g(()=>[f(C,{"prepend-icon":"mdi-eye",variant:"text",onClick:t[3]||(t[3]=i=>a.status(null,1))},{default:g(()=>[P(D(e.$gettext("Enable")),1)]),_:1})]),_:1})):S("",!0),a.isChecked&&r.auth.can("page:save")?($(),N(I,{key:2},{default:g(()=>[f(C,{"prepend-icon":"mdi-eye-off",variant:"text",onClick:t[4]||(t[4]=i=>a.status(null,0))},{default:g(()=>[P(D(e.$gettext("Disable")),1)]),_:1})]),_:1})):S("",!0),f(xt),a.canTrash&&r.auth.can("page:drop")?($(),N(I,{key:3},{default:g(()=>[f(C,{"prepend-icon":"mdi-delete",variant:"text",onClick:t[5]||(t[5]=i=>a.drop())},{default:g(()=>[P(D(e.$gettext("Delete")),1)]),_:1})]),_:1})):S("",!0),a.isTrashed&&r.auth.can("page:keep")?($(),N(I,{key:4},{default:g(()=>[f(C,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:t[6]||(t[6]=i=>a.keep())},{default:g(()=>[P(D(e.$gettext("Restore")),1)]),_:1})]),_:1})):S("",!0),a.isChecked&&r.auth.can("page:purge")?($(),N(I,{key:5},{default:g(()=>[f(C,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:t[7]||(t[7]=i=>a.purge())},{default:g(()=>[P(D(e.$gettext("Purge")),1)]),_:1})]),_:1})):S("",!0)]),_:1})]),_:1})]),E("div",On,[f(wt,{modelValue:s.term,"onUpdate:modelValue":t[8]||(t[8]=i=>s.term=i),label:e.$gettext("Search for"),"prepend-inner-icon":"mdi-magnify",variant:"underlined","hide-details":"",clearable:""},null,8,["modelValue","label"])]),f(C,{onClick:t[9]||(t[9]=i=>a.reload()),title:e.$gettext("Reload page tree"),icon:"mdi-refresh",variant:"text",class:"no-rtl"},null,8,["title"])]),f(l,{ref:"tree",modelValue:s.items,"onUpdate:modelValue":t[10]||(t[10]=i=>s.items=i),onChange:t[11]||(t[11]=i=>a.change()),defaultOpen:!1,disableDrag:!r.auth.can("page:move"),rtl:e.$vuetify.locale.isRtl,watermark:!1,virtualization:""},{default:g(({node:i,stat:d})=>[E("div",Pn,[d.loading?($(),T("svg",Ln,[...t[13]||(t[13]=[E("circle",{class:"spin1",cx:"4",cy:"12",r:"3"},null,-1),E("circle",{class:"spin1 spin2",cx:"12",cy:"12",r:"3"},null,-1),E("circle",{class:"spin1 spin3",cx:"20",cy:"12",r:"3"},null,-1)])])):($(),N(C,{key:1,onClick:o=>a.load(d,i),class:me({hidden:!i.has&&!d.children.length}),icon:d.open?"mdi-menu-down":"mdi-menu-right",title:e.$gettext("Toggle child nodes"),variant:"text"},null,8,["onClick","class","icon","title"])),f(qe,{modelValue:d._checked,"onUpdate:modelValue":o=>d._checked=o,class:me({draft:!i.published})},null,8,["modelValue","onUpdate:modelValue","class"]),i.id?($(),N(fe,{key:2,location:"center"},{activator:g(({props:o})=>[f(C,Je(o,{title:e.$gettext("Actions"),icon:"mdi-dots-vertical",variant:"text"}),null,16,["title"])]),default:g(()=>[f(pe,null,{default:g(()=>[!i.deleted_at&&!i.published&&r.auth.can("page:publish")?($(),N(I,{key:0},{default:g(()=>[f(C,{"prepend-icon":"mdi-publish",variant:"text",onClick:o=>a.publish(d)},{default:g(()=>[P(D(e.$gettext("Publish")),1)]),_:1},8,["onClick"])]),_:2},1024)):S("",!0),f(I,null,{append:g(()=>[f(ae,{icon:"mdi-menu-right"})]),default:g(()=>[f(C,{"prepend-icon":"mdi-eye-arrow-right-outline",variant:"text"},{default:g(()=>[P(D(e.$gettext("Status")),1)]),_:1}),f(fe,{activator:"parent","open-on-hover":"",submenu:""},{default:g(()=>[f(pe,null,{default:g(()=>[i.status!==0&&r.auth.can("page:save")?($(),N(I,{key:0},{default:g(()=>[f(C,{"prepend-icon":"mdi-eye-off",variant:"text",onClick:o=>a.status(d,0)},{default:g(()=>[P(D(e.$gettext("Disable")),1)]),_:1},8,["onClick"])]),_:2},1024)):S("",!0),i.status!==1&&r.auth.can("page:save")?($(),N(I,{key:1},{default:g(()=>[f(C,{"prepend-icon":"mdi-eye",variant:"text",onClick:o=>a.status(d,1)},{default:g(()=>[P(D(e.$gettext("Enable")),1)]),_:1},8,["onClick"])]),_:2},1024)):S("",!0),i.status!==2&&r.auth.can("page:save")?($(),N(I,{key:2},{default:g(()=>[f(C,{"prepend-icon":"mdi-eye-off-outline",variant:"text",onClick:o=>a.status(d,2)},{default:g(()=>[P(D(e.$gettext("Hide")),1)]),_:1},8,["onClick"])]),_:2},1024)):S("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024),r.auth.can("page:move")?($(),N(I,{key:1},{default:g(()=>[f(C,{"prepend-icon":"mdi-content-cut",variant:"text",onClick:o=>a.cut(d,i)},{default:g(()=>[P(D(e.$gettext("Cut")),1)]),_:1},8,["onClick"])]),_:2},1024)):S("",!0),!this.embed&&r.auth.can("page:add")?($(),N(I,{key:2},{default:g(()=>[f(C,{"prepend-icon":"mdi-content-copy",variant:"text",onClick:o=>a.copy(d,i)},{default:g(()=>[P(D(e.$gettext("Copy")),1)]),_:1},8,["onClick"])]),_:2},1024)):S("",!0),s.clip&&s.clip.type=="copy"&&!this.embed&&r.auth.can("page:add")?($(),N(I,{key:3},{append:g(()=>[f(ae,{icon:"mdi-menu-right"})]),default:g(()=>[f(C,{"prepend-icon":"mdi-clipboard-arrow-right-outline",variant:"text"},{default:g(()=>[P(D(e.$gettext("Paste")),1)]),_:1}),f(fe,{activator:"parent","open-on-hover":"",submenu:""},{default:g(()=>[f(pe,null,{default:g(()=>[f(I,null,{default:g(()=>[f(C,{"prepend-icon":"mdi-arrow-up",variant:"text",onClick:o=>a.paste(d,0),class:"subitem"},{default:g(()=>[P(D(e.$gettext("Before")),1)]),_:1},8,["onClick"])]),_:2},1024),f(I,null,{default:g(()=>[f(C,{"prepend-icon":"mdi-arrow-right",variant:"text",onClick:o=>a.paste(d),class:"subitem"},{default:g(()=>[P(D(e.$gettext("Into")),1)]),_:1},8,["onClick"])]),_:2},1024),f(I,null,{default:g(()=>[f(C,{"prepend-icon":"mdi-arrow-down",variant:"text",onClick:o=>a.paste(d,1),class:"subitem"},{default:g(()=>[P(D(e.$gettext("After")),1)]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)):S("",!0),!this.embed&&r.auth.can("page:add")?($(),N(I,{key:4},{append:g(()=>[f(ae,{icon:"mdi-menu-right"})]),default:g(()=>[f(C,{"prepend-icon":"mdi-arrow-right-bold-box-outline",variant:"text"},{default:g(()=>[P(D(e.$gettext("Insert")),1)]),_:1}),f(fe,{activator:"parent","open-on-hover":"",submenu:""},{default:g(()=>[f(pe,null,{default:g(()=>[f(I,null,{default:g(()=>[f(C,{"prepend-icon":"mdi-arrow-up",variant:"text",onClick:o=>a.insert(d,0),class:"subitem"},{default:g(()=>[P(D(e.$gettext("Before")),1)]),_:1},8,["onClick"])]),_:2},1024),f(I,null,{default:g(()=>[f(C,{"prepend-icon":"mdi-arrow-right",variant:"text",onClick:o=>a.insert(d),class:"subitem"},{default:g(()=>[P(D(e.$gettext("Into")),1)]),_:1},8,["onClick"])]),_:2},1024),f(I,null,{default:g(()=>[f(C,{"prepend-icon":"mdi-arrow-down",variant:"text",onClick:o=>a.insert(d,1),class:"subitem"},{default:g(()=>[P(D(e.$gettext("After")),1)]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)):S("",!0),f(I,null,{append:g(()=>[f(ae,{icon:"mdi-menu-right"})]),default:g(()=>[f(C,{"prepend-icon":"mdi-delete-outline",variant:"text"},{default:g(()=>[P(D(e.$gettext("Remove")),1)]),_:1}),f(fe,{activator:"parent","open-on-hover":"",submenu:""},{default:g(()=>[f(pe,null,{default:g(()=>[!i.deleted_at&&r.auth.can("page:drop")?($(),N(I,{key:0},{default:g(()=>[f(C,{"prepend-icon":"mdi-delete",variant:"text",onClick:o=>a.drop(d)},{default:g(()=>[P(D(e.$gettext("Delete")),1)]),_:1},8,["onClick"])]),_:2},1024)):S("",!0),i.deleted_at&&r.auth.can("page:keep")?($(),N(I,{key:1},{default:g(()=>[f(C,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:o=>a.keep(d)},{default:g(()=>[P(D(e.$gettext("Restore")),1)]),_:1},8,["onClick"])]),_:2},1024)):S("",!0),r.auth.can("page:purge")?($(),N(I,{key:2},{default:g(()=>[f(C,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:o=>a.purge(d)},{default:g(()=>[P(D(e.$gettext("Purge")),1)]),_:1},8,["onClick"])]),_:2},1024)):S("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)):S("",!0)]),E("div",{class:me(["item-content",{"status-hidden":i.status==2,"status-enabled":i.status==1,"status-disabled":!i.status,trashed:i.deleted_at,cut:d.cut}]),title:a.title(i)},[E("div",{class:"item-text",onClick:o=>e.$emit("select",i)},[E("div",Nn,[i.lang?($(),T("span",Fn,D(i.lang),1)):S("",!0),i.publish_at?($(),N(ae,{key:1,class:"publish-at",icon:"mdi-clock-outline"})):S("",!0),i.status>1?($(),N(ae,{key:2,class:"item-status",icon:"mdi-eye-off-outline"})):S("",!0),E("span",An,D(i.name||e.$gettext("New")),1)]),i.title?($(),T("div",Bn,D(i.title),1)):S("",!0)],8,In),E("a",{class:"item-aux",href:a.url(i),target:"_blank",draggable:"false"},[E("div",Hn,D(i.domain),1),E("span",Kn,D(a.url(i)),1),i.to?($(),T("span",Un," ➔ "+D(i.to),1)):S("",!0)],8,Vn)],10,Tn)]),_:1},8,["modelValue","disableDrag","rtl"]),s.loading?($(),T("p",zn,[P(D(e.$gettext("Loading"))+" ",1),t[14]||(t[14]=E("svg",{class:"spinner",width:"32",height:"32",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},[E("circle",{class:"spin1",cx:"4",cy:"12",r:"3"}),E("circle",{class:"spin1 spin2",cx:"12",cy:"12",r:"3"}),E("circle",{class:"spin1 spin3",cx:"20",cy:"12",r:"3"})],-1))])):S("",!0),!s.loading&&!s.items.length?($(),T("p",Mn,D(e.$gettext("No entries found")),1)):S("",!0),!s.loading&&!s.items.length&&!this.embed&&this.auth.can("page:add")?($(),T("div",Rn,[f(C,{onClick:t[12]||(t[12]=i=>a.add()),title:e.$gettext("Add page"),icon:"mdi-folder-plus",color:"primary",variant:"flat"},null,8,["title"])])):S("",!0)],64)}const Wn=lt(Sn,[["render",jn]]),Yn={components:{PageListItems:Wn,PageDetail:Ze,Navigation:Nt,AsideList:It,User:Tt},inject:["locales","openView"],data:()=>({chat:"",response:"",help:!1,shortmsg:!0,synthesizing:!1,filter:{view:"tree",trashed:"WITHOUT",publish:null,status:null,editor:null,cache:null,lang:null}}),setup(){const e=ot(),t=St();return{auth:dt(),drawer:t,messages:e}},computed:{message(){if(!this.response)return this.chat;const e=this.response.indexOf(`
---
`);return this.shortmsg?this.$pgettext("ai",this.response.slice(0,e)):this.response.substring(e>0?e+5:0)}},methods:{languages(){const e=[{title:this.$gettext("All"),icon:"mdi-playlist-check",value:{lang:null}}];for(const t of this.locales())e.push({title:t.title,icon:"mdi-translate",value:{lang:t.value}});return e},open(e){this.openView(Ze,{item:e})},same(e,t){if(!e||!t)return!1;const n=Object.keys(e),r=Object.keys(t);return n.length===r.length&&n.every(s=>e[s]===t[s])},synthesize(){const e=this.chat.trim();this.chat&&(this.synthesizing=!0,this.$apollo.mutate({mutation:U`mutation($prompt: String!) {
            synthesize(prompt: $prompt)
          }`,variables:{prompt:e}}).then(t=>{var r,s;if(t.errors)throw t;this.response=((r=t.data)==null?void 0:r.synthesize)||"",this.chat=this.message;const n={view:"list",publish:"DRAFT",trashed:"WITHOUT",editor:(s=this.auth.me)==null?void 0:s.email,cache:null,lang:null,status:0};this.same(n,this.filter)?this.$refs.pagelist.reload():this.filter=n,this.synthesizing=null}).catch(t=>{this.messages.add(this.$gettext("Error synthesizing content")+`:
`+t,"error"),this.$log("PageDetailContentList::synthesize(): Error synthesizing content",t)}).finally(()=>{setTimeout(()=>{this.synthesizing=!1},3e3)}))}}},Xn={key:0,fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},qn={key:1,class:"spinner",fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Jn={key:2,fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Zn={key:0,class:"help"};function Gn(e,t,n,r,s,a){var u;const l=re("User"),i=re("Navigation"),d=re("PageListItems"),o=re("AsideList");return $(),T(ue,null,[f(Dt,{elevation:0,density:"compact"},{prepend:g(()=>[f(C,{onClick:t[0]||(t[0]=h=>r.drawer.toggle("nav")),title:r.drawer.nav?e.$gettext("Close navigation"):e.$gettext("Open navigation"),icon:r.drawer.nav?"mdi-close":"mdi-menu"},null,8,["title","icon"])]),append:g(()=>[f(l),f(C,{onClick:t[1]||(t[1]=h=>r.drawer.toggle("aside")),title:e.$gettext("Toggle side menu"),icon:r.drawer.aside?"mdi-chevron-right":"mdi-chevron-left"},null,8,["title","icon"])]),default:g(()=>[f(_t,null,{default:g(()=>[P(D(e.$gettext("Pages")),1)]),_:1})]),_:1}),f(i),f(Ct,{class:"page-list"},{default:g(()=>[f(Et,null,{default:g(()=>[f(Ot,{class:"box scroll"},{default:g(()=>[f(Pt,{modelValue:e.chat,"onUpdate:modelValue":t[5]||(t[5]=h=>e.chat=h),loading:e.synthesizing,placeholder:e.$gettext("Describe the page and content you want to create"),onDblclick:t[6]||(t[6]=h=>{e.shortmsg=!e.shortmsg,e.chat=a.message}),variant:"outlined",class:"prompt",rounded:"lg","hide-details":"",autofocus:"","auto-grow":"",clearable:"",outlined:"",rows:"1"},{prepend:g(()=>[f(ae,{onClick:t[2]||(t[2]=h=>e.help=!e.help)},{default:g(()=>[...t[9]||(t[9]=[E("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24"},[E("path",{d:"M15.07,11.25L14.17,12.17C13.45,12.89 13,13.5 13,15H11V14.5C11,13.39 11.45,12.39 12.17,11.67L13.41,10.41C13.78,10.05 14,9.55 14,9C14,7.89 13.1,7 12,7A2,2 0 0,0 10,9H8A4,4 0 0,1 12,5A4,4 0 0,1 16,9C16,9.88 15.64,10.67 15.07,11.25M13,19H11V17H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12C22,6.47 17.5,2 12,2Z"})],-1)])]),_:1})]),append:g(()=>[f(ae,{onClick:t[3]||(t[3]=h=>e.synthesizing||a.synthesize()),onKeydown:t[4]||(t[4]=Lt(h=>e.synthesizing||a.synthesize(),["enter"])),title:e.synthesizing?e.$gettext("Generating ..."):e.$gettext("Generate page based on prompt")},{default:g(()=>[e.synthesizing===!1?($(),T("svg",Xn,[...t[10]||(t[10]=[E("path",{d:"M22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2A10,10 0 0,1 22,12M6,13H14L10.5,16.5L11.92,17.92L17.84,12L11.92,6.08L10.5,7.5L14,11H6V13Z"},null,-1)])])):S("",!0),e.synthesizing===!0?($(),T("svg",qn,[...t[11]||(t[11]=[E("circle",{class:"spin1",cx:"4",cy:"12",r:"3"},null,-1),E("circle",{class:"spin1 spin2",cx:"12",cy:"12",r:"3"},null,-1),E("circle",{class:"spin1 spin3",cx:"20",cy:"12",r:"3"},null,-1)])])):S("",!0),e.synthesizing===null?($(),T("svg",Jn,[...t[12]||(t[12]=[E("path",{d:"M9,20.42L2.79,14.21L5.62,11.38L9,14.77L18.88,4.88L21.71,7.71L9,20.42Z"},null,-1)])])):S("",!0)]),_:1},8,["title"])]),_:1},8,["modelValue","loading","placeholder"]),e.help?($(),T("div",Zn,[E("ul",null,[E("li",null,D(e.$gettext("AI can create a page and content based on your input and add it to the page tree")),1),E("li",null,D(e.$gettext("Double click on the response in the input field to display full response")),1)])])):S("",!0),f(d,{ref:"pagelist",onSelect:t[7]||(t[7]=h=>a.open(h)),filter:e.filter},null,8,["filter"])]),_:1})]),_:1})]),_:1}),f(o,{filter:e.filter,"onUpdate:filter":t[8]||(t[8]=h=>e.filter=h),content:[{key:"view",title:e.$gettext("view"),items:[{title:e.$gettext("Tree"),icon:"mdi-file-tree",value:{view:"tree"}},{title:e.$gettext("List"),icon:"mdi-format-list-bulleted-square",value:{view:"list"}}]},{key:"publish",title:e.$gettext("publish"),items:[{title:e.$gettext("All"),icon:"mdi-playlist-check",value:{publish:null}},{title:e.$gettext("Published"),icon:"mdi-publish",value:{publish:"PUBLISHED"}},{title:e.$gettext("Scheduled"),icon:"mdi-clock-outline",value:{publish:"SCHEDULED"}},{title:e.$gettext("Drafts"),icon:"mdi-pencil",value:{publish:"DRAFT"}}]},{key:"trashed",title:e.$gettext("trashed"),items:[{title:e.$gettext("All"),icon:"mdi-playlist-check",value:{trashed:"WITH"}},{title:e.$gettext("Available only"),icon:"mdi-delete-off",value:{trashed:"WITHOUT"}},{title:e.$gettext("Only trashed"),icon:"mdi-delete",value:{trashed:"ONLY"}}]},{key:"status",title:e.$gettext("status"),items:[{title:e.$gettext("All"),icon:"mdi-playlist-check",value:{status:null}},{title:e.$gettext("Enabled"),icon:"mdi-eye",value:{status:1}},{title:e.$gettext("Hidden"),icon:"mdi-eye-off-outline",value:{status:2}},{title:e.$gettext("Disabled"),icon:"mdi-eye-off",value:{status:0}}]},{key:"cache",title:e.$gettext("cache"),items:[{title:e.$gettext("All"),icon:"mdi-playlist-check",value:{cache:null}},{title:e.$gettext("No cache"),icon:"mdi-clock-alert-outline",value:{cache:0}}]},{key:"editor",title:e.$gettext("editor"),items:[{title:e.$gettext("All"),icon:"mdi-playlist-check",value:{editor:null}},{title:e.$gettext("Edited by me"),icon:"mdi-account",value:{editor:(u=this.auth.me)==null?void 0:u.email}}]},{key:"lang",title:e.$gettext("languages"),items:a.languages()}]},null,8,["filter","content"])],64)}const ia=lt(Yn,[["render",Gn],["__scopeId","data-v-6236ff9f"]]);export{ia as default};
