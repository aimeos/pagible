import{l as E}from"./vue-draggable-plus-D1RNgL6u.js";import{_ as O,c as h,a as d,d as _,f as k,w as u,ac as P,F as p,a3 as b,b as v,h as V,r as U,o as s,ad as A,ae as I,t as x,af as L,ag as M,k as B,I as S,aa as J,ab as R,H as q,ah as G}from"../index.js";const H={components:{VueDraggable:E},props:{modelValue:{type:Array,default:()=>[]},config:{type:Object,default:()=>{}},assets:{type:Object,default:()=>{}},readonly:{type:Boolean,default:!1}},emits:["update:modelValue","error","addFile","removeFile"],inject:["compose","translate","txlocales"],data(){return{translating:{},composing:{},errors:[],items:[],panel:[]}},methods:{add(){this.items.push({}),this.panel.push(this.items.length-1),this.$emit("update:modelValue",this.items),this.validate()},change(){this.$emit("update:modelValue",this.items)},composeText(t,e){var f,l,o,y,m,n,g,r,c,a,C,F,N,T,w,j;const i=["generate for: "+(((l=(f=this.config.item)==null?void 0:f[e])==null?void 0:l.label)||e),"required output format: "+((y=(o=this.config.item)==null?void 0:o[e])==null?void 0:y.type),(n=(m=this.config.item)==null?void 0:m[e])!=null&&n.min?"minimum characters: "+((r=(g=this.config.item)==null?void 0:g[e])==null?void 0:r.min):null,(a=(c=this.config.item)==null?void 0:c[e])!=null&&a.max?"maximum characters: "+((F=(C=this.config.item)==null?void 0:C[e])==null?void 0:F.max):null,(T=(N=this.config.item)==null?void 0:N[e])!=null&&T.placeholder?"hint text: "+((j=(w=this.config.item)==null?void 0:w[e])==null?void 0:j.placeholder):null,"context information as JSON: "+JSON.stringify(this.items[t])];this.composing[t+e]=!0,this.compose(this.items[t][e]??"",i).then(D=>{this.update(t,e,D)}).finally(()=>{this.composing[t+e]=!1})},remove(t){this.items.splice(t,1),this.$emit("update:modelValue",this.items),this.validate()},title(t){return Object.values(t||{}).map(e=>e&&typeof e!="object"&&typeof e!="boolean"?e:null).filter(e=>!!e).join(" - ").substring(0,50)||""},toName(t){var e;return((e=t==null?void 0:t.charAt(0))==null?void 0:e.toUpperCase())+(t==null?void 0:t.slice(1))},translateText(t,e,i){this.translating[t+e]=!0,this.translate([this.items[t][e]],i).then(f=>{this.update(t,e,f[0]||"")}).finally(()=>{this.translating[t+e]=!1})},update(t,e,i){this.items[t]||(this.items[t]={}),this.items[t][e]=i,this.$emit("update:modelValue",this.items)},async validate(){const t=[e=>!this.config.max||this.config.max&&e.length<=this.config.max||this.$gettext("Maximum is %{num} entries",{num:this.config.max}),e=>(this.config.min??1)&&e.length>=(this.config.min??1)||this.$gettext("Minimum is %{num} entries",{num:this.config.min??1})];return this.errors=t.map(e=>e(this.items)).filter(e=>e!==!0),this.$emit("error",this.errors.length>0),await!this.errors.length}},watch:{modelValue:{immediate:!0,handler(t){this.items=t,this.validate()}}}},z={class:"element-title"},K={key:0,class:"actions"},Q={key:0,class:"v-input--error"},W={class:"v-input__details",role:"alert","aria-live":"polite"},X={class:"v-messages"},Y={class:"btn-group"};function Z(t,e,i,f,l,o){const y=U("VueDraggable");return s(),h(p,null,[d(P,{class:"items",modelValue:l.panel,"onUpdate:modelValue":e[4]||(e[4]=m=>l.panel=m),elevation:"0",multiple:""},{default:u(()=>[d(y,{modelValue:l.items,"onUpdate:modelValue":e[2]||(e[2]=m=>l.items=m),disabled:i.readonly,onChange:e[3]||(e[3]=m=>o.change()),draggable:".item",group:"items",animation:"500"},{default:u(()=>[(s(!0),h(p,null,b(l.items,(m,n)=>(s(),v(A,{key:n,class:"item"},{default:u(()=>[d(I,null,{default:u(()=>[i.readonly?_("",!0):(s(),v(V,{key:0,onClick:g=>o.remove(n),title:t.$gettext("Remove element"),icon:"mdi-trash-can",variant:"plain"},null,8,["onClick","title"])),k("div",z,x(o.title(m)),1)]),_:2},1024),d(L,null,{default:u(()=>[(s(!0),h(p,null,b(i.config.item||{},(g,r)=>{var c;return s(),h("div",{key:r,class:"field"},[d(M,null,{default:u(()=>[B(x(g.label||r)+" ",1),!i.readonly&&["markdown","plaintext","string","text"].includes(g.type)?(s(),h("div",K,[d(S,null,{activator:u(({props:a})=>[d(V,q({ref_for:!0},a,{title:t.$gettext("Translate %{code} field",{code:r}),loading:l.translating[n+r],icon:"mdi-translate",variant:"flat"}),null,16,["title","loading"])]),default:u(()=>[d(J,null,{default:u(()=>[(s(!0),h(p,null,b(o.txlocales(),a=>(s(),v(R,{key:a.code},{default:u(()=>[d(V,{onClick:C=>o.translateText(n,r,a.code),"prepend-icon":"mdi-arrow-right-thin",variant:"text"},{default:u(()=>[B(x(a.name),1)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1024),d(V,{title:t.$gettext("Generate text for %{code} field",{code:r}),loading:l.composing[n+r],onClick:a=>o.composeText(n,r),icon:"mdi-creation",variant:"flat"},null,8,["title","loading","onClick"])])):_("",!0)]),_:2},1024),(s(),v(G(o.toName(g.type)),{modelValue:((c=l.items[n])==null?void 0:c[r])||"","onUpdate:modelValue":a=>o.update(n,r,a),onAddFile:e[0]||(e[0]=a=>t.$emit("addFile",a)),onRemoveFile:e[1]||(e[1]=a=>t.$emit("removeFile",a)),readonly:i.readonly,assets:i.assets,config:g},null,40,["modelValue","onUpdate:modelValue","readonly","assets","config"]))])}),128))]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue","disabled"])]),_:1},8,["modelValue"]),l.errors.length?(s(),h("div",Q,[k("div",W,[k("div",X,[(s(!0),h(p,null,b(l.errors,(m,n)=>(s(),h("div",{key:n,class:"v-messages__message"},x(m),1))),128))])])])):_("",!0),k("div",Y,[!i.readonly&&(!i.config.max||i.config.max&&+l.items.length<+i.config.max)?(s(),v(V,{key:0,title:t.$gettext("Add element"),icon:"mdi-view-grid-plus",onClick:e[5]||(e[5]=m=>o.add())},null,8,["title"])):_("",!0)])],64)}const te=O(H,[["render",Z],["__scopeId","data-v-6daf0614"]]);export{te as default};
