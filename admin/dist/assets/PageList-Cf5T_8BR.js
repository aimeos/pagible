var si=Object.defineProperty;var li=(e,t,n)=>t in e?si(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var ot=(e,t,n)=>li(e,typeof t!="symbol"?t+"":t,n);import{_ as we,aF as fn,aC as St,b as E,w as m,aP as oi,o as k,a as y,a9 as ct,c as R,F as oe,a3 as $e,aN as et,aQ as ui,aa as M,f as X,t as I,H as tt,k as V,aO as Mt,av as it,b7 as Et,a1 as qe,b8 as pn,ay as ht,a4 as Rt,T as nt,r as ee,az as rt,d as O,ab as mn,ac as gn,n as ce,ad as yn,h as D,ae as kn,K as le,aB as vn,b9 as ur,a2 as bn,V as Pt,e as We,al as mt,E as je,a7 as qt,a8 as Me,aD as xn,aE as Xe,a5 as cr,ax as Ge,a6 as dr,ba as ci,i as Ue,aL as Ft,I as dt,G as hr,aG as fr,aH as pr,aI as mr,Y as di,aJ as hi,aK as fi,ao as It,bb as he,bc as Ze,Q as gt,q as xe,a$ as wt,S as rn,ar as pi,b2 as Jt,bd as Le,$ as mi}from"../index.js";import{U as gi,A as yi,N as ki}from"./Navigation-BAxNpIaQ.js";import{a as Ee,H as vi,A as bi}from"./utils-Ch_2qh3n.js";import{S as wn,F as Ht,E as xi}from"./ElementListItems-RW5KId9H.js";import{l as wi}from"./vue-draggable-plus-bJe6xj70.js";const Ci={data:()=>({active:{},open:[0,1,2]}),setup(){const e=fn(),t=St();return{drawer:e,side:t}},computed:{stores(){const e=Object.keys(this.side.store).sort(),t={};for(const n of e)t[n]=this.side.store[n];return t}},methods:{isActive(e,t){return typeof this.active[e]>"u"&&(this.active[e]={}),typeof this.active[e][t]>"u"&&(this.active[e][t]=!1),this.active[e][t]},sort(e){const t=Object.keys(e).sort(),n={};for(const r of t)n[r]=e[r];return n},toggle(e,t){this.side.toggle(e,t),this.active[e][t]=!this.active[e][t]}}},Si={class:"name"},Ei={class:"value"};function Ii(e,t,n,r,s,i){return k(),E(oi,{modelValue:r.drawer.aside,"onUpdate:modelValue":t[1]||(t[1]=a=>r.drawer.aside=a),"mobile-breakpoint":"md",location:"end"},{default:m(()=>[y(ct,{opened:e.open,"onUpdate:opened":t[0]||(t[0]=a=>e.open=a)},{default:m(()=>[(k(!0),R(oe,null,$e(i.stores,(a,l)=>et((k(),E(ui,{key:l,value:Object.keys(i.stores).indexOf(l)},{activator:m(({props:u})=>[y(M,tt({ref_for:!0},u),{default:m(()=>[V(I(e.$pgettext("as",l)),1)]),_:2},1040)]),default:m(()=>[(k(!0),R(oe,null,$e(a,(u,o)=>(k(),E(M,{key:o,active:i.isActive(l,o),onClick:c=>i.toggle(l,o),rounded:"lg"},{default:m(()=>[X("span",Si,I(e.$pgettext("st",o)),1),X("span",Ei,I(u),1)]),_:2},1032,["active","onClick"]))),128))]),_:2},1032,["value"])),[[Mt,Object.keys(a).length]])),128))]),_:1},8,["opened"])]),_:1},8,["modelValue"])}const $i=we(Ci,[["render",Ii],["__scopeId","data-v-d199f32c"]]),Pi={components:{Fields:Ht,SchemaItems:wn},props:{item:{type:Object,required:!0},assets:{type:Object,default:()=>{}}},emits:["change","error"],data:()=>({vschemas:!1,panel:[]}),setup(){const e=it(),t=Et(),n=St();return{auth:qe(),messages:e,schemas:t,side:n}},computed:{available(){return Object.keys(this.schemas).length}},methods:{add(e){if(this.item.meta||(this.item.meta={}),this.item.meta[e.type]){this.messages.add(this.$gettext("The element has already been added"),"error");return}this.item.meta[e.type]={id:Ee(),type:e.type,data:{}},this.panel.push(Object.keys(this.item.meta).length-1),this.vschemas=!1},error(e,t){e._error=t,this.$emit("error",Object.values(this.item.meta||{}).some(n=>n._error)),this.store()},fields(e){var t,n;return(t=this.schemas.meta[e])!=null&&t.fields?(n=this.schemas.meta[e])==null?void 0:n.fields:(console.warn(`No definition of fields for "${e}" available`),[])},remove(e){delete this.item.meta[e],this.$emit("change",!0),this.$nextTick(()=>{this.validate().then(t=>{this.$emit("error",!t)})})},reset(){Object.values(this.item.meta||{}).forEach(e=>{delete e._changed,delete e._error})},shown(e){const t=this.side.shown("state","valid"),n=this.side.shown("state","error"),r=this.side.shown("state","changed");return this.side.shown("type",e.type)&&(n&&e._error||r&&e._changed||t&&!e._error&&!e._changed)},store(e=!0){if(!e)return;const t={},n={};for(const r of Object.values(this.item.meta||{}))r.type&&(t[r.type]=(t[r.type]||0)+1),!r._changed&&!r._error&&(n.valid=(n.valid||0)+1),r._changed&&(n.changed=(n.changed||0)+1),r._error&&(n.error=(n.error||0)+1);this.side.store={type:t,state:n}},title(e){var t,n;return(((t=e.data)==null?void 0:t.title)||((n=e.data)==null?void 0:n.text)||Object.values(e.data||{}).map(r=>r&&typeof r!="object"&&typeof r!="boolean"?r:null).filter(r=>!!r).join(" - ")).substring(0,50)||""},update(e){e._changed=!0,this.$emit("change",!0),this.store()},validate(){var t;const e=[];return(t=this.$refs.field)==null||t.forEach(n=>{e.push(n.validate())}),Promise.all(e).then(n=>n.every(r=>r))}}},_i={class:"element-title"},Di={class:"element-type"},Oi={key:0,class:"btn-group"};function Ti(e,t,n,r,s,i){const a=ee("Fields"),l=ee("SchemaItems"),u=pn("observe-visibility");return k(),R(oe,null,[et((k(),E(ht,null,{default:m(()=>[y(rt,null,{default:m(()=>[y(mn,{class:"list",modelValue:e.panel,"onUpdate:modelValue":t[0]||(t[0]=o=>e.panel=o),elevation:"0",multiple:""},{default:m(()=>[(k(!0),R(oe,null,$e(n.item.meta||{},(o,c)=>et((k(),E(gn,{key:c,class:ce({changed:o._changed,error:o._error})},{default:m(()=>[y(yn,{"expand-icon":"mdi-pencil"},{default:m(()=>[r.auth.can("page:save")?(k(),E(D,{key:0,onClick:d=>i.remove(c),icon:"mdi-delete",variant:"text"},null,8,["onClick"])):O("",!0),X("div",_i,I(i.title(o)),1),X("div",Di,I(o.type),1)]),_:2},1024),y(kn,null,{default:m(()=>[y(a,{ref_for:!0,ref:"field",data:o.data,"onUpdate:data":d=>o.data=d,files:o.files,"onUpdate:files":d=>o.files=d,onError:d=>i.error(o,d),onChange:d=>i.update(o),readonly:!r.auth.can("page:save"),fields:i.fields(o.type),assets:n.assets},null,8,["data","onUpdate:data","files","onUpdate:files","onError","onChange","readonly","fields","assets"])]),_:2},1024)]),_:2},1032,["class"])),[[Mt,i.shown(o)]])),128))]),_:1},8,["modelValue"]),i.available&&r.auth.can("page:save")?(k(),R("div",Oi,[y(D,{onClick:t[1]||(t[1]=o=>e.vschemas=!0),title:e.$gettext("Add element"),icon:"mdi-view-grid-plus",color:"primary",variant:"flat"},null,8,["title"])])):O("",!0)]),_:1})]),_:1})),[[u,i.store]]),(k(),E(nt,{to:"body"},[y(Rt,{modelValue:e.vschemas,"onUpdate:modelValue":t[3]||(t[3]=o=>e.vschemas=o),scrollable:"",width:"auto"},{default:m(()=>[y(l,{type:"meta",onAdd:t[2]||(t[2]=o=>i.add(o))})]),_:1},8,["modelValue"])]))],64)}const Ai=we(Pi,[["render",Ti],["__scopeId","data-v-e6920356"]]),Fi={props:{item:{type:Object,required:!0},assets:{type:Object,default:()=>{}}},emits:["change","error"],inject:["debounce","locales"],data:()=>({errors:{},messages:{}}),setup(){const e=vn(),t=ur(),n=St(),r=qe();return{app:bn(),auth:r,side:n,config:t,languages:e}},created(){this.checkPathd=this.debounce(this.checkPath,500)},computed:{readonly(){return!this.auth.can("page:save")}},methods:{checkPath(){return this.$apollo.query({query:le`query($filter: PageFilter) {
            pages(filter: $filter) {
              data {
                id
              }
            }
          }`,variables:{filter:{path:this.item.path||"",domain:this.item.domain||""}}}).then(e=>{var t,n,r,s,i,a;return((r=(n=(t=e==null?void 0:e.data)==null?void 0:t.pages)==null?void 0:n.data)==null?void 0:r.length)>0&&((a=(i=(s=e==null?void 0:e.data)==null?void 0:s.pages)==null?void 0:i.data)!=null&&a.some(l=>l.id!==this.item.id))?this.messages.path=[this.$gettext("The path is already in use by another page")]:this.messages.path=[],this.$emit("error",!!this.messages.path.length),this.messages.path}).catch(e=>{console.error("PageDetailItemProps::checkPath: Error checking path",e)})},reset(){this.errors={}},setPath(e){var t;!e&&((t=this.item.path)==null?void 0:t.at(0))==="_"&&this.updatePath(this.item.name)},update(e,t){this.item[e]=typeof t=="string"?t.trim():t,this.$emit("change",!0)},updatePath(e){var t;this.update("path",(t=e==null?void 0:e.replace(/[?#%;&=+!"'()\[\]{}*<>|^]+/g," ").trim().replace(/[ ]+/g,"-"))==null?void 0:t.toLowerCase())},async validate(e=!1){await this.$nextTick();const t=[e?this.checkPathd():this.checkPath()];return Object.values(this.$refs).forEach(n=>{t.push(n.validate())}),Promise.all(t).then(n=>{const r=n.reduce((s,i)=>s+i.length,0);return this.$emit("error",!!r),r||!0})}},watch:{item:{deep:!0,immediate:!0,handler(e){this.validate(!0)}}}};function Vi(e,t,n,r,s,i){return k(),E(ht,null,{default:m(()=>[y(rt,null,{default:m(()=>[y(Pt,null,{default:m(()=>[y(We,{cols:"12",md:"6"},{default:m(()=>[y(mt,{ref:"status",items:[{key:0,val:e.$gettext("Disabled")},{key:1,val:e.$gettext("Enabled")},{key:2,val:e.$gettext("Hidden in navigation")}],readonly:i.readonly,modelValue:n.item.status,"onUpdate:modelValue":t[0]||(t[0]=a=>i.update("status",a)),variant:"underlined","item-title":"val","item-value":"key",label:e.$gettext("Status")},null,8,["items","readonly","modelValue","label"])]),_:1}),y(We,{cols:"12",md:"6"},{default:m(()=>[y(mt,{ref:"lang",items:i.locales(),readonly:i.readonly,modelValue:n.item.lang,"onUpdate:modelValue":t[1]||(t[1]=a=>i.update("lang",a)),variant:"underlined",label:e.$gettext("Language")},null,8,["items","readonly","modelValue","label"])]),_:1})]),_:1}),y(Pt,null,{default:m(()=>[y(We,{cols:"12",md:"6"},{default:m(()=>[y(je,{ref:"name",rules:[a=>!!a||e.$gettext("Field is required")],readonly:i.readonly,modelValue:n.item.name,"onUpdate:modelValue":t[2]||(t[2]=a=>i.update("name",a)),"onUpdate:focused":t[3]||(t[3]=a=>i.setPath(a)),variant:"underlined",label:e.$gettext("Page name"),counter:"255",maxlength:"255"},null,8,["rules","readonly","modelValue","label"]),y(je,{ref:"title",readonly:i.readonly,modelValue:n.item.title,"onUpdate:modelValue":t[4]||(t[4]=a=>i.update("title",a)),variant:"underlined",label:e.$gettext("Page title"),counter:"255",maxlength:"255"},null,8,["readonly","modelValue","label"])]),_:1}),y(We,{cols:"12",md:"6"},{default:m(()=>[y(je,{ref:"path",rules:[a=>!a||a&&a[0]!=="/"||e.$gettext("Path must not start with a slash (/)")],error:!!(e.messages.path||[]).length,"error-messages":e.messages.path,readonly:i.readonly,modelValue:n.item.path,"onUpdate:modelValue":t[5]||(t[5]=a=>{i.updatePath(a),e.messages.path=null}),onChange:t[6]||(t[6]=a=>i.checkPath()),variant:"underlined",label:e.$gettext("URL path"),counter:"255",maxlength:"255"},null,8,["rules","error","error-messages","readonly","modelValue","label"]),y(je,{ref:"domain",rules:[a=>!a||a&&/^([0-9a-z]+[.-])*[0-9a-z]+\.[a-z]{2,}$/.test(a)||e.$gettext("Domain name is invalid")],readonly:i.readonly,modelValue:n.item.domain,"onUpdate:modelValue":t[7]||(t[7]=a=>i.update("domain",a)),variant:"underlined",label:e.$gettext("Domain"),counter:"255",maxlength:"255"},null,8,["rules","readonly","modelValue","label"])]),_:1})]),_:1}),y(Pt,null,{default:m(()=>[y(We,{cols:"12",md:"6"},{default:m(()=>[y(mt,{ref:"theme",readonly:i.readonly,items:Object.keys(r.config.get("themes",{cms:""})),modelValue:n.item.theme,"onUpdate:modelValue":t[8]||(t[8]=a=>{i.update("theme",a),n.item.type=""}),variant:"underlined",label:e.$gettext("Theme")},null,8,["readonly","items","modelValue","label"]),y(mt,{ref:"type",readonly:i.readonly,items:Object.keys(r.config.get(`themes.${n.item.theme||"cms"}.types`,{page:""})),modelValue:n.item.type,"onUpdate:modelValue":t[9]||(t[9]=a=>i.update("type",a)),variant:"underlined",label:e.$gettext("Page type")},null,8,["readonly","items","modelValue","label"])]),_:1}),y(We,{cols:"12",md:"6"},{default:m(()=>[y(je,{ref:"tag",modelValue:n.item.tag,"onUpdate:modelValue":[t[10]||(t[10]=a=>n.item.tag=a),t[11]||(t[11]=a=>i.update())],readonly:i.readonly,label:e.$gettext("Page tag"),variant:"underlined",counter:"30",maxlength:"30"},null,8,["modelValue","readonly","label"]),y(mt,{ref:"cache",items:[{key:0,val:e.$gettext("No cache")},{key:1,val:e.$ngettext("%{num} minute","%{num} minutes",1,{num:1})},{key:5,val:e.$ngettext("%{num} minute","%{num} minutes",5,{num:5})},{key:15,val:e.$ngettext("%{num} minute","%{num} minutes",15,{num:15})},{key:30,val:e.$ngettext("%{num} minute","%{num} minutes",30,{num:30})},{key:60,val:e.$ngettext("%{num} hour","%{num} hours",1,{num:1})},{key:180,val:e.$ngettext("%{num} hour","%{num} hours",3,{num:3})},{key:360,val:e.$ngettext("%{num} hour","%{num} hours",6,{num:6})},{key:720,val:e.$ngettext("%{num} hour","%{num} hours",12,{num:12})},{key:1440,val:e.$ngettext("%{num} hour","%{num} hours",24,{num:24})}],readonly:i.readonly,modelValue:n.item.cache,"onUpdate:modelValue":t[12]||(t[12]=a=>i.update("cache",a)),variant:"underlined",label:e.$gettext("Cache time"),"item-title":"val","item-value":"key"},null,8,["items","readonly","modelValue","label"])]),_:1})]),_:1}),y(Pt,null,{default:m(()=>[y(We,{cols:"12"},{default:m(()=>[y(je,{ref:"to",rules:[a=>!a||a.match("^((https?:)?//([^\\s/:@]+(:[^\\s/:@]+)?@)?([0-9a-z]+(\\.|-))*[0-9a-z]+\\.[a-z]{2,}(:[0-9]{1,5})?)?(/[^\\s]*)*$")!==null||e.$gettext("URL is not valid")],readonly:i.readonly,modelValue:n.item.to,"onUpdate:modelValue":t[13]||(t[13]=a=>i.update("to",a)),variant:"underlined",label:e.$gettext("Redirect URL"),counter:"255",maxlength:"255"},null,8,["rules","readonly","modelValue","label"])]),_:1})]),_:1})]),_:1})]),_:1})}const Li=we(Fi,[["render",Vi]]),zi={components:{Fields:Ht,SchemaItems:wn},props:{item:{type:Object,required:!0},assets:{type:Object,default:()=>{}}},emits:["change","error"],data:()=>({vschemas:!1,panel:[]}),setup(){const e=it(),t=Et(),n=St();return{auth:qe(),messages:e,schemas:t,side:n}},computed:{available(){return Object.keys(this.schemas).length}},methods:{add(e){if(this.item.config||(this.item.config={}),this.item.config[e.type]){this.messages.add(this.$gettext("The element has already been added"),"error");return}this.item.config[e.type]={id:Ee(),type:e.type,data:{}},this.panel.push(Object.keys(this.item.config).length-1),this.vschemas=!1},error(e,t){e._error=t,this.$emit("error",Object.values(this.item.config||{}).some(n=>n._error)),this.store()},fields(e){var t,n;return(t=this.schemas.config[e])!=null&&t.fields?(n=this.schemas.config[e])==null?void 0:n.fields:(console.warn(`No definition of fields for "${e}" available`),[])},remove(e){delete this.item.config[e],this.$emit("change",!0),this.$nextTick(()=>{this.validate().then(t=>{this.$emit("error",!t)})})},reset(){Object.values(this.item.config||{}).forEach(e=>{delete e._changed,delete e._error})},shown(e){const t=this.side.shown("state","valid"),n=this.side.shown("state","error"),r=this.side.shown("state","changed");return this.side.shown("type",e.type)&&(n&&e._error||r&&e._changed||t&&!e._error&&!e._changed)},store(e=!0){if(!e)return;const t={},n={};for(const r of Object.values(this.item.config||{}))r.type&&(t[r.type]=(t[r.type]||0)+1),!r._changed&&!r._error&&(n.valid=(n.valid||0)+1),r._changed&&(n.changed=(n.changed||0)+1),r._error&&(n.error=(n.error||0)+1);this.side.store={type:t,state:n}},title(e){var t,n;return(((t=e.data)==null?void 0:t.title)||((n=e.data)==null?void 0:n.text)||Object.values(e.data||{}).map(r=>r&&typeof r!="object"&&typeof r!="boolean"?r:null).filter(r=>!!r).join(" - ")).substring(0,50)||""},update(e){e._changed=!0,this.$emit("change",!0),this.store()},validate(){var t;const e=[];return(t=this.$refs.field)==null||t.forEach(n=>{e.push(n.validate())}),Promise.all(e).then(n=>n.every(r=>r))}}},Bi={class:"element-title"},Ni={class:"element-type"},ji={key:0,class:"btn-group"};function Ui(e,t,n,r,s,i){const a=ee("Fields"),l=ee("SchemaItems"),u=pn("observe-visibility");return k(),R(oe,null,[et((k(),E(ht,null,{default:m(()=>[y(rt,null,{default:m(()=>[y(mn,{class:"list",modelValue:e.panel,"onUpdate:modelValue":t[0]||(t[0]=o=>e.panel=o),elevation:"0",multiple:""},{default:m(()=>[(k(!0),R(oe,null,$e(n.item.config||{},(o,c)=>et((k(),E(gn,{key:c,class:ce({changed:o._changed,error:o._error})},{default:m(()=>[y(yn,{"expand-icon":"mdi-pencil"},{default:m(()=>[r.auth.can("page:save")?(k(),E(D,{key:0,onClick:d=>i.remove(c),title:e.$gettext("Remove content element"),icon:"mdi-delete",variant:"text"},null,8,["onClick","title"])):O("",!0),X("div",Bi,I(i.title(o)),1),X("div",Ni,I(o.type),1)]),_:2},1024),y(kn,null,{default:m(()=>[y(a,{ref_for:!0,ref:"field",data:o.data,"onUpdate:data":d=>o.data=d,files:o.files,"onUpdate:files":d=>o.files=d,onError:d=>i.error(o,d),onChange:d=>i.update(o),readonly:!r.auth.can("page:save"),fields:i.fields(o.type),assets:n.assets},null,8,["data","onUpdate:data","files","onUpdate:files","onError","onChange","readonly","fields","assets"])]),_:2},1024)]),_:2},1032,["class"])),[[Mt,i.shown(o)]])),128))]),_:1},8,["modelValue"]),i.available&&r.auth.can("page:save")?(k(),R("div",ji,[y(D,{onClick:t[1]||(t[1]=o=>e.vschemas=!0),title:e.$gettext("Add element"),icon:"mdi-view-grid-plus",color:"primary",variant:"flat"},null,8,["title"])])):O("",!0)]),_:1})]),_:1})),[[u,i.store]]),(k(),E(nt,{to:"body"},[y(Rt,{modelValue:e.vschemas,"onUpdate:modelValue":t[3]||(t[3]=o=>e.vschemas=o),scrollable:"",width:"auto"},{default:m(()=>[y(l,{type:"config",onAdd:t[2]||(t[2]=o=>i.add(o))})]),_:1},8,["modelValue"])]))],64)}const Mi=we(zi,[["render",Ui],["__scopeId","data-v-2d8daabe"]]),Ri={components:{PageDetailItemMeta:Ai,PageDetailItemProps:Li,PageDetailItemConfig:Mi},props:{item:{type:Object,required:!0},assets:{type:Object,default:()=>{}}},emits:["update:item","update:aside","error"],data:()=>({changed:{},errors:{},tab:"details"}),methods:{error(e,t){this.errors[e]=t,this.$emit("error",Object.values(this.errors).includes(!0))},reset(){var e,t,n;this.changed={},this.errors={},(e=this.$refs.props)==null||e.reset(),(t=this.$refs.meta)==null||t.reset(),(n=this.$refs.config)==null||n.reset()},update(e){this.changed[e]=!0,this.$emit("update:item",this.item)},validate(){const e=Object.values(this.$refs).map(t=>t.validate());return Promise.all(e).then(t=>t.every(n=>n))}}};function qi(e,t,n,r,s,i){const a=ee("PageDetailItemProps"),l=ee("PageDetailItemMeta"),u=ee("PageDetailItemConfig");return k(),E(ht,null,{default:m(()=>[y(rt,{class:"box"},{default:m(()=>[y(qt,{class:"subtabs",modelValue:e.tab,"onUpdate:modelValue":t[3]||(t[3]=o=>e.tab=o),"align-tabs":"center"},{default:m(()=>[y(Me,{value:"details",class:ce({changed:e.changed.details,error:e.errors.details}),onClick:t[0]||(t[0]=o=>e.$emit("update:aside","meta"))},{default:m(()=>[V(I(e.$gettext("Detail")),1)]),_:1},8,["class"]),y(Me,{value:"meta",class:ce({changed:e.changed.meta,error:e.errors.meta}),onClick:t[1]||(t[1]=o=>e.$emit("update:aside","count"))},{default:m(()=>[V(I(e.$gettext("Meta")),1)]),_:1},8,["class"]),y(Me,{value:"config",class:ce({changed:e.changed.config,error:e.errors.config}),onClick:t[2]||(t[2]=o=>e.$emit("update:aside","count"))},{default:m(()=>[V(I(e.$gettext("Config")),1)]),_:1},8,["class"])]),_:1},8,["modelValue"]),y(xn,{modelValue:e.tab,"onUpdate:modelValue":t[10]||(t[10]=o=>e.tab=o)},{default:m(()=>[y(Xe,{value:"details"},{default:m(()=>[y(a,{ref:"props",item:n.item,assets:n.assets,onChange:t[4]||(t[4]=o=>i.update("details")),onError:t[5]||(t[5]=o=>i.error("details",o))},null,8,["item","assets"])]),_:1}),y(Xe,{value:"meta"},{default:m(()=>[y(l,{ref:"meta",item:n.item,assets:n.assets,onChange:t[6]||(t[6]=o=>i.update("meta")),onError:t[7]||(t[7]=o=>i.error("meta",o))},null,8,["item","assets"])]),_:1}),y(Xe,{value:"config"},{default:m(()=>[y(u,{ref:"config",item:n.item,assets:n.assets,onChange:t[8]||(t[8]=o=>i.update("config")),onError:t[9]||(t[9]=o=>i.error("config",o))},null,8,["item","assets"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}const Hi=we(Ri,[["render",qi],["__scopeId","data-v-c08997ac"]]),Ki={components:{ElementListItems:xi,SchemaItems:wn},props:{modelValue:{type:Boolean,required:!0},elements:{type:Boolean,default:!0}},emits:["update:modelValue","add"]},Wi={key:0};function Ji(e,t,n,r,s,i){const a=ee("SchemaItems"),l=ee("ElementListItems");return k(),E(Rt,{modelValue:n.modelValue,"max-width":"1200",scrollable:""},{default:m(()=>[y(cr,null,{append:m(()=>[y(D,{title:e.$gettext("Close"),onClick:t[0]||(t[0]=u=>e.$emit("update:modelValue",!1)),icon:"mdi-close",variant:"flat"},null,8,["title"])]),title:m(()=>[V(I(e.$gettext("Content elements")),1)]),default:m(()=>[y(Ge),y(dr,null,{default:m(()=>[y(a,{type:"content",onAdd:t[1]||(t[1]=u=>e.$emit("add",u))}),n.elements?(k(),R("div",Wi,[y(qt,null,{default:m(()=>[y(Me,null,{default:m(()=>[V(I(e.$gettext("Shared elements")),1)]),_:1})]),_:1}),y(l,{onSelect:t[2]||(t[2]=u=>e.$emit("add",u)),embed:""})])):O("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])}const gr=we(Ki,[["render",Ji],["__scopeId","data-v-028d1b9c"]]),Vn={}.hasOwnProperty;function Qi(e,t){const n=t||{};function r(s,...i){let a=r.invalid;const l=r.handlers;if(s&&Vn.call(s,e)){const u=String(s[e]);a=Vn.call(l,u)?l[u]:r.unknown}if(a)return a.call(this,s,...i)}return r.handlers=n.handlers||{},r.invalid=n.invalid,r.unknown=n.unknown,r}const Yi={}.hasOwnProperty;function yr(e,t){let n=-1,r;if(t.extensions)for(;++n<t.extensions.length;)yr(e,t.extensions[n]);for(r in t)if(Yi.call(t,r))switch(r){case"extensions":break;case"unsafe":{Ln(e[r],t[r]);break}case"join":{Ln(e[r],t[r]);break}case"handlers":{Xi(e[r],t[r]);break}default:e.options[r]=t[r]}return e}function Ln(e,t){t&&e.push(...t)}function Xi(e,t){t&&Object.assign(e,t)}function Gi(e,t,n,r){const s=n.enter("blockquote"),i=n.createTracker(r);i.move("> "),i.shift(2);const a=n.indentLines(n.containerFlow(e,i.current()),Zi);return s(),a}function Zi(e,t,n){return">"+(n?"":" ")+e}function kr(e,t){return zn(e,t.inConstruct,!0)&&!zn(e,t.notInConstruct,!1)}function zn(e,t,n){if(typeof t=="string"&&(t=[t]),!t||t.length===0)return n;let r=-1;for(;++r<t.length;)if(e.includes(t[r]))return!0;return!1}function Bn(e,t,n,r){let s=-1;for(;++s<n.unsafe.length;)if(n.unsafe[s].character===`
`&&kr(n.stack,n.unsafe[s]))return/[ \t]/.test(r.before)?"":" ";return`\\
`}function ea(e,t){const n=String(e);let r=n.indexOf(t),s=r,i=0,a=0;if(typeof t!="string")throw new TypeError("Expected substring");for(;r!==-1;)r===s?++i>a&&(a=i):i=1,s=r+t.length,r=n.indexOf(t,s);return a}function an(e,t){return!!(t.options.fences===!1&&e.value&&!e.lang&&/[^ \r\n]/.test(e.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(e.value))}function ta(e){const t=e.options.fence||"`";if(t!=="`"&&t!=="~")throw new Error("Cannot serialize code with `"+t+"` for `options.fence`, expected `` ` `` or `~`");return t}function na(e,t,n,r){const s=ta(n),i=e.value||"",a=s==="`"?"GraveAccent":"Tilde";if(an(e,n)){const d=n.enter("codeIndented"),h=n.indentLines(i,ra);return d(),h}const l=n.createTracker(r),u=s.repeat(Math.max(ea(i,s)+1,3)),o=n.enter("codeFenced");let c=l.move(u);if(e.lang){const d=n.enter(`codeFencedLang${a}`);c+=l.move(n.safe(e.lang,{before:c,after:" ",encode:["`"],...l.current()})),d()}if(e.lang&&e.meta){const d=n.enter(`codeFencedMeta${a}`);c+=l.move(" "),c+=l.move(n.safe(e.meta,{before:c,after:`
`,encode:["`"],...l.current()})),d()}return c+=l.move(`
`),i&&(c+=l.move(i+`
`)),c+=l.move(u),o(),c}function ra(e,t,n){return(n?"":"    ")+e}function Cn(e){const t=e.options.quote||'"';if(t!=='"'&&t!=="'")throw new Error("Cannot serialize title with `"+t+"` for `options.quote`, expected `\"`, or `'`");return t}function ia(e,t,n,r){const s=Cn(n),i=s==='"'?"Quote":"Apostrophe",a=n.enter("definition");let l=n.enter("label");const u=n.createTracker(r);let o=u.move("[");return o+=u.move(n.safe(n.associationId(e),{before:o,after:"]",...u.current()})),o+=u.move("]: "),l(),!e.url||/[\0- \u007F]/.test(e.url)?(l=n.enter("destinationLiteral"),o+=u.move("<"),o+=u.move(n.safe(e.url,{before:o,after:">",...u.current()})),o+=u.move(">")):(l=n.enter("destinationRaw"),o+=u.move(n.safe(e.url,{before:o,after:e.title?" ":`
`,...u.current()}))),l(),e.title&&(l=n.enter(`title${i}`),o+=u.move(" "+s),o+=u.move(n.safe(e.title,{before:o,after:s,...u.current()})),o+=u.move(s),l()),a(),o}function aa(e){const t=e.options.emphasis||"*";if(t!=="*"&&t!=="_")throw new Error("Cannot serialize emphasis with `"+t+"` for `options.emphasis`, expected `*`, or `_`");return t}function Re(e){return"&#x"+e.toString(16).toUpperCase()+";"}const De=He(/[A-Za-z]/),Ie=He(/[\dA-Za-z]/),sa=He(/[#-'*+\--9=?A-Z^-~]/);function sn(e){return e!==null&&(e<32||e===127)}const ln=He(/\d/),la=He(/[\dA-Fa-f]/),oa=He(/[!-/:-@[-`{-~]/);function U(e){return e!==null&&e<-2}function ge(e){return e!==null&&(e<0||e===32)}function Z(e){return e===-2||e===-1||e===32}const ua=He(new RegExp("\\p{P}|\\p{S}","u")),ca=He(/\s/);function He(e){return t;function t(n){return n!==null&&n>-1&&e.test(String.fromCharCode(n))}}function Vt(e){if(e===null||ge(e)||ca(e))return 1;if(ua(e))return 2}function Lt(e,t,n){const r=Vt(e),s=Vt(t);return r===void 0?s===void 0?n==="_"?{inside:!0,outside:!0}:{inside:!1,outside:!1}:s===1?{inside:!0,outside:!0}:{inside:!1,outside:!0}:r===1?s===void 0?{inside:!1,outside:!1}:s===1?{inside:!0,outside:!0}:{inside:!1,outside:!1}:s===void 0?{inside:!1,outside:!1}:s===1?{inside:!0,outside:!1}:{inside:!1,outside:!1}}vr.peek=da;function vr(e,t,n,r){const s=aa(n),i=n.enter("emphasis"),a=n.createTracker(r),l=a.move(s);let u=a.move(n.containerPhrasing(e,{after:s,before:l,...a.current()}));const o=u.charCodeAt(0),c=Lt(r.before.charCodeAt(r.before.length-1),o,s);c.inside&&(u=Re(o)+u.slice(1));const d=u.charCodeAt(u.length-1),h=Lt(r.after.charCodeAt(0),d,s);h.inside&&(u=u.slice(0,-1)+Re(d));const f=a.move(s);return i(),n.attentionEncodeSurroundingInfo={after:h.outside,before:c.outside},l+u+f}function da(e,t,n){return n.options.emphasis||"*"}const Sn=function(e){if(e==null)return ma;if(typeof e=="function")return Kt(e);if(typeof e=="object")return Array.isArray(e)?ha(e):fa(e);if(typeof e=="string")return pa(e);throw new Error("Expected function, string, or object as test")};function ha(e){const t=[];let n=-1;for(;++n<e.length;)t[n]=Sn(e[n]);return Kt(r);function r(...s){let i=-1;for(;++i<t.length;)if(t[i].apply(this,s))return!0;return!1}}function fa(e){const t=e;return Kt(n);function n(r){const s=r;let i;for(i in e)if(s[i]!==t[i])return!1;return!0}}function pa(e){return Kt(t);function t(n){return n&&n.type===e}}function Kt(e){return t;function t(n,r,s){return!!(ga(n)&&e.call(this,n,typeof r=="number"?r:void 0,s||void 0))}}function ma(){return!0}function ga(e){return e!==null&&typeof e=="object"&&"type"in e}const br=[],ya=!0,on=!1,ka="skip";function va(e,t,n,r){let s;typeof t=="function"&&typeof n!="function"?(r=n,n=t):s=t;const i=Sn(s),a=r?-1:1;l(e,void 0,[])();function l(u,o,c){const d=u&&typeof u=="object"?u:{};if(typeof d.type=="string"){const f=typeof d.tagName=="string"?d.tagName:typeof d.name=="string"?d.name:void 0;Object.defineProperty(h,"name",{value:"node ("+(u.type+(f?"<"+f+">":""))+")"})}return h;function h(){let f=br,v,C,A;if((!t||i(u,o,c[c.length-1]||void 0))&&(f=ba(n(u,c)),f[0]===on))return f;if("children"in u&&u.children){const x=u;if(x.children&&f[0]!==ka)for(C=(r?x.children.length:-1)+a,A=c.concat(x);C>-1&&C<x.children.length;){const z=x.children[C];if(v=l(z,C,A)(),v[0]===on)return v;C=typeof v[1]=="number"?v[1]:C+a}}return f}}}function ba(e){return Array.isArray(e)?e:typeof e=="number"?[ya,e]:e==null?br:[e]}function xa(e,t,n,r){let s,i,a;typeof t=="function"&&typeof n!="function"?(i=void 0,a=t,s=n):(i=t,a=n,s=r),va(e,i,l,s);function l(u,o){const c=o[o.length-1],d=c?c.children.indexOf(u):void 0;return a(u,d,c)}}const wa={};function En(e,t){const n=wa,r=typeof n.includeImageAlt=="boolean"?n.includeImageAlt:!0,s=typeof n.includeHtml=="boolean"?n.includeHtml:!0;return xr(e,r,s)}function xr(e,t,n){if(Ca(e)){if("value"in e)return e.type==="html"&&!n?"":e.value;if(t&&"alt"in e&&e.alt)return e.alt;if("children"in e)return Nn(e.children,t,n)}return Array.isArray(e)?Nn(e,t,n):""}function Nn(e,t,n){const r=[];let s=-1;for(;++s<e.length;)r[s]=xr(e[s],t,n);return r.join("")}function Ca(e){return!!(e&&typeof e=="object")}function wr(e,t){let n=!1;return xa(e,function(r){if("value"in r&&/\r?\n|\r/.test(r.value)||r.type==="break")return n=!0,on}),!!((!e.depth||e.depth<3)&&En(e)&&(t.options.setext||n))}function Sa(e,t,n,r){const s=Math.max(Math.min(6,e.depth||1),1),i=n.createTracker(r);if(wr(e,n)){const c=n.enter("headingSetext"),d=n.enter("phrasing"),h=n.containerPhrasing(e,{...i.current(),before:`
`,after:`
`});return d(),c(),h+`
`+(s===1?"=":"-").repeat(h.length-(Math.max(h.lastIndexOf("\r"),h.lastIndexOf(`
`))+1))}const a="#".repeat(s),l=n.enter("headingAtx"),u=n.enter("phrasing");i.move(a+" ");let o=n.containerPhrasing(e,{before:"# ",after:`
`,...i.current()});return/^[\t ]/.test(o)&&(o=Re(o.charCodeAt(0))+o.slice(1)),o=o?a+" "+o:a,n.options.closeAtx&&(o+=" "+a),u(),l(),o}Cr.peek=Ea;function Cr(e){return e.value||""}function Ea(){return"<"}Sr.peek=Ia;function Sr(e,t,n,r){const s=Cn(n),i=s==='"'?"Quote":"Apostrophe",a=n.enter("image");let l=n.enter("label");const u=n.createTracker(r);let o=u.move("![");return o+=u.move(n.safe(e.alt,{before:o,after:"]",...u.current()})),o+=u.move("]("),l(),!e.url&&e.title||/[\0- \u007F]/.test(e.url)?(l=n.enter("destinationLiteral"),o+=u.move("<"),o+=u.move(n.safe(e.url,{before:o,after:">",...u.current()})),o+=u.move(">")):(l=n.enter("destinationRaw"),o+=u.move(n.safe(e.url,{before:o,after:e.title?" ":")",...u.current()}))),l(),e.title&&(l=n.enter(`title${i}`),o+=u.move(" "+s),o+=u.move(n.safe(e.title,{before:o,after:s,...u.current()})),o+=u.move(s),l()),o+=u.move(")"),a(),o}function Ia(){return"!"}Er.peek=$a;function Er(e,t,n,r){const s=e.referenceType,i=n.enter("imageReference");let a=n.enter("label");const l=n.createTracker(r);let u=l.move("![");const o=n.safe(e.alt,{before:u,after:"]",...l.current()});u+=l.move(o+"]["),a();const c=n.stack;n.stack=[],a=n.enter("reference");const d=n.safe(n.associationId(e),{before:u,after:"]",...l.current()});return a(),n.stack=c,i(),s==="full"||!o||o!==d?u+=l.move(d+"]"):s==="shortcut"?u=u.slice(0,-1):u+=l.move("]"),u}function $a(){return"!"}Ir.peek=Pa;function Ir(e,t,n){let r=e.value||"",s="`",i=-1;for(;new RegExp("(^|[^`])"+s+"([^`]|$)").test(r);)s+="`";for(/[^ \r\n]/.test(r)&&(/^[ \r\n]/.test(r)&&/[ \r\n]$/.test(r)||/^`|`$/.test(r))&&(r=" "+r+" ");++i<n.unsafe.length;){const a=n.unsafe[i],l=n.compilePattern(a);let u;if(a.atBreak)for(;u=l.exec(r);){let o=u.index;r.charCodeAt(o)===10&&r.charCodeAt(o-1)===13&&o--,r=r.slice(0,o)+" "+r.slice(u.index+1)}}return s+r+s}function Pa(){return"`"}function $r(e,t){const n=En(e);return!!(!t.options.resourceLink&&e.url&&!e.title&&e.children&&e.children.length===1&&e.children[0].type==="text"&&(n===e.url||"mailto:"+n===e.url)&&/^[a-z][a-z+.-]+:/i.test(e.url)&&!/[\0- <>\u007F]/.test(e.url))}Pr.peek=_a;function Pr(e,t,n,r){const s=Cn(n),i=s==='"'?"Quote":"Apostrophe",a=n.createTracker(r);let l,u;if($r(e,n)){const c=n.stack;n.stack=[],l=n.enter("autolink");let d=a.move("<");return d+=a.move(n.containerPhrasing(e,{before:d,after:">",...a.current()})),d+=a.move(">"),l(),n.stack=c,d}l=n.enter("link"),u=n.enter("label");let o=a.move("[");return o+=a.move(n.containerPhrasing(e,{before:o,after:"](",...a.current()})),o+=a.move("]("),u(),!e.url&&e.title||/[\0- \u007F]/.test(e.url)?(u=n.enter("destinationLiteral"),o+=a.move("<"),o+=a.move(n.safe(e.url,{before:o,after:">",...a.current()})),o+=a.move(">")):(u=n.enter("destinationRaw"),o+=a.move(n.safe(e.url,{before:o,after:e.title?" ":")",...a.current()}))),u(),e.title&&(u=n.enter(`title${i}`),o+=a.move(" "+s),o+=a.move(n.safe(e.title,{before:o,after:s,...a.current()})),o+=a.move(s),u()),o+=a.move(")"),l(),o}function _a(e,t,n){return $r(e,n)?"<":"["}_r.peek=Da;function _r(e,t,n,r){const s=e.referenceType,i=n.enter("linkReference");let a=n.enter("label");const l=n.createTracker(r);let u=l.move("[");const o=n.containerPhrasing(e,{before:u,after:"]",...l.current()});u+=l.move(o+"]["),a();const c=n.stack;n.stack=[],a=n.enter("reference");const d=n.safe(n.associationId(e),{before:u,after:"]",...l.current()});return a(),n.stack=c,i(),s==="full"||!o||o!==d?u+=l.move(d+"]"):s==="shortcut"?u=u.slice(0,-1):u+=l.move("]"),u}function Da(){return"["}function In(e){const t=e.options.bullet||"*";if(t!=="*"&&t!=="+"&&t!=="-")throw new Error("Cannot serialize items with `"+t+"` for `options.bullet`, expected `*`, `+`, or `-`");return t}function Oa(e){const t=In(e),n=e.options.bulletOther;if(!n)return t==="*"?"-":"*";if(n!=="*"&&n!=="+"&&n!=="-")throw new Error("Cannot serialize items with `"+n+"` for `options.bulletOther`, expected `*`, `+`, or `-`");if(n===t)throw new Error("Expected `bullet` (`"+t+"`) and `bulletOther` (`"+n+"`) to be different");return n}function Ta(e){const t=e.options.bulletOrdered||".";if(t!=="."&&t!==")")throw new Error("Cannot serialize items with `"+t+"` for `options.bulletOrdered`, expected `.` or `)`");return t}function Dr(e){const t=e.options.rule||"*";if(t!=="*"&&t!=="-"&&t!=="_")throw new Error("Cannot serialize rules with `"+t+"` for `options.rule`, expected `*`, `-`, or `_`");return t}function Aa(e,t,n,r){const s=n.enter("list"),i=n.bulletCurrent;let a=e.ordered?Ta(n):In(n);const l=e.ordered?a==="."?")":".":Oa(n);let u=t&&n.bulletLastUsed?a===n.bulletLastUsed:!1;if(!e.ordered){const c=e.children?e.children[0]:void 0;if((a==="*"||a==="-")&&c&&(!c.children||!c.children[0])&&n.stack[n.stack.length-1]==="list"&&n.stack[n.stack.length-2]==="listItem"&&n.stack[n.stack.length-3]==="list"&&n.stack[n.stack.length-4]==="listItem"&&n.indexStack[n.indexStack.length-1]===0&&n.indexStack[n.indexStack.length-2]===0&&n.indexStack[n.indexStack.length-3]===0&&(u=!0),Dr(n)===a&&c){let d=-1;for(;++d<e.children.length;){const h=e.children[d];if(h&&h.type==="listItem"&&h.children&&h.children[0]&&h.children[0].type==="thematicBreak"){u=!0;break}}}}u&&(a=l),n.bulletCurrent=a;const o=n.containerFlow(e,r);return n.bulletLastUsed=a,n.bulletCurrent=i,s(),o}function Fa(e){const t=e.options.listItemIndent||"one";if(t!=="tab"&&t!=="one"&&t!=="mixed")throw new Error("Cannot serialize items with `"+t+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return t}function Va(e,t,n,r){const s=Fa(n);let i=n.bulletCurrent||In(n);t&&t.type==="list"&&t.ordered&&(i=(typeof t.start=="number"&&t.start>-1?t.start:1)+(n.options.incrementListMarker===!1?0:t.children.indexOf(e))+i);let a=i.length+1;(s==="tab"||s==="mixed"&&(t&&t.type==="list"&&t.spread||e.spread))&&(a=Math.ceil(a/4)*4);const l=n.createTracker(r);l.move(i+" ".repeat(a-i.length)),l.shift(a);const u=n.enter("listItem"),o=n.indentLines(n.containerFlow(e,l.current()),c);return u(),o;function c(d,h,f){return h?(f?"":" ".repeat(a))+d:(f?i:i+" ".repeat(a-i.length))+d}}function La(e,t,n,r){const s=n.enter("paragraph"),i=n.enter("phrasing"),a=n.containerPhrasing(e,r);return i(),s(),a}const za=Sn(["break","delete","emphasis","footnote","footnoteReference","image","imageReference","inlineCode","inlineMath","link","linkReference","mdxJsxTextElement","mdxTextExpression","strong","text","textDirective"]);function Ba(e,t,n,r){return(e.children.some(function(a){return za(a)})?n.containerPhrasing:n.containerFlow).call(n,e,r)}function Na(e){const t=e.options.strong||"*";if(t!=="*"&&t!=="_")throw new Error("Cannot serialize strong with `"+t+"` for `options.strong`, expected `*`, or `_`");return t}Or.peek=ja;function Or(e,t,n,r){const s=Na(n),i=n.enter("strong"),a=n.createTracker(r),l=a.move(s+s);let u=a.move(n.containerPhrasing(e,{after:s,before:l,...a.current()}));const o=u.charCodeAt(0),c=Lt(r.before.charCodeAt(r.before.length-1),o,s);c.inside&&(u=Re(o)+u.slice(1));const d=u.charCodeAt(u.length-1),h=Lt(r.after.charCodeAt(0),d,s);h.inside&&(u=u.slice(0,-1)+Re(d));const f=a.move(s+s);return i(),n.attentionEncodeSurroundingInfo={after:h.outside,before:c.outside},l+u+f}function ja(e,t,n){return n.options.strong||"*"}function Ua(e,t,n,r){return n.safe(e.value,r)}function Ma(e){const t=e.options.ruleRepetition||3;if(t<3)throw new Error("Cannot serialize rules with repetition `"+t+"` for `options.ruleRepetition`, expected `3` or more");return t}function Ra(e,t,n){const r=(Dr(n)+(n.options.ruleSpaces?" ":"")).repeat(Ma(n));return n.options.ruleSpaces?r.slice(0,-1):r}const qa={blockquote:Gi,break:Bn,code:na,definition:ia,emphasis:vr,hardBreak:Bn,heading:Sa,html:Cr,image:Sr,imageReference:Er,inlineCode:Ir,link:Pr,linkReference:_r,list:Aa,listItem:Va,paragraph:La,root:Ba,strong:Or,text:Ua,thematicBreak:Ra},Ha=[Ka];function Ka(e,t,n,r){if(t.type==="code"&&an(t,r)&&(e.type==="list"||e.type===t.type&&an(e,r)))return!1;if("spread"in n&&typeof n.spread=="boolean")return e.type==="paragraph"&&(e.type===t.type||t.type==="definition"||t.type==="heading"&&wr(t,r))?void 0:n.spread?1:0}const Je=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"],Wa=[{character:"	",after:"[\\r\\n]",inConstruct:"phrasing"},{character:"	",before:"[\\r\\n]",inConstruct:"phrasing"},{character:"	",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde"]},{character:"\r",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde","codeFencedMetaGraveAccent","codeFencedMetaTilde","destinationLiteral","headingAtx"]},{character:`
`,inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde","codeFencedMetaGraveAccent","codeFencedMetaTilde","destinationLiteral","headingAtx"]},{character:" ",after:"[\\r\\n]",inConstruct:"phrasing"},{character:" ",before:"[\\r\\n]",inConstruct:"phrasing"},{character:" ",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde"]},{character:"!",after:"\\[",inConstruct:"phrasing",notInConstruct:Je},{character:'"',inConstruct:"titleQuote"},{atBreak:!0,character:"#"},{character:"#",inConstruct:"headingAtx",after:`(?:[\r
]|$)`},{character:"&",after:"[#A-Za-z]",inConstruct:"phrasing"},{character:"'",inConstruct:"titleApostrophe"},{character:"(",inConstruct:"destinationRaw"},{before:"\\]",character:"(",inConstruct:"phrasing",notInConstruct:Je},{atBreak:!0,before:"\\d+",character:")"},{character:")",inConstruct:"destinationRaw"},{atBreak:!0,character:"*",after:`(?:[ 	\r
*])`},{character:"*",inConstruct:"phrasing",notInConstruct:Je},{atBreak:!0,character:"+",after:`(?:[ 	\r
])`},{atBreak:!0,character:"-",after:`(?:[ 	\r
-])`},{atBreak:!0,before:"\\d+",character:".",after:`(?:[ 	\r
]|$)`},{atBreak:!0,character:"<",after:"[!/?A-Za-z]"},{character:"<",after:"[!/?A-Za-z]",inConstruct:"phrasing",notInConstruct:Je},{character:"<",inConstruct:"destinationLiteral"},{atBreak:!0,character:"="},{atBreak:!0,character:">"},{character:">",inConstruct:"destinationLiteral"},{atBreak:!0,character:"["},{character:"[",inConstruct:"phrasing",notInConstruct:Je},{character:"[",inConstruct:["label","reference"]},{character:"\\",after:"[\\r\\n]",inConstruct:"phrasing"},{character:"]",inConstruct:["label","reference"]},{atBreak:!0,character:"_"},{character:"_",inConstruct:"phrasing",notInConstruct:Je},{atBreak:!0,character:"`"},{character:"`",inConstruct:["codeFencedLangGraveAccent","codeFencedMetaGraveAccent"]},{character:"`",inConstruct:"phrasing",notInConstruct:Je},{atBreak:!0,character:"~"}],jn=document.createElement("i");function $n(e){const t="&"+e+";";jn.innerHTML=t;const n=jn.textContent;return n.charCodeAt(n.length-1)===59&&e!=="semi"||n===t?!1:n}function Tr(e,t){const n=Number.parseInt(e,t);return n<9||n===11||n>13&&n<32||n>126&&n<160||n>55295&&n<57344||n>64975&&n<65008||(n&65535)===65535||(n&65535)===65534||n>1114111?"�":String.fromCodePoint(n)}const Ja=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function Ar(e){return e.replace(Ja,Qa)}function Qa(e,t,n){if(t)return t;if(n.charCodeAt(0)===35){const s=n.charCodeAt(1),i=s===120||s===88;return Tr(n.slice(i?2:1),i?16:10)}return $n(n)||e}function Ya(e){return e.label||!e.identifier?e.label||"":Ar(e.identifier)}function Xa(e){if(!e._compiled){const t=(e.atBreak?"[\\r\\n][\\t ]*":"")+(e.before?"(?:"+e.before+")":"");e._compiled=new RegExp((t?"("+t+")":"")+(/[|\\{}()[\]^$+*?.-]/.test(e.character)?"\\":"")+e.character+(e.after?"(?:"+e.after+")":""),"g")}return e._compiled}function Ga(e,t,n){const r=t.indexStack,s=e.children||[],i=[];let a=-1,l=n.before,u;r.push(-1);let o=t.createTracker(n);for(;++a<s.length;){const c=s[a];let d;if(r[r.length-1]=a,a+1<s.length){let v=t.handle.handlers[s[a+1].type];v&&v.peek&&(v=v.peek),d=v?v(s[a+1],e,t,{before:"",after:"",...o.current()}).charAt(0):""}else d=n.after;i.length>0&&(l==="\r"||l===`
`)&&c.type==="html"&&(i[i.length-1]=i[i.length-1].replace(/(\r?\n|\r)$/," "),l=" ",o=t.createTracker(n),o.move(i.join("")));let h=t.handle(c,e,t,{...o.current(),after:d,before:l});u&&u===h.slice(0,1)&&(h=Re(u.charCodeAt(0))+h.slice(1));const f=t.attentionEncodeSurroundingInfo;t.attentionEncodeSurroundingInfo=void 0,u=void 0,f&&(i.length>0&&f.before&&l===i[i.length-1].slice(-1)&&(i[i.length-1]=i[i.length-1].slice(0,-1)+Re(l.charCodeAt(0))),f.after&&(u=d)),o.move(h),i.push(h),l=h.slice(-1)}return r.pop(),i.join("")}function Za(e,t,n){const r=t.indexStack,s=e.children||[],i=t.createTracker(n),a=[];let l=-1;for(r.push(-1);++l<s.length;){const u=s[l];r[r.length-1]=l,a.push(i.move(t.handle(u,e,t,{before:`
`,after:`
`,...i.current()}))),u.type!=="list"&&(t.bulletLastUsed=void 0),l<s.length-1&&a.push(i.move(es(u,s[l+1],e,t)))}return r.pop(),a.join("")}function es(e,t,n,r){let s=r.join.length;for(;s--;){const i=r.join[s](e,t,n,r);if(i===!0||i===1)break;if(typeof i=="number")return`
`.repeat(1+i);if(i===!1)return`

<!---->

`}return`

`}const ts=/\r?\n|\r/g;function ns(e,t){const n=[];let r=0,s=0,i;for(;i=ts.exec(e);)a(e.slice(r,i.index)),n.push(i[0]),r=i.index+i[0].length,s++;return a(e.slice(r)),n.join("");function a(l){n.push(t(l,s,!l))}}function rs(e,t,n){const r=(n.before||"")+(t||"")+(n.after||""),s=[],i=[],a={};let l=-1;for(;++l<e.unsafe.length;){const c=e.unsafe[l];if(!kr(e.stack,c))continue;const d=e.compilePattern(c);let h;for(;h=d.exec(r);){const f="before"in c||!!c.atBreak,v="after"in c,C=h.index+(f?h[1].length:0);s.includes(C)?(a[C].before&&!f&&(a[C].before=!1),a[C].after&&!v&&(a[C].after=!1)):(s.push(C),a[C]={before:f,after:v})}}s.sort(is);let u=n.before?n.before.length:0;const o=r.length-(n.after?n.after.length:0);for(l=-1;++l<s.length;){const c=s[l];c<u||c>=o||c+1<o&&s[l+1]===c+1&&a[c].after&&!a[c+1].before&&!a[c+1].after||s[l-1]===c-1&&a[c].before&&!a[c-1].before&&!a[c-1].after||(u!==c&&i.push(Un(r.slice(u,c),"\\")),u=c,/[!-/:-@[-`{-~]/.test(r.charAt(c))&&(!n.encode||!n.encode.includes(r.charAt(c)))?i.push("\\"):(i.push(Re(r.charCodeAt(c))),u++))}return i.push(Un(r.slice(u,o),n.after)),i.join("")}function is(e,t){return e-t}function Un(e,t){const n=/\\(?=[!-/:-@[-`{-~])/g,r=[],s=[],i=e+t;let a=-1,l=0,u;for(;u=n.exec(i);)r.push(u.index);for(;++a<r.length;)l!==r[a]&&s.push(e.slice(l,r[a])),s.push("\\"),l=r[a];return s.push(e.slice(l)),s.join("")}function as(e){const t=e||{},n=t.now||{};let r=t.lineShift||0,s=n.line||1,i=n.column||1;return{move:u,current:a,shift:l};function a(){return{now:{line:s,column:i},lineShift:r}}function l(o){r+=o}function u(o){const c=o||"",d=c.split(/\r?\n|\r/g),h=d[d.length-1];return s+=d.length-1,i=d.length===1?i+h.length:1+h.length+r,c}}function ss(e,t){const n={},r={associationId:Ya,containerPhrasing:cs,containerFlow:ds,createTracker:as,compilePattern:Xa,enter:i,handlers:{...qa},handle:void 0,indentLines:ns,indexStack:[],join:[...Ha],options:{},safe:hs,stack:[],unsafe:[...Wa]};yr(r,n),r.options.tightDefinitions&&r.join.push(us),r.handle=Qi("type",{invalid:ls,unknown:os,handlers:r.handlers});let s=r.handle(e,void 0,r,{before:`
`,after:`
`,now:{line:1,column:1},lineShift:0});return s&&s.charCodeAt(s.length-1)!==10&&s.charCodeAt(s.length-1)!==13&&(s+=`
`),s;function i(a){return r.stack.push(a),l;function l(){r.stack.pop()}}}function ls(e){throw new Error("Cannot handle value `"+e+"`, expected node")}function os(e){const t=e;throw new Error("Cannot handle unknown node `"+t.type+"`")}function us(e,t){if(e.type==="definition"&&e.type===t.type)return 0}function cs(e,t){return Ga(e,this,t)}function ds(e,t){return Za(e,this,t)}function hs(e,t){return rs(this,e,t)}function Ae(e,t,n,r){const s=e.length;let i=0,a;if(t<0?t=-t>s?0:s+t:t=t>s?s:t,n=n>0?n:0,r.length<1e4)a=Array.from(r),a.unshift(t,n),e.splice(...a);else for(n&&e.splice(t,n);i<r.length;)a=r.slice(i,i+1e4),a.unshift(t,0),e.splice(...a),i+=1e4,t+=1e4}function Ce(e,t){return e.length>0?(Ae(e,e.length,0,t),e):t}const Mn={}.hasOwnProperty;function fs(e){const t={};let n=-1;for(;++n<e.length;)ps(t,e[n]);return t}function ps(e,t){let n;for(n in t){const s=(Mn.call(e,n)?e[n]:void 0)||(e[n]={}),i=t[n];let a;if(i)for(a in i){Mn.call(s,a)||(s[a]=[]);const l=i[a];ms(s[a],Array.isArray(l)?l:l?[l]:[])}}}function ms(e,t){let n=-1;const r=[];for(;++n<t.length;)(t[n].add==="after"?e:r).push(t[n]);Ae(e,0,0,r)}function ut(e){return e.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}function ae(e,t,n,r){const s=r?r-1:Number.POSITIVE_INFINITY;let i=0;return a;function a(u){return Z(u)?(e.enter(n),l(u)):t(u)}function l(u){return Z(u)&&i++<s?(e.consume(u),l):(e.exit(n),t(u))}}const gs={tokenize:ys};function ys(e){const t=e.attempt(this.parser.constructs.contentInitial,r,s);let n;return t;function r(l){if(l===null){e.consume(l);return}return e.enter("lineEnding"),e.consume(l),e.exit("lineEnding"),ae(e,t,"linePrefix")}function s(l){return e.enter("paragraph"),i(l)}function i(l){const u=e.enter("chunkText",{contentType:"text",previous:n});return n&&(n.next=u),n=u,a(l)}function a(l){if(l===null){e.exit("chunkText"),e.exit("paragraph"),e.consume(l);return}return U(l)?(e.consume(l),e.exit("chunkText"),i):(e.consume(l),a)}}const ks={tokenize:vs},Rn={tokenize:bs};function vs(e){const t=this,n=[];let r=0,s,i,a;return l;function l(T){if(r<n.length){const N=n[r];return t.containerState=N[1],e.attempt(N[0].continuation,u,o)(T)}return o(T)}function u(T){if(r++,t.containerState._closeFlow){t.containerState._closeFlow=void 0,s&&z();const N=t.events.length;let J=N,w;for(;J--;)if(t.events[J][0]==="exit"&&t.events[J][1].type==="chunkFlow"){w=t.events[J][1].end;break}x(r);let K=N;for(;K<t.events.length;)t.events[K][1].end={...w},K++;return Ae(t.events,J+1,0,t.events.slice(N)),t.events.length=K,o(T)}return l(T)}function o(T){if(r===n.length){if(!s)return h(T);if(s.currentConstruct&&s.currentConstruct.concrete)return v(T);t.interrupt=!!(s.currentConstruct&&!s._gfmTableDynamicInterruptHack)}return t.containerState={},e.check(Rn,c,d)(T)}function c(T){return s&&z(),x(r),h(T)}function d(T){return t.parser.lazy[t.now().line]=r!==n.length,a=t.now().offset,v(T)}function h(T){return t.containerState={},e.attempt(Rn,f,v)(T)}function f(T){return r++,n.push([t.currentConstruct,t.containerState]),h(T)}function v(T){if(T===null){s&&z(),x(0),e.consume(T);return}return s=s||t.parser.flow(t.now()),e.enter("chunkFlow",{_tokenizer:s,contentType:"flow",previous:i}),C(T)}function C(T){if(T===null){A(e.exit("chunkFlow"),!0),x(0),e.consume(T);return}return U(T)?(e.consume(T),A(e.exit("chunkFlow")),r=0,t.interrupt=void 0,l):(e.consume(T),C)}function A(T,N){const J=t.sliceStream(T);if(N&&J.push(null),T.previous=i,i&&(i.next=T),i=T,s.defineSkip(T.start),s.write(J),t.parser.lazy[T.start.line]){let w=s.events.length;for(;w--;)if(s.events[w][1].start.offset<a&&(!s.events[w][1].end||s.events[w][1].end.offset>a))return;const K=t.events.length;let Q=K,Y,te;for(;Q--;)if(t.events[Q][0]==="exit"&&t.events[Q][1].type==="chunkFlow"){if(Y){te=t.events[Q][1].end;break}Y=!0}for(x(r),w=K;w<t.events.length;)t.events[w][1].end={...te},w++;Ae(t.events,Q+1,0,t.events.slice(K)),t.events.length=w}}function x(T){let N=n.length;for(;N-- >T;){const J=n[N];t.containerState=J[1],J[0].exit.call(t,e)}n.length=T}function z(){s.write([null]),i=void 0,s=void 0,t.containerState._closeFlow=void 0}}function bs(e,t,n){return ae(e,e.attempt(this.parser.constructs.document,t,n),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function Pn(e,t,n){const r=[];let s=-1;for(;++s<e.length;){const i=e[s].resolveAll;i&&!r.includes(i)&&(t=i(t,n),r.push(i))}return t}const un={name:"attention",resolveAll:xs,tokenize:ws};function xs(e,t){let n=-1,r,s,i,a,l,u,o,c;for(;++n<e.length;)if(e[n][0]==="enter"&&e[n][1].type==="attentionSequence"&&e[n][1]._close){for(r=n;r--;)if(e[r][0]==="exit"&&e[r][1].type==="attentionSequence"&&e[r][1]._open&&t.sliceSerialize(e[r][1]).charCodeAt(0)===t.sliceSerialize(e[n][1]).charCodeAt(0)){if((e[r][1]._close||e[n][1]._open)&&(e[n][1].end.offset-e[n][1].start.offset)%3&&!((e[r][1].end.offset-e[r][1].start.offset+e[n][1].end.offset-e[n][1].start.offset)%3))continue;u=e[r][1].end.offset-e[r][1].start.offset>1&&e[n][1].end.offset-e[n][1].start.offset>1?2:1;const d={...e[r][1].end},h={...e[n][1].start};qn(d,-u),qn(h,u),a={type:u>1?"strongSequence":"emphasisSequence",start:d,end:{...e[r][1].end}},l={type:u>1?"strongSequence":"emphasisSequence",start:{...e[n][1].start},end:h},i={type:u>1?"strongText":"emphasisText",start:{...e[r][1].end},end:{...e[n][1].start}},s={type:u>1?"strong":"emphasis",start:{...a.start},end:{...l.end}},e[r][1].end={...a.start},e[n][1].start={...l.end},o=[],e[r][1].end.offset-e[r][1].start.offset&&(o=Ce(o,[["enter",e[r][1],t],["exit",e[r][1],t]])),o=Ce(o,[["enter",s,t],["enter",a,t],["exit",a,t],["enter",i,t]]),o=Ce(o,Pn(t.parser.constructs.insideSpan.null,e.slice(r+1,n),t)),o=Ce(o,[["exit",i,t],["enter",l,t],["exit",l,t],["exit",s,t]]),e[n][1].end.offset-e[n][1].start.offset?(c=2,o=Ce(o,[["enter",e[n][1],t],["exit",e[n][1],t]])):c=0,Ae(e,r-1,n-r+3,o),n=r+o.length-c-2;break}}for(n=-1;++n<e.length;)e[n][1].type==="attentionSequence"&&(e[n][1].type="data");return e}function ws(e,t){const n=this.parser.constructs.attentionMarkers.null,r=this.previous,s=Vt(r);let i;return a;function a(u){return i=u,e.enter("attentionSequence"),l(u)}function l(u){if(u===i)return e.consume(u),l;const o=e.exit("attentionSequence"),c=Vt(u),d=!c||c===2&&s||n.includes(u),h=!s||s===2&&c||n.includes(r);return o._open=!!(i===42?d:d&&(s||!h)),o._close=!!(i===42?h:h&&(c||!d)),t(u)}}function qn(e,t){e.column+=t,e.offset+=t,e._bufferIndex+=t}const Cs={name:"autolink",tokenize:Ss};function Ss(e,t,n){let r=0;return s;function s(f){return e.enter("autolink"),e.enter("autolinkMarker"),e.consume(f),e.exit("autolinkMarker"),e.enter("autolinkProtocol"),i}function i(f){return De(f)?(e.consume(f),a):f===64?n(f):o(f)}function a(f){return f===43||f===45||f===46||Ie(f)?(r=1,l(f)):o(f)}function l(f){return f===58?(e.consume(f),r=0,u):(f===43||f===45||f===46||Ie(f))&&r++<32?(e.consume(f),l):(r=0,o(f))}function u(f){return f===62?(e.exit("autolinkProtocol"),e.enter("autolinkMarker"),e.consume(f),e.exit("autolinkMarker"),e.exit("autolink"),t):f===null||f===32||f===60||sn(f)?n(f):(e.consume(f),u)}function o(f){return f===64?(e.consume(f),c):sa(f)?(e.consume(f),o):n(f)}function c(f){return Ie(f)?d(f):n(f)}function d(f){return f===46?(e.consume(f),r=0,c):f===62?(e.exit("autolinkProtocol").type="autolinkEmail",e.enter("autolinkMarker"),e.consume(f),e.exit("autolinkMarker"),e.exit("autolink"),t):h(f)}function h(f){if((f===45||Ie(f))&&r++<63){const v=f===45?h:d;return e.consume(f),v}return n(f)}}const Wt={partial:!0,tokenize:Es};function Es(e,t,n){return r;function r(i){return Z(i)?ae(e,s,"linePrefix")(i):s(i)}function s(i){return i===null||U(i)?t(i):n(i)}}const Fr={continuation:{tokenize:$s},exit:Ps,name:"blockQuote",tokenize:Is};function Is(e,t,n){const r=this;return s;function s(a){if(a===62){const l=r.containerState;return l.open||(e.enter("blockQuote",{_container:!0}),l.open=!0),e.enter("blockQuotePrefix"),e.enter("blockQuoteMarker"),e.consume(a),e.exit("blockQuoteMarker"),i}return n(a)}function i(a){return Z(a)?(e.enter("blockQuotePrefixWhitespace"),e.consume(a),e.exit("blockQuotePrefixWhitespace"),e.exit("blockQuotePrefix"),t):(e.exit("blockQuotePrefix"),t(a))}}function $s(e,t,n){const r=this;return s;function s(a){return Z(a)?ae(e,i,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(a):i(a)}function i(a){return e.attempt(Fr,t,n)(a)}}function Ps(e){e.exit("blockQuote")}const Vr={name:"characterEscape",tokenize:_s};function _s(e,t,n){return r;function r(i){return e.enter("characterEscape"),e.enter("escapeMarker"),e.consume(i),e.exit("escapeMarker"),s}function s(i){return oa(i)?(e.enter("characterEscapeValue"),e.consume(i),e.exit("characterEscapeValue"),e.exit("characterEscape"),t):n(i)}}const Lr={name:"characterReference",tokenize:Ds};function Ds(e,t,n){const r=this;let s=0,i,a;return l;function l(d){return e.enter("characterReference"),e.enter("characterReferenceMarker"),e.consume(d),e.exit("characterReferenceMarker"),u}function u(d){return d===35?(e.enter("characterReferenceMarkerNumeric"),e.consume(d),e.exit("characterReferenceMarkerNumeric"),o):(e.enter("characterReferenceValue"),i=31,a=Ie,c(d))}function o(d){return d===88||d===120?(e.enter("characterReferenceMarkerHexadecimal"),e.consume(d),e.exit("characterReferenceMarkerHexadecimal"),e.enter("characterReferenceValue"),i=6,a=la,c):(e.enter("characterReferenceValue"),i=7,a=ln,c(d))}function c(d){if(d===59&&s){const h=e.exit("characterReferenceValue");return a===Ie&&!$n(r.sliceSerialize(h))?n(d):(e.enter("characterReferenceMarker"),e.consume(d),e.exit("characterReferenceMarker"),e.exit("characterReference"),t)}return a(d)&&s++<i?(e.consume(d),c):n(d)}}const Hn={partial:!0,tokenize:Ts},Kn={concrete:!0,name:"codeFenced",tokenize:Os};function Os(e,t,n){const r=this,s={partial:!0,tokenize:J};let i=0,a=0,l;return u;function u(w){return o(w)}function o(w){const K=r.events[r.events.length-1];return i=K&&K[1].type==="linePrefix"?K[2].sliceSerialize(K[1],!0).length:0,l=w,e.enter("codeFenced"),e.enter("codeFencedFence"),e.enter("codeFencedFenceSequence"),c(w)}function c(w){return w===l?(a++,e.consume(w),c):a<3?n(w):(e.exit("codeFencedFenceSequence"),Z(w)?ae(e,d,"whitespace")(w):d(w))}function d(w){return w===null||U(w)?(e.exit("codeFencedFence"),r.interrupt?t(w):e.check(Hn,C,N)(w)):(e.enter("codeFencedFenceInfo"),e.enter("chunkString",{contentType:"string"}),h(w))}function h(w){return w===null||U(w)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),d(w)):Z(w)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),ae(e,f,"whitespace")(w)):w===96&&w===l?n(w):(e.consume(w),h)}function f(w){return w===null||U(w)?d(w):(e.enter("codeFencedFenceMeta"),e.enter("chunkString",{contentType:"string"}),v(w))}function v(w){return w===null||U(w)?(e.exit("chunkString"),e.exit("codeFencedFenceMeta"),d(w)):w===96&&w===l?n(w):(e.consume(w),v)}function C(w){return e.attempt(s,N,A)(w)}function A(w){return e.enter("lineEnding"),e.consume(w),e.exit("lineEnding"),x}function x(w){return i>0&&Z(w)?ae(e,z,"linePrefix",i+1)(w):z(w)}function z(w){return w===null||U(w)?e.check(Hn,C,N)(w):(e.enter("codeFlowValue"),T(w))}function T(w){return w===null||U(w)?(e.exit("codeFlowValue"),z(w)):(e.consume(w),T)}function N(w){return e.exit("codeFenced"),t(w)}function J(w,K,Q){let Y=0;return te;function te(B){return w.enter("lineEnding"),w.consume(B),w.exit("lineEnding"),L}function L(B){return w.enter("codeFencedFence"),Z(B)?ae(w,S,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(B):S(B)}function S(B){return B===l?(w.enter("codeFencedFenceSequence"),P(B)):Q(B)}function P(B){return B===l?(Y++,w.consume(B),P):Y>=a?(w.exit("codeFencedFenceSequence"),Z(B)?ae(w,_,"whitespace")(B):_(B)):Q(B)}function _(B){return B===null||U(B)?(w.exit("codeFencedFence"),K(B)):Q(B)}}}function Ts(e,t,n){const r=this;return s;function s(a){return a===null?n(a):(e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),i)}function i(a){return r.parser.lazy[r.now().line]?n(a):t(a)}}const Qt={name:"codeIndented",tokenize:Fs},As={partial:!0,tokenize:Vs};function Fs(e,t,n){const r=this;return s;function s(o){return e.enter("codeIndented"),ae(e,i,"linePrefix",5)(o)}function i(o){const c=r.events[r.events.length-1];return c&&c[1].type==="linePrefix"&&c[2].sliceSerialize(c[1],!0).length>=4?a(o):n(o)}function a(o){return o===null?u(o):U(o)?e.attempt(As,a,u)(o):(e.enter("codeFlowValue"),l(o))}function l(o){return o===null||U(o)?(e.exit("codeFlowValue"),a(o)):(e.consume(o),l)}function u(o){return e.exit("codeIndented"),t(o)}}function Vs(e,t,n){const r=this;return s;function s(a){return r.parser.lazy[r.now().line]?n(a):U(a)?(e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),s):ae(e,i,"linePrefix",5)(a)}function i(a){const l=r.events[r.events.length-1];return l&&l[1].type==="linePrefix"&&l[2].sliceSerialize(l[1],!0).length>=4?t(a):U(a)?s(a):n(a)}}const Ls={name:"codeText",previous:Bs,resolve:zs,tokenize:Ns};function zs(e){let t=e.length-4,n=3,r,s;if((e[n][1].type==="lineEnding"||e[n][1].type==="space")&&(e[t][1].type==="lineEnding"||e[t][1].type==="space")){for(r=n;++r<t;)if(e[r][1].type==="codeTextData"){e[n][1].type="codeTextPadding",e[t][1].type="codeTextPadding",n+=2,t-=2;break}}for(r=n-1,t++;++r<=t;)s===void 0?r!==t&&e[r][1].type!=="lineEnding"&&(s=r):(r===t||e[r][1].type==="lineEnding")&&(e[s][1].type="codeTextData",r!==s+2&&(e[s][1].end=e[r-1][1].end,e.splice(s+2,r-s-2),t-=r-s-2,r=s+2),s=void 0);return e}function Bs(e){return e!==96||this.events[this.events.length-1][1].type==="characterEscape"}function Ns(e,t,n){let r=0,s,i;return a;function a(d){return e.enter("codeText"),e.enter("codeTextSequence"),l(d)}function l(d){return d===96?(e.consume(d),r++,l):(e.exit("codeTextSequence"),u(d))}function u(d){return d===null?n(d):d===32?(e.enter("space"),e.consume(d),e.exit("space"),u):d===96?(i=e.enter("codeTextSequence"),s=0,c(d)):U(d)?(e.enter("lineEnding"),e.consume(d),e.exit("lineEnding"),u):(e.enter("codeTextData"),o(d))}function o(d){return d===null||d===32||d===96||U(d)?(e.exit("codeTextData"),u(d)):(e.consume(d),o)}function c(d){return d===96?(e.consume(d),s++,c):s===r?(e.exit("codeTextSequence"),e.exit("codeText"),t(d)):(i.type="codeTextData",o(d))}}class js{constructor(t){this.left=t?[...t]:[],this.right=[]}get(t){if(t<0||t>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+t+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return t<this.left.length?this.left[t]:this.right[this.right.length-t+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(t,n){const r=n??Number.POSITIVE_INFINITY;return r<this.left.length?this.left.slice(t,r):t>this.left.length?this.right.slice(this.right.length-r+this.left.length,this.right.length-t+this.left.length).reverse():this.left.slice(t).concat(this.right.slice(this.right.length-r+this.left.length).reverse())}splice(t,n,r){const s=n||0;this.setCursor(Math.trunc(t));const i=this.right.splice(this.right.length-s,Number.POSITIVE_INFINITY);return r&&yt(this.left,r),i.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(t){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(t)}pushMany(t){this.setCursor(Number.POSITIVE_INFINITY),yt(this.left,t)}unshift(t){this.setCursor(0),this.right.push(t)}unshiftMany(t){this.setCursor(0),yt(this.right,t.reverse())}setCursor(t){if(!(t===this.left.length||t>this.left.length&&this.right.length===0||t<0&&this.left.length===0))if(t<this.left.length){const n=this.left.splice(t,Number.POSITIVE_INFINITY);yt(this.right,n.reverse())}else{const n=this.right.splice(this.left.length+this.right.length-t,Number.POSITIVE_INFINITY);yt(this.left,n.reverse())}}}function yt(e,t){let n=0;if(t.length<1e4)e.push(...t);else for(;n<t.length;)e.push(...t.slice(n,n+1e4)),n+=1e4}function zr(e){const t={};let n=-1,r,s,i,a,l,u,o;const c=new js(e);for(;++n<c.length;){for(;n in t;)n=t[n];if(r=c.get(n),n&&r[1].type==="chunkFlow"&&c.get(n-1)[1].type==="listItemPrefix"&&(u=r[1]._tokenizer.events,i=0,i<u.length&&u[i][1].type==="lineEndingBlank"&&(i+=2),i<u.length&&u[i][1].type==="content"))for(;++i<u.length&&u[i][1].type!=="content";)u[i][1].type==="chunkText"&&(u[i][1]._isInFirstContentOfListItem=!0,i++);if(r[0]==="enter")r[1].contentType&&(Object.assign(t,Us(c,n)),n=t[n],o=!0);else if(r[1]._container){for(i=n,s=void 0;i--;)if(a=c.get(i),a[1].type==="lineEnding"||a[1].type==="lineEndingBlank")a[0]==="enter"&&(s&&(c.get(s)[1].type="lineEndingBlank"),a[1].type="lineEnding",s=i);else if(!(a[1].type==="linePrefix"||a[1].type==="listItemIndent"))break;s&&(r[1].end={...c.get(s)[1].start},l=c.slice(s,n),l.unshift(r),c.splice(s,n-s+1,l))}}return Ae(e,0,Number.POSITIVE_INFINITY,c.slice(0)),!o}function Us(e,t){const n=e.get(t)[1],r=e.get(t)[2];let s=t-1;const i=[];let a=n._tokenizer;a||(a=r.parser[n.contentType](n.start),n._contentTypeTextTrailing&&(a._contentTypeTextTrailing=!0));const l=a.events,u=[],o={};let c,d,h=-1,f=n,v=0,C=0;const A=[C];for(;f;){for(;e.get(++s)[1]!==f;);i.push(s),f._tokenizer||(c=r.sliceStream(f),f.next||c.push(null),d&&a.defineSkip(f.start),f._isInFirstContentOfListItem&&(a._gfmTasklistFirstContentOfListItem=!0),a.write(c),f._isInFirstContentOfListItem&&(a._gfmTasklistFirstContentOfListItem=void 0)),d=f,f=f.next}for(f=n;++h<l.length;)l[h][0]==="exit"&&l[h-1][0]==="enter"&&l[h][1].type===l[h-1][1].type&&l[h][1].start.line!==l[h][1].end.line&&(C=h+1,A.push(C),f._tokenizer=void 0,f.previous=void 0,f=f.next);for(a.events=[],f?(f._tokenizer=void 0,f.previous=void 0):A.pop(),h=A.length;h--;){const x=l.slice(A[h],A[h+1]),z=i.pop();u.push([z,z+x.length-1]),e.splice(z,2,x)}for(u.reverse(),h=-1;++h<u.length;)o[v+u[h][0]]=v+u[h][1],v+=u[h][1]-u[h][0]-1;return o}const Ms={resolve:qs,tokenize:Hs},Rs={partial:!0,tokenize:Ks};function qs(e){return zr(e),e}function Hs(e,t){let n;return r;function r(l){return e.enter("content"),n=e.enter("chunkContent",{contentType:"content"}),s(l)}function s(l){return l===null?i(l):U(l)?e.check(Rs,a,i)(l):(e.consume(l),s)}function i(l){return e.exit("chunkContent"),e.exit("content"),t(l)}function a(l){return e.consume(l),e.exit("chunkContent"),n.next=e.enter("chunkContent",{contentType:"content",previous:n}),n=n.next,s}}function Ks(e,t,n){const r=this;return s;function s(a){return e.exit("chunkContent"),e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),ae(e,i,"linePrefix")}function i(a){if(a===null||U(a))return n(a);const l=r.events[r.events.length-1];return!r.parser.constructs.disable.null.includes("codeIndented")&&l&&l[1].type==="linePrefix"&&l[2].sliceSerialize(l[1],!0).length>=4?t(a):e.interrupt(r.parser.constructs.flow,n,t)(a)}}function Br(e,t,n,r,s,i,a,l,u){const o=u||Number.POSITIVE_INFINITY;let c=0;return d;function d(x){return x===60?(e.enter(r),e.enter(s),e.enter(i),e.consume(x),e.exit(i),h):x===null||x===32||x===41||sn(x)?n(x):(e.enter(r),e.enter(a),e.enter(l),e.enter("chunkString",{contentType:"string"}),C(x))}function h(x){return x===62?(e.enter(i),e.consume(x),e.exit(i),e.exit(s),e.exit(r),t):(e.enter(l),e.enter("chunkString",{contentType:"string"}),f(x))}function f(x){return x===62?(e.exit("chunkString"),e.exit(l),h(x)):x===null||x===60||U(x)?n(x):(e.consume(x),x===92?v:f)}function v(x){return x===60||x===62||x===92?(e.consume(x),f):f(x)}function C(x){return!c&&(x===null||x===41||ge(x))?(e.exit("chunkString"),e.exit(l),e.exit(a),e.exit(r),t(x)):c<o&&x===40?(e.consume(x),c++,C):x===41?(e.consume(x),c--,C):x===null||x===32||x===40||sn(x)?n(x):(e.consume(x),x===92?A:C)}function A(x){return x===40||x===41||x===92?(e.consume(x),C):C(x)}}function Nr(e,t,n,r,s,i){const a=this;let l=0,u;return o;function o(f){return e.enter(r),e.enter(s),e.consume(f),e.exit(s),e.enter(i),c}function c(f){return l>999||f===null||f===91||f===93&&!u||f===94&&!l&&"_hiddenFootnoteSupport"in a.parser.constructs?n(f):f===93?(e.exit(i),e.enter(s),e.consume(f),e.exit(s),e.exit(r),t):U(f)?(e.enter("lineEnding"),e.consume(f),e.exit("lineEnding"),c):(e.enter("chunkString",{contentType:"string"}),d(f))}function d(f){return f===null||f===91||f===93||U(f)||l++>999?(e.exit("chunkString"),c(f)):(e.consume(f),u||(u=!Z(f)),f===92?h:d)}function h(f){return f===91||f===92||f===93?(e.consume(f),l++,d):d(f)}}function jr(e,t,n,r,s,i){let a;return l;function l(h){return h===34||h===39||h===40?(e.enter(r),e.enter(s),e.consume(h),e.exit(s),a=h===40?41:h,u):n(h)}function u(h){return h===a?(e.enter(s),e.consume(h),e.exit(s),e.exit(r),t):(e.enter(i),o(h))}function o(h){return h===a?(e.exit(i),u(a)):h===null?n(h):U(h)?(e.enter("lineEnding"),e.consume(h),e.exit("lineEnding"),ae(e,o,"linePrefix")):(e.enter("chunkString",{contentType:"string"}),c(h))}function c(h){return h===a||h===null||U(h)?(e.exit("chunkString"),o(h)):(e.consume(h),h===92?d:c)}function d(h){return h===a||h===92?(e.consume(h),c):c(h)}}function Ct(e,t){let n;return r;function r(s){return U(s)?(e.enter("lineEnding"),e.consume(s),e.exit("lineEnding"),n=!0,r):Z(s)?ae(e,r,n?"linePrefix":"lineSuffix")(s):t(s)}}const Ws={name:"definition",tokenize:Qs},Js={partial:!0,tokenize:Ys};function Qs(e,t,n){const r=this;let s;return i;function i(f){return e.enter("definition"),a(f)}function a(f){return Nr.call(r,e,l,n,"definitionLabel","definitionLabelMarker","definitionLabelString")(f)}function l(f){return s=ut(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)),f===58?(e.enter("definitionMarker"),e.consume(f),e.exit("definitionMarker"),u):n(f)}function u(f){return ge(f)?Ct(e,o)(f):o(f)}function o(f){return Br(e,c,n,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(f)}function c(f){return e.attempt(Js,d,d)(f)}function d(f){return Z(f)?ae(e,h,"whitespace")(f):h(f)}function h(f){return f===null||U(f)?(e.exit("definition"),r.parser.defined.push(s),t(f)):n(f)}}function Ys(e,t,n){return r;function r(l){return ge(l)?Ct(e,s)(l):n(l)}function s(l){return jr(e,i,n,"definitionTitle","definitionTitleMarker","definitionTitleString")(l)}function i(l){return Z(l)?ae(e,a,"whitespace")(l):a(l)}function a(l){return l===null||U(l)?t(l):n(l)}}const Xs={name:"hardBreakEscape",tokenize:Gs};function Gs(e,t,n){return r;function r(i){return e.enter("hardBreakEscape"),e.consume(i),s}function s(i){return U(i)?(e.exit("hardBreakEscape"),t(i)):n(i)}}const Zs={name:"headingAtx",resolve:el,tokenize:tl};function el(e,t){let n=e.length-2,r=3,s,i;return e[r][1].type==="whitespace"&&(r+=2),n-2>r&&e[n][1].type==="whitespace"&&(n-=2),e[n][1].type==="atxHeadingSequence"&&(r===n-1||n-4>r&&e[n-2][1].type==="whitespace")&&(n-=r+1===n?2:4),n>r&&(s={type:"atxHeadingText",start:e[r][1].start,end:e[n][1].end},i={type:"chunkText",start:e[r][1].start,end:e[n][1].end,contentType:"text"},Ae(e,r,n-r+1,[["enter",s,t],["enter",i,t],["exit",i,t],["exit",s,t]])),e}function tl(e,t,n){let r=0;return s;function s(c){return e.enter("atxHeading"),i(c)}function i(c){return e.enter("atxHeadingSequence"),a(c)}function a(c){return c===35&&r++<6?(e.consume(c),a):c===null||ge(c)?(e.exit("atxHeadingSequence"),l(c)):n(c)}function l(c){return c===35?(e.enter("atxHeadingSequence"),u(c)):c===null||U(c)?(e.exit("atxHeading"),t(c)):Z(c)?ae(e,l,"whitespace")(c):(e.enter("atxHeadingText"),o(c))}function u(c){return c===35?(e.consume(c),u):(e.exit("atxHeadingSequence"),l(c))}function o(c){return c===null||c===35||ge(c)?(e.exit("atxHeadingText"),l(c)):(e.consume(c),o)}}const nl=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],Wn=["pre","script","style","textarea"],rl={concrete:!0,name:"htmlFlow",resolveTo:sl,tokenize:ll},il={partial:!0,tokenize:ul},al={partial:!0,tokenize:ol};function sl(e){let t=e.length;for(;t--&&!(e[t][0]==="enter"&&e[t][1].type==="htmlFlow"););return t>1&&e[t-2][1].type==="linePrefix"&&(e[t][1].start=e[t-2][1].start,e[t+1][1].start=e[t-2][1].start,e.splice(t-2,2)),e}function ll(e,t,n){const r=this;let s,i,a,l,u;return o;function o(p){return c(p)}function c(p){return e.enter("htmlFlow"),e.enter("htmlFlowData"),e.consume(p),d}function d(p){return p===33?(e.consume(p),h):p===47?(e.consume(p),i=!0,C):p===63?(e.consume(p),s=3,r.interrupt?t:g):De(p)?(e.consume(p),a=String.fromCharCode(p),A):n(p)}function h(p){return p===45?(e.consume(p),s=2,f):p===91?(e.consume(p),s=5,l=0,v):De(p)?(e.consume(p),s=4,r.interrupt?t:g):n(p)}function f(p){return p===45?(e.consume(p),r.interrupt?t:g):n(p)}function v(p){const re="CDATA[";return p===re.charCodeAt(l++)?(e.consume(p),l===re.length?r.interrupt?t:S:v):n(p)}function C(p){return De(p)?(e.consume(p),a=String.fromCharCode(p),A):n(p)}function A(p){if(p===null||p===47||p===62||ge(p)){const re=p===47,de=a.toLowerCase();return!re&&!i&&Wn.includes(de)?(s=1,r.interrupt?t(p):S(p)):nl.includes(a.toLowerCase())?(s=6,re?(e.consume(p),x):r.interrupt?t(p):S(p)):(s=7,r.interrupt&&!r.parser.lazy[r.now().line]?n(p):i?z(p):T(p))}return p===45||Ie(p)?(e.consume(p),a+=String.fromCharCode(p),A):n(p)}function x(p){return p===62?(e.consume(p),r.interrupt?t:S):n(p)}function z(p){return Z(p)?(e.consume(p),z):te(p)}function T(p){return p===47?(e.consume(p),te):p===58||p===95||De(p)?(e.consume(p),N):Z(p)?(e.consume(p),T):te(p)}function N(p){return p===45||p===46||p===58||p===95||Ie(p)?(e.consume(p),N):J(p)}function J(p){return p===61?(e.consume(p),w):Z(p)?(e.consume(p),J):T(p)}function w(p){return p===null||p===60||p===61||p===62||p===96?n(p):p===34||p===39?(e.consume(p),u=p,K):Z(p)?(e.consume(p),w):Q(p)}function K(p){return p===u?(e.consume(p),u=null,Y):p===null||U(p)?n(p):(e.consume(p),K)}function Q(p){return p===null||p===34||p===39||p===47||p===60||p===61||p===62||p===96||ge(p)?J(p):(e.consume(p),Q)}function Y(p){return p===47||p===62||Z(p)?T(p):n(p)}function te(p){return p===62?(e.consume(p),L):n(p)}function L(p){return p===null||U(p)?S(p):Z(p)?(e.consume(p),L):n(p)}function S(p){return p===45&&s===2?(e.consume(p),ne):p===60&&s===1?(e.consume(p),G):p===62&&s===4?(e.consume(p),fe):p===63&&s===3?(e.consume(p),g):p===93&&s===5?(e.consume(p),pe):U(p)&&(s===6||s===7)?(e.exit("htmlFlowData"),e.check(il,H,P)(p)):p===null||U(p)?(e.exit("htmlFlowData"),P(p)):(e.consume(p),S)}function P(p){return e.check(al,_,H)(p)}function _(p){return e.enter("lineEnding"),e.consume(p),e.exit("lineEnding"),B}function B(p){return p===null||U(p)?P(p):(e.enter("htmlFlowData"),S(p))}function ne(p){return p===45?(e.consume(p),g):S(p)}function G(p){return p===47?(e.consume(p),a="",ue):S(p)}function ue(p){if(p===62){const re=a.toLowerCase();return Wn.includes(re)?(e.consume(p),fe):S(p)}return De(p)&&a.length<8?(e.consume(p),a+=String.fromCharCode(p),ue):S(p)}function pe(p){return p===93?(e.consume(p),g):S(p)}function g(p){return p===62?(e.consume(p),fe):p===45&&s===2?(e.consume(p),g):S(p)}function fe(p){return p===null||U(p)?(e.exit("htmlFlowData"),H(p)):(e.consume(p),fe)}function H(p){return e.exit("htmlFlow"),t(p)}}function ol(e,t,n){const r=this;return s;function s(a){return U(a)?(e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),i):n(a)}function i(a){return r.parser.lazy[r.now().line]?n(a):t(a)}}function ul(e,t,n){return r;function r(s){return e.enter("lineEnding"),e.consume(s),e.exit("lineEnding"),e.attempt(Wt,t,n)}}const cl={name:"htmlText",tokenize:dl};function dl(e,t,n){const r=this;let s,i,a;return l;function l(g){return e.enter("htmlText"),e.enter("htmlTextData"),e.consume(g),u}function u(g){return g===33?(e.consume(g),o):g===47?(e.consume(g),J):g===63?(e.consume(g),T):De(g)?(e.consume(g),Q):n(g)}function o(g){return g===45?(e.consume(g),c):g===91?(e.consume(g),i=0,v):De(g)?(e.consume(g),z):n(g)}function c(g){return g===45?(e.consume(g),f):n(g)}function d(g){return g===null?n(g):g===45?(e.consume(g),h):U(g)?(a=d,G(g)):(e.consume(g),d)}function h(g){return g===45?(e.consume(g),f):d(g)}function f(g){return g===62?ne(g):g===45?h(g):d(g)}function v(g){const fe="CDATA[";return g===fe.charCodeAt(i++)?(e.consume(g),i===fe.length?C:v):n(g)}function C(g){return g===null?n(g):g===93?(e.consume(g),A):U(g)?(a=C,G(g)):(e.consume(g),C)}function A(g){return g===93?(e.consume(g),x):C(g)}function x(g){return g===62?ne(g):g===93?(e.consume(g),x):C(g)}function z(g){return g===null||g===62?ne(g):U(g)?(a=z,G(g)):(e.consume(g),z)}function T(g){return g===null?n(g):g===63?(e.consume(g),N):U(g)?(a=T,G(g)):(e.consume(g),T)}function N(g){return g===62?ne(g):T(g)}function J(g){return De(g)?(e.consume(g),w):n(g)}function w(g){return g===45||Ie(g)?(e.consume(g),w):K(g)}function K(g){return U(g)?(a=K,G(g)):Z(g)?(e.consume(g),K):ne(g)}function Q(g){return g===45||Ie(g)?(e.consume(g),Q):g===47||g===62||ge(g)?Y(g):n(g)}function Y(g){return g===47?(e.consume(g),ne):g===58||g===95||De(g)?(e.consume(g),te):U(g)?(a=Y,G(g)):Z(g)?(e.consume(g),Y):ne(g)}function te(g){return g===45||g===46||g===58||g===95||Ie(g)?(e.consume(g),te):L(g)}function L(g){return g===61?(e.consume(g),S):U(g)?(a=L,G(g)):Z(g)?(e.consume(g),L):Y(g)}function S(g){return g===null||g===60||g===61||g===62||g===96?n(g):g===34||g===39?(e.consume(g),s=g,P):U(g)?(a=S,G(g)):Z(g)?(e.consume(g),S):(e.consume(g),_)}function P(g){return g===s?(e.consume(g),s=void 0,B):g===null?n(g):U(g)?(a=P,G(g)):(e.consume(g),P)}function _(g){return g===null||g===34||g===39||g===60||g===61||g===96?n(g):g===47||g===62||ge(g)?Y(g):(e.consume(g),_)}function B(g){return g===47||g===62||ge(g)?Y(g):n(g)}function ne(g){return g===62?(e.consume(g),e.exit("htmlTextData"),e.exit("htmlText"),t):n(g)}function G(g){return e.exit("htmlTextData"),e.enter("lineEnding"),e.consume(g),e.exit("lineEnding"),ue}function ue(g){return Z(g)?ae(e,pe,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(g):pe(g)}function pe(g){return e.enter("htmlTextData"),a(g)}}const _n={name:"labelEnd",resolveAll:ml,resolveTo:gl,tokenize:yl},hl={tokenize:kl},fl={tokenize:vl},pl={tokenize:bl};function ml(e){let t=-1;const n=[];for(;++t<e.length;){const r=e[t][1];if(n.push(e[t]),r.type==="labelImage"||r.type==="labelLink"||r.type==="labelEnd"){const s=r.type==="labelImage"?4:2;r.type="data",t+=s}}return e.length!==n.length&&Ae(e,0,e.length,n),e}function gl(e,t){let n=e.length,r=0,s,i,a,l;for(;n--;)if(s=e[n][1],i){if(s.type==="link"||s.type==="labelLink"&&s._inactive)break;e[n][0]==="enter"&&s.type==="labelLink"&&(s._inactive=!0)}else if(a){if(e[n][0]==="enter"&&(s.type==="labelImage"||s.type==="labelLink")&&!s._balanced&&(i=n,s.type!=="labelLink")){r=2;break}}else s.type==="labelEnd"&&(a=n);const u={type:e[i][1].type==="labelLink"?"link":"image",start:{...e[i][1].start},end:{...e[e.length-1][1].end}},o={type:"label",start:{...e[i][1].start},end:{...e[a][1].end}},c={type:"labelText",start:{...e[i+r+2][1].end},end:{...e[a-2][1].start}};return l=[["enter",u,t],["enter",o,t]],l=Ce(l,e.slice(i+1,i+r+3)),l=Ce(l,[["enter",c,t]]),l=Ce(l,Pn(t.parser.constructs.insideSpan.null,e.slice(i+r+4,a-3),t)),l=Ce(l,[["exit",c,t],e[a-2],e[a-1],["exit",o,t]]),l=Ce(l,e.slice(a+1)),l=Ce(l,[["exit",u,t]]),Ae(e,i,e.length,l),e}function yl(e,t,n){const r=this;let s=r.events.length,i,a;for(;s--;)if((r.events[s][1].type==="labelImage"||r.events[s][1].type==="labelLink")&&!r.events[s][1]._balanced){i=r.events[s][1];break}return l;function l(h){return i?i._inactive?d(h):(a=r.parser.defined.includes(ut(r.sliceSerialize({start:i.end,end:r.now()}))),e.enter("labelEnd"),e.enter("labelMarker"),e.consume(h),e.exit("labelMarker"),e.exit("labelEnd"),u):n(h)}function u(h){return h===40?e.attempt(hl,c,a?c:d)(h):h===91?e.attempt(fl,c,a?o:d)(h):a?c(h):d(h)}function o(h){return e.attempt(pl,c,d)(h)}function c(h){return t(h)}function d(h){return i._balanced=!0,n(h)}}function kl(e,t,n){return r;function r(d){return e.enter("resource"),e.enter("resourceMarker"),e.consume(d),e.exit("resourceMarker"),s}function s(d){return ge(d)?Ct(e,i)(d):i(d)}function i(d){return d===41?c(d):Br(e,a,l,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(d)}function a(d){return ge(d)?Ct(e,u)(d):c(d)}function l(d){return n(d)}function u(d){return d===34||d===39||d===40?jr(e,o,n,"resourceTitle","resourceTitleMarker","resourceTitleString")(d):c(d)}function o(d){return ge(d)?Ct(e,c)(d):c(d)}function c(d){return d===41?(e.enter("resourceMarker"),e.consume(d),e.exit("resourceMarker"),e.exit("resource"),t):n(d)}}function vl(e,t,n){const r=this;return s;function s(l){return Nr.call(r,e,i,a,"reference","referenceMarker","referenceString")(l)}function i(l){return r.parser.defined.includes(ut(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)))?t(l):n(l)}function a(l){return n(l)}}function bl(e,t,n){return r;function r(i){return e.enter("reference"),e.enter("referenceMarker"),e.consume(i),e.exit("referenceMarker"),s}function s(i){return i===93?(e.enter("referenceMarker"),e.consume(i),e.exit("referenceMarker"),e.exit("reference"),t):n(i)}}const xl={name:"labelStartImage",resolveAll:_n.resolveAll,tokenize:wl};function wl(e,t,n){const r=this;return s;function s(l){return e.enter("labelImage"),e.enter("labelImageMarker"),e.consume(l),e.exit("labelImageMarker"),i}function i(l){return l===91?(e.enter("labelMarker"),e.consume(l),e.exit("labelMarker"),e.exit("labelImage"),a):n(l)}function a(l){return l===94&&"_hiddenFootnoteSupport"in r.parser.constructs?n(l):t(l)}}const Cl={name:"labelStartLink",resolveAll:_n.resolveAll,tokenize:Sl};function Sl(e,t,n){const r=this;return s;function s(a){return e.enter("labelLink"),e.enter("labelMarker"),e.consume(a),e.exit("labelMarker"),e.exit("labelLink"),i}function i(a){return a===94&&"_hiddenFootnoteSupport"in r.parser.constructs?n(a):t(a)}}const Yt={name:"lineEnding",tokenize:El};function El(e,t){return n;function n(r){return e.enter("lineEnding"),e.consume(r),e.exit("lineEnding"),ae(e,t,"linePrefix")}}const Ot={name:"thematicBreak",tokenize:Il};function Il(e,t,n){let r=0,s;return i;function i(o){return e.enter("thematicBreak"),a(o)}function a(o){return s=o,l(o)}function l(o){return o===s?(e.enter("thematicBreakSequence"),u(o)):r>=3&&(o===null||U(o))?(e.exit("thematicBreak"),t(o)):n(o)}function u(o){return o===s?(e.consume(o),r++,u):(e.exit("thematicBreakSequence"),Z(o)?ae(e,l,"whitespace")(o):l(o))}}const me={continuation:{tokenize:Dl},exit:Tl,name:"list",tokenize:_l},$l={partial:!0,tokenize:Al},Pl={partial:!0,tokenize:Ol};function _l(e,t,n){const r=this,s=r.events[r.events.length-1];let i=s&&s[1].type==="linePrefix"?s[2].sliceSerialize(s[1],!0).length:0,a=0;return l;function l(f){const v=r.containerState.type||(f===42||f===43||f===45?"listUnordered":"listOrdered");if(v==="listUnordered"?!r.containerState.marker||f===r.containerState.marker:ln(f)){if(r.containerState.type||(r.containerState.type=v,e.enter(v,{_container:!0})),v==="listUnordered")return e.enter("listItemPrefix"),f===42||f===45?e.check(Ot,n,o)(f):o(f);if(!r.interrupt||f===49)return e.enter("listItemPrefix"),e.enter("listItemValue"),u(f)}return n(f)}function u(f){return ln(f)&&++a<10?(e.consume(f),u):(!r.interrupt||a<2)&&(r.containerState.marker?f===r.containerState.marker:f===41||f===46)?(e.exit("listItemValue"),o(f)):n(f)}function o(f){return e.enter("listItemMarker"),e.consume(f),e.exit("listItemMarker"),r.containerState.marker=r.containerState.marker||f,e.check(Wt,r.interrupt?n:c,e.attempt($l,h,d))}function c(f){return r.containerState.initialBlankLine=!0,i++,h(f)}function d(f){return Z(f)?(e.enter("listItemPrefixWhitespace"),e.consume(f),e.exit("listItemPrefixWhitespace"),h):n(f)}function h(f){return r.containerState.size=i+r.sliceSerialize(e.exit("listItemPrefix"),!0).length,t(f)}}function Dl(e,t,n){const r=this;return r.containerState._closeFlow=void 0,e.check(Wt,s,i);function s(l){return r.containerState.furtherBlankLines=r.containerState.furtherBlankLines||r.containerState.initialBlankLine,ae(e,t,"listItemIndent",r.containerState.size+1)(l)}function i(l){return r.containerState.furtherBlankLines||!Z(l)?(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,a(l)):(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,e.attempt(Pl,t,a)(l))}function a(l){return r.containerState._closeFlow=!0,r.interrupt=void 0,ae(e,e.attempt(me,t,n),"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(l)}}function Ol(e,t,n){const r=this;return ae(e,s,"listItemIndent",r.containerState.size+1);function s(i){const a=r.events[r.events.length-1];return a&&a[1].type==="listItemIndent"&&a[2].sliceSerialize(a[1],!0).length===r.containerState.size?t(i):n(i)}}function Tl(e){e.exit(this.containerState.type)}function Al(e,t,n){const r=this;return ae(e,s,"listItemPrefixWhitespace",r.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function s(i){const a=r.events[r.events.length-1];return!Z(i)&&a&&a[1].type==="listItemPrefixWhitespace"?t(i):n(i)}}const Jn={name:"setextUnderline",resolveTo:Fl,tokenize:Vl};function Fl(e,t){let n=e.length,r,s,i;for(;n--;)if(e[n][0]==="enter"){if(e[n][1].type==="content"){r=n;break}e[n][1].type==="paragraph"&&(s=n)}else e[n][1].type==="content"&&e.splice(n,1),!i&&e[n][1].type==="definition"&&(i=n);const a={type:"setextHeading",start:{...e[r][1].start},end:{...e[e.length-1][1].end}};return e[s][1].type="setextHeadingText",i?(e.splice(s,0,["enter",a,t]),e.splice(i+1,0,["exit",e[r][1],t]),e[r][1].end={...e[i][1].end}):e[r][1]=a,e.push(["exit",a,t]),e}function Vl(e,t,n){const r=this;let s;return i;function i(o){let c=r.events.length,d;for(;c--;)if(r.events[c][1].type!=="lineEnding"&&r.events[c][1].type!=="linePrefix"&&r.events[c][1].type!=="content"){d=r.events[c][1].type==="paragraph";break}return!r.parser.lazy[r.now().line]&&(r.interrupt||d)?(e.enter("setextHeadingLine"),s=o,a(o)):n(o)}function a(o){return e.enter("setextHeadingLineSequence"),l(o)}function l(o){return o===s?(e.consume(o),l):(e.exit("setextHeadingLineSequence"),Z(o)?ae(e,u,"lineSuffix")(o):u(o))}function u(o){return o===null||U(o)?(e.exit("setextHeadingLine"),t(o)):n(o)}}const Ll={tokenize:zl};function zl(e){const t=this,n=e.attempt(Wt,r,e.attempt(this.parser.constructs.flowInitial,s,ae(e,e.attempt(this.parser.constructs.flow,s,e.attempt(Ms,s)),"linePrefix")));return n;function r(i){if(i===null){e.consume(i);return}return e.enter("lineEndingBlank"),e.consume(i),e.exit("lineEndingBlank"),t.currentConstruct=void 0,n}function s(i){if(i===null){e.consume(i);return}return e.enter("lineEnding"),e.consume(i),e.exit("lineEnding"),t.currentConstruct=void 0,n}}const Bl={resolveAll:Mr()},Nl=Ur("string"),jl=Ur("text");function Ur(e){return{resolveAll:Mr(e==="text"?Ul:void 0),tokenize:t};function t(n){const r=this,s=this.parser.constructs[e],i=n.attempt(s,a,l);return a;function a(c){return o(c)?i(c):l(c)}function l(c){if(c===null){n.consume(c);return}return n.enter("data"),n.consume(c),u}function u(c){return o(c)?(n.exit("data"),i(c)):(n.consume(c),u)}function o(c){if(c===null)return!0;const d=s[c];let h=-1;if(d)for(;++h<d.length;){const f=d[h];if(!f.previous||f.previous.call(r,r.previous))return!0}return!1}}}function Mr(e){return t;function t(n,r){let s=-1,i;for(;++s<=n.length;)i===void 0?n[s]&&n[s][1].type==="data"&&(i=s,s++):(!n[s]||n[s][1].type!=="data")&&(s!==i+2&&(n[i][1].end=n[s-1][1].end,n.splice(i+2,s-i-2),s=i+2),i=void 0);return e?e(n,r):n}}function Ul(e,t){let n=0;for(;++n<=e.length;)if((n===e.length||e[n][1].type==="lineEnding")&&e[n-1][1].type==="data"){const r=e[n-1][1],s=t.sliceStream(r);let i=s.length,a=-1,l=0,u;for(;i--;){const o=s[i];if(typeof o=="string"){for(a=o.length;o.charCodeAt(a-1)===32;)l++,a--;if(a)break;a=-1}else if(o===-2)u=!0,l++;else if(o!==-1){i++;break}}if(t._contentTypeTextTrailing&&n===e.length&&(l=0),l){const o={type:n===e.length||u||l<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:i?a:r.start._bufferIndex+a,_index:r.start._index+i,line:r.end.line,column:r.end.column-l,offset:r.end.offset-l},end:{...r.end}};r.end={...o.start},r.start.offset===r.end.offset?Object.assign(r,o):(e.splice(n,0,["enter",o,t],["exit",o,t]),n+=2)}n++}return e}const Ml={42:me,43:me,45:me,48:me,49:me,50:me,51:me,52:me,53:me,54:me,55:me,56:me,57:me,62:Fr},Rl={91:Ws},ql={[-2]:Qt,[-1]:Qt,32:Qt},Hl={35:Zs,42:Ot,45:[Jn,Ot],60:rl,61:Jn,95:Ot,96:Kn,126:Kn},Kl={38:Lr,92:Vr},Wl={[-5]:Yt,[-4]:Yt,[-3]:Yt,33:xl,38:Lr,42:un,60:[Cs,cl],91:Cl,92:[Xs,Vr],93:_n,95:un,96:Ls},Jl={null:[un,Bl]},Ql={null:[42,95]},Yl={null:[]},Xl=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:Ql,contentInitial:Rl,disable:Yl,document:Ml,flow:Hl,flowInitial:ql,insideSpan:Jl,string:Kl,text:Wl},Symbol.toStringTag,{value:"Module"}));function Gl(e,t,n){let r={_bufferIndex:-1,_index:0,line:n&&n.line||1,column:n&&n.column||1,offset:n&&n.offset||0};const s={},i=[];let a=[],l=[];const u={attempt:K(J),check:K(w),consume:z,enter:T,exit:N,interrupt:K(w,{interrupt:!0})},o={code:null,containerState:{},defineSkip:C,events:[],now:v,parser:e,previous:null,sliceSerialize:h,sliceStream:f,write:d};let c=t.tokenize.call(o,u);return t.resolveAll&&i.push(t),o;function d(L){return a=Ce(a,L),A(),a[a.length-1]!==null?[]:(Q(t,0),o.events=Pn(i,o.events,o),o.events)}function h(L,S){return eo(f(L),S)}function f(L){return Zl(a,L)}function v(){const{_bufferIndex:L,_index:S,line:P,column:_,offset:B}=r;return{_bufferIndex:L,_index:S,line:P,column:_,offset:B}}function C(L){s[L.line]=L.column,te()}function A(){let L;for(;r._index<a.length;){const S=a[r._index];if(typeof S=="string")for(L=r._index,r._bufferIndex<0&&(r._bufferIndex=0);r._index===L&&r._bufferIndex<S.length;)x(S.charCodeAt(r._bufferIndex));else x(S)}}function x(L){c=c(L)}function z(L){U(L)?(r.line++,r.column=1,r.offset+=L===-3?2:1,te()):L!==-1&&(r.column++,r.offset++),r._bufferIndex<0?r._index++:(r._bufferIndex++,r._bufferIndex===a[r._index].length&&(r._bufferIndex=-1,r._index++)),o.previous=L}function T(L,S){const P=S||{};return P.type=L,P.start=v(),o.events.push(["enter",P,o]),l.push(P),P}function N(L){const S=l.pop();return S.end=v(),o.events.push(["exit",S,o]),S}function J(L,S){Q(L,S.from)}function w(L,S){S.restore()}function K(L,S){return P;function P(_,B,ne){let G,ue,pe,g;return Array.isArray(_)?H(_):"tokenize"in _?H([_]):fe(_);function fe(se){return Pe;function Pe(Be){const at=Be!==null&&se[Be],st=Be!==null&&se.null,$t=[...Array.isArray(at)?at:at?[at]:[],...Array.isArray(st)?st:st?[st]:[]];return H($t)(Be)}}function H(se){return G=se,ue=0,se.length===0?ne:p(se[ue])}function p(se){return Pe;function Pe(Be){return g=Y(),pe=se,se.partial||(o.currentConstruct=se),se.name&&o.parser.constructs.disable.null.includes(se.name)?de():se.tokenize.call(S?Object.assign(Object.create(o),S):o,u,re,de)(Be)}}function re(se){return L(pe,g),B}function de(se){return g.restore(),++ue<G.length?p(G[ue]):ne}}}function Q(L,S){L.resolveAll&&!i.includes(L)&&i.push(L),L.resolve&&Ae(o.events,S,o.events.length-S,L.resolve(o.events.slice(S),o)),L.resolveTo&&(o.events=L.resolveTo(o.events,o))}function Y(){const L=v(),S=o.previous,P=o.currentConstruct,_=o.events.length,B=Array.from(l);return{from:_,restore:ne};function ne(){r=L,o.previous=S,o.currentConstruct=P,o.events.length=_,l=B,te()}}function te(){r.line in s&&r.column<2&&(r.column=s[r.line],r.offset+=s[r.line]-1)}}function Zl(e,t){const n=t.start._index,r=t.start._bufferIndex,s=t.end._index,i=t.end._bufferIndex;let a;if(n===s)a=[e[n].slice(r,i)];else{if(a=e.slice(n,s),r>-1){const l=a[0];typeof l=="string"?a[0]=l.slice(r):a.shift()}i>0&&a.push(e[s].slice(0,i))}return a}function eo(e,t){let n=-1;const r=[];let s;for(;++n<e.length;){const i=e[n];let a;if(typeof i=="string")a=i;else switch(i){case-5:{a="\r";break}case-4:{a=`
`;break}case-3:{a=`\r
`;break}case-2:{a=t?" ":"	";break}case-1:{if(!t&&s)continue;a=" ";break}default:a=String.fromCharCode(i)}s=i===-2,r.push(a)}return r.join("")}function to(e){const r={constructs:fs([Xl,...(e||{}).extensions||[]]),content:s(gs),defined:[],document:s(ks),flow:s(Ll),lazy:{},string:s(Nl),text:s(jl)};return r;function s(i){return a;function a(l){return Gl(r,i,l)}}}function no(e){for(;!zr(e););return e}const Qn=/[\0\t\n\r]/g;function ro(){let e=1,t="",n=!0,r;return s;function s(i,a,l){const u=[];let o,c,d,h,f;for(i=t+(typeof i=="string"?i.toString():new TextDecoder(a||void 0).decode(i)),d=0,t="",n&&(i.charCodeAt(0)===65279&&d++,n=void 0);d<i.length;){if(Qn.lastIndex=d,o=Qn.exec(i),h=o&&o.index!==void 0?o.index:i.length,f=i.charCodeAt(h),!o){t=i.slice(d);break}if(f===10&&d===h&&r)u.push(-3),r=void 0;else switch(r&&(u.push(-5),r=void 0),d<h&&(u.push(i.slice(d,h)),e+=h-d),f){case 0:{u.push(65533),e++;break}case 9:{for(c=Math.ceil(e/4)*4,u.push(-2);e++<c;)u.push(-1);break}case 10:{u.push(-4),e=1;break}default:r=!0,e=1}d=h+1}return l&&(r&&u.push(-5),t&&u.push(t),u.push(null)),u}}function Tt(e){return!e||typeof e!="object"?"":"position"in e||"type"in e?Yn(e.position):"start"in e||"end"in e?Yn(e):"line"in e||"column"in e?cn(e):""}function cn(e){return Xn(e&&e.line)+":"+Xn(e&&e.column)}function Yn(e){return cn(e&&e.start)+"-"+cn(e&&e.end)}function Xn(e){return e&&typeof e=="number"?e:1}const Rr={}.hasOwnProperty;function io(e,t,n){return typeof t!="string"&&(n=t,t=void 0),ao(n)(no(to(n).document().write(ro()(e,t,!0))))}function ao(e){const t={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:i(An),autolinkProtocol:Y,autolinkEmail:Y,atxHeading:i(Dn),blockQuote:i(st),characterEscape:Y,characterReference:Y,codeFenced:i($t),codeFencedFenceInfo:a,codeFencedFenceMeta:a,codeIndented:i($t,a),codeText:i(Xr,a),codeTextData:Y,data:Y,codeFlowValue:Y,definition:i(Gr),definitionDestinationString:a,definitionLabelString:a,definitionTitleString:a,emphasis:i(Zr),hardBreakEscape:i(On),hardBreakTrailing:i(On),htmlFlow:i(Tn,a),htmlFlowData:Y,htmlText:i(Tn,a),htmlTextData:Y,image:i(ei),label:a,link:i(An),listItem:i(ti),listItemValue:h,listOrdered:i(Fn,d),listUnordered:i(Fn),paragraph:i(ni),reference:p,referenceString:a,resourceDestinationString:a,resourceTitleString:a,setextHeading:i(Dn),strong:i(ri),thematicBreak:i(ai)},exit:{atxHeading:u(),atxHeadingSequence:J,autolink:u(),autolinkEmail:at,autolinkProtocol:Be,blockQuote:u(),characterEscapeValue:te,characterReferenceMarkerHexadecimal:de,characterReferenceMarkerNumeric:de,characterReferenceValue:se,characterReference:Pe,codeFenced:u(A),codeFencedFence:C,codeFencedFenceInfo:f,codeFencedFenceMeta:v,codeFlowValue:te,codeIndented:u(x),codeText:u(B),codeTextData:te,data:te,definition:u(),definitionDestinationString:N,definitionLabelString:z,definitionTitleString:T,emphasis:u(),hardBreakEscape:u(S),hardBreakTrailing:u(S),htmlFlow:u(P),htmlFlowData:te,htmlText:u(_),htmlTextData:te,image:u(G),label:pe,labelText:ue,lineEnding:L,link:u(ne),listItem:u(),listOrdered:u(),listUnordered:u(),paragraph:u(),referenceString:re,resourceDestinationString:g,resourceTitleString:fe,resource:H,setextHeading:u(Q),setextHeadingLineSequence:K,setextHeadingText:w,strong:u(),thematicBreak:u()}};qr(t,(e||{}).mdastExtensions||[]);const n={};return r;function r(b){let $={type:"root",children:[]};const q={stack:[$],tokenStack:[],config:t,enter:l,exit:o,buffer:a,resume:c,data:n},W=[];let ie=-1;for(;++ie<b.length;)if(b[ie][1].type==="listOrdered"||b[ie][1].type==="listUnordered")if(b[ie][0]==="enter")W.push(ie);else{const Se=W.pop();ie=s(b,Se,ie)}for(ie=-1;++ie<b.length;){const Se=t[b[ie][0]];Rr.call(Se,b[ie][1].type)&&Se[b[ie][1].type].call(Object.assign({sliceSerialize:b[ie][2].sliceSerialize},q),b[ie][1])}if(q.tokenStack.length>0){const Se=q.tokenStack[q.tokenStack.length-1];(Se[1]||Gn).call(q,void 0,Se[0])}for($.position={start:Ne(b.length>0?b[0][1].start:{line:1,column:1,offset:0}),end:Ne(b.length>0?b[b.length-2][1].end:{line:1,column:1,offset:0})},ie=-1;++ie<t.transforms.length;)$=t.transforms[ie]($)||$;return $}function s(b,$,q){let W=$-1,ie=-1,Se=!1,Ke,Fe,ft,pt;for(;++W<=q;){const ye=b[W];switch(ye[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{ye[0]==="enter"?ie++:ie--,pt=void 0;break}case"lineEndingBlank":{ye[0]==="enter"&&(Ke&&!pt&&!ie&&!ft&&(ft=W),pt=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:pt=void 0}if(!ie&&ye[0]==="enter"&&ye[1].type==="listItemPrefix"||ie===-1&&ye[0]==="exit"&&(ye[1].type==="listUnordered"||ye[1].type==="listOrdered")){if(Ke){let lt=W;for(Fe=void 0;lt--;){const Ve=b[lt];if(Ve[1].type==="lineEnding"||Ve[1].type==="lineEndingBlank"){if(Ve[0]==="exit")continue;Fe&&(b[Fe][1].type="lineEndingBlank",Se=!0),Ve[1].type="lineEnding",Fe=lt}else if(!(Ve[1].type==="linePrefix"||Ve[1].type==="blockQuotePrefix"||Ve[1].type==="blockQuotePrefixWhitespace"||Ve[1].type==="blockQuoteMarker"||Ve[1].type==="listItemIndent"))break}ft&&(!Fe||ft<Fe)&&(Ke._spread=!0),Ke.end=Object.assign({},Fe?b[Fe][1].start:ye[1].end),b.splice(Fe||W,0,["exit",Ke,ye[2]]),W++,q++}if(ye[1].type==="listItemPrefix"){const lt={type:"listItem",_spread:!1,start:Object.assign({},ye[1].start),end:void 0};Ke=lt,b.splice(W,0,["enter",lt,ye[2]]),W++,q++,ft=void 0,pt=!0}}}return b[$][1]._spread=Se,q}function i(b,$){return q;function q(W){l.call(this,b(W),W),$&&$.call(this,W)}}function a(){this.stack.push({type:"fragment",children:[]})}function l(b,$,q){this.stack[this.stack.length-1].children.push(b),this.stack.push(b),this.tokenStack.push([$,q||void 0]),b.position={start:Ne($.start),end:void 0}}function u(b){return $;function $(q){b&&b.call(this,q),o.call(this,q)}}function o(b,$){const q=this.stack.pop(),W=this.tokenStack.pop();if(W)W[0].type!==b.type&&($?$.call(this,b,W[0]):(W[1]||Gn).call(this,b,W[0]));else throw new Error("Cannot close `"+b.type+"` ("+Tt({start:b.start,end:b.end})+"): it’s not open");q.position.end=Ne(b.end)}function c(){return En(this.stack.pop())}function d(){this.data.expectingFirstListItemValue=!0}function h(b){if(this.data.expectingFirstListItemValue){const $=this.stack[this.stack.length-2];$.start=Number.parseInt(this.sliceSerialize(b),10),this.data.expectingFirstListItemValue=void 0}}function f(){const b=this.resume(),$=this.stack[this.stack.length-1];$.lang=b}function v(){const b=this.resume(),$=this.stack[this.stack.length-1];$.meta=b}function C(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function A(){const b=this.resume(),$=this.stack[this.stack.length-1];$.value=b.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function x(){const b=this.resume(),$=this.stack[this.stack.length-1];$.value=b.replace(/(\r?\n|\r)$/g,"")}function z(b){const $=this.resume(),q=this.stack[this.stack.length-1];q.label=$,q.identifier=ut(this.sliceSerialize(b)).toLowerCase()}function T(){const b=this.resume(),$=this.stack[this.stack.length-1];$.title=b}function N(){const b=this.resume(),$=this.stack[this.stack.length-1];$.url=b}function J(b){const $=this.stack[this.stack.length-1];if(!$.depth){const q=this.sliceSerialize(b).length;$.depth=q}}function w(){this.data.setextHeadingSlurpLineEnding=!0}function K(b){const $=this.stack[this.stack.length-1];$.depth=this.sliceSerialize(b).codePointAt(0)===61?1:2}function Q(){this.data.setextHeadingSlurpLineEnding=void 0}function Y(b){const q=this.stack[this.stack.length-1].children;let W=q[q.length-1];(!W||W.type!=="text")&&(W=ii(),W.position={start:Ne(b.start),end:void 0},q.push(W)),this.stack.push(W)}function te(b){const $=this.stack.pop();$.value+=this.sliceSerialize(b),$.position.end=Ne(b.end)}function L(b){const $=this.stack[this.stack.length-1];if(this.data.atHardBreak){const q=$.children[$.children.length-1];q.position.end=Ne(b.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&t.canContainEols.includes($.type)&&(Y.call(this,b),te.call(this,b))}function S(){this.data.atHardBreak=!0}function P(){const b=this.resume(),$=this.stack[this.stack.length-1];$.value=b}function _(){const b=this.resume(),$=this.stack[this.stack.length-1];$.value=b}function B(){const b=this.resume(),$=this.stack[this.stack.length-1];$.value=b}function ne(){const b=this.stack[this.stack.length-1];if(this.data.inReference){const $=this.data.referenceType||"shortcut";b.type+="Reference",b.referenceType=$,delete b.url,delete b.title}else delete b.identifier,delete b.label;this.data.referenceType=void 0}function G(){const b=this.stack[this.stack.length-1];if(this.data.inReference){const $=this.data.referenceType||"shortcut";b.type+="Reference",b.referenceType=$,delete b.url,delete b.title}else delete b.identifier,delete b.label;this.data.referenceType=void 0}function ue(b){const $=this.sliceSerialize(b),q=this.stack[this.stack.length-2];q.label=Ar($),q.identifier=ut($).toLowerCase()}function pe(){const b=this.stack[this.stack.length-1],$=this.resume(),q=this.stack[this.stack.length-1];if(this.data.inReference=!0,q.type==="link"){const W=b.children;q.children=W}else q.alt=$}function g(){const b=this.resume(),$=this.stack[this.stack.length-1];$.url=b}function fe(){const b=this.resume(),$=this.stack[this.stack.length-1];$.title=b}function H(){this.data.inReference=void 0}function p(){this.data.referenceType="collapsed"}function re(b){const $=this.resume(),q=this.stack[this.stack.length-1];q.label=$,q.identifier=ut(this.sliceSerialize(b)).toLowerCase(),this.data.referenceType="full"}function de(b){this.data.characterReferenceType=b.type}function se(b){const $=this.sliceSerialize(b),q=this.data.characterReferenceType;let W;q?(W=Tr($,q==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):W=$n($);const ie=this.stack[this.stack.length-1];ie.value+=W}function Pe(b){const $=this.stack.pop();$.position.end=Ne(b.end)}function Be(b){te.call(this,b);const $=this.stack[this.stack.length-1];$.url=this.sliceSerialize(b)}function at(b){te.call(this,b);const $=this.stack[this.stack.length-1];$.url="mailto:"+this.sliceSerialize(b)}function st(){return{type:"blockquote",children:[]}}function $t(){return{type:"code",lang:null,meta:null,value:""}}function Xr(){return{type:"inlineCode",value:""}}function Gr(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function Zr(){return{type:"emphasis",children:[]}}function Dn(){return{type:"heading",depth:0,children:[]}}function On(){return{type:"break"}}function Tn(){return{type:"html",value:""}}function ei(){return{type:"image",title:null,url:"",alt:null}}function An(){return{type:"link",title:null,url:"",children:[]}}function Fn(b){return{type:"list",ordered:b.type==="listOrdered",start:null,spread:b._spread,children:[]}}function ti(b){return{type:"listItem",spread:b._spread,checked:null,children:[]}}function ni(){return{type:"paragraph",children:[]}}function ri(){return{type:"strong",children:[]}}function ii(){return{type:"text",value:""}}function ai(){return{type:"thematicBreak"}}}function Ne(e){return{line:e.line,column:e.column,offset:e.offset}}function qr(e,t){let n=-1;for(;++n<t.length;){const r=t[n];Array.isArray(r)?qr(e,r):so(e,r)}}function so(e,t){let n;for(n in t)if(Rr.call(t,n))switch(n){case"canContainEols":{const r=t[n];r&&e[n].push(...r);break}case"transforms":{const r=t[n];r&&e[n].push(...r);break}case"enter":case"exit":{const r=t[n];r&&Object.assign(e[n],r);break}}}function Gn(e,t){throw e?new Error("Cannot close `"+e.type+"` ("+Tt({start:e.start,end:e.end})+"): a different token (`"+t.type+"`, "+Tt({start:t.start,end:t.end})+") is open"):new Error("Cannot close document, a token (`"+t.type+"`, "+Tt({start:t.start,end:t.end})+") is still open")}const lo={components:{Fields:Ht,SchemaDialog:gr,VueDraggable:wi},props:{item:{type:Object,required:!0},assets:{type:Object,required:!0},content:{type:Array,required:!0},elements:{type:Object,required:!0},section:{type:String,default:"main"}},emits:["error","update:content"],data:()=>({panel:[],menu:{},index:null,checked:!1,vchange:!1,vschemas:!1,currentPage:1,lastPage:1}),setup(){const e=ci(),t=it(),n=Et(),r=St();return{auth:qe(),clipboard:e,side:r,messages:t,schemas:n}},computed:{changed(){return this.content.some(e=>e._changed)},isChecked(){return this.content.some(e=>e._checked)}},methods:{add(e,t){let n={id:Ee(),group:this.section};e.id?(this.elements[e.id]=e,n=Object.assign(n,{type:"reference",refid:e.id})):n=Object.assign(n,{type:e.type,data:{}}),t!==null?(this.content.splice(t,0,n),this.panel.push(this.panel.includes(t)?t+1:t)):(this.content.push(n),this.panel.push(this.content.length-1)),this.$emit("update:content",this.content),this.vschemas=!1,this.store()},change(e){if(!this.content[e]){this.messages.add(this.$gettext("Content element not found"),"error");return}this.index=e,this.vchange=!0},changeTo(e,t){if(!this.content[t]){this.messages.add(this.$gettext("Content element not found"),"error");return}this.content[t]._error=!1,this.content[t].type=e.type,this.vchange=!1,this.validate().then(n=>{this.$emit("update:content",this.content),this.$emit("error",!n),this.store()})},copy(e){const t=[];if(e===void 0){for(let n=this.content.length-1;n>=0;n--)if(this.content[n]._checked){const r=JSON.parse(JSON.stringify(this.content[n]));r._checked=!1,r.id=null,t.push(r)}}else{const n=JSON.parse(JSON.stringify(this.content[e]));n._checked=!1,n.id=null,t.push(n)}this.clipboard.set("page-content",t.reverse())},createMarkdown(e){return e.type==="text"?e.data.text||"":e.type==="code"?`\`\`\`${e.data.lang||""}
${e.data.text||""}
\`\`\``:e.type==="heading"?`${"#".repeat(Number(e.data.level)||1)} ${e.data.title||""}`:""},cut(e){const t=[];if(e===void 0){for(let n=this.content.length-1;n>=0;n--)if(this.content[n]._checked){const r=JSON.parse(JSON.stringify(this.content[n]));this.content.splice(n,1),r.id=null,t.push(r)}}else{const n=JSON.parse(JSON.stringify(this.content[e]));this.content.splice(e,1),n.id=null,t.push(n)}this.clipboard.set("page-content",t.reverse()),this.$emit("update:content",this.content),this.store()},error(e,t){e._error=t,this.$emit("error",this.content.some(n=>n._error)),this.store()},fields(e){var t,n;return(t=this.schemas.content[e])!=null&&t.fields?(n=this.schemas.content[e])==null?void 0:n.fields:(console.warn(`No definition of fields for "${e}" schemas`),[])},insert(e){this.index=e,this.vschemas=!0},merge(){let e=0;const t=[];for(let r=this.content.length-1;r>=0;r--)this.content[r]._checked&&["text","code","heading"].includes(this.content[r].type)&&(t.push(this.content[r]),this.content.splice(r,1),e=r);if(t.length===0)return;const n=t.reverse().reduce((r,s)=>(r.data.text+=this.createMarkdown(s)+`

`,r),{id:Ee(),group:this.section,type:"text",data:{text:""}});this.content.splice(e,0,n),this.$emit("update:content",this.content),this.store()},paste(e=null){e===null&&(e=this.content.length);const t=(this.clipboard.get("page-content")||[]).map(n=>(n.group=this.section,n));this.content.splice(e,0,...t),this.$emit("update:content",this.content),this.store()},purge(){for(let e=this.content.length-1;e>=0;e--)this.content[e]._checked&&this.content.splice(e,1);this.$emit("error",this.content.some(e=>e._error)),this.$emit("update:content",this.content),this.checked=!1,this.store()},remove(e){this.content.splice(e,1),this.$emit("error",this.content.some(t=>t._error)),this.$emit("update:content",this.content),this.store()},reset(){this.content.forEach(e=>{delete e._changed,delete e._error}),this.store()},search(e){e&&(e=e.toLocaleLowerCase().trim(),this.content.forEach(t=>{const n=t.type==="reference"?this.elements[t.refid]||{}:t;t._hide=!JSON.stringify(Object.values((n==null?void 0:n.data)||{})).toLocaleLowerCase().includes(e)}))},share(e){var n;if(!this.auth.can("element:add")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=this.content[e];if(!t){this.messages.add(this.$gettext("Element not found"),"error");return}if(t.type==="reference"){this.messages.add(this.$gettext("Element is already shared"),"error");return}this.$apollo.mutate({mutation:le`
            mutation($input: ElementInput!, $files: [ID!]) {
              addElement(input: $input, files: $files) {
                id
                type
                lang
                name
                data
                editor
                updated_at
                files {
                  id
                  lang
                  mime
                  name
                  path
                  previews
                  description
                  updated_at
                  editor
                }
              }
            }
          `,variables:{input:{type:t.type,lang:this.item.lang,name:this.title(t),data:JSON.stringify(t.data||{})},files:((n=t.files)==null?void 0:n.filter((r,s,i)=>i.indexOf(r)===s))||[]}}).then(r=>{if(r.errors)throw r.errors;const s=r.data.addElement;for(const i of s.files||[])i.previews=JSON.parse(i.previews||"{}"),this.assets[i.id]=i;s.data=JSON.parse(s.data),s.files=s.files.map(i=>i.id),this.elements[s.id]=s,this.content[e]={id:Ee(),group:this.section,type:"reference",refid:s.id},this.$emit("update:content",this.content),this.store()}).catch(r=>{this.messages.add(this.$gettext("Unable to make element shared"),"error"),this.$log("PageDetailContentList::share(): Error making element shared",e,r)})},shown(e){const t=this.side.shown("state","valid"),n=this.side.shown("state","error"),r=this.side.shown("state","changed");return!e._hide&&this.side.shown("type",e.type)&&(n&&e._error||r&&e._changed||t&&!e._error&&!e._changed)},split(e){var s;if(!this.content[e]){this.messages.add(this.$gettext("Not available for this content element"),"error");return}const t=[],n=io(((s=this.content[e].data)==null?void 0:s.text)||"");for(const i of n.children)switch(i.type){case"code":{t.push({id:Ee(),type:"code",group:this.section,data:{lang:i.lang||null,text:i.value}});break}case"heading":{const a=i.children.map(l=>l.value).join("");t.push({id:Ee(),type:"heading",group:this.section,data:{title:a.trim(),level:String(i.depth)}});break}case"table":{const a=i.children.map(l=>l.children.map(u=>u.children.map(o=>o.value||"").join("")).join(";")).join(`
`);t.push({id:Ee(),type:"table",group:this.section,data:{text:a.trim()}});break}default:t.push({id:Ee(),type:"text",group:this.section,data:{text:ss(i)}})}const r=t.reduce((i,a)=>{const l=i[i.length-1];return a.type==="text"&&(l==null?void 0:l.type)==="text"?l.data.text+=`
`+a.data.text:i.push({...a}),i},[]);this.content.splice(e,1,...r),this.$emit("error",this.content.some(i=>i._error)),this.$emit("update:content",this.content),this.store()},store(e=!0){if(!e)return;const t={},n={};return this.content.forEach(r=>{r.type&&(t[r.type]=(t[r.type]||0)+1),!r._changed&&!r._error&&(n.valid=(n.valid||0)+1),r._changed&&(n.changed=(n.changed||0)+1),r._error&&(n.error=(n.error||0)+1)}),this.side.store={type:t,state:n}},title(e){var t,n;return(((t=e.data)==null?void 0:t.title)||((n=e.data)==null?void 0:n.text)||Object.values(e.data||{}).map(r=>r&&typeof r!="object"&&typeof r!="boolean"?r:null).filter(r=>!!r).join(" - ")).substring(0,50)||this.$pgettext("st",e.type)||""},toggle(){this.content.forEach(e=>{this.shown(e)&&(e._checked=!e._checked)})},unshare(e){if(!this.content[e]){this.messages.add(this.$gettext("Content element not found"),"error");return}const t=this.content[e];if(t.type!=="reference"||!this.elements[t.refid]){this.messages.add(this.$gettext("Element is not shared"),"error");return}for(const n of this.elements[t.refid].files||[])this.assets[n.id]=n;this.content[e].type=this.elements[t.refid].type||null,this.content[e].data=this.elements[t.refid].data||{},delete this.content[e].refid,this.$emit("update:content",this.content),this.store()},update(e){e._changed=!0,e.group=this.section,this.$emit("error",this.content.some(t=>t._error)),this.$emit("update:content",this.content),this.store()},validate(){var t;const e=[];return(t=this.$refs.field)==null||t.forEach(n=>{e.push(n.validate())}),Promise.all(e).then(n=>n.every(r=>r))}}},oo={class:"header"},uo={key:0,class:"bulk"},co={class:"element-title"},ho={class:"element-type"},fo={key:0,class:"btn-group"};function po(e,t,n,r,s,i){const a=ee("Fields"),l=ee("VueDraggable"),u=ee("SchemaDialog"),o=pn("observe-visibility");return k(),R(oe,null,[et((k(),R("div",null,[X("div",oo,[r.auth.can("page:save")?(k(),R("div",uo,[y(Ft,{modelValue:e.checked,"onUpdate:modelValue":t[0]||(t[0]=c=>e.checked=c),onClick:t[1]||(t[1]=Ue(c=>i.toggle(),["stop"]))},null,8,["modelValue"]),y(dt,{location:"bottom left"},{activator:m(({props:c})=>[y(D,tt(c,{disabled:!i.isChecked,"append-icon":"mdi-menu-down",variant:"text"}),{default:m(()=>[V(I(e.$gettext("Actions")),1)]),_:2},1040,["disabled"])]),default:m(()=>[y(ct,null,{default:m(()=>[i.isChecked?(k(),E(M,{key:0},{default:m(()=>[y(D,{"prepend-icon":"mdi-delete",variant:"text",onClick:t[2]||(t[2]=c=>i.purge())},{default:m(()=>[V(I(e.$gettext("Delete")),1)]),_:1})]),_:1})):O("",!0),i.isChecked?(k(),E(M,{key:1},{default:m(()=>[y(D,{"prepend-icon":"mdi-content-copy",variant:"text",onClick:t[3]||(t[3]=c=>i.copy())},{default:m(()=>[V(I(e.$gettext("Copy")),1)]),_:1})]),_:1})):O("",!0),i.isChecked?(k(),E(M,{key:2},{default:m(()=>[y(D,{"prepend-icon":"mdi-content-cut",variant:"text",onClick:t[4]||(t[4]=c=>i.cut())},{default:m(()=>[V(I(e.$gettext("Cut")),1)]),_:1})]),_:1})):O("",!0),r.clipboard.get("page-content")?(k(),E(M,{key:3},{default:m(()=>[y(D,{"prepend-icon":"mdi-content-paste",variant:"text",onClick:t[5]||(t[5]=c=>i.paste())},{default:m(()=>[V(I(e.$gettext("Paste")),1)]),_:1})]),_:1})):O("",!0),i.isChecked?(k(),E(M,{key:4},{default:m(()=>[y(D,{"prepend-icon":"mdi-set-merge",variant:"text",onClick:t[6]||(t[6]=c=>i.merge())},{default:m(()=>[V(I(e.$gettext("Merge")),1)]),_:1})]),_:1})):O("",!0)]),_:1})]),_:1})])):O("",!0),y(je,{"onClick:clear":t[7]||(t[7]=c=>i.search("")),onInput:t[8]||(t[8]=c=>i.search(c.target.value)),label:e.$gettext("Search for"),"prepend-inner-icon":"mdi-magnify",variant:"underlined",class:"search",clearable:"","hide-details":""},null,8,["label"])]),y(mn,{class:"list",modelValue:e.panel,"onUpdate:modelValue":t[11]||(t[11]=c=>e.panel=c),elevation:"0",multiple:""},{default:m(()=>[y(l,{"onUpdate:modelValue":t[10]||(t[10]=c=>e.$emit("update:content",c)),disabled:!r.auth.can("page:save"),modelValue:n.content,draggable:".content",group:"content"},{default:m(()=>[(k(!0),R(oe,null,$e(n.content,(c,d)=>et((k(),E(gn,{key:d,class:ce(["content",{changed:c._changed,error:c._error}])},{default:m(()=>[y(yn,{"expand-icon":"mdi-pencil"},{default:m(()=>{var h;return[r.auth.can("page:save")?(k(),E(Ft,{key:0,modelValue:c._checked,"onUpdate:modelValue":f=>c._checked=f,onClick:t[9]||(t[9]=Ue(()=>{},["stop"]))},null,8,["modelValue","onUpdate:modelValue"])):O("",!0),r.auth.can("page:save")?(k(),E(dt,{key:1},{activator:m(({props:f})=>[y(D,tt({ref_for:!0},f,{title:e.$gettext("Actions"),icon:"mdi-dots-vertical",variant:"text"}),null,16,["title"])]),default:m(()=>[y(ct,null,{default:m(()=>[c._error?O("",!0):(k(),E(M,{key:0},{default:m(()=>[y(D,{"prepend-icon":"mdi-content-copy",variant:"text",onClick:f=>i.copy(d)},{default:m(()=>[V(I(e.$gettext("Copy")),1)]),_:2},1032,["onClick"])]),_:2},1024)),c._error?O("",!0):(k(),E(M,{key:1},{default:m(()=>[y(D,{"prepend-icon":"mdi-content-cut",variant:"text",onClick:f=>i.cut(d)},{default:m(()=>[V(I(e.$gettext("Cut")),1)]),_:2},1032,["onClick"])]),_:2},1024)),y(M,null,{default:m(()=>[y(D,{"prepend-icon":"mdi-delete",variant:"text",onClick:f=>i.remove(d)},{default:m(()=>[V(I(e.$gettext("Delete")),1)]),_:2},1032,["onClick"])]),_:2},1024),y(Ge),r.clipboard.get("page-content")?(k(),E(M,{key:2},{default:m(()=>[y(D,{"prepend-icon":"mdi-arrow-up",variant:"text",onClick:f=>i.paste(d)},{default:m(()=>[V(I(e.$gettext("Paste before")),1)]),_:2},1032,["onClick"])]),_:2},1024)):O("",!0),r.clipboard.get("page-content")?(k(),E(M,{key:3},{default:m(()=>[y(D,{"prepend-icon":"mdi-arrow-down",variant:"text",onClick:f=>i.paste(d+1)},{default:m(()=>[V(I(e.$gettext("Paste after")),1)]),_:2},1032,["onClick"])]),_:2},1024)):O("",!0),y(M,null,{default:m(()=>[y(D,{"prepend-icon":"mdi-arrow-up",variant:"text",onClick:f=>i.insert(d)},{default:m(()=>[V(I(e.$gettext("Insert before")),1)]),_:2},1032,["onClick"])]),_:2},1024),y(M,null,{default:m(()=>[y(D,{"prepend-icon":"mdi-arrow-down",variant:"text",onClick:f=>i.insert(d+1)},{default:m(()=>[V(I(e.$gettext("Insert after")),1)]),_:2},1032,["onClick"])]),_:2},1024),y(Ge),!c._error&&c.type!=="reference"&&r.auth.can("element:add")?(k(),E(M,{key:4},{default:m(()=>[y(D,{"prepend-icon":"mdi-link",variant:"text",onClick:f=>i.share(d)},{default:m(()=>[V(I(e.$gettext("Make shared")),1)]),_:2},1032,["onClick"])]),_:2},1024)):O("",!0),c.type==="reference"?(k(),E(M,{key:5},{default:m(()=>[y(D,{"prepend-icon":"mdi-link-off",variant:"text",onClick:f=>i.unshare(d)},{default:m(()=>[V(I(e.$gettext("Merge copy")),1)]),_:2},1032,["onClick"])]),_:2},1024)):O("",!0),c.type!=="reference"?(k(),E(M,{key:6},{default:m(()=>[y(D,{"prepend-icon":"mdi-swap-horizontal",variant:"text",onClick:f=>i.change(d)},{default:m(()=>[V(I(e.$gettext("Change to")),1)]),_:2},1032,["onClick"])]),_:2},1024)):O("",!0),c.type==="text"?(k(),E(M,{key:7},{default:m(()=>[y(D,{"prepend-icon":"mdi-set-split",variant:"text",onClick:f=>i.split(d)},{default:m(()=>[V(I(e.$gettext("Split")),1)]),_:2},1032,["onClick"])]),_:2},1024)):O("",!0)]),_:2},1024)]),_:2},1024)):O("",!0),c.type==="reference"?(k(),E(hr,{key:2,title:e.$gettext("Shared element"),class:"icon-shared",icon:"mdi-link"},null,8,["title"])):O("",!0),X("div",co,I(c.type==="reference"?(h=n.elements[c.refid])==null?void 0:h.name:i.title(c)),1),X("div",ho,I(e.$pgettext("st",c.type)),1)]}),_:2},1024),y(kn,null,{default:m(()=>{var h,f;return[c.type==="reference"?(k(),E(a,{key:0,data:((h=n.elements[c.refid])==null?void 0:h.data)||{},fields:i.fields((f=n.elements[c.refid])==null?void 0:f.type),assets:n.assets,readonly:!0},null,8,["data","fields","assets"])):(k(),E(a,{key:1,ref_for:!0,ref:"field",data:c.data,"onUpdate:data":v=>c.data=v,files:c.files,"onUpdate:files":v=>c.files=v,readonly:!r.auth.can("page:save"),fields:i.fields(c.type),assets:n.assets,onError:v=>i.error(c,v),onChange:v=>i.update(c)},null,8,["data","onUpdate:data","files","onUpdate:files","readonly","fields","assets","onError","onChange"]))]}),_:2},1024)]),_:2},1032,["class"])),[[Mt,i.shown(c)]])),128))]),_:1},8,["disabled","modelValue"])]),_:1},8,["modelValue"]),r.auth.can("page:save")?(k(),R("div",fo,[y(D,{onClick:t[12]||(t[12]=c=>e.vschemas=!0),title:e.$gettext("Add element"),icon:"mdi-view-grid-plus",color:"primary",variant:"flat"},null,8,["title"])])):O("",!0)])),[[o,i.store]]),(k(),E(nt,{to:"body"},[y(u,{modelValue:e.vschemas,"onUpdate:modelValue":t[13]||(t[13]=c=>e.vschemas=c),onAdd:t[14]||(t[14]=c=>i.add(c,e.index))},null,8,["modelValue"])])),(k(),E(nt,{to:"body"},[y(u,{modelValue:e.vchange,"onUpdate:modelValue":t[15]||(t[15]=c=>e.vchange=c),elements:!1,onAdd:t[16]||(t[16]=c=>i.changeTo(c,e.index))},null,8,["modelValue"])]))],64)}const mo=we(lo,[["render",po],["__scopeId","data-v-54df3d0d"]]),go={components:{PageDetailContentList:mo},props:{item:{type:Object,required:!0},assets:{type:Object,required:!0},elements:{type:Object,required:!0}},emits:["change","error"],data:()=>({changed:{},errors:{},tab:"default"}),setup(){return{config:ur()}},computed:{names(){const e=this.item.type||"page",t=this.item.theme||"cms";return this.config.get(`themes.${t}.types.${e}.sections`,["main"])},sections(){if(this.names.length<=1)return{};const e={};for(const t of this.names)e[t]=[];for(const t of this.item.content||[]){const n=t.group||"main";e[n]||(e[n]=[]),e[n].push(t)}return e}},methods:{error(e,t){this.errors[e]=t,this.$emit("error",Object.values(this.errors).includes(!0))},reset(){var e;this.changed={},this.errors={},Array.isArray(this.$refs.content)?this.$refs.content.forEach(t=>t.reset()):(e=this.$refs.content)==null||e.reset()},update(e,t){const n=this.sections;n[e]=t,this.item.content=Object.values(n).reduce((r,s)=>r.concat(s),[]),this.changed[e]=!0},validate(){const t=(Array.isArray(this.$refs.content)?this.$refs.content:[this.$refs.content]).map(n=>n==null?void 0:n.validate());return Promise.all(t).then(n=>n.every(r=>r))}}},yo={key:0};function ko(e,t,n,r,s,i){const a=ee("PageDetailContentList");return k(),E(ht,null,{default:m(()=>[y(rt,{class:"box"},{default:m(()=>[Object.keys(i.sections).length>1?(k(),R("div",yo,[y(qt,{class:"subtabs",modelValue:e.tab,"onUpdate:modelValue":t[0]||(t[0]=l=>e.tab=l),"align-tabs":"center"},{default:m(()=>[(k(!0),R(oe,null,$e(i.sections,(l,u)=>(k(),E(Me,{key:u,class:ce({changed:e.changed[u],error:e.errors[u]}),value:u},{default:m(()=>[V(I(e.$pgettext("cs",u)),1)]),_:2},1032,["class","value"]))),128))]),_:1},8,["modelValue"]),y(xn,{modelValue:e.tab,"onUpdate:modelValue":t[1]||(t[1]=l=>e.tab=l)},{default:m(()=>[(k(!0),R(oe,null,$e(i.sections,(l,u)=>(k(),E(Xe,{key:u,value:u},{default:m(()=>[y(a,{ref_for:!0,ref:"content",section:u,item:n.item,assets:n.assets,content:l,elements:n.elements,onError:o=>i.error(u,o),"onUpdate:content":o=>{i.update(u,o),this.$emit("change","content")}},null,8,["section","item","assets","content","elements","onError","onUpdate:content"])]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])])):(k(),E(a,{key:1,ref:"content",item:n.item,assets:n.assets,content:n.item.content||[],elements:n.elements,onError:t[2]||(t[2]=l=>e.$emit("error",l)),"onUpdate:content":t[3]||(t[3]=l=>{n.item.content=l,this.$emit("change","content")})},null,8,["item","assets","content","elements"]))]),_:1})]),_:1})}const vo=we(go,[["render",ko],["__scopeId","data-v-23d1776c"]]),bo={components:{Fields:Ht},props:{modelValue:{type:Boolean,required:!0},readonly:{type:Boolean,default:!1},element:{type:Object,required:!0},assets:{type:Object,default:()=>({})},type:{type:String,default:"content"}},emits:["update:modelValue","update:element"],setup(){return{schemas:Et()}},data(){return{error:!1}},methods:{fields(e){var t,n;return!this.schemas[this.type]||!((t=this.schemas[this.type][e])!=null&&t.fields)?(console.warn(`No definition of fields for "${e}" (${this.type}) schemas`),[]):(n=this.schemas.content[e])==null?void 0:n.fields}}};function xo(e,t,n,r,s,i){const a=ee("Fields");return k(),E(Rt,{modelValue:n.modelValue,"max-width":"1200",scrollable:""},{default:m(()=>[y(cr,null,{append:m(()=>[!n.readonly&&!s.error?(k(),E(D,{key:0,onClick:t[0]||(t[0]=l=>e.$emit("update:element",n.element)),variant:"outlined"},{default:m(()=>[V(I(e.$gettext("Save")),1)]),_:1})):O("",!0),y(D,{onClick:t[1]||(t[1]=l=>e.$emit("update:modelValue",!1)),title:e.$gettext("Close"),icon:"mdi-close",variant:"flat"},null,8,["title"])]),title:m(()=>[V(I(e.$gettext("Content Element")),1)]),default:m(()=>[y(Ge),y(dr,null,{default:m(()=>[y(a,{data:n.element.data,"onUpdate:data":t[2]||(t[2]=l=>n.element.data=l),files:n.element.files,"onUpdate:files":t[3]||(t[3]=l=>n.element.files=l),readonly:n.readonly,fields:i.fields(n.element.type),assets:n.assets,onError:t[4]||(t[4]=l=>s.error=n.element._error=l)},null,8,["data","files","readonly","fields","assets"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}const wo=we(bo,[["render",xo]]),Co={components:{FieldsDialog:wo,SchemaDialog:gr},props:{save:{type:Object,required:!0},item:{type:Object,required:!0},elements:{type:Object,required:!0},assets:{type:Object,default:()=>({})}},emits:["change"],setup(){const e=it(),t=qe();return{app:bn(),auth:t,messages:e}},data(){return{pos:null,index:null,element:null,section:"main",expanded:!1,vschemas:!1,vpreview:!1,vedit:!1}},mounted(){var e;window.addEventListener("message",this.message),(e=this.$refs.iframe)==null||e.addEventListener("load",()=>{var t,n;(n=(t=this.$refs.iframe)==null?void 0:t.contentWindow)==null||n.postMessage("init","*")}),this.messages.add(this.$gettext("Double-click to edit"),"info")},beforeUnmount(){window.removeEventListener("message",this.message)},computed:{url(){return this.app.urlpage.replace(/:domain/,this.item.domain||"").replace(/:path/,this.item.path||"").replace(/\/+$/,"")}},methods:{add(e){const t=this.section||"main";this.vschemas=!1,e.id?(this.elements[e.id]=e,this.element={id:Ee(),group:t,type:"reference",refid:e.id},this.update()):(this.element={id:Ee(),group:t,type:e.type,data:{}},this.vedit=!0)},edit(){this.element=this.item.content[this.index]||null,this.vedit=!!this.element},fullscreen(){const e=this.$refs.preview;this.expanded?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():e!=null&&e.requestFullscreen?e.requestFullscreen():e!=null&&e.webkitRequestFullscreen&&e.webkitRequestFullscreen(),this.expanded=!this.expanded},message(e){switch(e.data){case null:this.index=null;break;case!1:this.vpreview=!0,setTimeout(()=>{this.vpreview=!1},3e3);break;default:this.index=e.data.id?this.item.content.findIndex(t=>t.id===e.data.id):null,this.section=e.section||"main"}},remove(){this.index!==null&&(this.item.content.splice(this.index,1),this.$emit("change","content"),this.index=null,this.save.fcn(!0).then(()=>{this.$refs.iframe.contentWindow.postMessage("reload",this.url)}))},update(){this.pos!==null&&this.item.content.splice(this.index+this.pos,0,this.element),this.vedit=!1,this.index=null,this.pos=null,this.$emit("change","content"),this.save.fcn(!0).then(()=>{this.$refs.iframe.contentWindow.postMessage("reload",this.url)})}},watch:{"save.count":function(){this.save.count>0&&this.$refs.iframe.contentWindow.postMessage("reload",this.url)}}},So={class:"page-preview",ref:"preview"},Eo={key:0,class:"actions"},Io={key:1,class:"preview-mode"},$o=["src"];function Po(e,t,n,r,s,i){const a=ee("FieldsDialog"),l=ee("SchemaDialog");return k(),R(oe,null,[X("div",So,[s.index!==null?(k(),R("div",Eo,[s.index!==-1?(k(),E(D,{key:0,onClick:t[0]||(t[0]=u=>i.edit()),title:e.$gettext("Edit element"),icon:"mdi-pencil",variant:"flat"},null,8,["title"])):O("",!0),s.index!==-1?(k(),E(D,{key:1,onClick:t[1]||(t[1]=u=>{s.vschemas=!0,s.pos=0}),title:e.$gettext("Add element before"),icon:"mdi-table-row-plus-before",variant:"text"},null,8,["title"])):O("",!0),y(D,{onClick:t[2]||(t[2]=u=>{s.vschemas=!0,s.pos=1}),title:e.$gettext("Add element after"),icon:"mdi-table-row-plus-after",variant:"text"},null,8,["title"]),s.index!==-1?(k(),E(D,{key:2,onClick:t[3]||(t[3]=u=>i.remove()),title:e.$gettext("Remove element"),icon:"mdi-trash-can-outline",variant:"text"},null,8,["title"])):O("",!0)])):O("",!0),s.vpreview?(k(),R("div",Io,I(e.$gettext("Preview mode")),1)):O("",!0),X("iframe",{ref:"iframe",src:i.url},null,8,$o),s.expanded?O("",!0):(k(),E(D,{key:2,onClick:t[4]||(t[4]=u=>i.fullscreen()),title:e.$gettext("Fullscreen mode"),icon:"mdi-fullscreen",class:"fullscreen",variant:"text"},null,8,["title"])),s.expanded?(k(),E(D,{key:3,onClick:t[5]||(t[5]=u=>i.fullscreen()),title:e.$gettext("Exit fullscreen mode"),icon:"mdi-fullscreen-exit",class:"fullscreen",variant:"text"},null,8,["title"])):O("",!0)],512),(k(),E(nt,{to:"body"},[s.element?(k(),E(a,{key:0,modelValue:s.vedit,"onUpdate:modelValue":t[6]||(t[6]=u=>s.vedit=u),element:s.element.type==="reference"?n.elements[s.element.refid]:s.element,readonly:!r.auth.can("page:save")||!!s.element.refid,"onUpdate:element":t[7]||(t[7]=u=>i.update())},null,8,["modelValue","element","readonly"])):O("",!0)])),(k(),E(nt,{to:"body"},[y(l,{modelValue:s.vschemas,"onUpdate:modelValue":t[8]||(t[8]=u=>s.vschemas=u),onAdd:t[9]||(t[9]=u=>i.add(u))},null,8,["modelValue"])]))],64)}const _o=we(Co,[["render",Po]]),Do={components:{AsideMeta:bi,AsideCount:$i,HistoryDialog:vi,PageDetailItem:Hi,PageDetailContent:vo,PageDetailPreview:_o},inject:["closeView","compose","translate","txlocales"],props:{item:{type:Object,required:!0}},provide(){return{compose:this.composeText,translate:this.translateText}},setup(){const e=vn(),t=it(),n=Et(),r=fn();return{auth:qe(),drawer:r,languages:e,messages:t,schemas:n}},data:()=>({tab:"page",aside:"meta",asidePage:"meta",changed:{},errors:{},assets:{},elements:{},latest:null,pubmenu:null,publishAt:null,translating:!1,vhistory:!1,savecnt:0}),computed:{hasChanged(){return Object.values(this.changed).some(e=>e)},hasError(){return Object.values(this.errors).some(e=>e)},langs(){const e=[],t=["ar","bg","cs","da","de","el","en","en-GB","en_US","es","et","fi","fr","he","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt","pt-BR","ro","ru","sk","sl","sv","th","tr","uk","vi","zh","zh-HANS","zh-HANT"];return Object.entries(this.languages.available).forEach(n=>{t.includes(n[0])&&n[0]!==this.item.lang&&e.push({code:n[0],name:n[1]})}),e}},created(){var e;this.$options._compose=this.compose,!(!((e=this.item)!=null&&e.id)||!this.auth.can("page:view"))&&this.$apollo.query({query:le`query($id: ID!) {
          page(id: $id) {
            id
            lang
            path
            domain
            name
            title
            to
            tag
            type
            theme
            status
            cache
            meta
            config
            content
            editor
            updated_at
            deleted_at
            files {
              id
              lang
              mime
              name
              path
              previews
              description
              updated_at
              editor
            }
            elements {
              id
              type
              data
              editor
              updated_at
              files {
                id
                lang
                mime
                name
                path
                previews
                description
                updated_at
                editor
              }
            }
            latest {
              id
              published
              data
              aux
              editor
              created_at
              files {
                id
                lang
                mime
                name
                path
                previews
                description
                updated_at
                editor
              }
              elements {
                id
                type
                data
                name
                editor
                updated_at
                files {
                  id
                  lang
                  mime
                  name
                  path
                  previews
                  description
                  updated_at
                  editor
                }
              }
            }
          }
        }`,variables:{id:this.item.id}}).then(t=>{var r,s,i;if(t.errors||!t.data.page)throw t;const n=t.data.page;if(this.reset(),this.assets={},this.elements={},this.latest=n.latest,(r=this.latest)!=null&&r.aux){const a=JSON.parse(this.latest.aux);this.item.content=a.content??[],this.item.config=a.config??{},this.item.meta=a.meta??{}}else this.item.content=JSON.parse(n.content??"{}"),this.item.config=JSON.parse(n.config??"{}"),this.item.meta=JSON.parse(n.meta??"{}");for(const a of((s=this.latest)==null?void 0:s.elements)||n.elements||[])this.elements[a.id]={...a,data:JSON.parse(a.data||"{}"),files:(a.files||[]).map(l=>({...l,previews:JSON.parse(l.previews||"{}"),description:JSON.parse(l.description||"{}")}))};for(const a of((i=this.latest)==null?void 0:i.files)||n.files||[])this.assets[a.id]={...a,previews:JSON.parse(a.previews||"{}"),description:JSON.parse(a.description||"{}")};for(const a of this.item.content)a.files&&Array.isArray(a.files)&&(a.files=a.files.filter(l=>typeof this.assets[l]<"u"))}).catch(t=>{this.messages.add(this.$gettext("Error fetching page"),"error"),this.$log("PageDetail::watch(item): Error fetching page",t)})},methods:{clean(e,t){var n,r,s;if(e&&t){e=JSON.parse(JSON.stringify(e));for(const i in e){const a=e[i];for(const l in a)l.startsWith("_")&&delete a[l];for(const l in a.data||{})(s=(r=(n=this.schemas[t])==null?void 0:n[a.type])==null?void 0:r.fields)!=null&&s[l]||delete a.data[l]}}return e},composeText(e,t=[],n=[]){return this.$options._compose?(Array.isArray(t)||(t=[t]),t.push("page content as JSON: "+JSON.stringify(this.item.content)),t.push("required output language: "+(this.item.lang||"en")),this.$options._compose(e,t,n)):Promise.reject(new Error("Compose method is not available in PageDetail component"))},invalidate(){const e=this.$apollo.provider.defaultClient.cache;e.evict({id:"Page:"+this.item.id}),e.gc()},publish(e=null){if(!this.auth.can("page:publish")){this.messages.add(this.$gettext("Permission denied"),"error");return}this.save(!0).then(t=>{var n,r;t&&this.$apollo.mutate({mutation:le`mutation ($id: [ID!]!, $at: DateTime) {
              pubPage(id: $id, at: $at) {
                id
              }
            }`,variables:{id:[this.item.id],at:(r=(n=e==null?void 0:e.toISOString())==null?void 0:n.substring(0,19))==null?void 0:r.replace("T"," ")}}).then(s=>{if(s.errors)throw s.errors;e?(this.item.publish_at=e,this.messages.add(this.$gettext("Page scheduled for publishing at %{date}",{date:e.toLocaleDateString()}),"info")):(this.item.published=!0,this.messages.add(this.$gettext("Page published successfully"),"success")),this.closeView()}).catch(s=>{this.messages.add(this.$gettext("Error publishing page"),"error"),this.$log("PageDetail::publish(): Error publishing page",e,s)})})},reset(){var e,t;(e=this.$refs.page)==null||e.reset(),(t=this.$refs.content)==null||t.reset(),this.changed={},this.errors={}},save(e=!1){return this.auth.can("page:save")?this.hasChanged?this.validate().then(t=>{if(!t)return this.messages.add(this.$gettext("There are invalid fields, please resolve the errors first"),"error"),t;const n=[];for(const i of this.item.content||[])n.push(...i.files||[]);const r={};for(const i in this.item.meta||{})r[i]={type:this.item.meta[i].type||"",data:this.item.meta[i].data||{},files:this.item.meta[i].files||[]},n.push(...this.item.meta[i].files||[]);const s={};for(const i in this.item.config||{})s[i]={type:this.item.config[i].type||"",data:this.item.config[i].data||{},files:this.item.config[i].files||[]},n.push(...this.item.config[i].files||[]);return this.$apollo.mutate({mutation:le`mutation ($id: ID!, $input: PageInput!, $elements: [ID!], $files: [ID!]) {
              savePage(id: $id, input: $input, elements: $elements, files: $files) {
                id
              }
            }`,variables:{id:this.item.id,input:{cache:this.item.cache||0,domain:this.item.domain||"",lang:this.item.lang||"",name:this.item.name||"",path:this.item.path||"",status:this.item.status||0,title:this.item.title||"",tag:this.item.tag||"",to:this.item.to||"",type:this.item.type||"",theme:this.item.theme||"",meta:JSON.stringify(this.clean(r,"meta")),config:JSON.stringify(this.clean(s,"config")),content:JSON.stringify(this.clean(this.item.content,"content"))},elements:Object.keys(this.elements),files:n.filter((i,a,l)=>l.indexOf(i)===a)}}).then(i=>{var a;if(i.errors)throw i.errors;return this.item.published=!1,(a=this.$refs.history)==null||a.reset(),this.reset(),e||this.messages.add(this.$gettext("Page saved successfully"),"success"),this.invalidate(),this.savecnt++,!0}).catch(i=>{this.messages.add(this.$gettext("Error saving page"),"error"),this.$log("PageDetail::save(): Error saving page",i)})}):Promise.resolve(!0):(this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve(!1))},translatePage(e){var r,s,i;if(!this.schemas.content){this.messages.add(this.$gettext('No page schema for "content" found'),"error");return}const t=["text","markdown","plaintext","string"],n=[{item:this.item,key:"title",text:this.item.title},{item:this.item,key:"name",text:this.item.name},{item:this.item,key:"path",text:this.item.path}];for(const a of Object.values(this.item.meta))for(const l in a.data){const u=(i=(s=(r=this.schemas.meta[a.type])==null?void 0:r.fields)==null?void 0:s[l])==null?void 0:i.type;a.data[l]&&t.includes(u)&&n.push({item:a.data,key:l,text:a.data[l]})}this.item.content.forEach(a=>{var l,u,o,c,d;for(const h in a.data){const f=(l=this.schemas.content[a.type])==null?void 0:l.fields,v=(u=f==null?void 0:f[h])==null?void 0:u.type;if(v==="items")for(const C in a.data[h]){const A=a.data[h][C];for(const x in A)t.includes((d=(c=(o=f[h])==null?void 0:o.item)==null?void 0:c[x])==null?void 0:d.type)&&n.push({item:A,key:x,text:A[x]})}else a.type!=="code"&&a.data[h]&&t.includes(v)&&n.push({item:a.data,key:h,text:a.data[h]})}}),this.translating=!0,this.translate(n.map(a=>a.text),e,this.item.lang).then(a=>{a.forEach((l,u)=>{n[u]&&(n[u].item[n[u].key]=l)}),this.changed.content=!0,this.changed.page=!0,this.item.lang=e}).finally(()=>{this.translating=!1})},translateText(e,t,n=null){return this.translate(e,t,n||this.item.lang)},update(e,t){e==="page"?Object.assign(this.item,t):this[e]=t,this.changed[e]=!0},use(e){Object.assign(this.item,e.data),this.changed.content=!0,this.changed.page=!0,this.vhistory=!1},validate(){var e,t;return Promise.all([(e=this.$refs.page)==null?void 0:e.validate(),(t=this.$refs.content)==null?void 0:t.validate()].filter(n=>n)).then(n=>n.every(r=>r))},versions(e){return this.auth.can("page:view")?e?this.$apollo.query({query:le`query($id: ID!) {
            page(id: $id) {
              id
              versions {
                id
                published
                publish_at
                data
                aux
                editor
                created_at
              }
            }
          }`,variables:{id:e}}).then(t=>{if(t.errors||!t.data.page)throw t;return(t.data.page.versions||[]).map(n=>{const r={...n,data:Object.assign(JSON.parse(n.data||"{}"),JSON.parse(n.aux||"{}"))};return delete r.aux,r}).reverse()}).catch(t=>{this.messages.add(this.$gettext("Error fetching page versions"),"error"),this.$log("PageDetail::versions(): Error fetching page versions",e,t)}):Promise.resolve([]):(this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve([]))}},watch:{asidePage(e){this.aside=e}}},Oo={class:"app-title"},To={class:"menu-content"};function Ao(e,t,n,r,s,i){const a=ee("PageDetailItem"),l=ee("PageDetailPreview"),u=ee("PageDetailContent"),o=ee("AsideMeta"),c=ee("AsideCount"),d=ee("HistoryDialog");return k(),R(oe,null,[y(fr,{elevation:0,density:"compact"},{prepend:m(()=>[y(D,{onClick:t[0]||(t[0]=h=>i.closeView()),title:e.$gettext("Back to list view"),icon:"mdi-keyboard-backspace"},null,8,["title"])]),append:m(()=>[y(dt,null,{activator:m(({props:h})=>[y(D,tt(h,{title:e.$gettext("Translate page"),loading:e.translating,icon:"mdi-translate"}),null,16,["title","loading"])]),default:m(()=>[y(ct,null,{default:m(()=>[(k(!0),R(oe,null,$e(i.txlocales(n.item.lang),h=>(k(),E(M,{key:h.code},{default:m(()=>[y(D,{onClick:f=>i.translatePage(h.code),"prepend-icon":"mdi-arrow-right-thin",variant:"text"},{default:m(()=>[V(I(h.name),1)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})]),_:1}),y(D,{onClick:t[1]||(t[1]=h=>e.vhistory=!0),class:ce([{hidden:n.item.published&&!i.hasChanged&&!e.latest},"no-rtl"]),icon:"mdi-history"},null,8,["class"]),y(D,{onClick:t[2]||(t[2]=h=>i.save()),class:ce([{error:i.hasError},"menu-save"]),disabled:!i.hasChanged||i.hasError||!r.auth.can("page:save"),variant:"text"},{default:m(()=>[V(I(e.$gettext("Save")),1)]),_:1},8,["class","disabled"]),y(dt,{modelValue:e.pubmenu,"onUpdate:modelValue":t[6]||(t[6]=h=>e.pubmenu=h),"close-on-content-click":!1},{activator:m(({props:h})=>[y(hi,{class:"menu-publish",variant:"text"},{default:m(()=>[y(D,{onClick:t[3]||(t[3]=f=>i.publish()),class:ce([{error:i.hasError},"button"]),disabled:n.item.published&&!i.hasChanged||i.hasError||!r.auth.can("page:publish")},{default:m(()=>[V(I(e.$gettext("Publish")),1)]),_:1},8,["class","disabled"]),y(D,tt(h,{class:[{error:i.hasError},"icon"],disabled:n.item.published&&!i.hasChanged||i.hasError||!r.auth.can("page:publish"),title:e.$gettext("Schedule publishing"),icon:"mdi-menu-down"}),null,16,["class","disabled","title"])]),_:2},1024)]),default:m(()=>[X("div",To,[y(di,{modelValue:e.publishAt,"onUpdate:modelValue":t[4]||(t[4]=h=>e.publishAt=h),"hide-header":"","show-adjacent-months":""},null,8,["modelValue"]),y(D,{onClick:t[5]||(t[5]=h=>{i.publish(e.publishAt),e.pubmenu=!1}),disabled:!e.publishAt||i.hasError,color:e.publishAt?"primary":"",variant:"flat"},{default:m(()=>[V(I(e.$gettext("Publish")),1)]),_:1},8,["disabled","color"])])]),_:1},8,["modelValue"]),y(D,{onClick:t[7]||(t[7]=Ue(h=>r.drawer.toggle("aside"),["stop"])),title:e.$gettext("Toggle side menu"),icon:r.drawer.aside?"mdi-chevron-right":"mdi-chevron-left"},null,8,["title","icon"])]),default:m(()=>[y(mr,null,{default:m(()=>[X("div",Oo,I(e.$gettext("Page"))+": "+I(n.item.name),1)]),_:1})]),_:1}),y(pr,{class:"page-details"},{default:m(()=>[y(fi,{onSubmit:t[19]||(t[19]=Ue(()=>{},["prevent"]))},{default:m(()=>[y(qt,{"fixed-tabs":"",modelValue:e.tab,"onUpdate:modelValue":t[11]||(t[11]=h=>e.tab=h)},{default:m(()=>[y(Me,{value:"page",class:ce({changed:e.changed.page,error:e.errors.page}),onClick:t[8]||(t[8]=h=>e.aside=e.asidePage)},{default:m(()=>[V(I(e.$gettext("Page")),1)]),_:1},8,["class"]),y(Me,{value:"editor",onClick:t[9]||(t[9]=h=>e.aside="")},{default:m(()=>[V(I(e.$gettext("Editor")),1)]),_:1}),y(Me,{value:"content",class:ce({changed:e.changed.content,error:e.errors.content}),onClick:t[10]||(t[10]=h=>e.aside="count")},{default:m(()=>[V(I(e.$gettext("Content")),1)]),_:1},8,["class"])]),_:1},8,["modelValue"]),y(xn,{modelValue:e.tab,"onUpdate:modelValue":t[18]||(t[18]=h=>e.tab=h)},{default:m(()=>[y(Xe,{value:"page"},{default:m(()=>[y(a,{ref:"page",item:n.item,assets:e.assets,"onUpdate:item":t[12]||(t[12]=h=>{Object.assign(n.item,h),e.changed.page=!0}),"onUpdate:aside":t[13]||(t[13]=h=>e.asidePage=h),onError:t[14]||(t[14]=h=>e.errors.page=h)},null,8,["item","assets"])]),_:1}),y(Xe,{value:"editor"},{default:m(()=>[y(l,{save:{fcn:i.save,count:e.savecnt},item:n.item,assets:e.assets,elements:e.elements,onChange:t[15]||(t[15]=h=>e.changed.content=!0)},null,8,["save","item","assets","elements"])]),_:1}),y(Xe,{value:"content"},{default:m(()=>[y(u,{ref:"content",item:n.item,assets:e.assets,elements:e.elements,onError:t[16]||(t[16]=h=>e.errors.content=h),onChange:t[17]||(t[17]=h=>e.changed.content=!0)},null,8,["item","assets","elements"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e.aside==="meta"?(k(),E(o,{key:0,item:n.item},null,8,["item"])):O("",!0),e.aside==="count"?(k(),E(c,{key:1})):O("",!0),(k(),E(nt,{to:"body"},[y(d,{ref:"history",modelValue:e.vhistory,"onUpdate:modelValue":t[20]||(t[20]=h=>e.vhistory=h),current:{data:{cache:n.item.cache,domain:n.item.domain,lang:n.item.lang,name:n.item.name,path:n.item.path,status:n.item.status,title:n.item.title,tag:n.item.tag,to:n.item.to,type:n.item.type,theme:n.item.theme,meta:i.clean(n.item.meta,"meta"),config:i.clean(n.item.config,"config"),content:i.clean(n.item.content,"content")}},load:()=>i.versions(n.item.id),onUse:t[21]||(t[21]=h=>i.use(h)),onRevert:t[22]||(t[22]=h=>{i.use(h),i.reset()})},null,8,["modelValue","current","load"])]))],64)}const Zn=we(Do,[["render",Ao],["__scopeId","data-v-a1f3f8aa"]]);var Fo=!1,Vo=!0;/*!
 * helper-js v3.1.6
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: null
 * Released under the MIT License.
 */function zt(e){return Object.prototype.toString.call(e)==="[object Array]"}function er(e){return Object.prototype.toString.call(e)==="[object Object]"}function Lo(e){return typeof e=="function"}function zo(e,t){return e<t?e:t}function Hr(e,t){let n,r=0;for(;(n=e.indexOf(t))>-1;)e.splice(n,1),r++;return r}function Kr(e){return e[e.length-1]}function Bo(e){return zt(e)?e:[e]}function No(e,t){let n=new Set(t);const r={};return n.forEach(s=>{r[s]=e[s]}),r}function jo(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){if(t.reverse)if(e.length!=null)for(let n=e.length-1;n>=0;n--){const r={value:e[n],index:n};(!t.exclude||!t.exclude(r))&&(yield r)}else if(er(e)){const n=Object.keys(e);n.reverse();for(const r of n){const s={value:e[r],key:r};(!t.exclude||!t.exclude(s))&&(yield s)}}else throw"Unsupported type";else if(e.length!=null)for(let n=0;n<e.length;n++){const r={value:e[n],index:n};(!t.exclude||!t.exclude(r))&&(yield r)}else if(er(e))for(const n of Object.keys(e)){const r={value:e[n],key:n};(!t.exclude||!t.exclude(r))&&(yield r)}else throw"Unsupported type"}()}function Uo(e,t,n){e.hasOwnProperty(t)||(e[t]=n)}function Wr(e,t){return Object.keys(t).forEach(n=>{Uo(e,n,t[n])}),e}function Mo(e){const t={};return Object.keys(e).forEach(n=>{e[n]!==void 0&&(t[n]=e[n])}),t}function _e(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};n=Wr({...n},{childrenKey:"children"});const{childrenKey:r}=n,s=zt(e)?e:[e];class i{}const a=(l,u,o)=>{n.reverse&&(l=l.slice(),l.reverse());const c=l.length;for(let d=0;d<c;d++){const h=l[d],f=n.reverse?c-d-1:d,v=o?[...o,f]:[];n.childFirst&&h[r]!=null&&a(h[r],h,v);const C=t(h,f,u,v);if(C===!1)throw new i;if(C==="skip children")continue;if(C==="skip siblings")break;n.childFirst||h[r]!=null&&a(h[r],h,v)}};try{a(s,null,zt(e)?[]:null)}catch(l){if(!(l instanceof i))throw l}}function Ro(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r;return _e(e,function(){if(t(...arguments))return r={node:arguments.length<=0?void 0:arguments[0],index:arguments.length<=1?void 0:arguments[1],parent:arguments.length<=2?void 0:arguments[2],path:arguments.length<=3?void 0:arguments[3]},!1},n),r}function qo(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=Ro(e,t,n);return r==null?void 0:r.node}function Jr(e,t){const n={childrenKey:"children"};t&&Object.assign(n,t);const{childrenKey:r,nodeHandler:s}=n,i=new dn;return i.childrenKey=r,_e(e,(a,l,u,o)=>{let c=Object.assign({},a);c[r]&&(c[r]=[]),s&&(c=s(c,{oldNode:a,index:l,parent:u,path:o})),i.set(o,c)},{childrenKey:r}),i.data}class dn{constructor(){ot(this,"data");ot(this,"childrenKey","children");let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this.data=t}get rootChildren(){const{childrenKey:t}=this,{data:n}=this;return zt(n)?n:n[t]}iteratePath(t){var n=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{childrenKey:s,rootChildren:i}=n;if(r.reverse){const a=[...n.iteratePath(t,{...r,reverse:!1})];a.reverse();for(const{path:l,node:u}of a)yield{path:l,node:u}}else{let a=[],l=i;for(const u of t){const o=[...a,u],c=l[u];yield{path:o,node:c},a=o,l=c[s]}}}()}getFamily(t){const n=[];for(const{node:r}of this.iteratePath(t))n.push(r);return n}get(t){return Kr(this.getFamily(t))}getParentAndIndex(t){const n=t.slice(),r=n.pop();return{parent:this.get(n),index:r,parentPath:n}}getParent(t){return this.getParentAndIndex(t).parent}set(t,n){if(t==null||t.length===0)this.data=n;else{const{childrenKey:r}=this;let{rootChildren:s}=this;const{parent:i,index:a}=this.getParentAndIndex(t);let l;t.length===1?(s||(this.data?this.data[r]=[]:this.data=[]),l=s):(i[r]||(i[r]=[]),l=i[r]),l[a]=n}}delete(t){const{childrenKey:n,rootChildren:r}=this,{parent:s,index:i}=this.getParentAndIndex(t),a=t.length===1?r:s[n],l=a[i];return a.splice(i,1),l}walk(t,n){const{childrenKey:r,data:s}=this;return _e(s,t,r,n)}clone(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Jr(this.data),Mo({childrenKey:this.childrenKey,nodeHandler:t.nodeHandler||void 0})}}function tr(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return Lo(e)?e(...t):e}function Ho(e,t){return function(){let r,s;try{r=e(...arguments)}catch(i){s=i}finally{}if(s)throw s;return r}}function kt(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=[];let r;const s={};let i=s;return{action:function(){for(var u=arguments.length,o=new Array(u),c=0;c<u;c++)o[c]=arguments[c];if(o.length===0)return i===s&&(i=e()),i;if(r||(r=new Qo),!r.has(o)&&(r.set(o,e(...o)),t.capacity!=null)){n.push(o);const d=n.splice(0,n.length-t.capacity);for(const h of d)r.delete(h)}return r.get(o)},clearCache:()=>{r=null,n.splice(0,n.length)}}}function Ko(){let e,t;return{promise:new Promise((r,s)=>{e=r,t=s}),resolve:e,reject:t}}function Wo(e,t){for(;;){if(e.parentNode==null)return!1;if(e.parentNode===t)return!0;e=e.parentNode}}function Xt(e){let t=e.getBoundingClientRect();if(document.documentElement.clientTop>0){const n=t.top-document.documentElement.clientTop,r=t.bottom,s=t.left-document.documentElement.clientLeft,i=t.right,a=t.width||i-s,l=t.height||r-n,c={top:n,right:i,bottom:r,left:s,width:a,height:l,x:s,y:n};t={...c,toJSON:()=>c}}return t}function nr(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=n&&n.withSelf?e:e.parentElement;for(;r;){const s=n.until&&r===n.until;if(s&&!n.withUntil)return;const i=t(r);if(i==="break")return;if(i)return r;if(s)return;r=r.parentElement}}function Bt(e,t){return e.classList?e.classList.contains(t):new RegExp("(^| )"+t+"( |$)","gi").test(e.className)}function rr(e,t){for(const n of t)if(Bt(e,n))return!0;return!1}function Oe(e,t,n,r){e.addEventListener?e.addEventListener(t,n,r):e.attachEvent&&e.attachEvent(`on${t}`,n,r)}function Te(e,t,n,r){e.removeEventListener?e.removeEventListener(t,n,r):e.detachEvent&&e.detachEvent(`on${t}`,n,r)}function Jo(e){let t=[];const n=()=>{if(!s.listening){for(const i of e){Oe.apply(this,i);const a=()=>Te.apply(this,i);t.push(a)}s.listening=!0}},s={listening:!1,stop:()=>{if(s.listening){for(const i of t)i();t=[],s.listening=!1}},resume:n,start:n};return s.start(),s}function Nt(e,t){return getComputedStyle(e)[t]}function hn(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};n={start:0,end:e.length-1,maxTimes:1e3,...n};let{start:r,end:s}=n;const{returnNearestIfNoHit:i,maxTimes:a}=n;let l,u;r==null&&(r=0,s=e.length-1);let o=0,c;for(;r>=0&&r<=s;){if(o>=a)throw Error(`binarySearch: loop times is over ${a}, you can increase the limit.`);l=Math.floor((s-r)/2+r),u=e[l];const d=o+1;if(c=t(u,l,d),c>0)s=l-1;else if(c<0)r=l+1;else return{index:l,value:u,count:d,hit:!0};o++}return i?{index:l,value:u,count:o+1,hit:!1,greater:c>0}:null}class Qo{constructor(){ot(this,"_map",new Map);ot(this,"_values",{});ot(this,"_objCount",0)}_keysToString(t){const{_map:n}=this;let r=[];for(const s of t){if(!n.has(s))return null;r.push(n.get(s)[0])}return r.toString()}has(t){return this._keysToString(t)!=null}get(t){const{_values:n}=this,r=this._keysToString(t);if(r==null)throw"Value not found by specified keys";return n[r][1]}set(t,n){const{_map:r,_values:s}=this;let i=[];for(const a of t){let l,u=1;r.has(a)?([l,u]=r.get(a),u++):(this._objCount++,l=this._objCount.toString()),r.set(a,[l,u]),i.push(l)}s[i.toString()]=[t.slice(),n]}delete(t){const{_values:n,_map:r}=this,s=this._keysToString(t);if(s==null)throw"Value not found by specified keys";delete n[s];for(const i of t){let[a,l]=r.get(i);l--,l===0?r.delete(i):r.set(i,[a,l])}}clear(){this._map.clear(),this._values={}}*entries(){const{_values:t}=this;for(const n in t){const[r,s]=t[n];yield[r,s]}}count(){return[...this.entries()].length}}/*!
 * @virtual-list/vue
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: https://virtual-list.phphe.com
 * Released under the MIT License.
 */const Yo=It({props:{table:Boolean}}),Qr=(e,t)=>{const n=e.__vccOpts||e;for(const[r,s]of t)n[r]=s;return n},Xo={key:0},Go={key:1};function Zo(e,t,n,r,s,i){return e.table?(k(),R("table",Xo,[he(e.$slots,"prepend"),X("tbody",null,[he(e.$slots,"default")]),he(e.$slots,"append")])):(k(),R("div",Go,[he(e.$slots,"prepend"),he(e.$slots,"default"),he(e.$slots,"append")]))}const eu=Qr(Yo,[["render",Zo]]),tu=It({components:{VirtualListTable:eu},props:{items:Array,disabled:Boolean,horizontal:Boolean,firstRender:{type:Number,default:10},buffer:{type:Number,default:100},itemKey:{type:[String,Function]},itemSize:{type:Function},table:Boolean},setup(e){const t=gt(0),n=gt(e.firstRender-1),r=xe(()=>{var S;return zo(n.value,(((S=e.items)==null?void 0:S.length)||1)-1)}),s=gt(0),i=xe(()=>h.value[t.value]?Y(t.value):0),a=xe(()=>h.value.length>0?Y(h.value.length-1)+Kr(d.value):0),l=xe(()=>h.value[r.value]?a.value-Y(r.value)-d.value[r.value]:0),u=xe(()=>e.disabled?{}:{overflow:"auto"}),o=xe(()=>{const S={display:"flex"};return e.disabled||(e.horizontal?Object.assign(S,{"margin-left":i.value+"px","margin-right":l.value+"px",width:a.value-l.value-i.value+"px"}):Object.assign(S,{"margin-top":i.value+"px","margin-bottom":l.value+"px"})),S["flex-direction"]=e.horizontal?"row":"column",e.table&&(delete S.display,delete S["flex-direction"]),S}),c=xe(()=>wt((e.items||[]).map(()=>null))),d=xe(()=>(e.items||[]).map((S,P)=>{var _;if(c[P]!=null)return c[P];let B=(_=e.itemSize)==null?void 0:_.call(e,S,P);return B==null&&(B=s.value),B})),h=xe(()=>{const S=[];return d.value.reduce((P,_)=>(S.push(P),P+_),0),S});rn(()=>e.items,N);const f=xe(()=>{if(!e.items||e.disabled)return;const S=[];for(let P=t.value;P<=r.value;P++){const _=e.items[P];if(!_)break;S.push({item:_,index:P})}return S}),v=gt(),C=gt();pi(async()=>{N();try{te()}catch{await Jt(),N()}});let A;function x(){const S=v.value;if(!S)return;const P=K(S);A!=null&&e.buffer-Math.abs(P-A)>=10||(A=P,N())}let z=!1,T=!1;async function N(){var S;if(z){T=!0;return}if(!e.items||e.disabled)return;z=!0;const P=v.value,_=(S=C.value)==null?void 0:S.$el;if(!P||!_)return;s.value||(s.value=fe()),t.value=pe(),n.value=g(),await Jt();let B,ne=0;const G={},ue=e.table?_.querySelector("tbody").children:_.children;for(let H=0;H<ue.length;H++){const p=ue[H],re=Nt(p,"position");if(re&&["absolute","fixed"].includes(re))continue;const de=Nt(p,"display")!=="none"?w(p):0,se=p.getAttribute("vt-index"),Pe=se?parseInt(se):t.value+ne;G[Pe]=(G[Pe]||0)+de,ne++}for(const H of Object.keys(G)){const p=parseInt(H);c.value[p]!==G[p]&&(c.value[p]=G[p],B=!0)}B&&await Jt(),z=!1,T&&(T=!1,N());function pe(){const H=K(P)-Q(P)-e.buffer;return hn(h.value,p=>p-H,{returnNearestIfNoHit:!0}).index}function g(){const H=K(P)-Q(P)+J(P)+e.buffer;return hn(h.value,p=>p-H,{returnNearestIfNoHit:!0}).index}function fe(){const H=[],p=e.table?_.querySelector("tbody").children:_.children;for(let re=0;re<p.length;re++){const de=p[re],se=getComputedStyle(de);if(["absolute","fixed"].includes(se.position))continue;const Pe=w(de);if(H.push(Pe),H.length>=10)break}return H.length===0?0:H.reduce((re,de)=>re+de,0)/H.length}}function J(S){const P=getComputedStyle(S);let _=parseFloat(e.horizontal?P.width:P.height);return P.boxSizing==="border-box"&&(e.horizontal?_=_-parseFloat(P.borderLeftWidth)-parseFloat(P.borderRightWidth):_=_-parseFloat(P.borderTopWidth)-parseFloat(P.borderBottomWidth)),_}function w(S){let P=J(S);const _=getComputedStyle(S);return e.horizontal?P+=parseFloat(_.borderLeftWidth)+parseFloat(_.borderRightWidth)+parseFloat(_.marginLeft)+parseFloat(_.marginRight):P+=parseFloat(_.borderTopWidth)+parseFloat(_.borderBottomWidth)+parseFloat(_.marginTop)+parseFloat(_.marginBottom),P=Number.isNaN(P)?0:P,P}function K(S){return e.horizontal?S.scrollLeft:S.scrollTop}function Q(S){const P=getComputedStyle(S);return e.horizontal?parseFloat(P.paddingLeft):parseFloat(P.paddingTop)}function Y(S){return h.value[S]}function te(){const S=v.value;new ResizeObserver(P=>{for(let _ of P)if(Bt(_.target,"vtlist")){N();break}}).observe(S)}function L(S,P){if(e.itemKey){if(typeof e.itemKey=="string"&&e.itemKey==="index")return P;if(typeof e.itemKey=="function")return e.itemKey(S,P)}}return{listElRef:v,listInnerRef:C,onscroll:x,listStyle:u,listInnerStyle:o,visibleItemsInfo:f,getItemKey:L,update:N,sizes:d,positions:h,runtimeSizes:c}}});function nu(e,t,n,r,s,i){const a=ee("VirtualListTable");return k(),R("div",{class:"vtlist",ref:"listElRef",style:Ze(e.listStyle),onScrollPassive:t[0]||(t[0]=(...l)=>e.onscroll&&e.onscroll(...l))},[y(a,{class:"vtlist-inner",ref:"listInnerRef",style:Ze(e.listInnerStyle),table:e.table},{prepend:m(()=>[he(e.$slots,"prepend")]),append:m(()=>[he(e.$slots,"append")]),default:m(()=>[e.disabled?(k(!0),R(oe,{key:0},$e(e.items,(l,u)=>he(e.$slots,"default",{key:e.getItemKey(l,u),item:l,index:u})),128)):(k(!0),R(oe,{key:1},$e(e.visibleItemsInfo,({item:l,index:u})=>he(e.$slots,"default",{key:e.getItemKey(l,u),item:l,index:u})),128))]),_:3},8,["style","table"])],36)}const ru=Qr(tu,[["render",nu]]);/*!
 * @he-tree/tree-utils v0.1.0-alpha.5
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: null
 * Released under the MIT License.
 */const Ye="children";function iu(e){const n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r={...au,...n,data:e,stats:null,statsFlat:null,_statsMap:null,initialized:!1,init(){const{data:i,childrenKey:a}=this,l=new dn([]);this._statsMap=new Map,_e(i,(o,c,d,h)=>{const f=this.statHandler({...ir(),data:o,open:!!this.defaultOpen,parent:l.getParent(h),children:[],level:h.length});this._statsMap.set(o,f),l.set(h,f)},{childrenKey:a});const u=[];l.walk(o=>{u.push(o)}),this.stats=this.statsHandler(l.rootChildren),this.statsFlat=this.statsFlatHandler(u),this.initialized=!0},getStat(i){let a=this._statsMap.get(i);if(!a)throw new ar("Stat not found");return a},has(i){if(i.isStat)return this.statsFlat.indexOf(i)>-1;try{return!!this.getStat(i)}catch(a){if(a instanceof ar)return!1;throw a}},_getPathByStat(i){if(i==null)return[];const l=this.getSiblings(i).indexOf(i);return[...i.parent?this._getPathByStat(i.parent):[],l]},afterOneCheckChanged(i){const{checked:a}=i;if(i._ignoreCheckedOnce)return delete i._ignoreCheckedOnce,!1;const l=u=>{const{parent:o}=u;if(o){let c,d,h;for(const v of o.children)v.checked?c=!0:v.checked===0?h=!0:d=!0;const f=h?0:d?c?0:!1:!0;o.checked!==f&&(this._ignoreCheckedOnce(o),o.checked=f),l(o)}};return l(i),_e(i.children,u=>{u.checked!==a&&(this._ignoreCheckedOnce(u),u.checked=a)},{childrenKey:Ye}),!0},_ignoreCheckedOnce(i){i._ignoreCheckedOnce=!0,setTimeout(()=>{i._ignoreCheckedOnce&&(i._ignoreCheckedOnce=!1)},100)},isVisible(i){const a=i.isStat?i:this.getStat(i),l=u=>!u||!u.hidden&&u.open&&l(u.parent);return!!(!a.hidden&&l(a.parent))},updateCheck(){_e(this.stats,i=>{if(i.children&&i.children.length>0){const a=i.children.every(l=>l.checked);i.checked!==a&&(this._ignoreCheckedOnce(i),i.checked=a)}},{childFirst:!0,childrenKey:Ye})},getChecked(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return this.statsFlat.filter(a=>a.checked||i&&a.checked===0)},getUnchecked(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this.statsFlat.filter(a=>i?!a.checked:a.checked===!1)},openAll(){for(const i of this.statsFlat)i.open=!0},closeAll(){for(const i of this.statsFlat)i.open=!1},openNodeAndParents(i){const a=i.isStat?i:this.getStat(i);for(const l of this.iterateParent(a,{withSelf:!0}))l.open=!0},_calcFlatIndex(i,a){let l=i?this.statsFlat.indexOf(i)+1:0;const u=i?i.children:this.stats;for(let o=0;o<a;o++)l+=this._count(u[o]);return l},add(i,a,l){if(this.has(i))throw"Can't add because data exists in tree";const u=a?a.children:this.stats;l==null&&(l=u.length);const o=this.statHandler({...ir(),open:!!this.defaultOpen,data:i,parent:a||null,children:[],level:a?a.level+1:1});this._setPosition(o,a||null,l);const c=i[this.childrenKey];if(c){const d=c.slice();for(const h of d)this.add(h,o)}},remove(i){const a=this.getSiblings(i);if(a.includes(i)){Hr(a,i);const l=this._flat(i);this.statsFlat.splice(this.statsFlat.indexOf(i),l.length);for(const u of l)this._statsMap.delete(u.data);return this.afterRemoveStat(i),!0}return!1},getSiblings(i){const{parent:a}=i;return a?a.children:this.stats},_setPosition(i,a,l){(a?a.children:this.stats).splice(l,0,i),i.parent=a,i.level=a?a.level+1:1;const o=this._calcFlatIndex(a,l),c=this._flat(i);this.statsFlat.splice(o,0,...c);for(const d of c)this._statsMap.has(d.data)||this._statsMap.set(d.data,d);_e(i,(d,h,f)=>{f&&(d.level=f.level+1)},{childrenKey:Ye}),this.afterSetStat(i,a,l)},*iterateParent(i,a){let l=a!=null&&a.withSelf?i:i.parent;for(;l;)yield l,l=l.parent},move(i,a,l){if(this.has(i)){if(i.parent===a&&this.getSiblings(i).indexOf(i)===l)return!1;if(i===a)throw new Error("Can't move node to it self");if(a&&i.level<a.level){let u;for(const o of this.iterateParent(a))if(o.level===i.level){u=o;break}if(i===u)throw new Error("Can't move node to its descendant")}this.remove(i)}return this._setPosition(i,a,l),!0},_flat(i){const a=[];return _e(i,l=>{a.push(l)},{childrenKey:Ye}),a},_count(i){return this._flat(i).length},getData(i,a){const{childrenKey:l}=this,u=new dn([]);return u.childrenKey=l,_e(a||this.stats,(o,c,d,h)=>{let f={...o.data,[l]:[]};i&&(f=i(f)),u.set(h,f)},{childrenKey:Ye}),u.data}},s=r;return r.noInitialization||s.init(),s}const au={childrenKey:"children",defaultOpen:!1,statsHandler(e){return e},statsFlatHandler(e){return e},afterSetStat(e,t,n){},afterRemoveStat(e){},statHandler(e){return e}};function ir(){return{isStat:!0,hidden:!1,checked:!1,style:null,class:null,draggable:null,droppable:null}}class ar extends Error{constructor(t){super(t),this.name="StatNotFoundError"}}/*!
 * drag-event-service v2.0.0
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: null
 * Released under the MIT License.
 */const _t={start:["mousedown","touchstart"],move:["mousemove","touchmove"],end:["mouseup","touchend"]},Gt={isTouch(e){return e.type&&e.type.startsWith("touch")},_getStore(e){return e._wrapperStore||(e._wrapperStore=[]),e._wrapperStore},on(e,t,n,r){const{args:s,mouseArgs:i,touchArgs:a}=sr(r),l=this._getStore(e),u=this,o=function(c){let d;if(u.isTouch(c))d={x:c.changedTouches[0].pageX,y:c.changedTouches[0].pageY,pageX:c.changedTouches[0].pageX,pageY:c.changedTouches[0].pageY,clientX:c.changedTouches[0].clientX,clientY:c.changedTouches[0].clientY,screenX:c.changedTouches[0].screenX,screenY:c.changedTouches[0].screenY};else if(d={x:c.pageX,y:c.pageY,pageX:c.pageX,pageY:c.pageY,clientX:c.clientX,clientY:c.clientY,screenX:c.screenX,screenY:c.screenY},t==="start"&&c.which!==1)return;return n.call(this,c,d)};l.push({handler:n,wrapper:o}),Oe.call(null,e,_t[t][0],o,...s,...i),Oe.call(null,e,_t[t][1],o,...s,...a)},off(e,t,n,r){const{args:s,mouseArgs:i}=sr(r),a=this._getStore(e);for(let l=a.length-1;l>=0;l--){const{handler:u,wrapper:o}=a[l];n===u&&(Te.call(null,e,_t[t][0],o,...s,...i),Te.call(null,e,_t[t][1],o,...s,...i),a.splice(l,1))}}};function sr(e){e||(e={});const t=e.args||[],n=e.mouseArgs||[],r=e.touchArgs||[];return{args:t,mouseArgs:n,touchArgs:r}}/*!
 * @he-tree/dnd-utils v0.1.0-alpha.4
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: null
 * Released under the MIT License.
 */const Zt=new Map,ze={triggerElement:null,dragElement:null,internal:!1,dropEffect:"none",preventDefault:!1},be=ze;function vt(e){e.dataTransfer&&(e.dataTransfer.dropEffect=be.dropEffect)}function su(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Zt.has(e))throw"Already registered on specified element";const n={...t},r=n;Wr(n,lu),Gt.on(e,"start",s,{touchArgs:[{passive:!0}]}),Gt.on(e,"end",i);function s(d){var h;const f=d.target;f.nodeType===Node.ELEMENT_NODE&&(be.triggerElement=f);const v=f;if(n.ingoreHTMLTags&&v.tagName&&n.ingoreHTMLTags.find(A=>A.toUpperCase()===v.tagName))return;const C=(h=n.beforeDragStart)===null||h===void 0?void 0:h.call(n,d);C&&(C.setAttribute("draggable","true"),be.dragElement=C)}function i(d){be.dragElement&&be.dragElement.removeAttribute("draggable")}function a(d){var h;be.internal=!0,(h=n.onDragStart)===null||h===void 0||h.call(n,d),vt(d)}function l(d){var h;(h=n.onDrag)===null||h===void 0||h.call(n,d),vt(d)}function u(d){var h;(h=n.onDragEnd)===null||h===void 0||h.call(n,d),be.internal=!1,be.dragElement&&be.dragElement.removeAttribute("draggable"),be.triggerElement=null,be.dragElement=null,be.dropEffect="none"}const o=uu(e,{onDragLeave(d){var h;(h=n.onDragLeave)===null||h===void 0||h.call(n,d),vt(d)},onDragEnter(d){var h;r.ifPreventDefault(d)&&d.preventDefault(),(h=n.onDragEnter)===null||h===void 0||h.call(n,d),vt(d)},onDragOver(d){var h;r.ifPreventDefault(d)&&d.preventDefault(),(h=n.onDragOver)===null||h===void 0||h.call(n,d),vt(d)},onDrop(d){var h;r.ifPreventDefault(d)&&d.preventDefault(),(h=n.onDrop)===null||h===void 0||h.call(n,d)},onEnter(d){var h;(h=n.onEnter)===null||h===void 0||h.call(n,d)},onLeave(d){var h;(h=n.onLeave)===null||h===void 0||h.call(n,d)}});return Oe(e,"dragstart",a),Oe(e,"drag",l),Oe(e,"dragend",u),Object.assign(n,{root:e,destroy:()=>{Gt.off(e,"start",s,{touchArgs:[{passive:!0}]}),Te(e,"dragstart",a),Te(e,"drag",l),Te(e,"dragend",u),o(),Zt.delete(e)}}),Zt.set(e,r),r}const lu={ingoreHTMLTags:["INPUT","TEXTAREA","SELECT","OPTGROUP","OPTION"],ifPreventDefault(e){return ze.dragElement?!0:be.preventDefault},beforeDragStart(e){},onDragStart(e){},onDrag(e){},onDragEnter(e){},onDragLeave(e){},onDragOver(e){},onDragEnd(e){},onDrop(e){}};let jt=null;const ou=e=>{jt=e,setTimeout(()=>{jt=null},20)};function uu(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=e;let r=!1;const s=f=>{var v;r=!0,(v=t.onEnter)===null||v===void 0||v.call(t,f),c.resume()},i=f=>{var v;ou(f.target),(v=t.onDragEnter)===null||v===void 0||v.call(t,f),r||s(f)},a=f=>{var v;r||s(f),(v=t.onDragOver)===null||v===void 0||v.call(t,f)},l=f=>{var v;(v=t.onDragLeave)===null||v===void 0||v.call(t,f);const C=function(){var x;let z=arguments.length>0&&arguments[0]!==void 0?arguments[0]:f;r=!1,(x=t.onLeave)===null||x===void 0||x.call(t,z),c.stop()},A=jt;jt=null,A&&Wo(A,n)||C()},u=f=>{var v;(v=t.onDrop)===null||v===void 0||v.call(t,f)},o=f=>{var v;f instanceof KeyboardEvent&&f.key!=="Escape"||(r=!1,c.stop(),(v=t.onEndBeforeLeave)===null||v===void 0||v.call(t,f))},c=Jo([[e,"drop",o],[window,"mouseup",o],[window,"touchend",o],[window,"keydown",o]]);c.stop();const d=()=>{Oe(e,"dragenter",i),Oe(e,"dragover",a),Oe(e,"dragleave",l),Oe(e,"drop",u)},h=()=>{Te(e,"dragenter",i),Te(e,"dragover",a),Te(e,"dragleave",l),Te(e,"drop",u),c.stop()};return d(),h}/*!
 * @he-tree/vue v2.9.3
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: https://hetree.phphe.com/
 * Released under the MIT License.
 */let Ut=!1;const cu=()=>{Ut=!0,setTimeout(()=>{Ut=!1},100)},du=It({props:["stat","rtl","btt","indent","table","treeLine","treeLineOffset","processor"],emits:["open","close","check"],setup(e,{emit:t}){const n=xe(()=>({[e.rtl?"paddingRight":"paddingLeft"]:e.indent*(e.stat.level-1)+"px"}));rn(()=>e.stat.checked,i=>{Ut||e.processor.afterOneCheckChanged(e.stat)&&t("check",e.stat)}),rn(()=>e.stat.open,i=>{Ut||(t(i?"open":"close",e.stat),cu())});const r=xe(()=>{const i=[],a=c=>{var d;if(c.parent){let h=(d=c.parent)==null?void 0:d.children.indexOf(c);do{h++;let f=c.parent.children[h];if(f){if(!f.hidden)return!0}else break}while(!0)}return!1},l=e.rtl?"right":"left",u=e.btt?"top":"bottom";let o=e.stat;for(;o;){let c=(o.level-2)*e.indent+e.treeLineOffset;const d=a(o),h=()=>{i.push({style:{[l]:c+"px",[u]:d?0:"50%"}})};o===e.stat?o.level>1&&h():d&&h(),o=o.parent}return i}),s=xe(()=>{let i=(e.stat.level-2)*e.indent+e.treeLineOffset;return{[e.rtl?"right":"left"]:i+"px"}});return{indentStyle:n,vLines:r,hLineStyle:s}}}),Yr=(e,t)=>{const n=e.__vccOpts||e;for(const[r,s]of t)n[r]=s;return n},hu={class:"tree-node-inner"},fu={key:1,class:"tree-node",ref:"el"};function pu(e,t,n,r,s,i){return e.table?(k(),R("tr",fu,[he(e.$slots,"default",{indentStyle:e.indentStyle})],512)):(k(),R("div",{key:0,class:ce(["tree-node",{"tree-node--with-tree-line":e.treeLine}]),style:Ze(e.indentStyle),ref:"el"},[e.treeLine?(k(),R(oe,{key:0},[(k(!0),R(oe,null,$e(e.vLines,a=>(k(),R("div",{class:"tree-line tree-vline",style:Ze(a.style)},null,4))),256)),e.stat.level>1?(k(),R("div",{key:0,class:"tree-line tree-hline",style:Ze(e.hLineStyle)},null,4)):O("",!0)],64)):O("",!0),X("div",hu,[he(e.$slots,"default",{indentStyle:e.indentStyle})])],6))}const mu=Yr(du,[["render",pu]]);function gu(e,t={}){const n={...t,statHandler(r){return this._statHandler2&&(r=this._statHandler2(r)),en(t.statHandler,wt(r))},statsHandler(r){return en(t.statsHandler,wt(r))},statsFlatHandler(r){return en(t.statsFlatHandler,wt(r))}};return iu(e,n)}function en(e,t){return e?e(t):t}const yu=It({components:{VirtualList:ru,TreeNode:mu},props:{value:{required:Fo,type:Array},modelValue:{required:Vo,type:Array},updateBehavior:{type:String,default:"modify"},processor:{type:Object,default:()=>gu([],{noInitialization:!0})},childrenKey:{type:String,default:"children"},textKey:{type:String,default:"text"},indent:{type:Number,default:20},virtualization:{type:Boolean,default:!1},virtualizationPrerenderCount:{type:Number,default:20},defaultOpen:{type:Boolean,default:!0},statHandler:{type:Function},rtl:{type:Boolean,default:!1},btt:{type:Boolean,default:!1},table:{type:Boolean,default:!1},watermark:{type:Boolean,default:!1},nodeKey:{type:[String,Function],default:"index"},treeLine:{type:Boolean,default:!1},treeLineOffset:{type:Number,default:8}},emits:["update:modelValue","click:node","open:node","close:node","check:node","beforeDragStart","before-drag-start","after-drop","change","enter","leave"],data(){return{stats:[],statsFlat:[],dragNode:null,dragOvering:!1,placeholderData:{},placeholderColspan:1,batchUpdateWaiting:!1,self:this,_ignoreValueChangeOnce:!1}},computed:{valueComputed(){return this.modelValue||[]},visibleStats(){const{statsFlat:e,isVisible:t}=this;let n=e;return this.btt&&(n=n.slice(),n.reverse()),n.filter(r=>t(r))},rootChildren(){return this.stats}},methods:{_emitValue(e){this.$emit("update:modelValue",e)},_updateValue(e){return this.updateBehavior==="disabled"?!1:(e!==this.valueComputed&&(this._ignoreValueChangeOnce=!0),this._emitValue(e),!0)},getStat:tn(ke("getStat")),has:tn(ke("has")),updateCheck:ke("updateCheck"),getChecked:ke("getChecked"),getUnchecked:ke("getUnchecked"),openAll:ke("openAll"),closeAll:ke("closeAll"),openNodeAndParents:ke("openNodeAndParents"),isVisible:ke("isVisible"),move:lr("move"),add:tn(lr("add")),addMulti(e,t,n){this.batchUpdate(()=>{let r=n;for(const s of e)this.add(s,t,r),r!=null&&r++})},remove:ke("remove"),removeMulti(e){let t=[...e];this.batchUpdate(()=>{for(const n of t)this.remove(n)})},iterateParent:ke("iterateParent"),getSiblings:ke("getSiblings"),getData:ke("getData"),getRootEl(){return this.$refs.vtlist.listElRef},batchUpdate(e){const t=this.ignoreUpdate(e);return this.batchUpdateWaiting||this._updateValue(this.updateBehavior==="new"?this.getData():this.valueComputed),t},ignoreUpdate(e){const t=this.batchUpdateWaiting;this.batchUpdateWaiting=!0;const n=e();return this.batchUpdateWaiting=t,n}},watch:{processor:{immediate:!0,handler(e){if(e){const t=n=>{if(n){const{childrenKey:r}=this;return n[r]||(n[r]=[]),n[r]}else return this.valueComputed};e._statHandler2=this.statHandler?n=>n.data===this.placeholderData?n:this.statHandler(n):null,e.afterSetStat=(n,r,s)=>{const{childrenKey:i,updateBehavior:a}=this;let l=this.valueComputed;if(a==="new"){if(this.batchUpdateWaiting)return;l=this.getData()}else if(a==="modify"){const u=t(r==null?void 0:r.data);u.includes(n.data)||u.splice(s,0,n.data)}this.batchUpdateWaiting||this._updateValue(l)},e.afterRemoveStat=n=>{var r;const{childrenKey:s,updateBehavior:i}=this;let a=this.valueComputed;if(i==="new"){if(this.batchUpdateWaiting)return;a=this.getData()}else if(i==="modify"){const l=t((r=n.parent)==null?void 0:r.data);Hr(l,n.data)}this.batchUpdateWaiting||this._updateValue(a)}}e.initialized||(e.data=this.valueComputed,Object.assign(e,No(this,["childrenKey","defaultOpen"])),e.init(),e.updateCheck()),this.stats=e.stats,this.statsFlat=e.statsFlat,e.data!==this.valueComputed&&this._updateValue(e.data)}},valueComputed:{handler(e){if(this.dragOvering||this.dragNode||this._ignoreValueChangeOnce)this._ignoreValueChangeOnce=!1;else{const{processor:t}=this;t.data=e,t.init(),this.stats=t.stats,this.statsFlat=t.statsFlat}}}},created(){},mounted(){typeof window<"u"&&(this.watermark===!1&&(window._heTreeWatermarkDisabled=!0),this.watermark&&!window._heTreeWatermarkDisabled&&(window._heTreeWatermark||(window._heTreeWatermark=!0,console.log("%c[he-tree] Vue tree component:  https://hetree.phphe.com","color:#0075ff; font-size:14px;"))))}});function ke(e){return function(...t){return this.processor[e](...t)}}function lr(e){return function(...t){return this.batchUpdate(()=>this.processor[e](...t))}}function tn(e){return function(t,...n){return t&&(t=wt(t)),e.call(this,t,...n)}}const ku={key:0,class:"drag-placeholder he-tree-drag-placeholder"},vu=["colspan"],bu={class:"drag-placeholder he-tree-drag-placeholder"};function xu(e,t,n,r,s,i){const a=ee("TreeNode"),l=ee("VirtualList");return k(),E(l,{class:ce(["he-tree",{"he-tree--rtl rtl":e.rtl,"he-tree--drag-overing drag-overing":e.dragOvering}]),ref:"vtlist",items:e.visibleStats,disabled:!e.virtualization,table:e.table,itemKey:e.nodeKey},{prepend:m(()=>[he(e.$slots,"prepend",{tree:e.self})]),default:m(({item:u,index:o})=>[y(a,{"vt-index":o,class:ce([u.class,{"drag-placeholder-wrapper":u.data===e.placeholderData,"dragging-node":u===e.dragNode}]),style:Ze(u.style),stat:u,rtl:e.rtl,btt:e.btt,indent:e.indent,table:e.table,treeLine:e.treeLine,treeLineOffset:e.treeLineOffset,processor:e.processor,onClick:c=>e.$emit("click:node",u),onOpen:t[0]||(t[0]=c=>e.$emit("open:node",c)),onClose:t[1]||(t[1]=c=>e.$emit("close:node",c)),onCheck:t[2]||(t[2]=c=>e.$emit("check:node",c))},{default:m(({indentStyle:c})=>[u.data===e.placeholderData?(k(),R(oe,{key:0},[e.table?(k(),R("td",{key:1,style:Ze(c),colspan:e.placeholderColspan},[X("div",bu,[he(e.$slots,"placeholder",{tree:e.self})])],12,vu)):(k(),R("div",ku,[he(e.$slots,"placeholder",{tree:e.self})]))],64)):he(e.$slots,"default",{key:1,node:u.data,stat:u,indentStyle:c,tree:e.self},()=>[V(I(u.data[e.textKey]),1)])]),_:2},1032,["vt-index","class","style","stat","rtl","btt","indent","table","treeLine","treeLineOffset","processor","onClick"])]),append:m(()=>[he(e.$slots,"append",{tree:e.self})]),_:3},8,["class","items","disabled","table","itemKey"])}const wu=Yr(yu,[["render",xu]]);let j=null,F=null,At,xt,Qe,Dt,nn,ve,or;const bt={get startInfo(){return At},get targetInfo(){return xt}},Cu=It({extends:wu,props:{triggerClass:{type:[String,Array]},disableDrag:Boolean,disableDrop:Boolean,eachDraggable:{type:Function},eachDroppable:{type:Function},rootDroppable:{type:[Boolean,Function],default:!0},dragOpen:{type:Boolean,default:!0},dragOpenDelay:{type:Number,default:0},beforeDragOpen:{type:Function},resolveStartMovePoint:{type:[String,Function]},keepPlaceholder:{type:Boolean},maxLevel:{type:Number},dragCopy:{type:Boolean},dragCopyDataHandler:{type:Function},onExternalDragOver:{type:Function},externalDataHandler:{type:Function},ondragstart:{type:Function}},data(){return{treeDraggableInstance:null}},computed:{},methods:{getNodeByElement(e){const t=e.getAttribute("vt-index");return t==null?null:this.visibleStats[t]},isDraggable(e){if(this.disableDrag)return!1;if(e.draggable!=null)return e.draggable;if(this.eachDraggable){const n=this.eachDraggable(e);if(n!=null)return n}const{parent:t}=e;return t?this.isDraggable(t):!0},isDroppable(e){if(this.disableDrop)return!1;if(!e)return tr(this.rootDroppable,[this,j]);if(e.droppable!=null)return e.droppable;if(this.eachDroppable){const n=this.eachDroppable(e);if(n!=null)return n}const{parent:t}=e;return t?this.isDroppable(t):!0},_eachDroppable(){var e;return tr((e=this._isDragCopy)==null?void 0:e.call(this),[this])}},mounted(){const e=(o,c)=>{let d=!0;return j&&j!==this&&(d=d&&this._isMoved),this.table&&!this._isDragCopy&&(d=d&&this._isDragCopy),d&&(o.x!==c.x||o.y!==c.y)},t=(o,c)=>{F.ignoreUpdate(()=>{if(!F.has(F.placeholderData)){if(F.table){let h=0;const f=F.getRootEl().querySelector("tr");if(f)for(const{value:v}of jo(f.children))Nt(v,"display")!=="none"&&(h+=v.colSpan||1);h<1&&(h=1),F.placeholderColspan=h}F.add(F.placeholderData)}const d=F.getStat(F.placeholderData);F.move(d,o,c)})},n=()=>{const o=this;if(o.has(o.placeholderData))return o.remove(o.getStat(o.placeholderData)),!0},r=o=>{o?ze.dropEffect=j!=null&&j.dragCopy?"copy":"move":ze.dropEffect="none"},s=o=>{const c=this;o?r(!0):c.keepPlaceholder?c.has(c.placeholderData)||r(!1):(n(),r(!1))};let i={x:0,y:0};const a=this.getRootEl();let l=null;const u=()=>{F!=null&&F.has(F.placeholderData)&&F.ignoreUpdate(()=>{F.remove(F.getStat(F.placeholderData)),j&&(j.dragNode.hidden=!1,j.dragOvering=!1)})};this.treeDraggableInstance=su(a,{beforeDragStart:o=>{if(!ze.triggerElement)return;let c=this.triggerClass;(!c||c.length===0)&&(c="tree-node");let d=Bo(c),h=nr(ze.triggerElement,f=>{if(rr(f,d))return!0;if(Bt(f,"tree-node"))return"break"},{withSelf:!0,until:a});if(l=nr(h,f=>{if(Bt(f,"tree-node"))return!0},{withSelf:!0,until:a}),!!l){if(ve=this.getNodeByElement(l),!ve)throw"Can't find drag node";if(this.isDraggable(ve))return this.$emit("before-drag-start",ve),this.$emit("beforeDragStart",ve),a}},onDragStart:o=>{var c,d,h;if(!l||!ve)return;{const{x:C,y:A}=l.getBoundingClientRect(),{clientX:x,clientY:z}=o;(c=o.dataTransfer)==null||c.setDragImage(l,x-C,z-A)}nn={x:o.clientX,y:o.clientY},j=this,j.dragNode=ve,Dt=(()=>{if(this.resolveStartMovePoint==="mouse")return{x:o.clientX,y:o.clientY};if(typeof this.resolveStartMovePoint=="function")return this.resolveStartMovePoint(l);{let C,A=0;if(this.table){let x=l.getBoundingClientRect();C={x:x.x,y:x.y},this.rtl&&(C.x=x.right),A=x.height}else if(!this.rtl)C=l.children[0].getBoundingClientRect().toJSON(),A=C.height;else{const x=l.children[0].getBoundingClientRect();C={x:x.right,y:x.y},A=x.height}return this.btt&&(C.y+=A),C}})(),this.dragOvering=!0;const f=j.getSiblings(j.dragNode),v=f.indexOf(ve);At={tree:j,dragNode:ve,parent:ve.parent,siblings:f,indexBeforeDrop:v},F=this,(d=o.dataTransfer)==null||d.setData("text",`he-tree drag start at ${new Date().toISOString()}`),j._eachDroppable()||setTimeout(()=>{ve.hidden=!0,t(ve.parent,v+1)},0),(h=this.ondragstart)==null||h.call(this,o)},onEnter:o=>{this.$emit("enter",o)},onLeave:o=>{Qe=null,this.dragOvering=!1,ze.preventDefault=!1,n(),this.$emit("leave",o)},onDragOver:Ho(o=>{if(!j){if(!this.onExternalDragOver||this.onExternalDragOver(o)===!1)return;ze.preventDefault=!0}const c={x:o.clientX,y:o.clientY},d=e(c,i);if(i=c,!d)return;this.dragOvering=!0,F=this;const h=Dt?{x:Dt.x+(c.x-nn.x),y:Dt.y+(c.y-nn.y)}:{...c},{btt:f,rtl:v}=F;if(F.disableDrop){ze.dropEffect="none";return}let C,A;const x=F.getRootEl().querySelectorAll(".tree-node"),z=[];x.forEach(_=>{!rr(_,["drag-placeholder-wrapper","dragging-node"])&&Nt(_,"display")!=="none"&&z.push(_)});const T=hn(z,_=>Xt(_)[f?"bottom":"top"]-h.y,{returnNearestIfNoHit:!0});let N=null,J,w;T.hit||(T.greater?f||(N=T.index-1,z[N]||N++):f&&(N=T.index+1,z[N]||N--)),N==null&&(N=T.index),J=z[N],w=f?z[N-1]:z[N+1],C=J&&F.getNodeByElement(J),A=w&&F.getNodeByElement(w);const{indent:K}=F,Q=kt(()=>{if(F.table){let _=Xt(J).toJSON();const B=K*(C.level-1);return v?(_.width-=B,_.right-=B):_.x+=B,_}else return Xt(J.firstElementChild)}).action,Y=kt(()=>f?h.y>Q().y+Q().height/2:h.y<Q().y+Q().height/2).action,te=kt(()=>f?!J||N===z.length-1&&Y():!J||N===0&&Y()).action,L=kt(()=>v?h.x-(Q().x+Q().width):Q().x-h.x).action,S=kt(()=>v?h.x<Q().x+Q().width-K:h.x>Q().x+K).action;let P;if(te())P=1,C=null;else if(C)L()>0?P=C.level-Math.ceil(L()/K):S()?P=C.level+1:P=C.level;else return;A&&P<A.level&&(P=A.level),(async()=>{let _,B,ne=!1,G=null;const ue=async H=>{if(H.open)return!0;if(F.dragOpen)if(F.dragOpenDelay)if(G=H,Qe===H)ne=!0;else{let p=Ko();Qe=H;const re=H;return setTimeout(async()=>{re!==Qe?(ne=!0,p.resolve(!0)):(F.beforeDragOpen&&await F.beforeDragOpen(H),re!==Qe?(ne=!0,p.resolve(!0)):(H.open=!0,G=null,p.resolve(!0)))},F.dragOpenDelay),await p.promise}else return F.beforeDragOpen&&await F.beforeDragOpen(H),H.open=!0,!0;else return!1},pe=async()=>{if(F.isDroppable(C)&&await ue(C)){if(ne)return;_=C,B=null}else return!1},g=(H=P)=>{let p=C,re=[];for(;p&&p.level>=H;)p=p.parent||null,re.unshift(p);let de=0;for(const se of re){if(F.isDroppable(se))return _=se,B=re[de+1]||C,!0;de++}return!1};or=C||null,C?P>C.level?await pe()===!1&&g(C.level):g()===!1&&await pe():F.isDroppable(null)&&(_=null),Qe=G;const fe=!!(!ne&&(_||_===null));return{cancelled:ne,success:fe,parent:_,index:fe?B?(_?_.children:F.stats).filter(H=>H.data!==F.placeholderData).indexOf(B)+1:0:-1}})().then(_=>{if(!_.cancelled){if(!_.success){s(!1);return}if(F.maxLevel!=null&&F.maxLevel>0){let B=1;if(j){const ne=j.dragNode;let G=0;_e(ne,ue=>{ue.level>G&&(G=ue.level)},{childrenKey:Ye}),B=G-ne.level+1}if(B+(_.parent?_.parent.level:0)>F.maxLevel){s(!1);return}}s(!0),t(_.parent,_.index)}})}),onDrop:o=>{F=this;const c=!j;if(!F)return;const d=j==null?void 0:j.dragNode;let h,f=(()=>{var v;let C=!0;if(!F.has(F.placeholderData))C=!1;else if(c)h=(v=this.externalDataHandler)==null?void 0:v.call(this,o),C=h!=null;else if(!j.dragCopy){const A=F.getStat(F.placeholderData);j===F&&A.parent===d.parent&&qo(d,x=>x===A)}return C})();if(f){const v=F.getStat(F.placeholderData),C=F.getSiblings(v);xt={tree:F,dragNode:d,parent:v.parent,siblings:C,indexBeforeDrop:C.indexOf(v)}}(()=>{if(u(),f){let v=xt.indexBeforeDrop;j&&!j.dragCopy&&j===F&&At.parent==xt.parent&&At.indexBeforeDrop<v&&v--,j&&j!==F&&!j._eachDroppable()&&j.batchUpdate(()=>{j.remove(d),j.updateCheck()}),F.batchUpdate(()=>{let C=j==null?void 0:j.dragNode,A;h?A=h:j._eachDroppable()&&(A=Jr(j.dragNode.data,{childrenKey:j.childrenKey}),j.dragCopyDataHandler&&(A=j.dragCopyDataHandler(A))),A&&(F.add(A),C=F.getStat(A)),F.move(C,xt.parent,v),F.updateCheck()})}F.$emit("after-drop"),f&&(j&&(j.dragCopy||j.$emit("change")),F!==j&&F.$emit("change"))})()},onDragEnd:o=>{u(),j&&(j.dragNode&&(j.dragNode.hidden=!1),j.dragNode=null,j.dragOvering=!1,j=null),F=null,Qe=null,ve=null,or=null}})},unmounted(){var e;(e=this.treeDraggableInstance)==null||e.destroy()}}),Su={components:{Draggable:Cu},props:{embed:{type:Boolean,default:!1},filter:{type:Object,default:()=>({})}},emits:["select"],inject:["debounce"],data(){return{clip:null,menu:{},items:[],loading:!0,checked:!1,isChecked:!1,term:""}},setup(){const e=vn(),t=it(),n=qe();return{app:bn(),auth:n,languages:e,messages:t}},created(){this.searchd=this.debounce(this.search,500),this.fetch().then(e=>{this.items=e.data,this.loading=!1})},computed:{canTrash(){var e;return this.isChecked&&((e=this.$refs.tree)==null?void 0:e.statsFlat.some(t=>t.checked&&!t.data.deleted_at))},isTrashed(){var e;return this.isChecked&&((e=this.$refs.tree)==null?void 0:e.statsFlat.some(t=>t.checked&&t.data.deleted_at))}},methods:{add(){if(this.embed||!this.auth.can("page:add")){this.messages.add(this.$gettext("Permission denied"),"error");return}const e=this.create();this.$apollo.mutate({mutation:le`mutation ($input: PageInput!) {
            addPage(input: $input) {
              id
            }
          }`,variables:{input:e}}).then(t=>{if(t.errors)throw t.errors;e.id=t.data.addPage.id,e.published=!0,this.$refs.tree.add(e),this.$emit("select",e)}).catch(t=>{this.messages.add(this.$gettext("Error adding root page"),"error"),this.$log("PageList::add(): Error adding root page",t)})},change(){if(!this.auth.can("page:move")){this.messages.add(this.$gettext("Permission denied"),"error");return}const e=bt.targetInfo.parent,n=bt.targetInfo.siblings[bt.targetInfo.indexBeforeDrop+1]||null;this.$apollo.mutate({mutation:le`mutation ($id: ID!, $parent: ID, $ref: ID) {
            movePage(id: $id, parent: $parent, ref: $ref) {
              id
            }
          }`,variables:{id:bt.startInfo.dragNode.data.id,parent:e?e.data.id:null,ref:n?n.data.id:null}}).then(r=>{if(r.errors)throw r.errors;const s=bt.startInfo.parent;s!=null&&s.data&&!(s!=null&&s.children.length)&&(s.data.has=!1),e&&(e.data.has=!0)}).catch(r=>{this.messages.add(this.$gettext("Error moving page"),"error"),this.$log("PageList::change(): Error moving page",r)})},copy(e,t){this.clip={type:"copy",node:t,stat:e}},create(e={}){return Object.assign({path:"_"+Math.floor(Math.random()*1e4),lang:this.languages.current||this.languages.default(),status:0,cache:5},e)},cut(e,t){this.$refs.tree.statsFlat.forEach(n=>{delete n.cut}),e.cut=!0,this.clip={type:"cut",node:t,stat:e}},drop(e){if(!this.auth.can("page:drop")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.$refs.tree.statsFlat.filter(n=>{var r;return n.checked&&((r=n.data)==null?void 0:r.id)});t.length&&this.$apollo.mutate({mutation:le`mutation ($id: [ID!]!) {
            dropPage(id: $id) {
              id
            }
          }`,variables:{id:t.map(n=>n.data.id)}}).then(n=>{if(n.errors)throw n.errors;for(const r of t)this.update(r,s=>{s.data.deleted_at=new Date().toISOString().replace(/T/," ").substring(0,19),s.check=!1});this.invalidate()}).catch(n=>{this.messages.add(this.$gettext("Error trashing page"),"error"),this.$log("PageList::drop(): Error trashing page",t,n)})},fetch(e=null,t=1,n=100){if(!this.auth.can("page:view"))return this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve([]);const r=this.filter.publish||null,s=this.filter.trashed||"WITHOUT",i={...this.filter};return delete i.trashed,delete i.publish,delete i.view,i.parent_id=e,this.$apollo.query({query:le`query($filter: PageFilter, $limit: Int!, $page: Int!, $trashed: Trashed, $publish: Publish) {
            pages(filter: $filter, first: $limit, page: $page, trashed: $trashed, publish: $publish) {
              data {
                ${this.fields()}
              }
              paginatorInfo {
                currentPage
                lastPage
              }
            }
          }`,variables:{filter:i,page:t,limit:n,trashed:s,publish:r}}).then(a=>{if(a.errors)throw a.errors;return this.transform(a.data.pages)}).catch(a=>{this.messages.add(this.$gettext("Error fetching pages"),"error"),this.$log("PageList::fetch(): Error fetching page",e,t,n,a)})},fields(){return`id
          parent_id
          lang
          path
          domain
          name
          title
          to
          tag
          type
          theme
          status
          cache
          editor
          updated_at
          deleted_at
          has
          latest {
            id
            published
            publish_at
            data
            editor
            created_at
          }`},insert(e,t=null){if(!this.auth.can("page:add")){this.messages.add(this.$gettext("Permission denied"),"error");return}const n=this.$refs.tree.getSiblings(e),r=t!==null?e.parent:e,s=n.indexOf(e),i=this.create();let a=null;switch(t===null&&!e.open&&this.load(e,e.data),t){case 0:a=e.data.id;break;case null:a=e.children&&e.children[0]?e.children[0].data.id:null;break;case 1:a=n[s+1]?n[s+1].data.id:null;break}this.$apollo.mutate({mutation:le`mutation ($input: PageInput!, $parent: ID, $ref: ID) {
            addPage(input: $input, parent: $parent, ref: $ref) {
              id
            }
          }`,variables:{input:i,parent:r?r.data.id:null,ref:a}}).then(l=>{if(l.errors)throw l.errors;i.id=l.data.addPage.id,(t!==null||e.open)&&this.$refs.tree.add(i,r,t!==null?s+t:0),r&&(r.data.has=!0),this.invalidate()}).catch(l=>{this.messages.add(this.$gettext("Error inserting page"),"error"),this.$log("PageList::insert(): Error inserting page",l)})},invalidate(){const e=this.$apollo.provider.defaultClient.cache;e.evict({id:"ROOT_QUERY",fieldName:"pages"}),e.gc()},keep(e){if(!this.auth.can("page:keep")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.$refs.tree.statsFlat.filter(s=>s.checked&&s.data.id&&s.data.deleted_at),n=t.filter(s=>t.indexOf(s.parent)===-1),r=e.data.deleted_at||null;n.length&&this.$apollo.mutate({mutation:le`mutation ($id: [ID!]!) {
            keepPage(id: $id) {
              id
            }
          }`,variables:{id:n.map(s=>s.data.id)}}).then(s=>{if(s.errors)throw s.errors;for(const i of n)this.update(i,a=>{r>=a.data.deleted_at&&(a.data.deleted_at=null,a.check=!1)});this.invalidate()}).catch(s=>{this.messages.add(this.$gettext("Error restoring page"),"error"),this.$log("PageList::keep(): Error restoring page",n,s)})},load(e,t){!e.open&&!t.children&&(e.loading=!0,this.fetch(t.id,e.page?e.page+1:1).then(n=>{this.$refs.tree.addMulti(n.data,e,0),e.page=n.currentPage||1}).finally(()=>{e.loading=!1})),e.open=!e.open},move(e,t=null){if(!this.auth.can("page:move")){this.messages.add(this.$gettext("Permission denied"),"error");return}const n=this.$refs.tree.getSiblings(e),r=t!==null?e.parent:e,s=n.indexOf(e);let i=null;switch(t){case 0:i=e.data.id;break;case null:i=e.children&&e.children[0]?e.children[0].data.id:null;break;case 1:i=n[s+1]?n[s+1].data.id:null;break}this.$apollo.mutate({mutation:le`mutation ($id: ID!, $parent: ID, $ref: ID) {
            movePage(id: $id, parent: $parent, ref: $ref) {
              id
            }
          }`,variables:{id:this.clip.node.id,parent:r?r.data.id:null,ref:i}}).then(a=>{var u;if(a.errors)throw a.errors;const l=t!==null?s<this.$refs.tree.getSiblings(e).indexOf(this.clip.stat)?s+t:s:0;this.$refs.tree.move(this.clip.stat,r,l),r&&((u=this.clip.stat.children)!=null&&u.length||(e.parent.data.has=!1),r.data.has=!0),this.invalidate()}).catch(a=>{this.messages.add(this.$gettext("Error moving page"),"error"),this.$log("PageList::move(): Error moving page",e,t,a)}),this.show()},paste(e,t=null){if(!this.auth.can("page:add")){this.messages.add(this.$gettext("Permission denied"),"error");return}const n=this.$refs.tree.getSiblings(e),r=t!==null?e.parent:e,s=n.indexOf(e),i={...this.clip.node};let a=null;switch(t){case 0:a=e.data.id;break;case null:a=e.children&&e.children[0]?e.children[0].data.id:null;break;case 1:a=n[s+1]?n[s+1].data.id:null;break}return this.$apollo.query({query:le`query($id: ID!) {
            page(id: $id) {
              meta
              config
              content
              files {
                id
              }
              elements {
                id
              }
            }
          }`,variables:{id:i.id}}).then(l=>{var u,o,c,d,h,f,v,C,A,x;if(l.errors)throw l.errors;this.$apollo.mutate({mutation:le`mutation ($input: PageInput!, $parent: ID, $ref: ID, $elements: [ID!], $files: [ID!]) {
              addPage(input: $input, parent: $parent, ref: $ref, elements: $elements, files: $files) {
                ${this.fields()}
              }
            }`,variables:{input:{status:0,to:i.to,tag:i.tag,type:i.type,theme:i.theme,lang:i.lang,name:i.name,title:i.title,cache:i.cache,domain:i.domain,related_id:i.id,meta:((o=(u=l==null?void 0:l.data)==null?void 0:u.page)==null?void 0:o.meta)||"{}",config:((d=(c=l==null?void 0:l.data)==null?void 0:c.page)==null?void 0:d.config)||"{}",content:((f=(h=l==null?void 0:l.data)==null?void 0:h.page)==null?void 0:f.content)||"[]",path:i.path+"_"+Math.floor(Math.random()*1e4)},parent:r?r.data.id:null,ref:a,elements:((C=(v=l==null?void 0:l.data)==null?void 0:v.page)==null?void 0:C.elements.map(z=>z.id))||[],files:((x=(A=l==null?void 0:l.data)==null?void 0:A.page)==null?void 0:x.files.map(z=>z.id))||[]}}).then(z=>{if(z.errors)throw z.errors;if(!z.data.addPage)throw new Error("No page data returned");const T=t!==null?this.$refs.tree.getSiblings(e).indexOf(e)+t:0,N=z.data.addPage;this.$refs.tree.add(N,r,T),this.invalidate()}).catch(z=>{this.messages.add(this.$gettext("Error copying page"),"error"),this.$log("PageList::paste(): Error copying page",e,t,z)})}).catch(l=>{this.messages.add(this.$gettext("Error fetching page"),"error"),this.$log("PageList::paste(): Error fetching page",i.id,l)})},publish(e){if(!this.auth.can("page:publish")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.$refs.tree.statsFlat.filter(n=>n.checked&&n.data.id&&!n.data.published);t.length&&this.$apollo.mutate({mutation:le`mutation ($id: [ID!]!) {
            pubPage(id: $id) {
              id
            }
          }`,variables:{id:t.map(n=>n.data.id)}}).then(n=>{if(n.errors)throw n.errors;for(const r of t)r.data.published=!0,r.check=!1;this.invalidate()}).catch(n=>{this.messages.add(this.$gettext("Error publishing page"),"error"),this.$log("PageList::publish(): Error publishing page",t,n)})},purge(e){if(!this.auth.can("page:purge")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.$refs.tree.statsFlat.filter(n=>n.checked&&n.data.id);t.length&&this.$apollo.mutate({mutation:le`mutation ($id: [ID!]!) {
            purgePage(id: $id) {
              id
            }
          }`,variables:{id:t.map(n=>n.data.id).reverse()}}).then(n=>{var r;if(n.errors)throw n.errors;for(const s of t)this.$refs.tree.remove(s),s.parent&&!((r=s.parent.children)!=null&&r.length)&&(s.parent.data.has=!1)}).catch(n=>{this.messages.add(this.$gettext("Error purging page"),"error"),this.$log("PageList::purge(): Error purging page",t,n)})},reload(e=!0){if(this.items=[],this.loading=!0,e){const n=this.$apollo.provider.defaultClient.cache;n.evict({id:"ROOT_QUERY",fieldName:"pages"}),n.gc()}(this.filter.view==="list"?this.search():this.fetch()).then(n=>{this.items=n.data,this.loading=!1})},search(e=1,t=100){if(!this.auth.can("page:view"))return this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve([]);const n=this.filter.publish||null,r=this.filter.trashed||"WITHOUT",s={...this.filter};return delete s.trashed,delete s.publish,delete s.view,this.term&&(s.any=this.term),this.$apollo.query({query:le`query($filter: PageFilter, $limit: Int!, $page: Int!, $trashed: Trashed, $publish: Publish) {
            pages(filter: $filter, first: $limit, page: $page, trashed: $trashed, publish: $publish) {
              data {
                ${this.fields()}
              }
              paginatorInfo {
                currentPage
                lastPage
              }
            }
          }`,variables:{filter:s,page:e,limit:t,trashed:r,publish:n}}).then(i=>{if(i.errors)throw i.errors;return this.transform(i.data.pages)}).catch(i=>{this.messages.add(this.$gettext("Error searching pages"),"error"),this.$log("PageList::search(): Error searching pages",e,t,i)})},show(e=null){e===null?this.menu={}:this.menu[e]?this.menu[e]=!1:(this.menu={},this.menu[e]=!0)},status(e,t){if(!this.auth.can("page:save")){this.messages.add(this.$gettext("Permission denied"),"error");return}(e?[e]:this.$refs.tree.statsFlat.filter(r=>r.checked&&r.data.id)).forEach(r=>{this.$apollo.mutate({mutation:le`mutation ($id: ID!, $input: PageInput!) {
              savePage(id: $id, input: $input) {
                id
              }
            }`,variables:{id:r.data.id,input:{status:t}}}).then(s=>{if(s.errors)throw s.errors;r.data.status=t}).catch(s=>{this.messages.add(this.$gettext("Error saving page"),"error"),this.$log("PageList::status(): Error saving page",r,t,s)})})},title(e){const t=[];return e.publish_at&&t.push("Publish at: "+new Date(e.publish_at).toLocaleDateString()),e.theme&&t.push("Theme: "+e.theme),e.type&&t.push("Page type: "+e.type),e.tag&&t.push("Tag: "+e.tag),e.cache&&t.push("Cache: "+e.cache+" min"),t.join(`
`)},toggle(){this.$refs.tree.statsFlat.forEach(e=>{e.checked=!e.checked})},transform(e){return{data:e.data.map(n=>{var s,i,a,l,u;const r=(s=n.latest)!=null&&s.data?JSON.parse(n.latest.data):{...n};return Object.assign(r,{id:n.id,has:n.has,parent_id:n.parent_id,deleted_at:n.deleted_at,created_at:n.created_at,updated_at:((i=n.latest)==null?void 0:i.created_at)||n.updated_at,editor:((a=n.latest)==null?void 0:a.editor)||n.editor,published:((l=n.latest)==null?void 0:l.published)??!0,publish_at:((u=n.latest)==null?void 0:u.publish_at)||null,latest:n.latest})}),currentPage:e.paginatorInfo.currentPage,lastPage:e.paginatorInfo.lastPage}},update(e,t){var n;if(typeof t!="function")throw new Error("Second paramter must be a function");t(e),(n=e.children)==null||n.forEach(r=>{t(r,t)})},updateChecked(e){var t;e?this.isChecked=!0:this.isChecked=(t=this.$refs.tree)==null?void 0:t.statsFlat.some(n=>n.checked)},url(e){return this.app.urlpage.replace(/:domain/,e.domain||"").replace(/:path/,e.path||"").replace(/\/+$/,"")}},watch:{filter:{deep:!0,handler(e){this.items=[],this.loading=!0,(e.view==="list"?this.search():this.fetch()).then(n=>{this.items=n.data,this.loading=!1})}},term:{handler(){this.reload(!1)}}}},Eu={class:"header"},Iu={class:"bulk"},$u={class:"search"},Pu={key:0,class:"spinner",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},_u=["title"],Du=["onClick"],Ou={class:"item-head"},Tu={key:1,class:"item-lang"},Au={class:"item-title"},Fu={key:0,class:"item-subtitle"},Vu=["href"],Lu={class:"item-domain"},zu={class:"item-path item-subtitle"},Bu={key:0,class:"item-to item-subtitle"},Nu={key:0,class:"loading"},ju={key:1,class:"notfound"},Uu={key:2,class:"btn-group"};function Mu(e,t,n,r,s,i){const a=ee("Draggable");return k(),R(oe,null,[X("div",Eu,[X("div",Iu,[y(Ft,{modelValue:s.checked,"onUpdate:modelValue":t[0]||(t[0]=l=>s.checked=l),onClick:t[1]||(t[1]=Ue(l=>i.toggle(),["stop"]))},null,8,["modelValue"]),y(dt,{location:"bottom left"},{activator:m(({props:l})=>[y(D,tt({"append-icon":"mdi-menu-down",variant:"text"},l,{disabled:!s.isChecked}),{default:m(()=>[V(I(e.$gettext("Actions")),1)]),_:2},1040,["disabled"])]),default:m(()=>[y(ct,null,{default:m(()=>[s.isChecked&&r.auth.can("page:publish")?(k(),E(M,{key:0},{default:m(()=>[y(D,{"prepend-icon":"mdi-publish",variant:"text",onClick:t[2]||(t[2]=l=>i.publish())},{default:m(()=>[V(I(e.$gettext("Publish")),1)]),_:1})]),_:1})):O("",!0),s.isChecked&&r.auth.can("page:save")?(k(),E(M,{key:1},{default:m(()=>[y(D,{"prepend-icon":"mdi-eye",variant:"text",onClick:t[3]||(t[3]=l=>i.status(null,1))},{default:m(()=>[V(I(e.$gettext("Enable")),1)]),_:1})]),_:1})):O("",!0),s.isChecked&&r.auth.can("page:save")?(k(),E(M,{key:2},{default:m(()=>[y(D,{"prepend-icon":"mdi-eye-off",variant:"text",onClick:t[4]||(t[4]=l=>i.status(null,0))},{default:m(()=>[V(I(e.$gettext("Disable")),1)]),_:1})]),_:1})):O("",!0),y(Ge),i.canTrash&&r.auth.can("page:drop")?(k(),E(M,{key:3},{default:m(()=>[y(D,{"prepend-icon":"mdi-delete",variant:"text",onClick:t[5]||(t[5]=l=>i.drop())},{default:m(()=>[V(I(e.$gettext("Trash")),1)]),_:1})]),_:1})):O("",!0),i.isTrashed&&r.auth.can("page:keep")?(k(),E(M,{key:4},{default:m(()=>[y(D,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:t[6]||(t[6]=l=>i.keep())},{default:m(()=>[V(I(e.$gettext("Restore")),1)]),_:1})]),_:1})):O("",!0),s.isChecked&&r.auth.can("page:purge")?(k(),E(M,{key:5},{default:m(()=>[y(D,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:t[7]||(t[7]=l=>i.purge())},{default:m(()=>[V(I(e.$gettext("Purge")),1)]),_:1})]),_:1})):O("",!0)]),_:1})]),_:1})]),X("div",$u,[y(je,{modelValue:s.term,"onUpdate:modelValue":t[8]||(t[8]=l=>s.term=l),label:e.$gettext("Search for"),"prepend-inner-icon":"mdi-magnify",variant:"underlined","hide-details":"",clearable:""},null,8,["modelValue","label"])]),y(D,{onClick:t[9]||(t[9]=l=>i.reload()),title:e.$gettext("Reload page tree"),icon:"mdi-refresh",variant:"flat",class:"no-rtl"},null,8,["title"])]),y(a,{ref:"tree",modelValue:s.items,"onUpdate:modelValue":t[13]||(t[13]=l=>s.items=l),onChange:t[14]||(t[14]=l=>i.change()),"onCheck:node":t[15]||(t[15]=l=>i.updateChecked(l.checked)),defaultOpen:!1,disableDrag:!r.auth.can("page:move"),rtl:e.$vuetify.locale.isRtl,watermark:!1,virtualization:""},{default:m(({node:l,stat:u})=>[u.loading?(k(),R("svg",Pu,t[17]||(t[17]=[X("circle",{class:"spin1",cx:"4",cy:"12",r:"3"},null,-1),X("circle",{class:"spin1 spin2",cx:"12",cy:"12",r:"3"},null,-1),X("circle",{class:"spin1 spin3",cx:"20",cy:"12",r:"3"},null,-1)]))):(k(),E(D,{key:1,onClick:o=>i.load(u,l),class:ce({hidden:!l.has}),icon:u.open?"mdi-menu-down":"mdi-menu-right",title:e.$gettext("Toggle child nodes"),variant:"flat"},null,8,["onClick","class","icon","title"])),y(Ft,{modelValue:u.checked,"onUpdate:modelValue":o=>u.checked=o,class:ce({draft:!l.published})},null,8,["modelValue","onUpdate:modelValue","class"]),l.id?(k(),E(dt,{key:2},{activator:m(({props:o})=>[y(D,tt(o,{title:e.$gettext("Actions"),icon:"mdi-dots-vertical",variant:"text"}),null,16,["title"])]),default:m(()=>[y(ct,null,{default:m(()=>[!l.deleted_at&&!l.published&&r.auth.can("page:publish")?(k(),E(M,{key:0},{default:m(()=>[y(D,{"prepend-icon":"mdi-publish",variant:"text",onClick:o=>i.publish(u)},{default:m(()=>[V(I(e.$gettext("Publish")),1)]),_:2},1032,["onClick"])]),_:2},1024)):O("",!0),l.status!==0&&r.auth.can("page:save")?(k(),E(M,{key:1},{default:m(()=>[y(D,{"prepend-icon":"mdi-eye-off",variant:"text",onClick:o=>i.status(u,0)},{default:m(()=>[V(I(e.$gettext("Disable")),1)]),_:2},1032,["onClick"])]),_:2},1024)):O("",!0),l.status!==1&&r.auth.can("page:save")?(k(),E(M,{key:2},{default:m(()=>[y(D,{"prepend-icon":"mdi-eye",variant:"text",onClick:o=>i.status(u,1)},{default:m(()=>[V(I(e.$gettext("Enable")),1)]),_:2},1032,["onClick"])]),_:2},1024)):O("",!0),l.status!==2&&r.auth.can("page:save")?(k(),E(M,{key:3},{default:m(()=>[y(D,{"prepend-icon":"mdi-eye-off-outline",variant:"text",onClick:o=>i.status(u,2)},{default:m(()=>[V(I(e.$gettext("Hide in menu")),1)]),_:2},1032,["onClick"])]),_:2},1024)):O("",!0),y(Ge),r.auth.can("page:move")?(k(),E(M,{key:4},{default:m(()=>[y(D,{"prepend-icon":"mdi-content-cut",variant:"text",onClick:o=>i.cut(u,l)},{default:m(()=>[V(I(e.$gettext("Cut")),1)]),_:2},1032,["onClick"])]),_:2},1024)):O("",!0),!this.embed&&r.auth.can("page:add")?(k(),E(M,{key:5},{default:m(()=>[y(D,{"prepend-icon":"mdi-content-copy",variant:"text",onClick:o=>i.copy(u,l)},{default:m(()=>[V(I(e.$gettext("Copy")),1)]),_:2},1032,["onClick"])]),_:2},1024)):O("",!0),s.clip&&s.clip.type=="copy"&&!this.embed&&r.auth.can("page:add")?(k(),E(M,{key:6},{default:m(()=>[y(D,{"prepend-icon":"mdi-content-paste",variant:"text",onClick:t[10]||(t[10]=Ue(o=>i.show("paste"),["stop"]))},{default:m(()=>[V(I(e.$gettext("Paste")),1)]),_:1})]),_:1})):O("",!0),s.clip&&s.clip.type=="copy"&&s.menu.paste&&!this.embed&&r.auth.can("page:add")?(k(),E(Le,{key:7},{default:m(()=>[y(M,null,{default:m(()=>[y(D,{"prepend-icon":"mdi-arrow-up",variant:"text",onClick:o=>i.paste(u,0),class:"subitem"},{default:m(()=>[V(I(e.$gettext("Before")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):O("",!0),s.clip&&s.clip.type=="copy"&&s.menu.paste&&!this.embed&&r.auth.can("page:add")?(k(),E(Le,{key:8},{default:m(()=>[y(M,null,{default:m(()=>[y(D,{"prepend-icon":"mdi-arrow-right",variant:"text",onClick:o=>i.paste(u),class:"subitem"},{default:m(()=>[V(I(e.$gettext("Into")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):O("",!0),s.clip&&s.clip.type=="copy"&&s.menu.paste&&!this.embed&&r.auth.can("page:add")?(k(),E(Le,{key:9},{default:m(()=>[y(M,null,{default:m(()=>[y(D,{"prepend-icon":"mdi-arrow-down",variant:"text",onClick:o=>i.paste(u,1),class:"subitem"},{default:m(()=>[V(I(e.$gettext("After")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):O("",!0),s.clip&&s.clip.type=="cut"&&r.auth.can("page:move")?(k(),E(M,{key:10},{default:m(()=>[y(D,{"prepend-icon":"mdi-content-paste",variant:"text",onClick:t[11]||(t[11]=Ue(o=>i.show("move"),["stop"]))},{default:m(()=>[V(I(e.$gettext("Paste")),1)]),_:1})]),_:1})):O("",!0),s.clip&&s.clip.type=="cut"&&s.menu.move&&r.auth.can("page:move")?(k(),E(Le,{key:11},{default:m(()=>[y(M,null,{default:m(()=>[y(D,{"prepend-icon":"mdi-arrow-up",variant:"text",onClick:o=>i.move(u,0),class:"subitem"},{default:m(()=>[V(I(e.$gettext("Before")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):O("",!0),s.clip&&s.clip.type=="cut"&&s.menu.move&&r.auth.can("page:move")?(k(),E(Le,{key:12},{default:m(()=>[y(M,null,{default:m(()=>[y(D,{"prepend-icon":"mdi-arrow-right",variant:"text",onClick:o=>i.move(u),class:"subitem"},{default:m(()=>[V(I(e.$gettext("Into")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):O("",!0),s.clip&&s.clip.type=="cut"&&s.menu.move&&r.auth.can("page:move")?(k(),E(Le,{key:13},{default:m(()=>[y(M,null,{default:m(()=>[y(D,{"prepend-icon":"mdi-arrow-down",variant:"text",onClick:o=>i.move(u,1),class:"subitem"},{default:m(()=>[V(I(e.$gettext("After")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):O("",!0),!this.embed&&r.auth.can("page:add")?(k(),E(M,{key:14},{default:m(()=>[y(D,{"prepend-icon":"mdi-content-paste",variant:"text",onClick:t[12]||(t[12]=Ue(o=>i.show("insert"),["stop"]))},{default:m(()=>[V(I(e.$gettext("Insert")),1)]),_:1})]),_:1})):O("",!0),s.menu.insert&&!this.embed&&r.auth.can("page:add")?(k(),E(Le,{key:15},{default:m(()=>[y(M,null,{default:m(()=>[y(D,{"prepend-icon":"mdi-arrow-up",variant:"text",onClick:o=>i.insert(u,0),class:"subitem"},{default:m(()=>[V(I(e.$gettext("Before")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):O("",!0),s.menu.insert&&!this.embed&&r.auth.can("page:add")?(k(),E(Le,{key:16},{default:m(()=>[y(M,null,{default:m(()=>[y(D,{"prepend-icon":"mdi-arrow-right",variant:"text",onClick:o=>i.insert(u),class:"subitem"},{default:m(()=>[V(I(e.$gettext("Into")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):O("",!0),s.menu.insert&&!this.embed&&r.auth.can("page:add")?(k(),E(Le,{key:17},{default:m(()=>[y(M,null,{default:m(()=>[y(D,{"prepend-icon":"mdi-arrow-down",variant:"text",onClick:o=>i.insert(u,1),class:"subitem"},{default:m(()=>[V(I(e.$gettext("After")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):O("",!0),y(Ge),!l.deleted_at&&r.auth.can("page:drop")?(k(),E(M,{key:18},{default:m(()=>[y(D,{"prepend-icon":"mdi-delete",variant:"text",onClick:o=>i.drop(u)},{default:m(()=>[V(I(e.$gettext("Trash")),1)]),_:2},1032,["onClick"])]),_:2},1024)):O("",!0),l.deleted_at&&r.auth.can("page:keep")?(k(),E(M,{key:19},{default:m(()=>[y(D,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:o=>i.keep(u)},{default:m(()=>[V(I(e.$gettext("Restore")),1)]),_:2},1032,["onClick"])]),_:2},1024)):O("",!0),r.auth.can("page:purge")?(k(),E(M,{key:20},{default:m(()=>[y(D,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:o=>i.purge(u)},{default:m(()=>[V(I(e.$gettext("Purge")),1)]),_:2},1032,["onClick"])]),_:2},1024)):O("",!0)]),_:2},1024)]),_:2},1024)):O("",!0),X("div",{class:ce(["item-content",{"status-hidden":l.status==2,"status-enabled":l.status==1,"status-disabled":!l.status,trashed:l.deleted_at,cut:u.cut}]),title:i.title(l)},[X("div",{class:"item-text",onClick:o=>e.$emit("select",l)},[X("div",Ou,[l.publish_at?(k(),E(hr,{key:0,class:"publish-at",icon:"mdi-clock-outline"})):O("",!0),l.lang?(k(),R("span",Tu,I(l.lang),1)):O("",!0),X("span",Au,I(l.name||e.$gettext("New")),1)]),l.title?(k(),R("div",Fu,I(l.title),1)):O("",!0)],8,Du),X("a",{class:"item-aux",href:i.url(l),target:"_blank",draggable:"false"},[X("div",Lu,I(l.domain),1),X("span",zu,I(i.url(l)),1),l.to?(k(),R("span",Bu," ➔ "+I(l.to),1)):O("",!0)],8,Vu)],10,_u)]),_:1},8,["modelValue","disableDrag","rtl"]),s.loading?(k(),R("p",Nu,[V(I(e.$gettext("Loading"))+" ",1),t[18]||(t[18]=X("svg",{class:"spinner",width:"32",height:"32",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[X("circle",{class:"spin1",cx:"4",cy:"12",r:"3"}),X("circle",{class:"spin1 spin2",cx:"12",cy:"12",r:"3"}),X("circle",{class:"spin1 spin3",cx:"20",cy:"12",r:"3"})],-1))])):O("",!0),!s.loading&&!s.items.length?(k(),R("p",ju,I(e.$gettext("No entries found")),1)):O("",!0),!s.loading&&!s.items.length&&!this.embed&&this.auth.can("page:add")?(k(),R("div",Uu,[y(D,{onClick:t[16]||(t[16]=l=>i.add()),title:e.$gettext("Add page"),icon:"mdi-folder-plus",color:"primary",variant:"flat"},null,8,["title"])])):O("",!0)],64)}const Ru=we(Su,[["render",Mu]]),qu={components:{PageListItems:Ru,PageDetail:Zn,Navigation:ki,AsideList:yi,User:gi},inject:["locales","openView"],data:()=>({chat:"",sending:!1,sendicon:"mdi-send",filter:{view:"tree",trashed:"WITHOUT",publish:null,status:null,editor:null,cache:null,lang:null}}),setup(){const e=it(),t=fn();return{auth:qe(),drawer:t,messages:e}},methods:{languages(){const e=[{title:this.$gettext("All"),icon:"mdi-playlist-check",value:{lang:null}}];for(const t of this.locales())e.push({title:t.title,icon:"mdi-translate",value:{lang:t.value}});return e},open(e){this.openView(Zn,{item:e})},send(){const e=this.chat.trim();this.chat&&(this.sending=!0,this.sendicon="mdi-power-off",this.$apollo.mutate({mutation:le`mutation($prompt: String!) {
            manage(prompt: $prompt)
          }`,variables:{prompt:e}}).then(t=>{var i,a;if(t.errors)throw t;this.chat=((i=t.data)==null?void 0:i.manage)||"",this.sendicon="mdi-check";const n={view:"list",publish:"DRAFT",trashed:"WITHOUT",editor:(a=this.auth.me)==null?void 0:a.email,cache:null,lang:null,status:0},r=Object.keys(n),s=Object.keys(this.filter);r.length===s.length&&r.every(l=>n[l]===this.filter[l])?this.$refs.pagelist.reload():this.filter=n,setTimeout(()=>{this.sendicon="mdi-send"},3e3)}).catch(t=>{this.messages.add("Error sending manage request","error"),this.$log("PageList::send(): Error sending manage request",t)}).finally(()=>{this.sending=!1}))}}};function Hu(e,t,n,r,s,i){var c;const a=ee("User"),l=ee("Navigation"),u=ee("PageListItems"),o=ee("AsideList");return k(),R(oe,null,[y(fr,{elevation:0,density:"compact"},{prepend:m(()=>[y(D,{onClick:t[0]||(t[0]=d=>r.drawer.toggle("nav")),title:r.drawer.nav?e.$gettext("Close navigation"):e.$gettext("Open navigation"),icon:r.drawer.nav?"mdi-close":"mdi-menu"},null,8,["title","icon"])]),append:m(()=>[y(a),y(D,{onClick:t[1]||(t[1]=d=>r.drawer.toggle("aside")),title:e.$gettext("Toggle side menu"),icon:r.drawer.aside?"mdi-chevron-right":"mdi-chevron-left"},null,8,["title","icon"])]),default:m(()=>[y(mr,null,{default:m(()=>[V(I(e.$gettext("Pages")),1)]),_:1})]),_:1}),y(l),y(pr,{class:"page-list"},{default:m(()=>[y(ht,null,{default:m(()=>[y(rt,{class:"box"},{default:m(()=>[y(mi,{modelValue:e.chat,"onUpdate:modelValue":t[2]||(t[2]=d=>e.chat=d),loading:e.sending,"append-icon":e.sendicon,placeholder:e.$gettext("What kind of page and content should I create?"),"onClick:append":t[3]||(t[3]=d=>e.sending||i.send()),variant:"outlined",rounded:"pill","hide-details":"",autofocus:"","auto-grow":"",outlined:"",rows:"1"},null,8,["modelValue","loading","append-icon","placeholder"])]),_:1}),y(rt,{class:"box"},{default:m(()=>[y(u,{ref:"pagelist",onSelect:t[4]||(t[4]=d=>i.open(d)),filter:e.filter},null,8,["filter"])]),_:1})]),_:1})]),_:1}),y(o,{filter:e.filter,"onUpdate:filter":t[5]||(t[5]=d=>e.filter=d),content:[{key:"view",title:e.$gettext("view"),items:[{title:e.$gettext("Tree"),icon:"mdi-file-tree",value:{view:"tree"}},{title:e.$gettext("List"),icon:"mdi-format-list-bulleted-square",value:{view:"list"}}]},{key:"publish",title:e.$gettext("publish"),items:[{title:e.$gettext("All"),icon:"mdi-playlist-check",value:{publish:null}},{title:e.$gettext("Published"),icon:"mdi-publish",value:{publish:"PUBLISHED"}},{title:e.$gettext("Scheduled"),icon:"mdi-clock-outline",value:{publish:"SCHEDULED"}},{title:e.$gettext("Drafts"),icon:"mdi-pencil",value:{publish:"DRAFT"}}]},{key:"trashed",title:e.$gettext("trashed"),items:[{title:e.$gettext("All"),icon:"mdi-playlist-check",value:{trashed:"WITH"}},{title:e.$gettext("Available only"),icon:"mdi-delete-off",value:{trashed:"WITHOUT"}},{title:e.$gettext("Only trashed"),icon:"mdi-delete",value:{trashed:"ONLY"}}]},{key:"status",title:e.$gettext("status"),items:[{title:e.$gettext("All"),icon:"mdi-playlist-check",value:{status:null}},{title:e.$gettext("Enabled"),icon:"mdi-eye-outline",value:{status:1}},{title:e.$gettext("Hidden"),icon:"mdi-eye-remove-outline",value:{status:2}},{title:e.$gettext("Disabled"),icon:"mdi-eye-off-outline",value:{status:0}}]},{key:"cache",title:e.$gettext("cache"),items:[{title:e.$gettext("All"),icon:"mdi-playlist-check",value:{cache:null}},{title:e.$gettext("No cache"),icon:"mdi-clock-alert-outline",value:{cache:0}}]},{key:"editor",title:e.$gettext("editor"),items:[{title:e.$gettext("All"),icon:"mdi-playlist-check",value:{editor:null}},{title:e.$gettext("Edited by me"),icon:"mdi-account",value:{editor:(c=this.auth.me)==null?void 0:c.email}}]},{key:"lang",title:e.$gettext("languages"),items:i.languages()}]},null,8,["filter","content"])],64)}const Gu=we(qu,[["render",Hu],["__scopeId","data-v-322abc71"]]);export{Gu as default};
