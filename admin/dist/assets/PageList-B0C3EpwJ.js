var mt=Object.defineProperty;var vt=(e,t,n)=>t in e?mt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var ge=(e,t,n)=>vt(e,typeof t!="symbol"?t+"":t,n);import{ar as Ce,r as ae,c as L,o as k,a as f,w as g,F as ue,a5 as je,bj as B,bk as oe,R as ve,y as Y,bf as we,U as We,au as yt,b9 as Be,f as E,b as A,n as de,l as P,t as x,d as _,_ as lt,L as U,aD as bt,a7 as ot,a3 as dt,a4 as kt,aM as $t,aO as qe,h as fe,I as wt,k as D,i as pe,j as I,az as Ct,m as Je,aF as me,aJ as xt,aK as Dt,a6 as St,aI as _t,aL as Et,aA as Ot,aB as Pt,a1 as Lt,ay as Tt}from"./index-C2tWXbj5.js";import{U as It,A as At,N as Nt}from"./Navigation-BnuPUKXj.js";import{P as Ze}from"./PageDetail-BISojbOB.js";import"./ElementListItems-XF3X6cdX.js";import"./vue-draggable-plus-Dyts9QEO.js";var Ft=!1,Vt=!0;/*!
 * helper-js v3.1.6
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: null
 * Released under the MIT License.
 */function Te(e){return Object.prototype.toString.call(e)==="[object Array]"}function Ge(e){return Object.prototype.toString.call(e)==="[object Object]"}function Bt(e){return typeof e=="function"}function Ht(e,t){return e<t?e:t}function ut(e,t){let n,i=0;for(;(n=e.indexOf(t))>-1;)e.splice(n,1),i++;return i}function ct(e){return e[e.length-1]}function Kt(e){return Te(e)?e:[e]}function Ut(e,t){let n=new Set(t);const i={};return n.forEach(s=>{i[s]=e[s]}),i}function Mt(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(function*(){if(t.reverse)if(e.length!=null)for(let n=e.length-1;n>=0;n--){const i={value:e[n],index:n};(!t.exclude||!t.exclude(i))&&(yield i)}else if(Ge(e)){const n=Object.keys(e);n.reverse();for(const i of n){const s={value:e[i],key:i};(!t.exclude||!t.exclude(s))&&(yield s)}}else throw"Unsupported type";else if(e.length!=null)for(let n=0;n<e.length;n++){const i={value:e[n],index:n};(!t.exclude||!t.exclude(i))&&(yield i)}else if(Ge(e))for(const n of Object.keys(e)){const i={value:e[n],key:n};(!t.exclude||!t.exclude(i))&&(yield i)}else throw"Unsupported type"})()}function zt(e,t,n){e.hasOwnProperty(t)||(e[t]=n)}function ht(e,t){return Object.keys(t).forEach(n=>{zt(e,n,t[n])}),e}function Rt(e){const t={};return Object.keys(e).forEach(n=>{e[n]!==void 0&&(t[n]=e[n])}),t}function J(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};n=ht({...n},{childrenKey:"children"});const{childrenKey:i}=n,s=Te(e)?e:[e];class a{}const l=(r,d,o)=>{n.reverse&&(r=r.slice(),r.reverse());const u=r.length;for(let h=0;h<u;h++){const c=r[h],p=n.reverse?u-h-1:h,v=o?[...o,p]:[];n.childFirst&&c[i]!=null&&l(c[i],c,v);const $=t(c,p,d,v);if($===!1)throw new a;if($==="skip children")continue;if($==="skip siblings")break;n.childFirst||c[i]!=null&&l(c[i],c,v)}};try{l(s,null,Te(e)?[]:null)}catch(r){if(!(r instanceof a))throw r}}function jt(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i;return J(e,function(){if(t(...arguments))return i={node:arguments.length<=0?void 0:arguments[0],index:arguments.length<=1?void 0:arguments[1],parent:arguments.length<=2?void 0:arguments[2],path:arguments.length<=3?void 0:arguments[3]},!1},n),i}function Wt(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=jt(e,t,n);return i==null?void 0:i.node}function gt(e,t){const n={childrenKey:"children"};t&&Object.assign(n,t);const{childrenKey:i,nodeHandler:s}=n,a=new Ye;return a.childrenKey=i,J(e,(l,r,d,o)=>{let u=Object.assign({},l);u[i]&&(u[i]=[]),s&&(u=s(u,{oldNode:l,index:r,parent:d,path:o})),a.set(o,u)},{childrenKey:i}),a.data}class Ye{constructor(){ge(this,"data");ge(this,"childrenKey","children");let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this.data=t}get rootChildren(){const{childrenKey:t}=this,{data:n}=this;return Te(n)?n:n[t]}iteratePath(t){var n=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(function*(){const{childrenKey:s,rootChildren:a}=n;if(i.reverse){const l=[...n.iteratePath(t,{...i,reverse:!1})];l.reverse();for(const{path:r,node:d}of l)yield{path:r,node:d}}else{let l=[],r=a;for(const d of t){const o=[...l,d],u=r[d];yield{path:o,node:u},l=o,r=u[s]}}})()}getFamily(t){const n=[];for(const{node:i}of this.iteratePath(t))n.push(i);return n}get(t){return ct(this.getFamily(t))}getParentAndIndex(t){const n=t.slice(),i=n.pop();return{parent:this.get(n),index:i,parentPath:n}}getParent(t){return this.getParentAndIndex(t).parent}set(t,n){if(t==null||t.length===0)this.data=n;else{const{childrenKey:i}=this;let{rootChildren:s}=this;const{parent:a,index:l}=this.getParentAndIndex(t);let r;t.length===1?(s||(this.data?this.data[i]=[]:this.data=[]),r=s):(a[i]||(a[i]=[]),r=a[i]),r[l]=n}}delete(t){const{childrenKey:n,rootChildren:i}=this,{parent:s,index:a}=this.getParentAndIndex(t),l=t.length===1?i:s[n],r=l[a];return l.splice(a,1),r}walk(t,n){const{childrenKey:i,data:s}=this;return J(s,t,i,n)}clone(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return gt(this.data),Rt({childrenKey:this.childrenKey,nodeHandler:t.nodeHandler||void 0})}}function Qe(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return Bt(e)?e(...t):e}function Yt(e,t){return function(){let i,s;try{i=e(...arguments)}catch(a){s=a}finally{}if(s)throw s;return i}}function ye(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=[];let i;const s={};let a=s;return{action:function(){for(var d=arguments.length,o=new Array(d),u=0;u<d;u++)o[u]=arguments[u];if(o.length===0)return a===s&&(a=e()),a;if(i||(i=new Zt),!i.has(o)&&(i.set(o,e(...o)),t.capacity!=null)){n.push(o);const h=n.splice(0,n.length-t.capacity);for(const c of h)i.delete(c)}return i.get(o)},clearCache:()=>{i=null,n.splice(0,n.length)}}}function Xt(){let e,t;return{promise:new Promise((i,s)=>{e=i,t=s}),resolve:e,reject:t}}function qt(e,t){for(;;){if(e.parentNode==null)return!1;if(e.parentNode===t)return!0;e=e.parentNode}}function He(e){let t=e.getBoundingClientRect();if(document.documentElement.clientTop>0){const n=t.top-document.documentElement.clientTop,i=t.bottom,s=t.left-document.documentElement.clientLeft,a=t.right,l=t.width||a-s,r=t.height||i-n,u={top:n,right:a,bottom:i,left:s,width:l,height:r,x:s,y:n};t={...u,toJSON:()=>u}}return t}function et(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=n&&n.withSelf?e:e.parentElement;for(;i;){const s=n.until&&i===n.until;if(s&&!n.withUntil)return;const a=t(i);if(a==="break")return;if(a)return i;if(s)return;i=i.parentElement}}function Ie(e,t){return e.classList?e.classList.contains(t):new RegExp("(^| )"+t+"( |$)","gi").test(e.className)}function tt(e,t){for(const n of t)if(Ie(e,n))return!0;return!1}function Z(e,t,n,i){e.addEventListener?e.addEventListener(t,n,i):e.attachEvent&&e.attachEvent(`on${t}`,n,i)}function G(e,t,n,i){e.removeEventListener?e.removeEventListener(t,n,i):e.detachEvent&&e.detachEvent(`on${t}`,n,i)}function Jt(e){let t=[];const n=()=>{if(!s.listening){for(const a of e){Z.apply(this,a);const l=()=>G.apply(this,a);t.push(l)}s.listening=!0}},s={listening:!1,stop:()=>{if(s.listening){for(const a of t)a();t=[],s.listening=!1}},resume:n,start:n};return s.start(),s}function Ae(e,t){return getComputedStyle(e)[t]}function Xe(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};n={start:0,end:e.length-1,maxTimes:1e3,...n};let{start:i,end:s}=n;const{returnNearestIfNoHit:a,maxTimes:l}=n;let r,d;i==null&&(i=0,s=e.length-1);let o=0,u;for(;i>=0&&i<=s;){if(o>=l)throw Error(`binarySearch: loop times is over ${l}, you can increase the limit.`);r=Math.floor((s-i)/2+i),d=e[r];const h=o+1;if(u=t(d,r,h),u>0)s=r-1;else if(u<0)i=r+1;else return{index:r,value:d,count:h,hit:!0};o++}return a?{index:r,value:d,count:o+1,hit:!1,greater:u>0}:null}class Zt{constructor(){ge(this,"_map",new Map);ge(this,"_values",{});ge(this,"_objCount",0)}_keysToString(t){const{_map:n}=this;let i=[];for(const s of t){if(!n.has(s))return null;i.push(n.get(s)[0])}return i.toString()}has(t){return this._keysToString(t)!=null}get(t){const{_values:n}=this,i=this._keysToString(t);if(i==null)throw"Value not found by specified keys";return n[i][1]}set(t,n){const{_map:i,_values:s}=this;let a=[];for(const l of t){let r,d=1;i.has(l)?([r,d]=i.get(l),d++):(this._objCount++,r=this._objCount.toString()),i.set(l,[r,d]),a.push(r)}s[a.toString()]=[t.slice(),n]}delete(t){const{_values:n,_map:i}=this,s=this._keysToString(t);if(s==null)throw"Value not found by specified keys";delete n[s];for(const a of t){let[l,r]=i.get(a);r--,r===0?i.delete(a):i.set(a,[l,r])}}clear(){this._map.clear(),this._values={}}*entries(){const{_values:t}=this;for(const n in t){const[i,s]=t[n];yield[i,s]}}count(){return[...this.entries()].length}}/*!
 * @virtual-list/vue
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: https://virtual-list.phphe.com
 * Released under the MIT License.
 */const Gt=Ce({props:{table:Boolean}}),ft=(e,t)=>{const n=e.__vccOpts||e;for(const[i,s]of t)n[i]=s;return n},Qt={key:0},en={key:1};function tn(e,t,n,i,s,a){return e.table?(k(),L("table",Qt,[B(e.$slots,"prepend"),E("tbody",null,[B(e.$slots,"default")]),B(e.$slots,"append")])):(k(),L("div",en,[B(e.$slots,"prepend"),B(e.$slots,"default"),B(e.$slots,"append")]))}const nn=ft(Gt,[["render",tn]]),an=Ce({components:{VirtualListTable:nn},props:{items:Array,disabled:Boolean,horizontal:Boolean,firstRender:{type:Number,default:10},buffer:{type:Number,default:100},itemKey:{type:[String,Function]},itemSize:{type:Function},table:Boolean},setup(e){const t=ve(0),n=ve(e.firstRender-1),i=Y(()=>{var C;return Ht(n.value,(((C=e.items)==null?void 0:C.length)||1)-1)}),s=ve(0),a=Y(()=>c.value[t.value]?he(t.value):0),l=Y(()=>c.value.length>0?he(c.value.length-1)+ct(h.value):0),r=Y(()=>c.value[i.value]?l.value-he(i.value)-h.value[i.value]:0),d=Y(()=>e.disabled?{}:{overflow:"auto"}),o=Y(()=>{const C={display:"flex"};return e.disabled||(e.horizontal?Object.assign(C,{"margin-left":a.value+"px","margin-right":r.value+"px",width:l.value-r.value-a.value+"px"}):Object.assign(C,{"margin-top":a.value+"px","margin-bottom":r.value+"px"})),C["flex-direction"]=e.horizontal?"row":"column",e.table&&(delete C.display,delete C["flex-direction"]),C}),u=Y(()=>we((e.items||[]).map(()=>null))),h=Y(()=>(e.items||[]).map((C,b)=>{var y;if(u[b]!=null)return u[b];let V=(y=e.itemSize)==null?void 0:y.call(e,C,b);return V==null&&(V=s.value),V})),c=Y(()=>{const C=[];return h.value.reduce((b,y)=>(C.push(b),b+y),0),C});We(()=>e.items,N);const p=Y(()=>{if(!e.items||e.disabled)return;const C=[];for(let b=t.value;b<=i.value;b++){const y=e.items[b];if(!y)break;C.push({item:y,index:b})}return C}),v=ve(),$=ve();yt(async()=>{N();try{Ve()}catch{await Be(),N()}});let S;function F(){const C=v.value;if(!C)return;const b=ne(C);S!=null&&e.buffer-Math.abs(b-S)>=10||(S=b,N())}let H=!1,Q=!1;async function N(){var C;if(H){Q=!0;return}if(!e.items||e.disabled)return;H=!0;const b=v.value,y=(C=$.value)==null?void 0:C.$el;if(!b||!y)return;s.value||(s.value=_e()),t.value=De(),n.value=Se(),await Be();let V,X=0;const z={},ie=e.table?y.querySelector("tbody").children:y.children;for(let O=0;O<ie.length;O++){const T=ie[O],K=Ae(T,"position");if(K&&["absolute","fixed"].includes(K))continue;const ee=Ae(T,"display")!=="none"?ce(T):0,re=T.getAttribute("vt-index"),Ee=re?parseInt(re):t.value+X;z[Ee]=(z[Ee]||0)+ee,X++}for(const O of Object.keys(z)){const T=parseInt(O);u.value[T]!==z[T]&&(u.value[T]=z[T],V=!0)}V&&await Be(),H=!1,Q&&(Q=!1,N());function De(){const O=ne(b)-M(b)-e.buffer;return Xe(c.value,T=>T-O,{returnNearestIfNoHit:!0}).index}function Se(){const O=ne(b)-M(b)+q(b)+e.buffer;return Xe(c.value,T=>T-O,{returnNearestIfNoHit:!0}).index}function _e(){const O=[],T=e.table?y.querySelector("tbody").children:y.children;for(let K=0;K<T.length;K++){const ee=T[K],re=getComputedStyle(ee);if(["absolute","fixed"].includes(re.position))continue;const Ee=ce(ee);if(O.push(Ee),O.length>=10)break}return O.length===0?0:O.reduce((K,ee)=>K+ee,0)/O.length}}function q(C){const b=getComputedStyle(C);let y=parseFloat(e.horizontal?b.width:b.height);return b.boxSizing==="border-box"&&(e.horizontal?y=y-parseFloat(b.borderLeftWidth)-parseFloat(b.borderRightWidth):y=y-parseFloat(b.borderTopWidth)-parseFloat(b.borderBottomWidth)),y}function ce(C){let b=q(C);const y=getComputedStyle(C);return e.horizontal?b+=parseFloat(y.borderLeftWidth)+parseFloat(y.borderRightWidth)+parseFloat(y.marginLeft)+parseFloat(y.marginRight):b+=parseFloat(y.borderTopWidth)+parseFloat(y.borderBottomWidth)+parseFloat(y.marginTop)+parseFloat(y.marginBottom),b=Number.isNaN(b)?0:b,b}function ne(C){return e.horizontal?C.scrollLeft:C.scrollTop}function M(C){const b=getComputedStyle(C);return e.horizontal?parseFloat(b.paddingLeft):parseFloat(b.paddingTop)}function he(C){return c.value[C]}function Ve(){const C=v.value;new ResizeObserver(b=>{for(let y of b)if(Ie(y.target,"vtlist")){N();break}}).observe(C)}function xe(C,b){if(e.itemKey){if(typeof e.itemKey=="string"&&e.itemKey==="index")return b;if(typeof e.itemKey=="function")return e.itemKey(C,b)}}return{listElRef:v,listInnerRef:$,onscroll:F,listStyle:d,listInnerStyle:o,visibleItemsInfo:p,getItemKey:xe,update:N,sizes:h,positions:c,runtimeSizes:u}}});function rn(e,t,n,i,s,a){const l=ae("VirtualListTable");return k(),L("div",{class:"vtlist",ref:"listElRef",style:oe(e.listStyle),onScrollPassive:t[0]||(t[0]=(...r)=>e.onscroll&&e.onscroll(...r))},[f(l,{class:"vtlist-inner",ref:"listInnerRef",style:oe(e.listInnerStyle),table:e.table},{prepend:g(()=>[B(e.$slots,"prepend")]),append:g(()=>[B(e.$slots,"append")]),default:g(()=>[e.disabled?(k(!0),L(ue,{key:0},je(e.items,(r,d)=>B(e.$slots,"default",{key:e.getItemKey(r,d),item:r,index:d})),128)):(k(!0),L(ue,{key:1},je(e.visibleItemsInfo,({item:r,index:d})=>B(e.$slots,"default",{key:e.getItemKey(r,d),item:r,index:d})),128))]),_:3},8,["style","table"])],36)}const sn=ft(an,[["render",rn]]);/*!
 * @he-tree/tree-utils v0.1.0-alpha.5
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: null
 * Released under the MIT License.
 */const le="children";function ln(e){const n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i={...on,...n,data:e,stats:null,statsFlat:null,_statsMap:null,initialized:!1,init(){const{data:a,childrenKey:l}=this,r=new Ye([]);this._statsMap=new Map,J(a,(o,u,h,c)=>{const p=this.statHandler({...nt(),data:o,open:!!this.defaultOpen,parent:r.getParent(c),children:[],level:c.length});this._statsMap.set(o,p),r.set(c,p)},{childrenKey:l});const d=[];r.walk(o=>{d.push(o)}),this.stats=this.statsHandler(r.rootChildren),this.statsFlat=this.statsFlatHandler(d),this.initialized=!0},getStat(a){let l=this._statsMap.get(a);if(!l)throw new at("Stat not found");return l},has(a){if(a.isStat)return this.statsFlat.indexOf(a)>-1;try{return!!this.getStat(a)}catch(l){if(l instanceof at)return!1;throw l}},_getPathByStat(a){if(a==null)return[];const r=this.getSiblings(a).indexOf(a);return[...a.parent?this._getPathByStat(a.parent):[],r]},afterOneCheckChanged(a){const{checked:l}=a;if(a._ignoreCheckedOnce)return delete a._ignoreCheckedOnce,!1;const r=d=>{const{parent:o}=d;if(o){let u,h,c;for(const v of o.children)v.checked?u=!0:v.checked===0?c=!0:h=!0;const p=c?0:h?u?0:!1:!0;o.checked!==p&&(this._ignoreCheckedOnce(o),o.checked=p),r(o)}};return r(a),J(a.children,d=>{d.checked!==l&&(this._ignoreCheckedOnce(d),d.checked=l)},{childrenKey:le}),!0},_ignoreCheckedOnce(a){a._ignoreCheckedOnce=!0,setTimeout(()=>{a._ignoreCheckedOnce&&(a._ignoreCheckedOnce=!1)},100)},isVisible(a){const l=a.isStat?a:this.getStat(a),r=d=>!d||!d.hidden&&d.open&&r(d.parent);return!!(!l.hidden&&r(l.parent))},updateCheck(){J(this.stats,a=>{if(a.children&&a.children.length>0){const l=a.children.every(r=>r.checked);a.checked!==l&&(this._ignoreCheckedOnce(a),a.checked=l)}},{childFirst:!0,childrenKey:le})},getChecked(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return this.statsFlat.filter(l=>l.checked||a&&l.checked===0)},getUnchecked(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this.statsFlat.filter(l=>a?!l.checked:l.checked===!1)},openAll(){for(const a of this.statsFlat)a.open=!0},closeAll(){for(const a of this.statsFlat)a.open=!1},openNodeAndParents(a){const l=a.isStat?a:this.getStat(a);for(const r of this.iterateParent(l,{withSelf:!0}))r.open=!0},_calcFlatIndex(a,l){let r=a?this.statsFlat.indexOf(a)+1:0;const d=a?a.children:this.stats;for(let o=0;o<l;o++)r+=this._count(d[o]);return r},add(a,l,r){if(this.has(a))throw"Can't add because data exists in tree";const d=l?l.children:this.stats;r==null&&(r=d.length);const o=this.statHandler({...nt(),open:!!this.defaultOpen,data:a,parent:l||null,children:[],level:l?l.level+1:1});this._setPosition(o,l||null,r);const u=a[this.childrenKey];if(u){const h=u.slice();for(const c of h)this.add(c,o)}},remove(a){const l=this.getSiblings(a);if(l.includes(a)){ut(l,a);const r=this._flat(a);this.statsFlat.splice(this.statsFlat.indexOf(a),r.length);for(const d of r)this._statsMap.delete(d.data);return this.afterRemoveStat(a),!0}return!1},getSiblings(a){const{parent:l}=a;return l?l.children:this.stats},_setPosition(a,l,r){(l?l.children:this.stats).splice(r,0,a),a.parent=l,a.level=l?l.level+1:1;const o=this._calcFlatIndex(l,r),u=this._flat(a);this.statsFlat.splice(o,0,...u);for(const h of u)this._statsMap.has(h.data)||this._statsMap.set(h.data,h);J(a,(h,c,p)=>{p&&(h.level=p.level+1)},{childrenKey:le}),this.afterSetStat(a,l,r)},*iterateParent(a,l){let r=l!=null&&l.withSelf?a:a.parent;for(;r;)yield r,r=r.parent},move(a,l,r){if(this.has(a)){if(a.parent===l&&this.getSiblings(a).indexOf(a)===r)return!1;if(a===l)throw new Error("Can't move node to it self");if(l&&a.level<l.level){let d;for(const o of this.iterateParent(l))if(o.level===a.level){d=o;break}if(a===d)throw new Error("Can't move node to its descendant")}this.remove(a)}return this._setPosition(a,l,r),!0},_flat(a){const l=[];return J(a,r=>{l.push(r)},{childrenKey:le}),l},_count(a){return this._flat(a).length},getData(a,l){const{childrenKey:r}=this,d=new Ye([]);return d.childrenKey=r,J(l||this.stats,(o,u,h,c)=>{let p={...o.data,[r]:[]};a&&(p=a(p)),d.set(c,p)},{childrenKey:le}),d.data}},s=i;return i.noInitialization||s.init(),s}const on={childrenKey:"children",defaultOpen:!1,statsHandler(e){return e},statsFlatHandler(e){return e},afterSetStat(e,t,n){},afterRemoveStat(e){},statHandler(e){return e}};function nt(){return{isStat:!0,hidden:!1,checked:!1,style:null,class:null,draggable:null,droppable:null}}class at extends Error{constructor(t){super(t),this.name="StatNotFoundError"}}/*!
 * drag-event-service v2.0.0
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: null
 * Released under the MIT License.
 */const Oe={start:["mousedown","touchstart"],move:["mousemove","touchmove"],end:["mouseup","touchend"]},Ke={isTouch(e){return e.type&&e.type.startsWith("touch")},_getStore(e){return e._wrapperStore||(e._wrapperStore=[]),e._wrapperStore},on(e,t,n,i){const{args:s,mouseArgs:a,touchArgs:l}=it(i),r=this._getStore(e),d=this,o=function(u){let h;if(d.isTouch(u))h={x:u.changedTouches[0].pageX,y:u.changedTouches[0].pageY,pageX:u.changedTouches[0].pageX,pageY:u.changedTouches[0].pageY,clientX:u.changedTouches[0].clientX,clientY:u.changedTouches[0].clientY,screenX:u.changedTouches[0].screenX,screenY:u.changedTouches[0].screenY};else if(h={x:u.pageX,y:u.pageY,pageX:u.pageX,pageY:u.pageY,clientX:u.clientX,clientY:u.clientY,screenX:u.screenX,screenY:u.screenY},t==="start"&&u.which!==1)return;return n.call(this,u,h)};r.push({handler:n,wrapper:o}),Z.call(null,e,Oe[t][0],o,...s,...a),Z.call(null,e,Oe[t][1],o,...s,...l)},off(e,t,n,i){const{args:s,mouseArgs:a}=it(i),l=this._getStore(e);for(let r=l.length-1;r>=0;r--){const{handler:d,wrapper:o}=l[r];n===d&&(G.call(null,e,Oe[t][0],o,...s,...a),G.call(null,e,Oe[t][1],o,...s,...a),l.splice(r,1))}}};function it(e){e||(e={});const t=e.args||[],n=e.mouseArgs||[],i=e.touchArgs||[];return{args:t,mouseArgs:n,touchArgs:i}}/*!
 * @he-tree/dnd-utils v0.1.0-alpha.4
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: null
 * Released under the MIT License.
 */const Ue=new Map,te={triggerElement:null,dragElement:null,internal:!1,dropEffect:"none",preventDefault:!1},W=te;function be(e){e.dataTransfer&&(e.dataTransfer.dropEffect=W.dropEffect)}function dn(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Ue.has(e))throw"Already registered on specified element";const n={...t},i=n;ht(n,un),Ke.on(e,"start",s,{touchArgs:[{passive:!0}]}),Ke.on(e,"end",a);function s(h){var c;const p=h.target;p.nodeType===Node.ELEMENT_NODE&&(W.triggerElement=p);const v=p;if(n.ingoreHTMLTags&&v.tagName&&n.ingoreHTMLTags.find(S=>S.toUpperCase()===v.tagName))return;const $=(c=n.beforeDragStart)===null||c===void 0?void 0:c.call(n,h);$&&($.setAttribute("draggable","true"),W.dragElement=$)}function a(h){W.dragElement&&W.dragElement.removeAttribute("draggable")}function l(h){var c;W.internal=!0,(c=n.onDragStart)===null||c===void 0||c.call(n,h),be(h)}function r(h){var c;(c=n.onDrag)===null||c===void 0||c.call(n,h),be(h)}function d(h){var c;(c=n.onDragEnd)===null||c===void 0||c.call(n,h),W.internal=!1,W.dragElement&&W.dragElement.removeAttribute("draggable"),W.triggerElement=null,W.dragElement=null,W.dropEffect="none"}const o=hn(e,{onDragLeave(h){var c;(c=n.onDragLeave)===null||c===void 0||c.call(n,h),be(h)},onDragEnter(h){var c;i.ifPreventDefault(h)&&h.preventDefault(),(c=n.onDragEnter)===null||c===void 0||c.call(n,h),be(h)},onDragOver(h){var c;i.ifPreventDefault(h)&&h.preventDefault(),(c=n.onDragOver)===null||c===void 0||c.call(n,h),be(h)},onDrop(h){var c;i.ifPreventDefault(h)&&h.preventDefault(),(c=n.onDrop)===null||c===void 0||c.call(n,h)},onEnter(h){var c;(c=n.onEnter)===null||c===void 0||c.call(n,h)},onLeave(h){var c;(c=n.onLeave)===null||c===void 0||c.call(n,h)}});return Z(e,"dragstart",l),Z(e,"drag",r),Z(e,"dragend",d),Object.assign(n,{root:e,destroy:()=>{Ke.off(e,"start",s,{touchArgs:[{passive:!0}]}),G(e,"dragstart",l),G(e,"drag",r),G(e,"dragend",d),o(),Ue.delete(e)}}),Ue.set(e,i),i}const un={ingoreHTMLTags:["INPUT","TEXTAREA","SELECT","OPTGROUP","OPTION"],ifPreventDefault(e){return te.dragElement?!0:W.preventDefault},beforeDragStart(e){},onDragStart(e){},onDrag(e){},onDragEnter(e){},onDragLeave(e){},onDragOver(e){},onDragEnd(e){},onDrop(e){}};let Ne=null;const cn=e=>{Ne=e,setTimeout(()=>{Ne=null},20)};function hn(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=e;let i=!1;const s=p=>{var v;i=!0,(v=t.onEnter)===null||v===void 0||v.call(t,p),u.resume()},a=p=>{var v;cn(p.target),(v=t.onDragEnter)===null||v===void 0||v.call(t,p),i||s(p)},l=p=>{var v;i||s(p),(v=t.onDragOver)===null||v===void 0||v.call(t,p)},r=p=>{var v;(v=t.onDragLeave)===null||v===void 0||v.call(t,p);const $=function(){var F;let H=arguments.length>0&&arguments[0]!==void 0?arguments[0]:p;i=!1,(F=t.onLeave)===null||F===void 0||F.call(t,H),u.stop()},S=Ne;Ne=null,S&&qt(S,n)||$()},d=p=>{var v;(v=t.onDrop)===null||v===void 0||v.call(t,p)},o=p=>{var v;p instanceof KeyboardEvent&&p.key!=="Escape"||(i=!1,u.stop(),(v=t.onEndBeforeLeave)===null||v===void 0||v.call(t,p))},u=Jt([[e,"drop",o],[window,"mouseup",o],[window,"touchend",o],[window,"keydown",o]]);u.stop();const h=()=>{Z(e,"dragenter",a),Z(e,"dragover",l),Z(e,"dragleave",r),Z(e,"drop",d)},c=()=>{G(e,"dragenter",a),G(e,"dragover",l),G(e,"dragleave",r),G(e,"drop",d),u.stop()};return h(),c}/*!
 * @he-tree/vue v2.9.3
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: https://hetree.phphe.com/
 * Released under the MIT License.
 */let Fe=!1;const gn=()=>{Fe=!0,setTimeout(()=>{Fe=!1},100)},fn=Ce({props:["stat","rtl","btt","indent","table","treeLine","treeLineOffset","processor"],emits:["open","close","check"],setup(e,{emit:t}){const n=Y(()=>({[e.rtl?"paddingRight":"paddingLeft"]:e.indent*(e.stat.level-1)+"px"}));We(()=>e.stat.checked,a=>{Fe||e.processor.afterOneCheckChanged(e.stat)&&t("check",e.stat)}),We(()=>e.stat.open,a=>{Fe||(t(a?"open":"close",e.stat),gn())});const i=Y(()=>{const a=[],l=u=>{var h;if(u.parent){let c=(h=u.parent)==null?void 0:h.children.indexOf(u);do{c++;let p=u.parent.children[c];if(p){if(!p.hidden)return!0}else break}while(!0)}return!1},r=e.rtl?"right":"left",d=e.btt?"top":"bottom";let o=e.stat;for(;o;){let u=(o.level-2)*e.indent+e.treeLineOffset;const h=l(o),c=()=>{a.push({style:{[r]:u+"px",[d]:h?0:"50%"}})};o===e.stat?o.level>1&&c():h&&c(),o=o.parent}return a}),s=Y(()=>{let a=(e.stat.level-2)*e.indent+e.treeLineOffset;return{[e.rtl?"right":"left"]:a+"px"}});return{indentStyle:n,vLines:i,hLineStyle:s}}}),pt=(e,t)=>{const n=e.__vccOpts||e;for(const[i,s]of t)n[i]=s;return n},pn={class:"tree-node-inner"},mn={key:1,class:"tree-node",ref:"el"};function vn(e,t,n,i,s,a){return e.table?(k(),L("tr",mn,[B(e.$slots,"default",{indentStyle:e.indentStyle})],512)):(k(),L("div",{key:0,class:de(["tree-node",{"tree-node--with-tree-line":e.treeLine}]),style:oe(e.indentStyle),ref:"el"},[e.treeLine?(k(),L(ue,{key:0},[(k(!0),L(ue,null,je(e.vLines,l=>(k(),L("div",{class:"tree-line tree-vline",style:oe(l.style)},null,4))),256)),e.stat.level>1?(k(),L("div",{key:0,class:"tree-line tree-hline",style:oe(e.hLineStyle)},null,4)):_("",!0)],64)):_("",!0),E("div",pn,[B(e.$slots,"default",{indentStyle:e.indentStyle})])],6))}const yn=pt(fn,[["render",vn]]);function bn(e,t={}){const n={...t,statHandler(i){return this._statHandler2&&(i=this._statHandler2(i)),Me(t.statHandler,we(i))},statsHandler(i){return Me(t.statsHandler,we(i))},statsFlatHandler(i){return Me(t.statsFlatHandler,we(i))}};return ln(e,n)}function Me(e,t){return e?e(t):t}const kn=Ce({components:{VirtualList:sn,TreeNode:yn},props:{value:{required:Ft,type:Array},modelValue:{required:Vt,type:Array},updateBehavior:{type:String,default:"modify"},processor:{type:Object,default:()=>bn([],{noInitialization:!0})},childrenKey:{type:String,default:"children"},textKey:{type:String,default:"text"},indent:{type:Number,default:20},virtualization:{type:Boolean,default:!1},virtualizationPrerenderCount:{type:Number,default:20},defaultOpen:{type:Boolean,default:!0},statHandler:{type:Function},rtl:{type:Boolean,default:!1},btt:{type:Boolean,default:!1},table:{type:Boolean,default:!1},watermark:{type:Boolean,default:!1},nodeKey:{type:[String,Function],default:"index"},treeLine:{type:Boolean,default:!1},treeLineOffset:{type:Number,default:8}},emits:["update:modelValue","click:node","open:node","close:node","check:node","beforeDragStart","before-drag-start","after-drop","change","enter","leave"],data(){return{stats:[],statsFlat:[],dragNode:null,dragOvering:!1,placeholderData:{},placeholderColspan:1,batchUpdateWaiting:!1,self:this,_ignoreValueChangeOnce:!1}},computed:{valueComputed(){return this.modelValue||[]},visibleStats(){const{statsFlat:e,isVisible:t}=this;let n=e;return this.btt&&(n=n.slice(),n.reverse()),n.filter(i=>t(i))},rootChildren(){return this.stats}},methods:{_emitValue(e){this.$emit("update:modelValue",e)},_updateValue(e){return this.updateBehavior==="disabled"?!1:(e!==this.valueComputed&&(this._ignoreValueChangeOnce=!0),this._emitValue(e),!0)},getStat:ze(R("getStat")),has:ze(R("has")),updateCheck:R("updateCheck"),getChecked:R("getChecked"),getUnchecked:R("getUnchecked"),openAll:R("openAll"),closeAll:R("closeAll"),openNodeAndParents:R("openNodeAndParents"),isVisible:R("isVisible"),move:rt("move"),add:ze(rt("add")),addMulti(e,t,n){this.batchUpdate(()=>{let i=n;for(const s of e)this.add(s,t,i),i!=null&&i++})},remove:R("remove"),removeMulti(e){let t=[...e];this.batchUpdate(()=>{for(const n of t)this.remove(n)})},iterateParent:R("iterateParent"),getSiblings:R("getSiblings"),getData:R("getData"),getRootEl(){return this.$refs.vtlist.listElRef},batchUpdate(e){const t=this.ignoreUpdate(e);return this.batchUpdateWaiting||this._updateValue(this.updateBehavior==="new"?this.getData():this.valueComputed),t},ignoreUpdate(e){const t=this.batchUpdateWaiting;this.batchUpdateWaiting=!0;const n=e();return this.batchUpdateWaiting=t,n}},watch:{processor:{immediate:!0,handler(e){if(e){const t=n=>{if(n){const{childrenKey:i}=this;return n[i]||(n[i]=[]),n[i]}else return this.valueComputed};e._statHandler2=this.statHandler?n=>n.data===this.placeholderData?n:this.statHandler(n):null,e.afterSetStat=(n,i,s)=>{const{childrenKey:a,updateBehavior:l}=this;let r=this.valueComputed;if(l==="new"){if(this.batchUpdateWaiting)return;r=this.getData()}else if(l==="modify"){const d=t(i==null?void 0:i.data);d.includes(n.data)||d.splice(s,0,n.data)}this.batchUpdateWaiting||this._updateValue(r)},e.afterRemoveStat=n=>{var i;const{childrenKey:s,updateBehavior:a}=this;let l=this.valueComputed;if(a==="new"){if(this.batchUpdateWaiting)return;l=this.getData()}else if(a==="modify"){const r=t((i=n.parent)==null?void 0:i.data);ut(r,n.data)}this.batchUpdateWaiting||this._updateValue(l)}}e.initialized||(e.data=this.valueComputed,Object.assign(e,Ut(this,["childrenKey","defaultOpen"])),e.init(),e.updateCheck()),this.stats=e.stats,this.statsFlat=e.statsFlat,e.data!==this.valueComputed&&this._updateValue(e.data)}},valueComputed:{handler(e){if(this.dragOvering||this.dragNode||this._ignoreValueChangeOnce)this._ignoreValueChangeOnce=!1;else{const{processor:t}=this;t.data=e,t.init(),this.stats=t.stats,this.statsFlat=t.statsFlat}}}},created(){},mounted(){typeof window<"u"&&(this.watermark===!1&&(window._heTreeWatermarkDisabled=!0),this.watermark&&!window._heTreeWatermarkDisabled&&(window._heTreeWatermark||(window._heTreeWatermark=!0,console.log("%c[he-tree] Vue tree component:  https://hetree.phphe.com","color:#0075ff; font-size:14px;"))))}});function R(e){return function(...t){return this.processor[e](...t)}}function rt(e){return function(...t){return this.batchUpdate(()=>this.processor[e](...t))}}function ze(e){return function(t,...n){return t&&(t=we(t)),e.call(this,t,...n)}}const $n={key:0,class:"drag-placeholder he-tree-drag-placeholder"},wn=["colspan"],Cn={class:"drag-placeholder he-tree-drag-placeholder"};function xn(e,t,n,i,s,a){const l=ae("TreeNode"),r=ae("VirtualList");return k(),A(r,{class:de(["he-tree",{"he-tree--rtl rtl":e.rtl,"he-tree--drag-overing drag-overing":e.dragOvering}]),ref:"vtlist",items:e.visibleStats,disabled:!e.virtualization,table:e.table,itemKey:e.nodeKey},{prepend:g(()=>[B(e.$slots,"prepend",{tree:e.self})]),default:g(({item:d,index:o})=>[f(l,{"vt-index":o,class:de([d.class,{"drag-placeholder-wrapper":d.data===e.placeholderData,"dragging-node":d===e.dragNode}]),style:oe(d.style),stat:d,rtl:e.rtl,btt:e.btt,indent:e.indent,table:e.table,treeLine:e.treeLine,treeLineOffset:e.treeLineOffset,processor:e.processor,onClick:u=>e.$emit("click:node",d),onOpen:t[0]||(t[0]=u=>e.$emit("open:node",u)),onClose:t[1]||(t[1]=u=>e.$emit("close:node",u)),onCheck:t[2]||(t[2]=u=>e.$emit("check:node",u))},{default:g(({indentStyle:u})=>[d.data===e.placeholderData?(k(),L(ue,{key:0},[e.table?(k(),L("td",{key:1,style:oe(u),colspan:e.placeholderColspan},[E("div",Cn,[B(e.$slots,"placeholder",{tree:e.self})])],12,wn)):(k(),L("div",$n,[B(e.$slots,"placeholder",{tree:e.self})]))],64)):B(e.$slots,"default",{key:1,node:d.data,stat:d,indentStyle:u,tree:e.self},()=>[P(x(d.data[e.textKey]),1)])]),_:2},1032,["vt-index","class","style","stat","rtl","btt","indent","table","treeLine","treeLineOffset","processor","onClick"])]),append:g(()=>[B(e.$slots,"append",{tree:e.self})]),_:3},8,["class","items","disabled","table","itemKey"])}const Dn=pt(kn,[["render",xn]]);let w=null,m=null,Le,$e,se,Pe,Re,j,st;const ke={get startInfo(){return Le},get targetInfo(){return $e}},Sn=Ce({extends:Dn,props:{triggerClass:{type:[String,Array]},disableDrag:Boolean,disableDrop:Boolean,eachDraggable:{type:Function},eachDroppable:{type:Function},rootDroppable:{type:[Boolean,Function],default:!0},dragOpen:{type:Boolean,default:!0},dragOpenDelay:{type:Number,default:0},beforeDragOpen:{type:Function},resolveStartMovePoint:{type:[String,Function]},keepPlaceholder:{type:Boolean},maxLevel:{type:Number},dragCopy:{type:Boolean},dragCopyDataHandler:{type:Function},onExternalDragOver:{type:Function},externalDataHandler:{type:Function},ondragstart:{type:Function}},data(){return{treeDraggableInstance:null}},computed:{},methods:{getNodeByElement(e){const t=e.getAttribute("vt-index");return t==null?null:this.visibleStats[t]},isDraggable(e){if(this.disableDrag)return!1;if(e.draggable!=null)return e.draggable;if(this.eachDraggable){const n=this.eachDraggable(e);if(n!=null)return n}const{parent:t}=e;return t?this.isDraggable(t):!0},isDroppable(e){if(this.disableDrop)return!1;if(!e)return Qe(this.rootDroppable,[this,w]);if(e.droppable!=null)return e.droppable;if(this.eachDroppable){const n=this.eachDroppable(e);if(n!=null)return n}const{parent:t}=e;return t?this.isDroppable(t):!0},_eachDroppable(){var e;return Qe((e=this._isDragCopy)==null?void 0:e.call(this),[this])}},mounted(){const e=(o,u)=>{let h=!0;return w&&w!==this&&(h=h&&this._isMoved),this.table&&!this._isDragCopy&&(h=h&&this._isDragCopy),h&&(o.x!==u.x||o.y!==u.y)},t=(o,u)=>{m.ignoreUpdate(()=>{if(!m.has(m.placeholderData)){if(m.table){let c=0;const p=m.getRootEl().querySelector("tr");if(p)for(const{value:v}of Mt(p.children))Ae(v,"display")!=="none"&&(c+=v.colSpan||1);c<1&&(c=1),m.placeholderColspan=c}m.add(m.placeholderData)}const h=m.getStat(m.placeholderData);m.move(h,o,u)})},n=()=>{const o=this;if(o.has(o.placeholderData))return o.remove(o.getStat(o.placeholderData)),!0},i=o=>{o?te.dropEffect=w!=null&&w.dragCopy?"copy":"move":te.dropEffect="none"},s=o=>{const u=this;o?i(!0):u.keepPlaceholder?u.has(u.placeholderData)||i(!1):(n(),i(!1))};let a={x:0,y:0};const l=this.getRootEl();let r=null;const d=()=>{m!=null&&m.has(m.placeholderData)&&m.ignoreUpdate(()=>{m.remove(m.getStat(m.placeholderData)),w&&(w.dragNode.hidden=!1,w.dragOvering=!1)})};this.treeDraggableInstance=dn(l,{beforeDragStart:o=>{if(!te.triggerElement)return;let u=this.triggerClass;(!u||u.length===0)&&(u="tree-node");let h=Kt(u),c=et(te.triggerElement,p=>{if(tt(p,h))return!0;if(Ie(p,"tree-node"))return"break"},{withSelf:!0,until:l});if(r=et(c,p=>{if(Ie(p,"tree-node"))return!0},{withSelf:!0,until:l}),!!r){if(j=this.getNodeByElement(r),!j)throw"Can't find drag node";if(this.isDraggable(j))return this.$emit("before-drag-start",j),this.$emit("beforeDragStart",j),l}},onDragStart:o=>{var u,h,c;if(!r||!j)return;{const{x:$,y:S}=r.getBoundingClientRect(),{clientX:F,clientY:H}=o;(u=o.dataTransfer)==null||u.setDragImage(r,F-$,H-S)}Re={x:o.clientX,y:o.clientY},w=this,w.dragNode=j,Pe=(()=>{if(this.resolveStartMovePoint==="mouse")return{x:o.clientX,y:o.clientY};if(typeof this.resolveStartMovePoint=="function")return this.resolveStartMovePoint(r);{let $,S=0;if(this.table){let F=r.getBoundingClientRect();$={x:F.x,y:F.y},this.rtl&&($.x=F.right),S=F.height}else if(!this.rtl)$=r.children[0].getBoundingClientRect().toJSON(),S=$.height;else{const F=r.children[0].getBoundingClientRect();$={x:F.right,y:F.y},S=F.height}return this.btt&&($.y+=S),$}})(),this.dragOvering=!0;const p=w.getSiblings(w.dragNode),v=p.indexOf(j);Le={tree:w,dragNode:j,parent:j.parent,siblings:p,indexBeforeDrop:v},m=this,(h=o.dataTransfer)==null||h.setData("text",`he-tree drag start at ${new Date().toISOString()}`),w._eachDroppable()||setTimeout(()=>{j.hidden=!0,t(j.parent,v+1)},0),(c=this.ondragstart)==null||c.call(this,o)},onEnter:o=>{this.$emit("enter",o)},onLeave:o=>{se=null,this.dragOvering=!1,te.preventDefault=!1,n(),this.$emit("leave",o)},onDragOver:Yt(o=>{if(!w){if(!this.onExternalDragOver||this.onExternalDragOver(o)===!1)return;te.preventDefault=!0}const u={x:o.clientX,y:o.clientY},h=e(u,a);if(a=u,!h)return;this.dragOvering=!0,m=this;const c=Pe?{x:Pe.x+(u.x-Re.x),y:Pe.y+(u.y-Re.y)}:{...u},{btt:p,rtl:v}=m;if(m.disableDrop){te.dropEffect="none";return}let $,S;const F=m.getRootEl().querySelectorAll(".tree-node"),H=[];F.forEach(y=>{!tt(y,["drag-placeholder-wrapper","dragging-node"])&&Ae(y,"display")!=="none"&&H.push(y)});const Q=Xe(H,y=>He(y)[p?"bottom":"top"]-c.y,{returnNearestIfNoHit:!0});let N=null,q,ce;Q.hit||(Q.greater?p||(N=Q.index-1,H[N]||N++):p&&(N=Q.index+1,H[N]||N--)),N==null&&(N=Q.index),q=H[N],ce=p?H[N-1]:H[N+1],$=q&&m.getNodeByElement(q),S=ce&&m.getNodeByElement(ce);const{indent:ne}=m,M=ye(()=>{if(m.table){let y=He(q).toJSON();const V=ne*($.level-1);return v?(y.width-=V,y.right-=V):y.x+=V,y}else return He(q.firstElementChild)}).action,he=ye(()=>p?c.y>M().y+M().height/2:c.y<M().y+M().height/2).action,Ve=ye(()=>p?!q||N===H.length-1&&he():!q||N===0&&he()).action,xe=ye(()=>v?c.x-(M().x+M().width):M().x-c.x).action,C=ye(()=>v?c.x<M().x+M().width-ne:c.x>M().x+ne).action;let b;if(Ve())b=1,$=null;else if($)xe()>0?b=$.level-Math.ceil(xe()/ne):C()?b=$.level+1:b=$.level;else return;S&&b<S.level&&(b=S.level),(async()=>{let y,V,X=!1,z=null;const ie=async O=>{if(O.open)return!0;if(m.dragOpen)if(m.dragOpenDelay)if(z=O,se===O)X=!0;else{let T=Xt();se=O;const K=O;return setTimeout(async()=>{K!==se?(X=!0,T.resolve(!0)):(m.beforeDragOpen&&await m.beforeDragOpen(O),K!==se?(X=!0,T.resolve(!0)):(O.open=!0,z=null,T.resolve(!0)))},m.dragOpenDelay),await T.promise}else return m.beforeDragOpen&&await m.beforeDragOpen(O),O.open=!0,!0;else return!1},De=async()=>{if(m.isDroppable($)&&await ie($)){if(X)return;y=$,V=null}else return!1},Se=(O=b)=>{let T=$,K=[];for(;T&&T.level>=O;)T=T.parent||null,K.unshift(T);let ee=0;for(const re of K){if(m.isDroppable(re))return y=re,V=K[ee+1]||$,!0;ee++}return!1};st=$||null,$?b>$.level?await De()===!1&&Se($.level):Se()===!1&&await De():m.isDroppable(null)&&(y=null),se=z;const _e=!!(!X&&(y||y===null));return{cancelled:X,success:_e,parent:y,index:_e?V?(y?y.children:m.stats).filter(O=>O.data!==m.placeholderData).indexOf(V)+1:0:-1}})().then(y=>{if(!y.cancelled){if(!y.success){s(!1);return}if(m.maxLevel!=null&&m.maxLevel>0){let V=1;if(w){const X=w.dragNode;let z=0;J(X,ie=>{ie.level>z&&(z=ie.level)},{childrenKey:le}),V=z-X.level+1}if(V+(y.parent?y.parent.level:0)>m.maxLevel){s(!1);return}}s(!0),t(y.parent,y.index)}})}),onDrop:o=>{m=this;const u=!w;if(!m)return;const h=w==null?void 0:w.dragNode;let c,p=(()=>{var v;let $=!0;if(!m.has(m.placeholderData))$=!1;else if(u)c=(v=this.externalDataHandler)==null?void 0:v.call(this,o),$=c!=null;else if(!w.dragCopy){const S=m.getStat(m.placeholderData);w===m&&S.parent===h.parent&&Wt(h,F=>F===S)}return $})();if(p){const v=m.getStat(m.placeholderData),$=m.getSiblings(v);$e={tree:m,dragNode:h,parent:v.parent,siblings:$,indexBeforeDrop:$.indexOf(v)}}(()=>{if(d(),p){let v=$e.indexBeforeDrop;w&&!w.dragCopy&&w===m&&Le.parent==$e.parent&&Le.indexBeforeDrop<v&&v--,w&&w!==m&&!w._eachDroppable()&&w.batchUpdate(()=>{w.remove(h),w.updateCheck()}),m.batchUpdate(()=>{let $=w==null?void 0:w.dragNode,S;c?S=c:w._eachDroppable()&&(S=gt(w.dragNode.data,{childrenKey:w.childrenKey}),w.dragCopyDataHandler&&(S=w.dragCopyDataHandler(S))),S&&(m.add(S),$=m.getStat(S)),m.move($,$e.parent,v),m.updateCheck()})}m.$emit("after-drop"),p&&(w&&(w.dragCopy||w.$emit("change")),m!==w&&m.$emit("change"))})()},onDragEnd:o=>{d(),w&&(w.dragNode&&(w.dragNode.hidden=!1),w.dragNode=null,w.dragOvering=!1,w=null),m=null,se=null,j=null,st=null}})},unmounted(){var e;(e=this.treeDraggableInstance)==null||e.destroy()}}),_n={components:{Draggable:Sn},props:{embed:{type:Boolean,default:!1},filter:{type:Object,default:()=>({})}},emits:["select"],inject:["debounce"],data(){return{menu:{},items:[],loading:!0,checked:null,clip:null,term:""}},setup(){const e=bt(),t=ot(),n=dt();return{app:kt(),auth:n,languages:e,messages:t}},created(){this.searchd=this.debounce(this.search,500),this.fetch().then(e=>{this.items=e.data,this.loading=!1})},mounted(){this.checked=!1},computed:{canTrash(){var e;return this.isChecked&&((e=this.$refs.tree)==null?void 0:e.statsFlat.some(t=>t._checked&&!t.data.deleted_at))},isChecked(){var e;return this.checked||((e=this.$refs.tree)==null?void 0:e.statsFlat.some(t=>t._checked))},isTrashed(){var e;return this.isChecked&&((e=this.$refs.tree)==null?void 0:e.statsFlat.some(t=>t._checked&&t.data.deleted_at))}},methods:{add(){if(this.embed||!this.auth.can("page:add")){this.messages.add(this.$gettext("Permission denied"),"error");return}const e=this.create();this.$apollo.mutate({mutation:U`mutation ($input: PageInput!) {
            addPage(input: $input) {
              id
            }
          }`,variables:{input:e}}).then(t=>{if(t.errors)throw t.errors;if(!t.data.addPage)throw new Error("No data in addPage mutation result");const n={...t.data.addPage};this.$refs.tree.add(n),this.$emit("select",n)}).catch(t=>{this.messages.add(this.$gettext("Error adding root page")+`:
`+t,"error"),this.$log("PageList::add(): Error adding root page",t)})},change(){if(!this.auth.can("page:move")){this.messages.add(this.$gettext("Permission denied"),"error");return}const e=ke.targetInfo.parent,n=ke.targetInfo.siblings[ke.targetInfo.indexBeforeDrop+1]||null;this.$apollo.mutate({mutation:U`mutation ($id: ID!, $parent: ID, $ref: ID) {
            movePage(id: $id, parent: $parent, ref: $ref) {
              id
            }
          }`,variables:{id:ke.startInfo.dragNode.data.id,parent:e?e.data.id:null,ref:n?n.data.id:null}}).then(i=>{if(i.errors)throw i.errors;const s=ke.startInfo.parent;s!=null&&s.data&&!(s!=null&&s.children.length)&&(s.data.has=!1),e&&(e.data.has=!0)}).catch(i=>{this.messages.add(this.$gettext("Error moving page")+`:
`+i,"error"),this.$log("PageList::change(): Error moving page",i)})},copy(e,t){this.clip={type:"copy",node:t,stat:e}},create(e={}){return Object.assign({path:"_"+Math.floor(Math.random()*1e4),lang:this.$vuetify.locale.current||this.languages.default(),status:0,cache:5},e)},cut(e,t){this.$refs.tree.statsFlat.forEach(n=>{delete n.cut}),e.cut=!0,this.clip={type:"cut",node:t,stat:e}},drop(e){if(!this.auth.can("page:drop")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.$refs.tree.statsFlat.filter(n=>{var i;return n._checked&&((i=n.data)==null?void 0:i.id)});t.length&&this.$apollo.mutate({mutation:U`mutation ($id: [ID!]!) {
            dropPage(id: $id) {
              id
            }
          }`,variables:{id:t.map(n=>n.data.id)}}).then(n=>{if(n.errors)throw n.errors;for(const i of t)this.update(i,s=>{s.data.deleted_at=new Date().toISOString().replace(/T/," ").substring(0,19),s.check=!1,this.filter.trashed==="WITHOUT"&&this.$refs.tree.remove(s)});this.invalidate()}).catch(n=>{this.messages.add(this.$gettext("Error trashing page")+`:
`+n,"error"),this.$log("PageList::drop(): Error trashing page",t,n)})},fetch(e=null,t=1,n=100){if(!this.auth.can("page:view"))return this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve([]);const i=this.filter.publish||null,s=this.filter.trashed||"WITHOUT",a={...this.filter};return delete a.trashed,delete a.publish,delete a.view,a.parent_id=e,this.$apollo.query({query:U`query($filter: PageFilter, $limit: Int!, $page: Int!, $trashed: Trashed, $publish: Publish) {
            pages(filter: $filter, first: $limit, page: $page, trashed: $trashed, publish: $publish) {
              data {
                ${this.fields()}
              }
              paginatorInfo {
                currentPage
                lastPage
              }
            }
          }`,variables:{filter:a,page:t,limit:n,trashed:s,publish:i}}).then(l=>{if(l.errors)throw l.errors;return this.transform(l.data.pages)}).catch(l=>{this.messages.add(this.$gettext("Error fetching pages")+`:
`+l,"error"),this.$log("PageList::fetch(): Error fetching page",e,t,n,l)})},fields(){return`id
          parent_id
          created_at
          deleted_at
          editor
          has
          latest {
            id
            published
            publish_at
            data
            editor
            created_at
          }`},hydrate(e){var n,i,s,a,l;const t=(n=e.latest)!=null&&n.data?JSON.parse(e.latest.data):{...e};return Object.assign(t,{id:e.id,has:e.has,parent_id:e.parent_id,deleted_at:e.deleted_at,created_at:e.created_at,updated_at:((i=e.latest)==null?void 0:i.created_at)||e.updated_at,editor:((s=e.latest)==null?void 0:s.editor)||e.editor,published:((a=e.latest)==null?void 0:a.published)??!0,publish_at:((l=e.latest)==null?void 0:l.publish_at)||null,latest:e.latest})},insert(e,t=null){if(!this.auth.can("page:add")){this.messages.add(this.$gettext("Permission denied"),"error");return}const n=this.$refs.tree.getSiblings(e),i=t!==null?e.parent:e,s=n.indexOf(e),a=this.create();let l=null;switch(t===null&&!e.open&&this.load(e,e.data),t){case 0:l=e.data.id;break;case null:l=e.children&&e.children[0]?e.children[0].data.id:null;break;case 1:l=n[s+1]?n[s+1].data.id:null;break}this.$apollo.mutate({mutation:U`mutation ($input: PageInput!, $parent: ID, $ref: ID) {
            addPage(input: $input, parent: $parent, ref: $ref) {
              id
            }
          }`,variables:{input:a,parent:i?i.data.id:null,ref:l}}).then(r=>{if(r.errors)throw r.errors;a.id=r.data.addPage.id,(t!==null||e.open)&&this.$refs.tree.add(a,i,t!==null?s+t:0),i&&(i.data.has=!0),this.invalidate(),this.submenu()}).catch(r=>{this.messages.add(this.$gettext("Error inserting page")+`:
`+r,"error"),this.$log("PageList::insert(): Error inserting page",r)})},invalidate(){const e=this.$apollo.provider.defaultClient.cache;e.evict({id:"ROOT_QUERY",fieldName:"pages"}),e.gc()},keep(e){if(!this.auth.can("page:keep")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.$refs.tree.statsFlat.filter(s=>s._checked&&s.data.id&&s.data.deleted_at),n=t.filter(s=>t.indexOf(s.parent)===-1),i=e.data.deleted_at||null;n.length&&this.$apollo.mutate({mutation:U`mutation ($id: [ID!]!) {
            keepPage(id: $id) {
              id
            }
          }`,variables:{id:n.map(s=>s.data.id)}}).then(s=>{if(s.errors)throw s.errors;for(const a of n)this.update(a,l=>{i>=l.data.deleted_at&&(l.data.deleted_at=null,l.check=!1)});this.invalidate()}).catch(s=>{this.messages.add(this.$gettext("Error restoring page")+`:
`+s,"error"),this.$log("PageList::keep(): Error restoring page",n,s)})},load(e,t){!e.open&&!t.children&&(e.loading=!0,this.fetch(t.id,e.page?e.page+1:1).then(n=>{this.$refs.tree.addMulti(n.data,e,0),e.page=n.currentPage||1}).finally(()=>{e.loading=!1})),e.open=!e.open},move(e,t=null){if(!this.auth.can("page:move")){this.messages.add(this.$gettext("Permission denied"),"error");return}const n=this.$refs.tree.getSiblings(e),i=t!==null?e.parent:e,s=n.indexOf(e);let a=null;switch(t){case 0:a=e.data.id;break;case null:a=e.children&&e.children[0]?e.children[0].data.id:null;break;case 1:a=n[s+1]?n[s+1].data.id:null;break}this.$apollo.mutate({mutation:U`mutation ($id: ID!, $parent: ID, $ref: ID) {
            movePage(id: $id, parent: $parent, ref: $ref) {
              id
            }
          }`,variables:{id:this.clip.node.id,parent:i?i.data.id:null,ref:a}}).then(l=>{var d;if(l.errors)throw l.errors;const r=t!==null?s<this.$refs.tree.getSiblings(e).indexOf(this.clip.stat)?s+t:s:0;this.$refs.tree.move(this.clip.stat,i,r),i&&((d=this.clip.stat.children)!=null&&d.length||(e.parent.data.has=!1),i.data.has=!0),this.invalidate(),this.submenu()}).catch(l=>{this.messages.add(this.$gettext("Error moving page")+`:
`+l,"error"),this.$log("PageList::move(): Error moving page",e,t,l)})},paste(e,t=null){if(!this.auth.can("page:add")){this.messages.add(this.$gettext("Permission denied"),"error");return}const n=this.$refs.tree.getSiblings(e),i=t!==null?e.parent:e,s=n.indexOf(e),a={...this.clip.node};let l=null;switch(t){case 0:l=e.data.id;break;case null:l=e.children&&e.children[0]?e.children[0].data.id:null;break;case 1:l=n[s+1]?n[s+1].data.id:null;break}return this.$apollo.query({query:U`query($id: ID!) {
            page(id: $id) {
              id
              latest {
                id
                aux
                files {
                  id
                }
                elements {
                  id
                }
              }
            }
          }`,variables:{id:a.id}}).then(r=>{var u,h;if(r.errors)throw r.errors;const d=(h=(u=r==null?void 0:r.data)==null?void 0:u.page)==null?void 0:h.latest,o=JSON.parse((d==null?void 0:d.aux)||"{}");this.$apollo.mutate({mutation:U`mutation ($input: PageInput!, $parent: ID, $ref: ID, $elements: [ID!], $files: [ID!]) {
              addPage(input: $input, parent: $parent, ref: $ref, elements: $elements, files: $files) {
                ${this.fields()}
              }
            }`,variables:{input:{status:0,to:a.to,tag:a.tag,type:a.type,theme:a.theme,lang:a.lang,name:a.name,title:a.title,cache:a.cache,domain:a.domain,related_id:a.id,meta:JSON.stringify((o==null?void 0:o.meta)||{}),config:JSON.stringify((o==null?void 0:o.config)||{}),content:JSON.stringify((o==null?void 0:o.content)||[]),path:a.path+"_"+Math.floor(Math.random()*1e4)},parent:i?i.data.id:null,ref:l,elements:(d==null?void 0:d.elements.map(c=>c.id))||[],files:(d==null?void 0:d.files.map(c=>c.id))||[]}}).then(c=>{if(c.errors)throw c.errors;if(!c.data.addPage)throw new Error("No page data returned");const p=t!==null?this.$refs.tree.getSiblings(e).indexOf(e)+t:0,v=this.hydrate(c.data.addPage);this.$refs.tree.add(v,i,p),this.invalidate(),this.submenu()}).catch(c=>{this.messages.add(this.$gettext("Error copying page")+`:
`+c,"error"),this.$log("PageList::paste(): Error copying page",e,t,c)})}).catch(r=>{this.messages.add(this.$gettext("Error fetching page")+`:
`+r,"error"),this.$log("PageList::paste(): Error fetching page",a.id,r)})},publish(e){if(!this.auth.can("page:publish")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.$refs.tree.statsFlat.filter(n=>n._checked&&n.data.id&&!n.data.published);t.length&&this.$apollo.mutate({mutation:U`mutation ($id: [ID!]!) {
            pubPage(id: $id) {
              id
            }
          }`,variables:{id:t.map(n=>n.data.id)}}).then(n=>{if(n.errors)throw n.errors;for(const i of t)i.data.published=!0,i.check=!1;this.invalidate()}).catch(n=>{this.messages.add(this.$gettext("Error publishing page")+`:
`+n,"error"),this.$log("PageList::publish(): Error publishing page",t,n)})},purge(e){if(!this.auth.can("page:purge")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.$refs.tree.statsFlat.filter(n=>n._checked&&n.data.id);t.length&&this.$apollo.mutate({mutation:U`mutation ($id: [ID!]!) {
            purgePage(id: $id) {
              id
            }
          }`,variables:{id:t.map(n=>n.data.id).reverse()}}).then(n=>{var i;if(n.errors)throw n.errors;for(const s of t)this.$refs.tree.remove(s),s.parent&&!((i=s.parent.children)!=null&&i.length)&&(s.parent.data.has=!1)}).catch(n=>{this.messages.add(this.$gettext("Error purging page")+`:
`+n,"error"),this.$log("PageList::purge(): Error purging page",t,n)})},reload(e=!0){if(this.items=[],this.loading=!0,e){const n=this.$apollo.provider.defaultClient.cache;n.evict({id:"ROOT_QUERY",fieldName:"pages"}),n.gc()}(this.filter.view==="list"?this.search():this.fetch()).then(n=>{this.items=(n==null?void 0:n.data)||[],this.loading=!1})},search(e=1,t=100){if(!this.auth.can("page:view"))return this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve([]);const n=this.filter.publish||null,i=this.filter.trashed||"WITHOUT",s={...this.filter};return delete s.trashed,delete s.publish,delete s.view,this.term&&(s.any=this.term),this.$apollo.query({query:U`query($filter: PageFilter, $limit: Int!, $page: Int!, $trashed: Trashed, $publish: Publish) {
            pages(filter: $filter, first: $limit, page: $page, trashed: $trashed, publish: $publish) {
              data {
                ${this.fields()}
              }
              paginatorInfo {
                currentPage
                lastPage
              }
            }
          }`,variables:{filter:s,page:e,limit:t,trashed:i,publish:n}}).then(a=>{if(a.errors)throw a.errors;return this.transform(a.data.pages)}).catch(a=>{this.messages.add(this.$gettext("Error searching pages")+`:
`+a,"error"),this.$log("PageList::search(): Error searching pages",e,t,a)})},status(e,t){if(!this.auth.can("page:save")){this.messages.add(this.$gettext("Permission denied"),"error");return}(e?[e]:this.$refs.tree.statsFlat.filter(i=>i._checked&&i.data.id)).forEach(i=>{this.$apollo.mutate({mutation:U`mutation ($id: ID!, $input: PageInput!) {
              savePage(id: $id, input: $input) {
                id
              }
            }`,variables:{id:i.data.id,input:{status:t}}}).then(s=>{if(s.errors)throw s.errors;i.data.status=t}).catch(s=>{this.messages.add(this.$gettext("Error saving page")+`:
`+s,"error"),this.$log("PageList::status(): Error saving page",i,t,s)})})},submenu(e=null){e?this.menu[e]=!this.menu[e]:this.menu={}},title(e){const t=[];return e.publish_at&&t.push("Publish at: "+new Date(e.publish_at).toLocaleDateString()),e.theme&&t.push("Theme: "+e.theme),e.type&&t.push("Page type: "+e.type),e.tag&&t.push("Tag: "+e.tag),e.cache&&t.push("Cache: "+e.cache+" min"),t.join(`
`)},toggle(){this.$refs.tree.statsFlat.forEach(e=>{e._checked=!e._checked})},transform(e){return{data:e.data.map(n=>this.hydrate(n)),currentPage:e.paginatorInfo.currentPage,lastPage:e.paginatorInfo.lastPage}},update(e,t){var n;if(typeof t!="function")throw new Error("Second paramter must be a function");t(e),(n=e.children)==null||n.forEach(i=>{t(i,t)})},url(e){return this.app.urlpage.replace(/_domain_/,e.domain||"").replace(/_path_/,e.path||"").replace(/\/+$/,"")}},watch:{filter:{deep:!0,handler(e){this.items=[],this.loading=!0,(e.view==="list"?this.search():this.fetch()).then(n=>{this.items=(n==null?void 0:n.data)||[],this.loading=!1})}},term:{handler(){this.reload(!1)}}}},En={class:"header"},On={class:"bulk"},Pn={class:"search"},Ln={class:"actions"},Tn={key:0,class:"spinner",fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},In=["title"],An=["onClick"],Nn={class:"item-head"},Fn={key:0,class:"item-lang"},Vn={class:"item-title"},Bn={key:0,class:"item-subtitle"},Hn=["href"],Kn={class:"item-domain"},Un={class:"item-path item-subtitle"},Mn={key:0,class:"item-to item-subtitle"},zn={key:0,class:"loading"},Rn={key:1,class:"notfound"},jn={key:2,class:"btn-group"};function Wn(e,t,n,i,s,a){const l=ae("Draggable");return k(),L(ue,null,[E("div",En,[E("div",On,[f(qe,{modelValue:s.checked,"onUpdate:modelValue":t[0]||(t[0]=r=>s.checked=r),onClick:t[1]||(t[1]=$t(r=>a.toggle(),["stop"]))},null,8,["modelValue"]),f(fe,null,{activator:g(({props:r})=>[f(D,Je({"append-icon":"mdi-menu-down",variant:"text"},r,{disabled:!a.isChecked}),{default:g(()=>[P(x(e.$gettext("Actions")),1)]),_:1},16,["disabled"])]),default:g(()=>[f(pe,null,{default:g(()=>[a.isChecked&&i.auth.can("page:publish")?(k(),A(I,{key:0},{default:g(()=>[f(D,{"prepend-icon":"mdi-publish",variant:"text",onClick:t[2]||(t[2]=r=>a.publish())},{default:g(()=>[P(x(e.$gettext("Publish")),1)]),_:1})]),_:1})):_("",!0),a.isChecked&&i.auth.can("page:save")?(k(),A(I,{key:1},{default:g(()=>[f(D,{"prepend-icon":"mdi-eye",variant:"text",onClick:t[3]||(t[3]=r=>a.status(null,1))},{default:g(()=>[P(x(e.$gettext("Enable")),1)]),_:1})]),_:1})):_("",!0),a.isChecked&&i.auth.can("page:save")?(k(),A(I,{key:2},{default:g(()=>[f(D,{"prepend-icon":"mdi-eye-off",variant:"text",onClick:t[4]||(t[4]=r=>a.status(null,0))},{default:g(()=>[P(x(e.$gettext("Disable")),1)]),_:1})]),_:1})):_("",!0),f(Ct),a.canTrash&&i.auth.can("page:drop")?(k(),A(I,{key:3},{default:g(()=>[f(D,{"prepend-icon":"mdi-delete",variant:"text",onClick:t[5]||(t[5]=r=>a.drop())},{default:g(()=>[P(x(e.$gettext("Delete")),1)]),_:1})]),_:1})):_("",!0),a.isTrashed&&i.auth.can("page:keep")?(k(),A(I,{key:4},{default:g(()=>[f(D,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:t[6]||(t[6]=r=>a.keep())},{default:g(()=>[P(x(e.$gettext("Restore")),1)]),_:1})]),_:1})):_("",!0),a.isChecked&&i.auth.can("page:purge")?(k(),A(I,{key:5},{default:g(()=>[f(D,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:t[7]||(t[7]=r=>a.purge())},{default:g(()=>[P(x(e.$gettext("Purge")),1)]),_:1})]),_:1})):_("",!0)]),_:1})]),_:1})]),E("div",Pn,[f(wt,{modelValue:s.term,"onUpdate:modelValue":t[8]||(t[8]=r=>s.term=r),label:e.$gettext("Search for"),"prepend-inner-icon":"mdi-magnify",variant:"underlined","hide-details":"",clearable:""},null,8,["modelValue","label"])]),f(D,{onClick:t[9]||(t[9]=r=>a.reload()),title:e.$gettext("Reload page tree"),icon:"mdi-refresh",variant:"text",class:"no-rtl"},null,8,["title"])]),f(l,{ref:"tree",modelValue:s.items,"onUpdate:modelValue":t[10]||(t[10]=r=>s.items=r),onChange:t[11]||(t[11]=r=>a.change()),defaultOpen:!1,disableDrag:!i.auth.can("page:move"),rtl:e.$vuetify.locale.isRtl,watermark:!1,virtualization:""},{default:g(({node:r,stat:d})=>[E("div",Ln,[d.loading?(k(),L("svg",Tn,[...t[13]||(t[13]=[E("circle",{class:"spin1",cx:"4",cy:"12",r:"3"},null,-1),E("circle",{class:"spin1 spin2",cx:"12",cy:"12",r:"3"},null,-1),E("circle",{class:"spin1 spin3",cx:"20",cy:"12",r:"3"},null,-1)])])):(k(),A(D,{key:1,onClick:o=>a.load(d,r),class:de({hidden:!r.has&&!d.children.length}),icon:d.open?"mdi-menu-down":"mdi-menu-right",title:e.$gettext("Toggle child nodes"),variant:"text"},null,8,["onClick","class","icon","title"])),f(qe,{modelValue:d._checked,"onUpdate:modelValue":o=>d._checked=o,class:de({draft:!r.published})},null,8,["modelValue","onUpdate:modelValue","class"]),r.id?(k(),A(fe,{key:2,location:"center"},{activator:g(({props:o})=>[f(D,Je(o,{title:e.$gettext("Actions"),icon:"mdi-dots-vertical",variant:"text"}),null,16,["title"])]),default:g(()=>[f(pe,null,{default:g(()=>[!r.deleted_at&&!r.published&&i.auth.can("page:publish")?(k(),A(I,{key:0},{default:g(()=>[f(D,{"prepend-icon":"mdi-publish",variant:"text",onClick:o=>a.publish(d)},{default:g(()=>[P(x(e.$gettext("Publish")),1)]),_:1},8,["onClick"])]),_:2},1024)):_("",!0),f(I,null,{append:g(()=>[f(me,{icon:"mdi-menu-right"})]),default:g(()=>[f(D,{"prepend-icon":"mdi-eye-arrow-right-outline",variant:"text"},{default:g(()=>[P(x(e.$gettext("Status")),1)]),_:1}),f(fe,{activator:"parent","open-on-hover":"",submenu:""},{default:g(()=>[f(pe,null,{default:g(()=>[r.status!==0&&i.auth.can("page:save")?(k(),A(I,{key:0},{default:g(()=>[f(D,{"prepend-icon":"mdi-eye-off",variant:"text",onClick:o=>a.status(d,0)},{default:g(()=>[P(x(e.$gettext("Disable")),1)]),_:1},8,["onClick"])]),_:2},1024)):_("",!0),r.status!==1&&i.auth.can("page:save")?(k(),A(I,{key:1},{default:g(()=>[f(D,{"prepend-icon":"mdi-eye",variant:"text",onClick:o=>a.status(d,1)},{default:g(()=>[P(x(e.$gettext("Enable")),1)]),_:1},8,["onClick"])]),_:2},1024)):_("",!0),r.status!==2&&i.auth.can("page:save")?(k(),A(I,{key:2},{default:g(()=>[f(D,{"prepend-icon":"mdi-eye-off-outline",variant:"text",onClick:o=>a.status(d,2)},{default:g(()=>[P(x(e.$gettext("Hide")),1)]),_:1},8,["onClick"])]),_:2},1024)):_("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024),i.auth.can("page:move")?(k(),A(I,{key:1},{default:g(()=>[f(D,{"prepend-icon":"mdi-content-cut",variant:"text",onClick:o=>a.cut(d,r)},{default:g(()=>[P(x(e.$gettext("Cut")),1)]),_:1},8,["onClick"])]),_:2},1024)):_("",!0),!this.embed&&i.auth.can("page:add")?(k(),A(I,{key:2},{default:g(()=>[f(D,{"prepend-icon":"mdi-content-copy",variant:"text",onClick:o=>a.copy(d,r)},{default:g(()=>[P(x(e.$gettext("Copy")),1)]),_:1},8,["onClick"])]),_:2},1024)):_("",!0),s.clip&&s.clip.type=="copy"&&!this.embed&&i.auth.can("page:add")?(k(),A(I,{key:3},{append:g(()=>[f(me,{icon:"mdi-menu-right"})]),default:g(()=>[f(D,{"prepend-icon":"mdi-clipboard-arrow-right-outline",variant:"text"},{default:g(()=>[P(x(e.$gettext("Paste")),1)]),_:1}),f(fe,{activator:"parent","open-on-hover":"",submenu:""},{default:g(()=>[f(pe,null,{default:g(()=>[f(I,null,{default:g(()=>[f(D,{"prepend-icon":"mdi-arrow-up",variant:"text",onClick:o=>a.paste(d,0),class:"subitem"},{default:g(()=>[P(x(e.$gettext("Before")),1)]),_:1},8,["onClick"])]),_:2},1024),f(I,null,{default:g(()=>[f(D,{"prepend-icon":"mdi-arrow-right",variant:"text",onClick:o=>a.paste(d),class:"subitem"},{default:g(()=>[P(x(e.$gettext("Into")),1)]),_:1},8,["onClick"])]),_:2},1024),f(I,null,{default:g(()=>[f(D,{"prepend-icon":"mdi-arrow-down",variant:"text",onClick:o=>a.paste(d,1),class:"subitem"},{default:g(()=>[P(x(e.$gettext("After")),1)]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)):_("",!0),!this.embed&&i.auth.can("page:add")?(k(),A(I,{key:4},{append:g(()=>[f(me,{icon:"mdi-menu-right"})]),default:g(()=>[f(D,{"prepend-icon":"mdi-arrow-right-bold-box-outline",variant:"text"},{default:g(()=>[P(x(e.$gettext("Insert")),1)]),_:1}),f(fe,{activator:"parent","open-on-hover":"",submenu:""},{default:g(()=>[f(pe,null,{default:g(()=>[f(I,null,{default:g(()=>[f(D,{"prepend-icon":"mdi-arrow-up",variant:"text",onClick:o=>a.insert(d,0),class:"subitem"},{default:g(()=>[P(x(e.$gettext("Before")),1)]),_:1},8,["onClick"])]),_:2},1024),f(I,null,{default:g(()=>[f(D,{"prepend-icon":"mdi-arrow-right",variant:"text",onClick:o=>a.insert(d),class:"subitem"},{default:g(()=>[P(x(e.$gettext("Into")),1)]),_:1},8,["onClick"])]),_:2},1024),f(I,null,{default:g(()=>[f(D,{"prepend-icon":"mdi-arrow-down",variant:"text",onClick:o=>a.insert(d,1),class:"subitem"},{default:g(()=>[P(x(e.$gettext("After")),1)]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)):_("",!0),f(I,null,{append:g(()=>[f(me,{icon:"mdi-menu-right"})]),default:g(()=>[f(D,{"prepend-icon":"mdi-delete-outline",variant:"text"},{default:g(()=>[P(x(e.$gettext("Remove")),1)]),_:1}),f(fe,{activator:"parent","open-on-hover":"",submenu:""},{default:g(()=>[f(pe,null,{default:g(()=>[!r.deleted_at&&i.auth.can("page:drop")?(k(),A(I,{key:0},{default:g(()=>[f(D,{"prepend-icon":"mdi-delete",variant:"text",onClick:o=>a.drop(d)},{default:g(()=>[P(x(e.$gettext("Delete")),1)]),_:1},8,["onClick"])]),_:2},1024)):_("",!0),r.deleted_at&&i.auth.can("page:keep")?(k(),A(I,{key:1},{default:g(()=>[f(D,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:o=>a.keep(d)},{default:g(()=>[P(x(e.$gettext("Restore")),1)]),_:1},8,["onClick"])]),_:2},1024)):_("",!0),i.auth.can("page:purge")?(k(),A(I,{key:2},{default:g(()=>[f(D,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:o=>a.purge(d)},{default:g(()=>[P(x(e.$gettext("Purge")),1)]),_:1},8,["onClick"])]),_:2},1024)):_("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)):_("",!0)]),E("div",{class:de(["item-content",{"status-hidden":r.status==2,"status-enabled":r.status==1,"status-disabled":!r.status,trashed:r.deleted_at,cut:d.cut}]),title:a.title(r)},[E("div",{class:"item-text",onClick:o=>e.$emit("select",r)},[E("div",Nn,[r.lang?(k(),L("span",Fn,x(r.lang),1)):_("",!0),r.publish_at?(k(),A(me,{key:1,class:"publish-at",icon:"mdi-clock-outline"})):_("",!0),r.status>1?(k(),A(me,{key:2,class:"item-status",icon:"mdi-eye-off-outline"})):_("",!0),E("span",Vn,x(r.name||e.$gettext("New")),1)]),r.title?(k(),L("div",Bn,x(r.title),1)):_("",!0)],8,An),E("a",{class:"item-aux",href:a.url(r),target:"_blank",draggable:"false"},[E("div",Kn,x(r.domain),1),E("span",Un,x(a.url(r)),1),r.to?(k(),L("span",Mn," ➔ "+x(r.to),1)):_("",!0)],8,Hn)],10,In)]),_:1},8,["modelValue","disableDrag","rtl"]),s.loading?(k(),L("p",zn,[P(x(e.$gettext("Loading"))+" ",1),t[14]||(t[14]=E("svg",{class:"spinner",width:"32",height:"32",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},[E("circle",{class:"spin1",cx:"4",cy:"12",r:"3"}),E("circle",{class:"spin1 spin2",cx:"12",cy:"12",r:"3"}),E("circle",{class:"spin1 spin3",cx:"20",cy:"12",r:"3"})],-1))])):_("",!0),!s.loading&&!s.items.length?(k(),L("p",Rn,x(e.$gettext("No entries found")),1)):_("",!0),!s.loading&&!s.items.length&&!this.embed&&this.auth.can("page:add")?(k(),L("div",jn,[f(D,{onClick:t[12]||(t[12]=r=>a.add()),title:e.$gettext("Add page"),icon:"mdi-folder-plus",color:"primary",variant:"flat"},null,8,["title"])])):_("",!0)],64)}const Yn=lt(_n,[["render",Wn]]),Xn={components:{PageListItems:Yn,PageDetail:Ze,Navigation:Nt,AsideList:At,User:It},inject:["locales","transcribe","openView"],data:()=>({chat:"",response:"",audio:null,help:!1,shortmsg:!0,synthesizing:!1,dictating:!1,filter:{view:"tree",trashed:"WITHOUT",publish:null,status:null,editor:null,cache:null,lang:null}}),setup(){const e=ot(),t=_t();return{auth:dt(),drawer:t,messages:e}},computed:{message(){if(!this.response)return this.chat;const e=this.response.indexOf(`
---
`);return this.shortmsg?this.$pgettext("ai",this.response.slice(0,e)):this.response.substring(e>0?e+5:0)}},methods:{languages(){const e=[{title:this.$gettext("All"),icon:"mdi-playlist-check",value:{lang:null}}];for(const t of this.locales())e.push({title:t.title,icon:"mdi-translate",value:{lang:t.value}});return e},open(e){this.openView(Ze,{item:e})},record(){if(!this.audio)return this.audio=St().start();this.audio.then(e=>{this.dictating=!0,this.audio=null,e.stop().then(t=>{this.transcribe(t).then(n=>{this.chat=n.asText()}).finally(()=>{this.dictating=!1})})})},same(e,t){if(!e||!t)return!1;const n=Object.keys(e),i=Object.keys(t);return n.length===i.length&&n.every(s=>e[s]===t[s])},synthesize(){const e=this.chat.trim();this.chat&&(this.synthesizing=!0,this.$apollo.mutate({mutation:U`mutation($prompt: String!) {
            synthesize(prompt: $prompt)
          }`,variables:{prompt:e}}).then(t=>{var i,s;if(t.errors)throw t;this.response=((i=t.data)==null?void 0:i.synthesize)||"",this.chat=this.message;const n={view:"list",publish:"DRAFT",trashed:"WITHOUT",editor:(s=this.auth.me)==null?void 0:s.email,cache:null,lang:null,status:0};this.same(n,this.filter)?this.$refs.pagelist.reload():this.filter=n,this.synthesizing=null}).catch(t=>{this.messages.add(this.$gettext("Error synthesizing content")+`:
`+t,"error"),this.$log("PageDetailContentList::synthesize(): Error synthesizing content",t)}).finally(()=>{setTimeout(()=>{this.synthesizing=!1},3e3)}))}}},qn={key:0,fill:"currentColor",width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Jn={key:1,fill:"currentColor",width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Zn={key:0,fill:"currentColor",width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Gn={key:1,fill:"currentColor",width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Qn={key:0,class:"help"};function ea(e,t,n,i,s,a){var u;const l=ae("User"),r=ae("Navigation"),d=ae("PageListItems"),o=ae("AsideList");return k(),L(ue,null,[f(xt,{elevation:0,density:"compact"},{prepend:g(()=>[f(D,{onClick:t[0]||(t[0]=h=>i.drawer.toggle("nav")),title:i.drawer.nav?e.$gettext("Close navigation"):e.$gettext("Open navigation"),icon:i.drawer.nav?"mdi-close":"mdi-menu"},null,8,["title","icon"])]),append:g(()=>[f(l),f(D,{onClick:t[1]||(t[1]=h=>i.drawer.toggle("aside")),title:e.$gettext("Toggle side menu"),icon:i.drawer.aside?"mdi-chevron-right":"mdi-chevron-left"},null,8,["title","icon"])]),default:g(()=>[f(Et,null,{default:g(()=>[P(x(e.$gettext("Pages")),1)]),_:1})]),_:1}),f(r),f(Dt,{class:"page-list"},{default:g(()=>[f(Ot,null,{default:g(()=>[f(Pt,{class:"box scroll"},{default:g(()=>[f(Lt,{modelValue:e.chat,"onUpdate:modelValue":t[6]||(t[6]=h=>e.chat=h),loading:e.synthesizing,placeholder:e.$gettext("Describe the page and content you want to create"),onDblclick:t[7]||(t[7]=h=>{e.shortmsg=!e.shortmsg,e.chat=a.message}),variant:"outlined",class:"prompt",rounded:"lg","hide-details":"",autofocus:"","auto-grow":"",clearable:"",outlined:"",rows:"1"},{prepend:g(()=>[f(D,{onClick:t[2]||(t[2]=h=>e.help=!e.help),title:e.help?e.$gettext("Hide help"):e.$gettext("Show help"),variant:"text",icon:""},{default:g(()=>[...t[10]||(t[10]=[E("svg",{fill:"currentColor",width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[E("path",{d:"M11,18H13V16H11V18M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,6A4,4 0 0,0 8,10H10A2,2 0 0,1 12,8A2,2 0 0,1 14,10C14,12 11,11.75 11,15H13C13,12.75 16,12.5 16,10A4,4 0 0,0 12,6Z"})],-1)])]),_:1},8,["title"])]),append:g(()=>[e.chat?(k(),A(D,{key:0,onClick:t[3]||(t[3]=h=>e.synthesizing||a.synthesize()),onKeydown:t[4]||(t[4]=Tt(h=>e.synthesizing||a.synthesize(),["enter"])),title:e.synthesizing?e.$gettext("Generating ..."):e.$gettext("Generate page based on prompt"),loading:e.synthesizing,variant:"text",icon:""},{default:g(()=>[e.synthesizing===!1?(k(),L("svg",qn,[...t[11]||(t[11]=[E("path",{d:"M22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2A10,10 0 0,1 22,12M6,13H14L10.5,16.5L11.92,17.92L17.84,12L11.92,6.08L10.5,7.5L14,11H6V13Z"},null,-1)])])):_("",!0),e.synthesizing===null?(k(),L("svg",Jn,[...t[12]||(t[12]=[E("path",{d:"M9,20.42L2.79,14.21L5.62,11.38L9,14.77L18.88,4.88L21.71,7.71L9,20.42Z"},null,-1)])])):_("",!0)]),_:1},8,["title","loading"])):(k(),A(D,{key:1,onClick:t[5]||(t[5]=h=>a.record()),title:e.$gettext("Dictate"),class:de({dictating:e.audio}),loading:e.dictating,variant:"text",icon:""},{default:g(()=>[e.audio?(k(),L("svg",Zn,[...t[13]||(t[13]=[E("path",{d:"M17.3,11C17.3,14 14.76,16.1 12,16.1C9.24,16.1 6.7,14 6.7,11H5C5,14.41 7.72,17.23 11,17.72V21H13V17.72C16.28,17.23 19,14.41 19,11M10.8,4.9C10.8,4.24 11.34,3.7 12,3.7C12.66,3.7 13.2,4.24 13.2,4.9L13.19,11.1C13.19,11.76 12.66,12.3 12,12.3C11.34,12.3 10.8,11.76 10.8,11.1M12,14A3,3 0 0,0 15,11V5A3,3 0 0,0 12,2A3,3 0 0,0 9,5V11A3,3 0 0,0 12,14Z"},null,-1)])])):(k(),L("svg",Gn,[...t[14]||(t[14]=[E("path",{d:"M12,2A3,3 0 0,1 15,5V11A3,3 0 0,1 12,14A3,3 0 0,1 9,11V5A3,3 0 0,1 12,2M19,11C19,14.53 16.39,17.44 13,17.93V21H11V17.93C7.61,17.44 5,14.53 5,11H7A5,5 0 0,0 12,16A5,5 0 0,0 17,11H19Z"},null,-1)])]))]),_:1},8,["title","class","loading"]))]),_:1},8,["modelValue","loading","placeholder"]),e.help?(k(),L("div",Qn,[E("ul",null,[E("li",null,x(e.$gettext("AI can create a page and content based on your input and add it to the page tree")),1),E("li",null,x(e.$gettext("Double click on the response in the input field to display full response")),1)])])):_("",!0),f(d,{ref:"pagelist",onSelect:t[8]||(t[8]=h=>a.open(h)),filter:e.filter},null,8,["filter"])]),_:1})]),_:1})]),_:1}),f(o,{filter:e.filter,"onUpdate:filter":t[9]||(t[9]=h=>e.filter=h),content:[{key:"view",title:e.$gettext("view"),items:[{title:e.$gettext("Tree"),icon:"mdi-file-tree",value:{view:"tree"}},{title:e.$gettext("List"),icon:"mdi-format-list-bulleted-square",value:{view:"list"}}]},{key:"publish",title:e.$gettext("publish"),items:[{title:e.$gettext("All"),icon:"mdi-playlist-check",value:{publish:null}},{title:e.$gettext("Published"),icon:"mdi-publish",value:{publish:"PUBLISHED"}},{title:e.$gettext("Scheduled"),icon:"mdi-clock-outline",value:{publish:"SCHEDULED"}},{title:e.$gettext("Drafts"),icon:"mdi-pencil",value:{publish:"DRAFT"}}]},{key:"trashed",title:e.$gettext("trashed"),items:[{title:e.$gettext("All"),icon:"mdi-playlist-check",value:{trashed:"WITH"}},{title:e.$gettext("Available only"),icon:"mdi-delete-off",value:{trashed:"WITHOUT"}},{title:e.$gettext("Only trashed"),icon:"mdi-delete",value:{trashed:"ONLY"}}]},{key:"status",title:e.$gettext("status"),items:[{title:e.$gettext("All"),icon:"mdi-playlist-check",value:{status:null}},{title:e.$gettext("Enabled"),icon:"mdi-eye",value:{status:1}},{title:e.$gettext("Hidden"),icon:"mdi-eye-off-outline",value:{status:2}},{title:e.$gettext("Disabled"),icon:"mdi-eye-off",value:{status:0}}]},{key:"cache",title:e.$gettext("cache"),items:[{title:e.$gettext("All"),icon:"mdi-playlist-check",value:{cache:null}},{title:e.$gettext("No cache"),icon:"mdi-clock-alert-outline",value:{cache:0}}]},{key:"editor",title:e.$gettext("editor"),items:[{title:e.$gettext("All"),icon:"mdi-playlist-check",value:{editor:null}},{title:e.$gettext("Edited by me"),icon:"mdi-account",value:{editor:(u=this.auth.me)==null?void 0:u.email}}]},{key:"lang",title:e.$gettext("languages"),items:a.languages()}]},null,8,["filter","content"])],64)}const la=lt(Xn,[["render",ea],["__scopeId","data-v-635cebcd"]]);export{la as default};
