var yt=Object.defineProperty;var bt=(e,t,n)=>t in e?yt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var ge=(e,t,n)=>bt(e,typeof t!="symbol"?t+"":t,n);import{av as $e,r as ae,c as L,o as k,a as f,w as g,F as ue,a5 as We,bl as B,bm as oe,R as fe,y as Y,bh as ke,U as Ye,ay as kt,bb as Fe,f as O,b as A,n as de,l as S,t as x,d as _,_ as dt,L as K,aG as $t,a7 as ut,a3 as ct,a4 as wt,aP as Ee,aR as Ze,h as Ct,I as xt,k as D,i as Je,j as I,ak as Be,m as pe,ah as Dt,a9 as St,ai as Et,aj as _t,aV as He,aI as Ge,aM as Ot,aN as Pt,a6 as Lt,aL as Tt,aO as It,aD as At,aE as Vt,a1 as Nt,aC as Ft}from"./index-BbU18Jta.js";import{U as Bt,A as Ht,N as Ut}from"./Navigation-0MLoaZQr.js";import{P as Qe}from"./PageDetail-BaWJDP5k.js";import"./ElementListItems-DanGspw6.js";import"./vue-draggable-plus-BuDKqo2a.js";var Kt=!1,Mt=!0;/*!
 * helper-js v3.1.6
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: null
 * Released under the MIT License.
 */function Le(e){return Object.prototype.toString.call(e)==="[object Array]"}function et(e){return Object.prototype.toString.call(e)==="[object Object]"}function zt(e){return typeof e=="function"}function Rt(e,t){return e<t?e:t}function ht(e,t){let n,i=0;for(;(n=e.indexOf(t))>-1;)e.splice(n,1),i++;return i}function gt(e){return e[e.length-1]}function jt(e){return Le(e)?e:[e]}function Wt(e,t){let n=new Set(t);const i={};return n.forEach(l=>{i[l]=e[l]}),i}function Yt(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(function*(){if(t.reverse)if(e.length!=null)for(let n=e.length-1;n>=0;n--){const i={value:e[n],index:n};(!t.exclude||!t.exclude(i))&&(yield i)}else if(et(e)){const n=Object.keys(e);n.reverse();for(const i of n){const l={value:e[i],key:i};(!t.exclude||!t.exclude(l))&&(yield l)}}else throw"Unsupported type";else if(e.length!=null)for(let n=0;n<e.length;n++){const i={value:e[n],index:n};(!t.exclude||!t.exclude(i))&&(yield i)}else if(et(e))for(const n of Object.keys(e)){const i={value:e[n],key:n};(!t.exclude||!t.exclude(i))&&(yield i)}else throw"Unsupported type"})()}function Xt(e,t,n){e.hasOwnProperty(t)||(e[t]=n)}function ft(e,t){return Object.keys(t).forEach(n=>{Xt(e,n,t[n])}),e}function qt(e){const t={};return Object.keys(e).forEach(n=>{e[n]!==void 0&&(t[n]=e[n])}),t}function Z(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};n=ft({...n},{childrenKey:"children"});const{childrenKey:i}=n,l=Le(e)?e:[e];class a{}const s=(r,u,o)=>{n.reverse&&(r=r.slice(),r.reverse());const c=r.length;for(let d=0;d<c;d++){const h=r[d],p=n.reverse?c-d-1:d,v=o?[...o,p]:[];n.childFirst&&h[i]!=null&&s(h[i],h,v);const $=t(h,p,u,v);if($===!1)throw new a;if($==="skip children")continue;if($==="skip siblings")break;n.childFirst||h[i]!=null&&s(h[i],h,v)}};try{s(l,null,Le(e)?[]:null)}catch(r){if(!(r instanceof a))throw r}}function Zt(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i;return Z(e,function(){if(t(...arguments))return i={node:arguments.length<=0?void 0:arguments[0],index:arguments.length<=1?void 0:arguments[1],parent:arguments.length<=2?void 0:arguments[2],path:arguments.length<=3?void 0:arguments[3]},!1},n),i}function Jt(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=Zt(e,t,n);return i==null?void 0:i.node}function pt(e,t){const n={childrenKey:"children"};t&&Object.assign(n,t);const{childrenKey:i,nodeHandler:l}=n,a=new Xe;return a.childrenKey=i,Z(e,(s,r,u,o)=>{let c=Object.assign({},s);c[i]&&(c[i]=[]),l&&(c=l(c,{oldNode:s,index:r,parent:u,path:o})),a.set(o,c)},{childrenKey:i}),a.data}class Xe{constructor(){ge(this,"data");ge(this,"childrenKey","children");let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this.data=t}get rootChildren(){const{childrenKey:t}=this,{data:n}=this;return Le(n)?n:n[t]}iteratePath(t){var n=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(function*(){const{childrenKey:l,rootChildren:a}=n;if(i.reverse){const s=[...n.iteratePath(t,{...i,reverse:!1})];s.reverse();for(const{path:r,node:u}of s)yield{path:r,node:u}}else{let s=[],r=a;for(const u of t){const o=[...s,u],c=r[u];yield{path:o,node:c},s=o,r=c[l]}}})()}getFamily(t){const n=[];for(const{node:i}of this.iteratePath(t))n.push(i);return n}get(t){return gt(this.getFamily(t))}getParentAndIndex(t){const n=t.slice(),i=n.pop();return{parent:this.get(n),index:i,parentPath:n}}getParent(t){return this.getParentAndIndex(t).parent}set(t,n){if(t==null||t.length===0)this.data=n;else{const{childrenKey:i}=this;let{rootChildren:l}=this;const{parent:a,index:s}=this.getParentAndIndex(t);let r;t.length===1?(l||(this.data?this.data[i]=[]:this.data=[]),r=l):(a[i]||(a[i]=[]),r=a[i]),r[s]=n}}delete(t){const{childrenKey:n,rootChildren:i}=this,{parent:l,index:a}=this.getParentAndIndex(t),s=t.length===1?i:l[n],r=s[a];return s.splice(a,1),r}walk(t,n){const{childrenKey:i,data:l}=this;return Z(l,t,i,n)}clone(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return pt(this.data),qt({childrenKey:this.childrenKey,nodeHandler:t.nodeHandler||void 0})}}function tt(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return zt(e)?e(...t):e}function Gt(e,t){return function(){let i,l;try{i=e(...arguments)}catch(a){l=a}finally{}if(l)throw l;return i}}function me(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=[];let i;const l={};let a=l;return{action:function(){for(var u=arguments.length,o=new Array(u),c=0;c<u;c++)o[c]=arguments[c];if(o.length===0)return a===l&&(a=e()),a;if(i||(i=new nn),!i.has(o)&&(i.set(o,e(...o)),t.capacity!=null)){n.push(o);const d=n.splice(0,n.length-t.capacity);for(const h of d)i.delete(h)}return i.get(o)},clearCache:()=>{i=null,n.splice(0,n.length)}}}function Qt(){let e,t;return{promise:new Promise((i,l)=>{e=i,t=l}),resolve:e,reject:t}}function en(e,t){for(;;){if(e.parentNode==null)return!1;if(e.parentNode===t)return!0;e=e.parentNode}}function Ue(e){let t=e.getBoundingClientRect();if(document.documentElement.clientTop>0){const n=t.top-document.documentElement.clientTop,i=t.bottom,l=t.left-document.documentElement.clientLeft,a=t.right,s=t.width||a-l,r=t.height||i-n,c={top:n,right:a,bottom:i,left:l,width:s,height:r,x:l,y:n};t={...c,toJSON:()=>c}}return t}function nt(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=n&&n.withSelf?e:e.parentElement;for(;i;){const l=n.until&&i===n.until;if(l&&!n.withUntil)return;const a=t(i);if(a==="break")return;if(a)return i;if(l)return;i=i.parentElement}}function Te(e,t){return e.classList?e.classList.contains(t):new RegExp("(^| )"+t+"( |$)","gi").test(e.className)}function at(e,t){for(const n of t)if(Te(e,n))return!0;return!1}function J(e,t,n,i){e.addEventListener?e.addEventListener(t,n,i):e.attachEvent&&e.attachEvent(`on${t}`,n,i)}function G(e,t,n,i){e.removeEventListener?e.removeEventListener(t,n,i):e.detachEvent&&e.detachEvent(`on${t}`,n,i)}function tn(e){let t=[];const n=()=>{if(!l.listening){for(const a of e){J.apply(this,a);const s=()=>G.apply(this,a);t.push(s)}l.listening=!0}},l={listening:!1,stop:()=>{if(l.listening){for(const a of t)a();t=[],l.listening=!1}},resume:n,start:n};return l.start(),l}function Ie(e,t){return getComputedStyle(e)[t]}function qe(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};n={start:0,end:e.length-1,maxTimes:1e3,...n};let{start:i,end:l}=n;const{returnNearestIfNoHit:a,maxTimes:s}=n;let r,u;i==null&&(i=0,l=e.length-1);let o=0,c;for(;i>=0&&i<=l;){if(o>=s)throw Error(`binarySearch: loop times is over ${s}, you can increase the limit.`);r=Math.floor((l-i)/2+i),u=e[r];const d=o+1;if(c=t(u,r,d),c>0)l=r-1;else if(c<0)i=r+1;else return{index:r,value:u,count:d,hit:!0};o++}return a?{index:r,value:u,count:o+1,hit:!1,greater:c>0}:null}class nn{constructor(){ge(this,"_map",new Map);ge(this,"_values",{});ge(this,"_objCount",0)}_keysToString(t){const{_map:n}=this;let i=[];for(const l of t){if(!n.has(l))return null;i.push(n.get(l)[0])}return i.toString()}has(t){return this._keysToString(t)!=null}get(t){const{_values:n}=this,i=this._keysToString(t);if(i==null)throw"Value not found by specified keys";return n[i][1]}set(t,n){const{_map:i,_values:l}=this;let a=[];for(const s of t){let r,u=1;i.has(s)?([r,u]=i.get(s),u++):(this._objCount++,r=this._objCount.toString()),i.set(s,[r,u]),a.push(r)}l[a.toString()]=[t.slice(),n]}delete(t){const{_values:n,_map:i}=this,l=this._keysToString(t);if(l==null)throw"Value not found by specified keys";delete n[l];for(const a of t){let[s,r]=i.get(a);r--,r===0?i.delete(a):i.set(a,[s,r])}}clear(){this._map.clear(),this._values={}}*entries(){const{_values:t}=this;for(const n in t){const[i,l]=t[n];yield[i,l]}}count(){return[...this.entries()].length}}/*!
 * @virtual-list/vue
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: https://virtual-list.phphe.com
 * Released under the MIT License.
 */const an=$e({props:{table:Boolean}}),mt=(e,t)=>{const n=e.__vccOpts||e;for(const[i,l]of t)n[i]=l;return n},rn={key:0},ln={key:1};function sn(e,t,n,i,l,a){return e.table?(k(),L("table",rn,[B(e.$slots,"prepend"),O("tbody",null,[B(e.$slots,"default")]),B(e.$slots,"append")])):(k(),L("div",ln,[B(e.$slots,"prepend"),B(e.$slots,"default"),B(e.$slots,"append")]))}const on=mt(an,[["render",sn]]),dn=$e({components:{VirtualListTable:on},props:{items:Array,disabled:Boolean,horizontal:Boolean,firstRender:{type:Number,default:10},buffer:{type:Number,default:100},itemKey:{type:[String,Function]},itemSize:{type:Function},table:Boolean},setup(e){const t=fe(0),n=fe(e.firstRender-1),i=Y(()=>{var C;return Rt(n.value,(((C=e.items)==null?void 0:C.length)||1)-1)}),l=fe(0),a=Y(()=>h.value[t.value]?he(t.value):0),s=Y(()=>h.value.length>0?he(h.value.length-1)+gt(d.value):0),r=Y(()=>h.value[i.value]?s.value-he(i.value)-d.value[i.value]:0),u=Y(()=>e.disabled?{}:{overflow:"auto"}),o=Y(()=>{const C={display:"flex"};return e.disabled||(e.horizontal?Object.assign(C,{"margin-left":a.value+"px","margin-right":r.value+"px",width:s.value-r.value-a.value+"px"}):Object.assign(C,{"margin-top":a.value+"px","margin-bottom":r.value+"px"})),C["flex-direction"]=e.horizontal?"row":"column",e.table&&(delete C.display,delete C["flex-direction"]),C}),c=Y(()=>ke((e.items||[]).map(()=>null))),d=Y(()=>(e.items||[]).map((C,b)=>{var y;if(c[b]!=null)return c[b];let F=(y=e.itemSize)==null?void 0:y.call(e,C,b);return F==null&&(F=l.value),F})),h=Y(()=>{const C=[];return d.value.reduce((b,y)=>(C.push(b),b+y),0),C});Ye(()=>e.items,V);const p=Y(()=>{if(!e.items||e.disabled)return;const C=[];for(let b=t.value;b<=i.value;b++){const y=e.items[b];if(!y)break;C.push({item:y,index:b})}return C}),v=fe(),$=fe();kt(async()=>{V();try{Ne()}catch{await Fe(),V()}});let E;function N(){const C=v.value;if(!C)return;const b=ne(C);E!=null&&e.buffer-Math.abs(b-E)>=10||(E=b,V())}let H=!1,Q=!1;async function V(){var C;if(H){Q=!0;return}if(!e.items||e.disabled)return;H=!0;const b=v.value,y=(C=$.value)==null?void 0:C.$el;if(!b||!y)return;l.value||(l.value=De()),t.value=Ce(),n.value=xe(),await Fe();let F,X=0;const z={},ie=e.table?y.querySelector("tbody").children:y.children;for(let P=0;P<ie.length;P++){const T=ie[P],U=Ie(T,"position");if(U&&["absolute","fixed"].includes(U))continue;const ee=Ie(T,"display")!=="none"?ce(T):0,re=T.getAttribute("vt-index"),Se=re?parseInt(re):t.value+X;z[Se]=(z[Se]||0)+ee,X++}for(const P of Object.keys(z)){const T=parseInt(P);c.value[T]!==z[T]&&(c.value[T]=z[T],F=!0)}F&&await Fe(),H=!1,Q&&(Q=!1,V());function Ce(){const P=ne(b)-M(b)-e.buffer;return qe(h.value,T=>T-P,{returnNearestIfNoHit:!0}).index}function xe(){const P=ne(b)-M(b)+q(b)+e.buffer;return qe(h.value,T=>T-P,{returnNearestIfNoHit:!0}).index}function De(){const P=[],T=e.table?y.querySelector("tbody").children:y.children;for(let U=0;U<T.length;U++){const ee=T[U],re=getComputedStyle(ee);if(["absolute","fixed"].includes(re.position))continue;const Se=ce(ee);if(P.push(Se),P.length>=10)break}return P.length===0?0:P.reduce((U,ee)=>U+ee,0)/P.length}}function q(C){const b=getComputedStyle(C);let y=parseFloat(e.horizontal?b.width:b.height);return b.boxSizing==="border-box"&&(e.horizontal?y=y-parseFloat(b.borderLeftWidth)-parseFloat(b.borderRightWidth):y=y-parseFloat(b.borderTopWidth)-parseFloat(b.borderBottomWidth)),y}function ce(C){let b=q(C);const y=getComputedStyle(C);return e.horizontal?b+=parseFloat(y.borderLeftWidth)+parseFloat(y.borderRightWidth)+parseFloat(y.marginLeft)+parseFloat(y.marginRight):b+=parseFloat(y.borderTopWidth)+parseFloat(y.borderBottomWidth)+parseFloat(y.marginTop)+parseFloat(y.marginBottom),b=Number.isNaN(b)?0:b,b}function ne(C){return e.horizontal?C.scrollLeft:C.scrollTop}function M(C){const b=getComputedStyle(C);return e.horizontal?parseFloat(b.paddingLeft):parseFloat(b.paddingTop)}function he(C){return h.value[C]}function Ne(){const C=v.value;new ResizeObserver(b=>{for(let y of b)if(Te(y.target,"vtlist")){V();break}}).observe(C)}function we(C,b){if(e.itemKey){if(typeof e.itemKey=="string"&&e.itemKey==="index")return b;if(typeof e.itemKey=="function")return e.itemKey(C,b)}}return{listElRef:v,listInnerRef:$,onscroll:N,listStyle:u,listInnerStyle:o,visibleItemsInfo:p,getItemKey:we,update:V,sizes:d,positions:h,runtimeSizes:c}}});function un(e,t,n,i,l,a){const s=ae("VirtualListTable");return k(),L("div",{class:"vtlist",ref:"listElRef",style:oe(e.listStyle),onScrollPassive:t[0]||(t[0]=(...r)=>e.onscroll&&e.onscroll(...r))},[f(s,{class:"vtlist-inner",ref:"listInnerRef",style:oe(e.listInnerStyle),table:e.table},{prepend:g(()=>[B(e.$slots,"prepend")]),append:g(()=>[B(e.$slots,"append")]),default:g(()=>[e.disabled?(k(!0),L(ue,{key:0},We(e.items,(r,u)=>B(e.$slots,"default",{key:e.getItemKey(r,u),item:r,index:u})),128)):(k(!0),L(ue,{key:1},We(e.visibleItemsInfo,({item:r,index:u})=>B(e.$slots,"default",{key:e.getItemKey(r,u),item:r,index:u})),128))]),_:3},8,["style","table"])],36)}const cn=mt(dn,[["render",un]]);/*!
 * @he-tree/tree-utils v0.1.0-alpha.5
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: null
 * Released under the MIT License.
 */const se="children";function hn(e){const n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i={...gn,...n,data:e,stats:null,statsFlat:null,_statsMap:null,initialized:!1,init(){const{data:a,childrenKey:s}=this,r=new Xe([]);this._statsMap=new Map,Z(a,(o,c,d,h)=>{const p=this.statHandler({...it(),data:o,open:!!this.defaultOpen,parent:r.getParent(h),children:[],level:h.length});this._statsMap.set(o,p),r.set(h,p)},{childrenKey:s});const u=[];r.walk(o=>{u.push(o)}),this.stats=this.statsHandler(r.rootChildren),this.statsFlat=this.statsFlatHandler(u),this.initialized=!0},getStat(a){let s=this._statsMap.get(a);if(!s)throw new rt("Stat not found");return s},has(a){if(a.isStat)return this.statsFlat.indexOf(a)>-1;try{return!!this.getStat(a)}catch(s){if(s instanceof rt)return!1;throw s}},_getPathByStat(a){if(a==null)return[];const r=this.getSiblings(a).indexOf(a);return[...a.parent?this._getPathByStat(a.parent):[],r]},afterOneCheckChanged(a){const{checked:s}=a;if(a._ignoreCheckedOnce)return delete a._ignoreCheckedOnce,!1;const r=u=>{const{parent:o}=u;if(o){let c,d,h;for(const v of o.children)v.checked?c=!0:v.checked===0?h=!0:d=!0;const p=h?0:d?c?0:!1:!0;o.checked!==p&&(this._ignoreCheckedOnce(o),o.checked=p),r(o)}};return r(a),Z(a.children,u=>{u.checked!==s&&(this._ignoreCheckedOnce(u),u.checked=s)},{childrenKey:se}),!0},_ignoreCheckedOnce(a){a._ignoreCheckedOnce=!0,setTimeout(()=>{a._ignoreCheckedOnce&&(a._ignoreCheckedOnce=!1)},100)},isVisible(a){const s=a.isStat?a:this.getStat(a),r=u=>!u||!u.hidden&&u.open&&r(u.parent);return!!(!s.hidden&&r(s.parent))},updateCheck(){Z(this.stats,a=>{if(a.children&&a.children.length>0){const s=a.children.every(r=>r.checked);a.checked!==s&&(this._ignoreCheckedOnce(a),a.checked=s)}},{childFirst:!0,childrenKey:se})},getChecked(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return this.statsFlat.filter(s=>s.checked||a&&s.checked===0)},getUnchecked(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this.statsFlat.filter(s=>a?!s.checked:s.checked===!1)},openAll(){for(const a of this.statsFlat)a.open=!0},closeAll(){for(const a of this.statsFlat)a.open=!1},openNodeAndParents(a){const s=a.isStat?a:this.getStat(a);for(const r of this.iterateParent(s,{withSelf:!0}))r.open=!0},_calcFlatIndex(a,s){let r=a?this.statsFlat.indexOf(a)+1:0;const u=a?a.children:this.stats;for(let o=0;o<s;o++)r+=this._count(u[o]);return r},add(a,s,r){if(this.has(a))throw"Can't add because data exists in tree";const u=s?s.children:this.stats;r==null&&(r=u.length);const o=this.statHandler({...it(),open:!!this.defaultOpen,data:a,parent:s||null,children:[],level:s?s.level+1:1});this._setPosition(o,s||null,r);const c=a[this.childrenKey];if(c){const d=c.slice();for(const h of d)this.add(h,o)}},remove(a){const s=this.getSiblings(a);if(s.includes(a)){ht(s,a);const r=this._flat(a);this.statsFlat.splice(this.statsFlat.indexOf(a),r.length);for(const u of r)this._statsMap.delete(u.data);return this.afterRemoveStat(a),!0}return!1},getSiblings(a){const{parent:s}=a;return s?s.children:this.stats},_setPosition(a,s,r){(s?s.children:this.stats).splice(r,0,a),a.parent=s,a.level=s?s.level+1:1;const o=this._calcFlatIndex(s,r),c=this._flat(a);this.statsFlat.splice(o,0,...c);for(const d of c)this._statsMap.has(d.data)||this._statsMap.set(d.data,d);Z(a,(d,h,p)=>{p&&(d.level=p.level+1)},{childrenKey:se}),this.afterSetStat(a,s,r)},*iterateParent(a,s){let r=s!=null&&s.withSelf?a:a.parent;for(;r;)yield r,r=r.parent},move(a,s,r){if(this.has(a)){if(a.parent===s&&this.getSiblings(a).indexOf(a)===r)return!1;if(a===s)throw new Error("Can't move node to it self");if(s&&a.level<s.level){let u;for(const o of this.iterateParent(s))if(o.level===a.level){u=o;break}if(a===u)throw new Error("Can't move node to its descendant")}this.remove(a)}return this._setPosition(a,s,r),!0},_flat(a){const s=[];return Z(a,r=>{s.push(r)},{childrenKey:se}),s},_count(a){return this._flat(a).length},getData(a,s){const{childrenKey:r}=this,u=new Xe([]);return u.childrenKey=r,Z(s||this.stats,(o,c,d,h)=>{let p={...o.data,[r]:[]};a&&(p=a(p)),u.set(h,p)},{childrenKey:se}),u.data}},l=i;return i.noInitialization||l.init(),l}const gn={childrenKey:"children",defaultOpen:!1,statsHandler(e){return e},statsFlatHandler(e){return e},afterSetStat(e,t,n){},afterRemoveStat(e){},statHandler(e){return e}};function it(){return{isStat:!0,hidden:!1,checked:!1,style:null,class:null,draggable:null,droppable:null}}class rt extends Error{constructor(t){super(t),this.name="StatNotFoundError"}}/*!
 * drag-event-service v2.0.0
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: null
 * Released under the MIT License.
 */const _e={start:["mousedown","touchstart"],move:["mousemove","touchmove"],end:["mouseup","touchend"]},Ke={isTouch(e){return e.type&&e.type.startsWith("touch")},_getStore(e){return e._wrapperStore||(e._wrapperStore=[]),e._wrapperStore},on(e,t,n,i){const{args:l,mouseArgs:a,touchArgs:s}=lt(i),r=this._getStore(e),u=this,o=function(c){let d;if(u.isTouch(c))d={x:c.changedTouches[0].pageX,y:c.changedTouches[0].pageY,pageX:c.changedTouches[0].pageX,pageY:c.changedTouches[0].pageY,clientX:c.changedTouches[0].clientX,clientY:c.changedTouches[0].clientY,screenX:c.changedTouches[0].screenX,screenY:c.changedTouches[0].screenY};else if(d={x:c.pageX,y:c.pageY,pageX:c.pageX,pageY:c.pageY,clientX:c.clientX,clientY:c.clientY,screenX:c.screenX,screenY:c.screenY},t==="start"&&c.which!==1)return;return n.call(this,c,d)};r.push({handler:n,wrapper:o}),J.call(null,e,_e[t][0],o,...l,...a),J.call(null,e,_e[t][1],o,...l,...s)},off(e,t,n,i){const{args:l,mouseArgs:a}=lt(i),s=this._getStore(e);for(let r=s.length-1;r>=0;r--){const{handler:u,wrapper:o}=s[r];n===u&&(G.call(null,e,_e[t][0],o,...l,...a),G.call(null,e,_e[t][1],o,...l,...a),s.splice(r,1))}}};function lt(e){e||(e={});const t=e.args||[],n=e.mouseArgs||[],i=e.touchArgs||[];return{args:t,mouseArgs:n,touchArgs:i}}/*!
 * @he-tree/dnd-utils v0.1.0-alpha.4
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: null
 * Released under the MIT License.
 */const Me=new Map,te={triggerElement:null,dragElement:null,internal:!1,dropEffect:"none",preventDefault:!1},W=te;function ve(e){e.dataTransfer&&(e.dataTransfer.dropEffect=W.dropEffect)}function fn(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Me.has(e))throw"Already registered on specified element";const n={...t},i=n;ft(n,pn),Ke.on(e,"start",l,{touchArgs:[{passive:!0}]}),Ke.on(e,"end",a);function l(d){var h;const p=d.target;p.nodeType===Node.ELEMENT_NODE&&(W.triggerElement=p);const v=p;if(n.ingoreHTMLTags&&v.tagName&&n.ingoreHTMLTags.find(E=>E.toUpperCase()===v.tagName))return;const $=(h=n.beforeDragStart)===null||h===void 0?void 0:h.call(n,d);$&&($.setAttribute("draggable","true"),W.dragElement=$)}function a(d){W.dragElement&&W.dragElement.removeAttribute("draggable")}function s(d){var h;W.internal=!0,(h=n.onDragStart)===null||h===void 0||h.call(n,d),ve(d)}function r(d){var h;(h=n.onDrag)===null||h===void 0||h.call(n,d),ve(d)}function u(d){var h;(h=n.onDragEnd)===null||h===void 0||h.call(n,d),W.internal=!1,W.dragElement&&W.dragElement.removeAttribute("draggable"),W.triggerElement=null,W.dragElement=null,W.dropEffect="none"}const o=vn(e,{onDragLeave(d){var h;(h=n.onDragLeave)===null||h===void 0||h.call(n,d),ve(d)},onDragEnter(d){var h;i.ifPreventDefault(d)&&d.preventDefault(),(h=n.onDragEnter)===null||h===void 0||h.call(n,d),ve(d)},onDragOver(d){var h;i.ifPreventDefault(d)&&d.preventDefault(),(h=n.onDragOver)===null||h===void 0||h.call(n,d),ve(d)},onDrop(d){var h;i.ifPreventDefault(d)&&d.preventDefault(),(h=n.onDrop)===null||h===void 0||h.call(n,d)},onEnter(d){var h;(h=n.onEnter)===null||h===void 0||h.call(n,d)},onLeave(d){var h;(h=n.onLeave)===null||h===void 0||h.call(n,d)}});return J(e,"dragstart",s),J(e,"drag",r),J(e,"dragend",u),Object.assign(n,{root:e,destroy:()=>{Ke.off(e,"start",l,{touchArgs:[{passive:!0}]}),G(e,"dragstart",s),G(e,"drag",r),G(e,"dragend",u),o(),Me.delete(e)}}),Me.set(e,i),i}const pn={ingoreHTMLTags:["INPUT","TEXTAREA","SELECT","OPTGROUP","OPTION"],ifPreventDefault(e){return te.dragElement?!0:W.preventDefault},beforeDragStart(e){},onDragStart(e){},onDrag(e){},onDragEnter(e){},onDragLeave(e){},onDragOver(e){},onDragEnd(e){},onDrop(e){}};let Ae=null;const mn=e=>{Ae=e,setTimeout(()=>{Ae=null},20)};function vn(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=e;let i=!1;const l=p=>{var v;i=!0,(v=t.onEnter)===null||v===void 0||v.call(t,p),c.resume()},a=p=>{var v;mn(p.target),(v=t.onDragEnter)===null||v===void 0||v.call(t,p),i||l(p)},s=p=>{var v;i||l(p),(v=t.onDragOver)===null||v===void 0||v.call(t,p)},r=p=>{var v;(v=t.onDragLeave)===null||v===void 0||v.call(t,p);const $=function(){var N;let H=arguments.length>0&&arguments[0]!==void 0?arguments[0]:p;i=!1,(N=t.onLeave)===null||N===void 0||N.call(t,H),c.stop()},E=Ae;Ae=null,E&&en(E,n)||$()},u=p=>{var v;(v=t.onDrop)===null||v===void 0||v.call(t,p)},o=p=>{var v;p instanceof KeyboardEvent&&p.key!=="Escape"||(i=!1,c.stop(),(v=t.onEndBeforeLeave)===null||v===void 0||v.call(t,p))},c=tn([[e,"drop",o],[window,"mouseup",o],[window,"touchend",o],[window,"keydown",o]]);c.stop();const d=()=>{J(e,"dragenter",a),J(e,"dragover",s),J(e,"dragleave",r),J(e,"drop",u)},h=()=>{G(e,"dragenter",a),G(e,"dragover",s),G(e,"dragleave",r),G(e,"drop",u),c.stop()};return d(),h}/*!
 * @he-tree/vue v2.9.3
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: https://hetree.phphe.com/
 * Released under the MIT License.
 */let Ve=!1;const yn=()=>{Ve=!0,setTimeout(()=>{Ve=!1},100)},bn=$e({props:["stat","rtl","btt","indent","table","treeLine","treeLineOffset","processor"],emits:["open","close","check"],setup(e,{emit:t}){const n=Y(()=>({[e.rtl?"paddingRight":"paddingLeft"]:e.indent*(e.stat.level-1)+"px"}));Ye(()=>e.stat.checked,a=>{Ve||e.processor.afterOneCheckChanged(e.stat)&&t("check",e.stat)}),Ye(()=>e.stat.open,a=>{Ve||(t(a?"open":"close",e.stat),yn())});const i=Y(()=>{const a=[],s=c=>{var d;if(c.parent){let h=(d=c.parent)==null?void 0:d.children.indexOf(c);do{h++;let p=c.parent.children[h];if(p){if(!p.hidden)return!0}else break}while(!0)}return!1},r=e.rtl?"right":"left",u=e.btt?"top":"bottom";let o=e.stat;for(;o;){let c=(o.level-2)*e.indent+e.treeLineOffset;const d=s(o),h=()=>{a.push({style:{[r]:c+"px",[u]:d?0:"50%"}})};o===e.stat?o.level>1&&h():d&&h(),o=o.parent}return a}),l=Y(()=>{let a=(e.stat.level-2)*e.indent+e.treeLineOffset;return{[e.rtl?"right":"left"]:a+"px"}});return{indentStyle:n,vLines:i,hLineStyle:l}}}),vt=(e,t)=>{const n=e.__vccOpts||e;for(const[i,l]of t)n[i]=l;return n},kn={class:"tree-node-inner"},$n={key:1,class:"tree-node",ref:"el"};function wn(e,t,n,i,l,a){return e.table?(k(),L("tr",$n,[B(e.$slots,"default",{indentStyle:e.indentStyle})],512)):(k(),L("div",{key:0,class:de(["tree-node",{"tree-node--with-tree-line":e.treeLine}]),style:oe(e.indentStyle),ref:"el"},[e.treeLine?(k(),L(ue,{key:0},[(k(!0),L(ue,null,We(e.vLines,s=>(k(),L("div",{class:"tree-line tree-vline",style:oe(s.style)},null,4))),256)),e.stat.level>1?(k(),L("div",{key:0,class:"tree-line tree-hline",style:oe(e.hLineStyle)},null,4)):_("",!0)],64)):_("",!0),O("div",kn,[B(e.$slots,"default",{indentStyle:e.indentStyle})])],6))}const Cn=vt(bn,[["render",wn]]);function xn(e,t={}){const n={...t,statHandler(i){return this._statHandler2&&(i=this._statHandler2(i)),ze(t.statHandler,ke(i))},statsHandler(i){return ze(t.statsHandler,ke(i))},statsFlatHandler(i){return ze(t.statsFlatHandler,ke(i))}};return hn(e,n)}function ze(e,t){return e?e(t):t}const Dn=$e({components:{VirtualList:cn,TreeNode:Cn},props:{value:{required:Kt,type:Array},modelValue:{required:Mt,type:Array},updateBehavior:{type:String,default:"modify"},processor:{type:Object,default:()=>xn([],{noInitialization:!0})},childrenKey:{type:String,default:"children"},textKey:{type:String,default:"text"},indent:{type:Number,default:20},virtualization:{type:Boolean,default:!1},virtualizationPrerenderCount:{type:Number,default:20},defaultOpen:{type:Boolean,default:!0},statHandler:{type:Function},rtl:{type:Boolean,default:!1},btt:{type:Boolean,default:!1},table:{type:Boolean,default:!1},watermark:{type:Boolean,default:!1},nodeKey:{type:[String,Function],default:"index"},treeLine:{type:Boolean,default:!1},treeLineOffset:{type:Number,default:8}},emits:["update:modelValue","click:node","open:node","close:node","check:node","beforeDragStart","before-drag-start","after-drop","change","enter","leave"],data(){return{stats:[],statsFlat:[],dragNode:null,dragOvering:!1,placeholderData:{},placeholderColspan:1,batchUpdateWaiting:!1,self:this,_ignoreValueChangeOnce:!1}},computed:{valueComputed(){return this.modelValue||[]},visibleStats(){const{statsFlat:e,isVisible:t}=this;let n=e;return this.btt&&(n=n.slice(),n.reverse()),n.filter(i=>t(i))},rootChildren(){return this.stats}},methods:{_emitValue(e){this.$emit("update:modelValue",e)},_updateValue(e){return this.updateBehavior==="disabled"?!1:(e!==this.valueComputed&&(this._ignoreValueChangeOnce=!0),this._emitValue(e),!0)},getStat:Re(R("getStat")),has:Re(R("has")),updateCheck:R("updateCheck"),getChecked:R("getChecked"),getUnchecked:R("getUnchecked"),openAll:R("openAll"),closeAll:R("closeAll"),openNodeAndParents:R("openNodeAndParents"),isVisible:R("isVisible"),move:st("move"),add:Re(st("add")),addMulti(e,t,n){this.batchUpdate(()=>{let i=n;for(const l of e)this.add(l,t,i),i!=null&&i++})},remove:R("remove"),removeMulti(e){let t=[...e];this.batchUpdate(()=>{for(const n of t)this.remove(n)})},iterateParent:R("iterateParent"),getSiblings:R("getSiblings"),getData:R("getData"),getRootEl(){return this.$refs.vtlist.listElRef},batchUpdate(e){const t=this.ignoreUpdate(e);return this.batchUpdateWaiting||this._updateValue(this.updateBehavior==="new"?this.getData():this.valueComputed),t},ignoreUpdate(e){const t=this.batchUpdateWaiting;this.batchUpdateWaiting=!0;const n=e();return this.batchUpdateWaiting=t,n}},watch:{processor:{immediate:!0,handler(e){if(e){const t=n=>{if(n){const{childrenKey:i}=this;return n[i]||(n[i]=[]),n[i]}else return this.valueComputed};e._statHandler2=this.statHandler?n=>n.data===this.placeholderData?n:this.statHandler(n):null,e.afterSetStat=(n,i,l)=>{const{childrenKey:a,updateBehavior:s}=this;let r=this.valueComputed;if(s==="new"){if(this.batchUpdateWaiting)return;r=this.getData()}else if(s==="modify"){const u=t(i==null?void 0:i.data);u.includes(n.data)||u.splice(l,0,n.data)}this.batchUpdateWaiting||this._updateValue(r)},e.afterRemoveStat=n=>{var i;const{childrenKey:l,updateBehavior:a}=this;let s=this.valueComputed;if(a==="new"){if(this.batchUpdateWaiting)return;s=this.getData()}else if(a==="modify"){const r=t((i=n.parent)==null?void 0:i.data);ht(r,n.data)}this.batchUpdateWaiting||this._updateValue(s)}}e.initialized||(e.data=this.valueComputed,Object.assign(e,Wt(this,["childrenKey","defaultOpen"])),e.init(),e.updateCheck()),this.stats=e.stats,this.statsFlat=e.statsFlat,e.data!==this.valueComputed&&this._updateValue(e.data)}},valueComputed:{handler(e){if(this.dragOvering||this.dragNode||this._ignoreValueChangeOnce)this._ignoreValueChangeOnce=!1;else{const{processor:t}=this;t.data=e,t.init(),this.stats=t.stats,this.statsFlat=t.statsFlat}}}},created(){},mounted(){typeof window<"u"&&(this.watermark===!1&&(window._heTreeWatermarkDisabled=!0),this.watermark&&!window._heTreeWatermarkDisabled&&(window._heTreeWatermark||(window._heTreeWatermark=!0,console.log("%c[he-tree] Vue tree component:  https://hetree.phphe.com","color:#0075ff; font-size:14px;"))))}});function R(e){return function(...t){return this.processor[e](...t)}}function st(e){return function(...t){return this.batchUpdate(()=>this.processor[e](...t))}}function Re(e){return function(t,...n){return t&&(t=ke(t)),e.call(this,t,...n)}}const Sn={key:0,class:"drag-placeholder he-tree-drag-placeholder"},En=["colspan"],_n={class:"drag-placeholder he-tree-drag-placeholder"};function On(e,t,n,i,l,a){const s=ae("TreeNode"),r=ae("VirtualList");return k(),A(r,{class:de(["he-tree",{"he-tree--rtl rtl":e.rtl,"he-tree--drag-overing drag-overing":e.dragOvering}]),ref:"vtlist",items:e.visibleStats,disabled:!e.virtualization,table:e.table,itemKey:e.nodeKey},{prepend:g(()=>[B(e.$slots,"prepend",{tree:e.self})]),default:g(({item:u,index:o})=>[f(s,{"vt-index":o,class:de([u.class,{"drag-placeholder-wrapper":u.data===e.placeholderData,"dragging-node":u===e.dragNode}]),style:oe(u.style),stat:u,rtl:e.rtl,btt:e.btt,indent:e.indent,table:e.table,treeLine:e.treeLine,treeLineOffset:e.treeLineOffset,processor:e.processor,onClick:c=>e.$emit("click:node",u),onOpen:t[0]||(t[0]=c=>e.$emit("open:node",c)),onClose:t[1]||(t[1]=c=>e.$emit("close:node",c)),onCheck:t[2]||(t[2]=c=>e.$emit("check:node",c))},{default:g(({indentStyle:c})=>[u.data===e.placeholderData?(k(),L(ue,{key:0},[e.table?(k(),L("td",{key:1,style:oe(c),colspan:e.placeholderColspan},[O("div",_n,[B(e.$slots,"placeholder",{tree:e.self})])],12,En)):(k(),L("div",Sn,[B(e.$slots,"placeholder",{tree:e.self})]))],64)):B(e.$slots,"default",{key:1,node:u.data,stat:u,indentStyle:c,tree:e.self},()=>[S(x(u.data[e.textKey]),1)])]),_:2},1032,["vt-index","class","style","stat","rtl","btt","indent","table","treeLine","treeLineOffset","processor","onClick"])]),append:g(()=>[B(e.$slots,"append",{tree:e.self})]),_:3},8,["class","items","disabled","table","itemKey"])}const Pn=vt(Dn,[["render",On]]);let w=null,m=null,Pe,be,le,Oe,je,j,ot;const ye={get startInfo(){return Pe},get targetInfo(){return be}},Ln=$e({extends:Pn,props:{triggerClass:{type:[String,Array]},disableDrag:Boolean,disableDrop:Boolean,eachDraggable:{type:Function},eachDroppable:{type:Function},rootDroppable:{type:[Boolean,Function],default:!0},dragOpen:{type:Boolean,default:!0},dragOpenDelay:{type:Number,default:0},beforeDragOpen:{type:Function},resolveStartMovePoint:{type:[String,Function]},keepPlaceholder:{type:Boolean},maxLevel:{type:Number},dragCopy:{type:Boolean},dragCopyDataHandler:{type:Function},onExternalDragOver:{type:Function},externalDataHandler:{type:Function},ondragstart:{type:Function}},data(){return{treeDraggableInstance:null}},computed:{},methods:{getNodeByElement(e){const t=e.getAttribute("vt-index");return t==null?null:this.visibleStats[t]},isDraggable(e){if(this.disableDrag)return!1;if(e.draggable!=null)return e.draggable;if(this.eachDraggable){const n=this.eachDraggable(e);if(n!=null)return n}const{parent:t}=e;return t?this.isDraggable(t):!0},isDroppable(e){if(this.disableDrop)return!1;if(!e)return tt(this.rootDroppable,[this,w]);if(e.droppable!=null)return e.droppable;if(this.eachDroppable){const n=this.eachDroppable(e);if(n!=null)return n}const{parent:t}=e;return t?this.isDroppable(t):!0},_eachDroppable(){var e;return tt((e=this._isDragCopy)==null?void 0:e.call(this),[this])}},mounted(){const e=(o,c)=>{let d=!0;return w&&w!==this&&(d=d&&this._isMoved),this.table&&!this._isDragCopy&&(d=d&&this._isDragCopy),d&&(o.x!==c.x||o.y!==c.y)},t=(o,c)=>{m.ignoreUpdate(()=>{if(!m.has(m.placeholderData)){if(m.table){let h=0;const p=m.getRootEl().querySelector("tr");if(p)for(const{value:v}of Yt(p.children))Ie(v,"display")!=="none"&&(h+=v.colSpan||1);h<1&&(h=1),m.placeholderColspan=h}m.add(m.placeholderData)}const d=m.getStat(m.placeholderData);m.move(d,o,c)})},n=()=>{const o=this;if(o.has(o.placeholderData))return o.remove(o.getStat(o.placeholderData)),!0},i=o=>{o?te.dropEffect=w!=null&&w.dragCopy?"copy":"move":te.dropEffect="none"},l=o=>{const c=this;o?i(!0):c.keepPlaceholder?c.has(c.placeholderData)||i(!1):(n(),i(!1))};let a={x:0,y:0};const s=this.getRootEl();let r=null;const u=()=>{m!=null&&m.has(m.placeholderData)&&m.ignoreUpdate(()=>{m.remove(m.getStat(m.placeholderData)),w&&(w.dragNode.hidden=!1,w.dragOvering=!1)})};this.treeDraggableInstance=fn(s,{beforeDragStart:o=>{if(!te.triggerElement)return;let c=this.triggerClass;(!c||c.length===0)&&(c="tree-node");let d=jt(c),h=nt(te.triggerElement,p=>{if(at(p,d))return!0;if(Te(p,"tree-node"))return"break"},{withSelf:!0,until:s});if(r=nt(h,p=>{if(Te(p,"tree-node"))return!0},{withSelf:!0,until:s}),!!r){if(j=this.getNodeByElement(r),!j)throw"Can't find drag node";if(this.isDraggable(j))return this.$emit("before-drag-start",j),this.$emit("beforeDragStart",j),s}},onDragStart:o=>{var c,d,h;if(!r||!j)return;{const{x:$,y:E}=r.getBoundingClientRect(),{clientX:N,clientY:H}=o;(c=o.dataTransfer)==null||c.setDragImage(r,N-$,H-E)}je={x:o.clientX,y:o.clientY},w=this,w.dragNode=j,Oe=(()=>{if(this.resolveStartMovePoint==="mouse")return{x:o.clientX,y:o.clientY};if(typeof this.resolveStartMovePoint=="function")return this.resolveStartMovePoint(r);{let $,E=0;if(this.table){let N=r.getBoundingClientRect();$={x:N.x,y:N.y},this.rtl&&($.x=N.right),E=N.height}else if(!this.rtl)$=r.children[0].getBoundingClientRect().toJSON(),E=$.height;else{const N=r.children[0].getBoundingClientRect();$={x:N.right,y:N.y},E=N.height}return this.btt&&($.y+=E),$}})(),this.dragOvering=!0;const p=w.getSiblings(w.dragNode),v=p.indexOf(j);Pe={tree:w,dragNode:j,parent:j.parent,siblings:p,indexBeforeDrop:v},m=this,(d=o.dataTransfer)==null||d.setData("text",`he-tree drag start at ${new Date().toISOString()}`),w._eachDroppable()||setTimeout(()=>{j.hidden=!0,t(j.parent,v+1)},0),(h=this.ondragstart)==null||h.call(this,o)},onEnter:o=>{this.$emit("enter",o)},onLeave:o=>{le=null,this.dragOvering=!1,te.preventDefault=!1,n(),this.$emit("leave",o)},onDragOver:Gt(o=>{if(!w){if(!this.onExternalDragOver||this.onExternalDragOver(o)===!1)return;te.preventDefault=!0}const c={x:o.clientX,y:o.clientY},d=e(c,a);if(a=c,!d)return;this.dragOvering=!0,m=this;const h=Oe?{x:Oe.x+(c.x-je.x),y:Oe.y+(c.y-je.y)}:{...c},{btt:p,rtl:v}=m;if(m.disableDrop){te.dropEffect="none";return}let $,E;const N=m.getRootEl().querySelectorAll(".tree-node"),H=[];N.forEach(y=>{!at(y,["drag-placeholder-wrapper","dragging-node"])&&Ie(y,"display")!=="none"&&H.push(y)});const Q=qe(H,y=>Ue(y)[p?"bottom":"top"]-h.y,{returnNearestIfNoHit:!0});let V=null,q,ce;Q.hit||(Q.greater?p||(V=Q.index-1,H[V]||V++):p&&(V=Q.index+1,H[V]||V--)),V==null&&(V=Q.index),q=H[V],ce=p?H[V-1]:H[V+1],$=q&&m.getNodeByElement(q),E=ce&&m.getNodeByElement(ce);const{indent:ne}=m,M=me(()=>{if(m.table){let y=Ue(q).toJSON();const F=ne*($.level-1);return v?(y.width-=F,y.right-=F):y.x+=F,y}else return Ue(q.firstElementChild)}).action,he=me(()=>p?h.y>M().y+M().height/2:h.y<M().y+M().height/2).action,Ne=me(()=>p?!q||V===H.length-1&&he():!q||V===0&&he()).action,we=me(()=>v?h.x-(M().x+M().width):M().x-h.x).action,C=me(()=>v?h.x<M().x+M().width-ne:h.x>M().x+ne).action;let b;if(Ne())b=1,$=null;else if($)we()>0?b=$.level-Math.ceil(we()/ne):C()?b=$.level+1:b=$.level;else return;E&&b<E.level&&(b=E.level),(async()=>{let y,F,X=!1,z=null;const ie=async P=>{if(P.open)return!0;if(m.dragOpen)if(m.dragOpenDelay)if(z=P,le===P)X=!0;else{let T=Qt();le=P;const U=P;return setTimeout(async()=>{U!==le?(X=!0,T.resolve(!0)):(m.beforeDragOpen&&await m.beforeDragOpen(P),U!==le?(X=!0,T.resolve(!0)):(P.open=!0,z=null,T.resolve(!0)))},m.dragOpenDelay),await T.promise}else return m.beforeDragOpen&&await m.beforeDragOpen(P),P.open=!0,!0;else return!1},Ce=async()=>{if(m.isDroppable($)&&await ie($)){if(X)return;y=$,F=null}else return!1},xe=(P=b)=>{let T=$,U=[];for(;T&&T.level>=P;)T=T.parent||null,U.unshift(T);let ee=0;for(const re of U){if(m.isDroppable(re))return y=re,F=U[ee+1]||$,!0;ee++}return!1};ot=$||null,$?b>$.level?await Ce()===!1&&xe($.level):xe()===!1&&await Ce():m.isDroppable(null)&&(y=null),le=z;const De=!!(!X&&(y||y===null));return{cancelled:X,success:De,parent:y,index:De?F?(y?y.children:m.stats).filter(P=>P.data!==m.placeholderData).indexOf(F)+1:0:-1}})().then(y=>{if(!y.cancelled){if(!y.success){l(!1);return}if(m.maxLevel!=null&&m.maxLevel>0){let F=1;if(w){const X=w.dragNode;let z=0;Z(X,ie=>{ie.level>z&&(z=ie.level)},{childrenKey:se}),F=z-X.level+1}if(F+(y.parent?y.parent.level:0)>m.maxLevel){l(!1);return}}l(!0),t(y.parent,y.index)}})}),onDrop:o=>{m=this;const c=!w;if(!m)return;const d=w==null?void 0:w.dragNode;let h,p=(()=>{var v;let $=!0;if(!m.has(m.placeholderData))$=!1;else if(c)h=(v=this.externalDataHandler)==null?void 0:v.call(this,o),$=h!=null;else if(!w.dragCopy){const E=m.getStat(m.placeholderData);w===m&&E.parent===d.parent&&Jt(d,N=>N===E)}return $})();if(p){const v=m.getStat(m.placeholderData),$=m.getSiblings(v);be={tree:m,dragNode:d,parent:v.parent,siblings:$,indexBeforeDrop:$.indexOf(v)}}(()=>{if(u(),p){let v=be.indexBeforeDrop;w&&!w.dragCopy&&w===m&&Pe.parent==be.parent&&Pe.indexBeforeDrop<v&&v--,w&&w!==m&&!w._eachDroppable()&&w.batchUpdate(()=>{w.remove(d),w.updateCheck()}),m.batchUpdate(()=>{let $=w==null?void 0:w.dragNode,E;h?E=h:w._eachDroppable()&&(E=pt(w.dragNode.data,{childrenKey:w.childrenKey}),w.dragCopyDataHandler&&(E=w.dragCopyDataHandler(E))),E&&(m.add(E),$=m.getStat(E)),m.move($,be.parent,v),m.updateCheck()})}m.$emit("after-drop"),p&&(w&&(w.dragCopy||w.$emit("change")),m!==w&&m.$emit("change"))})()},onDragEnd:o=>{u(),w&&(w.dragNode&&(w.dragNode.hidden=!1),w.dragNode=null,w.dragOvering=!1,w=null),m=null,le=null,j=null,ot=null}})},unmounted(){var e;(e=this.treeDraggableInstance)==null||e.destroy()}}),Tn={components:{Draggable:Ln},props:{embed:{type:Boolean,default:!1},filter:{type:Object,default:()=>({})}},emits:["select"],inject:["debounce"],data(){return{menu:{},items:[],loading:!0,checked:null,clip:null,term:""}},setup(){const e=$t(),t=ut(),n=ct();return{app:wt(),auth:n,languages:e,messages:t}},created(){this.searchd=this.debounce(this.search,500),this.fetch().then(e=>{this.items=e.data,this.loading=!1})},mounted(){this.checked=!1},computed:{canTrash(){var e;return this.isChecked&&((e=this.$refs.tree)==null?void 0:e.statsFlat.some(t=>t._checked&&!t.data.deleted_at))},isChecked(){var e;return this.checked||((e=this.$refs.tree)==null?void 0:e.statsFlat.some(t=>t._checked))},isTrashed(){var e;return this.isChecked&&((e=this.$refs.tree)==null?void 0:e.statsFlat.some(t=>t._checked&&t.data.deleted_at))}},methods:{add(){if(this.embed||!this.auth.can("page:add")){this.messages.add(this.$gettext("Permission denied"),"error");return}const e=this.create();this.$apollo.mutate({mutation:K`mutation ($input: PageInput!) {
            addPage(input: $input) {
              id
            }
          }`,variables:{input:e}}).then(t=>{if(t.errors)throw t.errors;if(!t.data.addPage)throw new Error("No data in addPage mutation result");const n={...t.data.addPage};this.$refs.tree.add(n),this.$emit("select",n)}).catch(t=>{this.messages.add(this.$gettext("Error adding root page")+`:
`+t,"error"),this.$log("PageList::add(): Error adding root page",t)})},change(){if(!this.auth.can("page:move")){this.messages.add(this.$gettext("Permission denied"),"error");return}const e=ye.targetInfo.parent,n=ye.targetInfo.siblings[ye.targetInfo.indexBeforeDrop+1]||null;this.$apollo.mutate({mutation:K`mutation ($id: ID!, $parent: ID, $ref: ID) {
            movePage(id: $id, parent: $parent, ref: $ref) {
              id
            }
          }`,variables:{id:ye.startInfo.dragNode.data.id,parent:e?e.data.id:null,ref:n?n.data.id:null}}).then(i=>{if(i.errors)throw i.errors;const l=ye.startInfo.parent;l!=null&&l.data&&!(l!=null&&l.children.length)&&(l.data.has=!1),e&&(e.data.has=!0)}).catch(i=>{this.messages.add(this.$gettext("Error moving page")+`:
`+i,"error"),this.$log("PageList::change(): Error moving page",i)})},copy(e,t){this.clip={type:"copy",node:t,stat:e}},create(e={}){return Object.assign({path:"_"+Math.floor(Math.random()*1e4),lang:this.$vuetify.locale.current||this.languages.default(),status:0,cache:5},e)},cut(e,t){this.$refs.tree.statsFlat.forEach(n=>{delete n.cut}),e.cut=!0,this.clip={type:"cut",node:t,stat:e}},drop(e){if(!this.auth.can("page:drop")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.$refs.tree.statsFlat.filter(n=>{var i;return n._checked&&((i=n.data)==null?void 0:i.id)});t.length&&this.$apollo.mutate({mutation:K`mutation ($id: [ID!]!) {
            dropPage(id: $id) {
              id
            }
          }`,variables:{id:t.map(n=>n.data.id)}}).then(n=>{if(n.errors)throw n.errors;for(const i of t)this.update(i,l=>{l.data.deleted_at=new Date().toISOString().replace(/T/," ").substring(0,19),l.check=!1,this.filter.trashed==="WITHOUT"&&this.$refs.tree.remove(l)});this.invalidate()}).catch(n=>{this.messages.add(this.$gettext("Error trashing page")+`:
`+n,"error"),this.$log("PageList::drop(): Error trashing page",t,n)})},fetch(e=null,t=1,n=100){if(!this.auth.can("page:view"))return this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve([]);const i=this.filter.publish||null,l=this.filter.trashed||"WITHOUT",a={...this.filter};return delete a.trashed,delete a.publish,delete a.view,a.parent_id=e,this.$apollo.query({query:K`query($filter: PageFilter, $limit: Int!, $page: Int!, $trashed: Trashed, $publish: Publish) {
            pages(filter: $filter, first: $limit, page: $page, trashed: $trashed, publish: $publish) {
              data {
                ${this.fields()}
              }
              paginatorInfo {
                currentPage
                lastPage
              }
            }
          }`,variables:{filter:a,page:t,limit:n,trashed:l,publish:i}}).then(s=>{if(s.errors)throw s.errors;return this.transform(s.data.pages)}).catch(s=>{this.messages.add(this.$gettext("Error fetching pages")+`:
`+s,"error"),this.$log("PageList::fetch(): Error fetching page",e,t,n,s)})},fields(){return`id
          parent_id
          created_at
          deleted_at
          editor
          has
          latest {
            id
            published
            publish_at
            data
            editor
            created_at
          }`},hydrate(e){var n,i,l,a,s;const t=(n=e.latest)!=null&&n.data?JSON.parse(e.latest.data):{...e};return Object.assign(t,{id:e.id,has:e.has,parent_id:e.parent_id,deleted_at:e.deleted_at,created_at:e.created_at,updated_at:((i=e.latest)==null?void 0:i.created_at)||e.updated_at,editor:((l=e.latest)==null?void 0:l.editor)||e.editor,published:((a=e.latest)==null?void 0:a.published)??!0,publish_at:((s=e.latest)==null?void 0:s.publish_at)||null,latest:e.latest})},insert(e,t=null){if(!this.auth.can("page:add")){this.messages.add(this.$gettext("Permission denied"),"error");return}const n=this.$refs.tree.getSiblings(e),i=t!==null?e.parent:e,l=n.indexOf(e),a=this.create();let s=null;switch(t===null&&!e.open&&this.load(e,e.data),t){case 0:s=e.data.id;break;case null:s=e.children&&e.children[0]?e.children[0].data.id:null;break;case 1:s=n[l+1]?n[l+1].data.id:null;break}this.$apollo.mutate({mutation:K`mutation ($input: PageInput!, $parent: ID, $ref: ID) {
            addPage(input: $input, parent: $parent, ref: $ref) {
              id
            }
          }`,variables:{input:a,parent:i?i.data.id:null,ref:s}}).then(r=>{if(r.errors)throw r.errors;a.id=r.data.addPage.id,(t!==null||e.open)&&this.$refs.tree.add(a,i,t!==null?l+t:0),i&&(i.data.has=!0),this.invalidate()}).catch(r=>{this.messages.add(this.$gettext("Error inserting page")+`:
`+r,"error"),this.$log("PageList::insert(): Error inserting page",r)})},invalidate(){const e=this.$apollo.provider.defaultClient.cache;e.evict({id:"ROOT_QUERY",fieldName:"pages"}),e.gc()},keep(e){if(!this.auth.can("page:keep")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.$refs.tree.statsFlat.filter(l=>l._checked&&l.data.id&&l.data.deleted_at),n=t.filter(l=>t.indexOf(l.parent)===-1),i=e.data.deleted_at||null;n.length&&this.$apollo.mutate({mutation:K`mutation ($id: [ID!]!) {
            keepPage(id: $id) {
              id
            }
          }`,variables:{id:n.map(l=>l.data.id)}}).then(l=>{if(l.errors)throw l.errors;for(const a of n)this.update(a,s=>{i>=s.data.deleted_at&&(s.data.deleted_at=null,s.check=!1)});this.invalidate()}).catch(l=>{this.messages.add(this.$gettext("Error restoring page")+`:
`+l,"error"),this.$log("PageList::keep(): Error restoring page",n,l)})},load(e,t){!e.open&&!t.children&&(e.loading=!0,this.fetch(t.id,e.page?e.page+1:1).then(n=>{this.$refs.tree.addMulti(n.data,e,0),e.page=n.currentPage||1}).finally(()=>{e.loading=!1})),e.open=!e.open},move(e,t=null){if(!this.auth.can("page:move")){this.messages.add(this.$gettext("Permission denied"),"error");return}const n=this.$refs.tree.getSiblings(e),i=t!==null?e.parent:e,l=n.indexOf(e);let a=null;switch(t){case 0:a=e.data.id;break;case null:a=e.children&&e.children[0]?e.children[0].data.id:null;break;case 1:a=n[l+1]?n[l+1].data.id:null;break}this.$apollo.mutate({mutation:K`mutation ($id: ID!, $parent: ID, $ref: ID) {
            movePage(id: $id, parent: $parent, ref: $ref) {
              id
            }
          }`,variables:{id:this.clip.node.id,parent:i?i.data.id:null,ref:a}}).then(s=>{var u;if(s.errors)throw s.errors;const r=t!==null?l<this.$refs.tree.getSiblings(e).indexOf(this.clip.stat)?l+t:l:0;this.$refs.tree.move(this.clip.stat,i,r),i&&((u=this.clip.stat.children)!=null&&u.length||(e.parent.data.has=!1),i.data.has=!0),this.invalidate()}).catch(s=>{this.messages.add(this.$gettext("Error moving page")+`:
`+s,"error"),this.$log("PageList::move(): Error moving page",e,t,s)})},paste(e,t=null){if(!this.auth.can("page:add")){this.messages.add(this.$gettext("Permission denied"),"error");return}const n=this.$refs.tree.getSiblings(e),i=t!==null?e.parent:e,l=n.indexOf(e),a={...this.clip.node};let s=null;switch(t){case 0:s=e.data.id;break;case null:s=e.children&&e.children[0]?e.children[0].data.id:null;break;case 1:s=n[l+1]?n[l+1].data.id:null;break}return this.$apollo.query({query:K`query($id: ID!) {
            page(id: $id) {
              id
              latest {
                id
                aux
                files {
                  id
                }
                elements {
                  id
                }
              }
            }
          }`,variables:{id:a.id}}).then(r=>{var c,d;if(r.errors)throw r.errors;const u=(d=(c=r==null?void 0:r.data)==null?void 0:c.page)==null?void 0:d.latest,o=JSON.parse((u==null?void 0:u.aux)||"{}");this.$apollo.mutate({mutation:K`mutation ($input: PageInput!, $parent: ID, $ref: ID, $elements: [ID!], $files: [ID!]) {
              addPage(input: $input, parent: $parent, ref: $ref, elements: $elements, files: $files) {
                ${this.fields()}
              }
            }`,variables:{input:{status:0,to:a.to,tag:a.tag,type:a.type,theme:a.theme,lang:a.lang,name:a.name,title:a.title,cache:a.cache,domain:a.domain,related_id:a.id,meta:JSON.stringify((o==null?void 0:o.meta)||{}),config:JSON.stringify((o==null?void 0:o.config)||{}),content:JSON.stringify((o==null?void 0:o.content)||[]),path:a.path+"_"+Math.floor(Math.random()*1e4)},parent:i?i.data.id:null,ref:s,elements:(u==null?void 0:u.elements.map(h=>h.id))||[],files:(u==null?void 0:u.files.map(h=>h.id))||[]}}).then(h=>{if(h.errors)throw h.errors;if(!h.data.addPage)throw new Error("No page data returned");const p=t!==null?this.$refs.tree.getSiblings(e).indexOf(e)+t:0,v=this.hydrate(h.data.addPage);this.$refs.tree.add(v,i,p),this.invalidate()}).catch(h=>{this.messages.add(this.$gettext("Error copying page")+`:
`+h,"error"),this.$log("PageList::paste(): Error copying page",e,t,h)})}).catch(r=>{this.messages.add(this.$gettext("Error fetching page")+`:
`+r,"error"),this.$log("PageList::paste(): Error fetching page",a.id,r)})},publish(e){if(!this.auth.can("page:publish")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.$refs.tree.statsFlat.filter(n=>n._checked&&n.data.id&&!n.data.published);t.length&&this.$apollo.mutate({mutation:K`mutation ($id: [ID!]!) {
            pubPage(id: $id) {
              id
            }
          }`,variables:{id:t.map(n=>n.data.id)}}).then(n=>{if(n.errors)throw n.errors;for(const i of t)i.data.published=!0,i.check=!1;this.invalidate()}).catch(n=>{this.messages.add(this.$gettext("Error publishing page")+`:
`+n,"error"),this.$log("PageList::publish(): Error publishing page",t,n)})},purge(e){if(!this.auth.can("page:purge")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.$refs.tree.statsFlat.filter(n=>n._checked&&n.data.id);t.length&&this.$apollo.mutate({mutation:K`mutation ($id: [ID!]!) {
            purgePage(id: $id) {
              id
            }
          }`,variables:{id:t.map(n=>n.data.id).reverse()}}).then(n=>{var i;if(n.errors)throw n.errors;for(const l of t)this.$refs.tree.remove(l),l.parent&&!((i=l.parent.children)!=null&&i.length)&&(l.parent.data.has=!1)}).catch(n=>{this.messages.add(this.$gettext("Error purging page")+`:
`+n,"error"),this.$log("PageList::purge(): Error purging page",t,n)})},reload(e=!0){if(this.items=[],this.loading=!0,e){const n=this.$apollo.provider.defaultClient.cache;n.evict({id:"ROOT_QUERY",fieldName:"pages"}),n.gc()}(this.filter.view==="list"?this.search():this.fetch()).then(n=>{this.items=(n==null?void 0:n.data)||[],this.loading=!1})},search(e=1,t=100){if(!this.auth.can("page:view"))return this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve([]);const n=this.filter.publish||null,i=this.filter.trashed||"WITHOUT",l={...this.filter};return delete l.trashed,delete l.publish,delete l.view,this.term&&(l.any=this.term),this.$apollo.query({query:K`query($filter: PageFilter, $limit: Int!, $page: Int!, $trashed: Trashed, $publish: Publish) {
            pages(filter: $filter, first: $limit, page: $page, trashed: $trashed, publish: $publish) {
              data {
                ${this.fields()}
              }
              paginatorInfo {
                currentPage
                lastPage
              }
            }
          }`,variables:{filter:l,page:e,limit:t,trashed:i,publish:n}}).then(a=>{if(a.errors)throw a.errors;return this.transform(a.data.pages)}).catch(a=>{this.messages.add(this.$gettext("Error searching pages")+`:
`+a,"error"),this.$log("PageList::search(): Error searching pages",e,t,a)})},status(e,t){if(!this.auth.can("page:save")){this.messages.add(this.$gettext("Permission denied"),"error");return}(e?[e]:this.$refs.tree.statsFlat.filter(i=>i._checked&&i.data.id)).forEach(i=>{this.$apollo.mutate({mutation:K`mutation ($id: ID!, $input: PageInput!) {
              savePage(id: $id, input: $input) {
                id
              }
            }`,variables:{id:i.data.id,input:{status:t}}}).then(l=>{if(l.errors)throw l.errors;i.data.status=t}).catch(l=>{this.messages.add(this.$gettext("Error saving page")+`:
`+l,"error"),this.$log("PageList::status(): Error saving page",i,t,l)})})},title(e){const t=[];return e.publish_at&&t.push("Publish at: "+new Date(e.publish_at).toLocaleDateString()),e.theme&&t.push("Theme: "+e.theme),e.type&&t.push("Page type: "+e.type),e.tag&&t.push("Tag: "+e.tag),e.cache&&t.push("Cache: "+e.cache+" min"),t.join(`
`)},toggle(){this.$refs.tree.statsFlat.forEach(e=>{e._checked=!e._checked})},transform(e){return{data:e.data.map(n=>this.hydrate(n)),currentPage:e.paginatorInfo.currentPage,lastPage:e.paginatorInfo.lastPage}},update(e,t){var n;if(typeof t!="function")throw new Error("Second paramter must be a function");t(e),(n=e.children)==null||n.forEach(i=>{t(i,t)})},url(e){return this.app.urlpage.replace(/_domain_/,e.domain||"").replace(/_path_/,e.path||"").replace(/\/+$/,"")}},watch:{filter:{deep:!0,handler(e){this.items=[],this.loading=!0,(e.view==="list"?this.search():this.fetch()).then(n=>{this.items=(n==null?void 0:n.data)||[],this.loading=!1})}},term:{handler(){this.reload(!1)}}}},In={class:"header"},An={class:"bulk"},Vn={class:"search"},Nn={class:"actions"},Fn={key:0,class:"spinner",fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Bn=["title"],Hn=["onClick"],Un={class:"item-head"},Kn={key:0,class:"item-lang"},Mn={class:"item-title"},zn={key:0,class:"item-subtitle"},Rn=["href"],jn={class:"item-domain"},Wn={class:"item-path item-subtitle"},Yn={key:0,class:"item-to item-subtitle"},Xn={key:0,class:"loading"},qn={key:1,class:"notfound"},Zn={key:2,class:"btn-group"};function Jn(e,t,n,i,l,a){const s=ae("Draggable");return k(),L(ue,null,[O("div",In,[O("div",An,[f(Ze,{modelValue:l.checked,"onUpdate:modelValue":t[0]||(t[0]=r=>l.checked=r),onClick:t[1]||(t[1]=Ee(r=>a.toggle(),["stop"]))},null,8,["modelValue"]),f(Ct,null,{activator:g(({props:r})=>[f(D,pe({"append-icon":"mdi-menu-down",variant:"text"},r,{disabled:!a.isChecked}),{default:g(()=>[S(x(e.$gettext("Actions")),1)]),_:1},16,["disabled"])]),default:g(()=>[f(Je,null,{default:g(()=>[a.isChecked&&i.auth.can("page:publish")?(k(),A(I,{key:0},{default:g(()=>[f(D,{"prepend-icon":"mdi-publish",variant:"text",onClick:t[2]||(t[2]=r=>a.publish())},{default:g(()=>[S(x(e.$gettext("Publish")),1)]),_:1})]),_:1})):_("",!0),a.isChecked&&i.auth.can("page:save")?(k(),A(I,{key:1},{default:g(()=>[f(D,{"prepend-icon":"mdi-eye",variant:"text",onClick:t[3]||(t[3]=r=>a.status(null,1))},{default:g(()=>[S(x(e.$gettext("Enable")),1)]),_:1})]),_:1})):_("",!0),a.isChecked&&i.auth.can("page:save")?(k(),A(I,{key:2},{default:g(()=>[f(D,{"prepend-icon":"mdi-eye-off",variant:"text",onClick:t[4]||(t[4]=r=>a.status(null,0))},{default:g(()=>[S(x(e.$gettext("Disable")),1)]),_:1})]),_:1})):_("",!0),f(Be),a.canTrash&&i.auth.can("page:drop")?(k(),A(I,{key:3},{default:g(()=>[f(D,{"prepend-icon":"mdi-delete",variant:"text",onClick:t[5]||(t[5]=r=>a.drop())},{default:g(()=>[S(x(e.$gettext("Delete")),1)]),_:1})]),_:1})):_("",!0),a.isTrashed&&i.auth.can("page:keep")?(k(),A(I,{key:4},{default:g(()=>[f(D,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:t[6]||(t[6]=r=>a.keep())},{default:g(()=>[S(x(e.$gettext("Restore")),1)]),_:1})]),_:1})):_("",!0),a.isChecked&&i.auth.can("page:purge")?(k(),A(I,{key:5},{default:g(()=>[f(D,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:t[7]||(t[7]=r=>a.purge())},{default:g(()=>[S(x(e.$gettext("Purge")),1)]),_:1})]),_:1})):_("",!0)]),_:1})]),_:1})]),O("div",Vn,[f(xt,{modelValue:l.term,"onUpdate:modelValue":t[8]||(t[8]=r=>l.term=r),label:e.$gettext("Search for"),"prepend-inner-icon":"mdi-magnify",variant:"underlined","hide-details":"",clearable:""},null,8,["modelValue","label"])]),f(D,{onClick:t[9]||(t[9]=r=>a.reload()),title:e.$gettext("Reload page tree"),icon:"mdi-refresh",variant:"text",class:"no-rtl"},null,8,["title"])]),f(s,{ref:"tree",modelValue:l.items,"onUpdate:modelValue":t[13]||(t[13]=r=>l.items=r),onChange:t[14]||(t[14]=r=>a.change()),defaultOpen:!1,disableDrag:e.$vuetify.display.smAndDown||!i.auth.can("page:move"),rtl:e.$vuetify.locale.isRtl,watermark:!1,virtualization:""},{default:g(({node:r,stat:u})=>[O("div",Nn,[u.loading?(k(),L("svg",Fn,[...t[16]||(t[16]=[O("circle",{class:"spin1",cx:"4",cy:"12",r:"3"},null,-1),O("circle",{class:"spin1 spin2",cx:"12",cy:"12",r:"3"},null,-1),O("circle",{class:"spin1 spin3",cx:"20",cy:"12",r:"3"},null,-1)])])):(k(),A(D,{key:1,onClick:o=>a.load(u,r),class:de({hidden:!r.has&&!u.children.length}),icon:u.open?"mdi-menu-down":"mdi-menu-right",title:e.$gettext("Toggle child nodes"),variant:"text"},null,8,["onClick","class","icon","title"])),f(Ze,{modelValue:u._checked,"onUpdate:modelValue":o=>u._checked=o,class:de({draft:!r.published})},null,8,["modelValue","onUpdate:modelValue","class"]),(k(),A(Dt(e.$vuetify.display.xs?"v-dialog":"v-menu"),{modelValue:l.menu[r.id],"onUpdate:modelValue":o=>l.menu[r.id]=o,transition:"scale-transition",location:"end center","max-width":"300"},{activator:g(({props:o})=>[f(D,pe(o,{title:e.$gettext("Actions"),icon:"mdi-dots-vertical",variant:"text"}),null,16,["title"])]),default:g(()=>[f(St,null,{default:g(()=>[f(Et,{density:"compact"},{default:g(()=>[f(_t,null,{default:g(()=>[S(x(e.$gettext("Actions")),1)]),_:1}),f(D,{icon:"mdi-close",onClick:o=>l.menu[r.id]=!1},null,8,["onClick"])]),_:2},1024),f(Je,{onClick:o=>l.menu[r.id]=!1},{default:g(()=>{var o,c;return[!r.deleted_at&&!r.published&&i.auth.can("page:publish")?(k(),A(I,{key:0},{default:g(()=>[f(D,{"prepend-icon":"mdi-publish",variant:"text",onClick:d=>a.publish(u)},{default:g(()=>[S(x(e.$gettext("Publish")),1)]),_:1},8,["onClick"])]),_:2},1024)):_("",!0),r.status!==0&&i.auth.can("page:save")?(k(),A(I,{key:1},{default:g(()=>[f(D,{"prepend-icon":"mdi-eye-off",variant:"text",onClick:d=>a.status(u,0)},{default:g(()=>[S(x(e.$gettext("Disable")),1)]),_:1},8,["onClick"])]),_:2},1024)):_("",!0),r.status!==1&&i.auth.can("page:save")?(k(),A(I,{key:2},{default:g(()=>[f(D,{"prepend-icon":"mdi-eye",variant:"text",onClick:d=>a.status(u,1)},{default:g(()=>[S(x(e.$gettext("Enable")),1)]),_:1},8,["onClick"])]),_:2},1024)):_("",!0),r.status!==2&&i.auth.can("page:save")?(k(),A(I,{key:3},{default:g(()=>[f(D,{"prepend-icon":"mdi-eye-off-outline",variant:"text",onClick:d=>a.status(u,2)},{default:g(()=>[S(x(e.$gettext("Hide")),1)]),_:1},8,["onClick"])]),_:2},1024)):_("",!0),f(Be),i.auth.can("page:move")?(k(),A(I,{key:4},{default:g(()=>[f(D,{"prepend-icon":"mdi-content-cut",variant:"text",onClick:d=>a.cut(u,r)},{default:g(()=>[S(x(e.$gettext("Cut")),1)]),_:1},8,["onClick"])]),_:2},1024)):_("",!0),!n.embed&&i.auth.can("page:add")?(k(),A(I,{key:5},{default:g(()=>[f(D,{"prepend-icon":"mdi-content-copy",variant:"text",onClick:d=>a.copy(u,r)},{default:g(()=>[S(x(e.$gettext("Copy")),1)]),_:1},8,["onClick"])]),_:2},1024)):_("",!0),((o=l.clip)==null?void 0:o.type)=="copy"&&!this.embed&&i.auth.can("page:add")?(k(),A(He,{key:6},{activator:g(({props:d})=>[f(I,pe(d,{onClick:t[10]||(t[10]=Ee(()=>{},["stop"]))}),{default:g(()=>[f(D,{"prepend-icon":"mdi-content-paste",variant:"text"},{default:g(()=>[S(x(e.$gettext("Paste")),1)]),_:1})]),_:1},16)]),default:g(()=>[f(I,null,{default:g(()=>[f(D,{"prepend-icon":"mdi-arrow-up",variant:"text",onClick:d=>a.paste(u,0)},{default:g(()=>[S(x(e.$gettext("Before")),1)]),_:1},8,["onClick"])]),_:2},1024),f(I,null,{default:g(()=>[f(D,{"prepend-icon":"mdi-arrow-right",variant:"text",onClick:d=>a.paste(u)},{default:g(()=>[S(x(e.$gettext("Into")),1)]),_:1},8,["onClick"])]),_:2},1024),f(I,null,{default:g(()=>[f(D,{"prepend-icon":"mdi-arrow-down",variant:"text",onClick:d=>a.paste(u,1)},{default:g(()=>[S(x(e.$gettext("After")),1)]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)):_("",!0),((c=l.clip)==null?void 0:c.type)=="cut"&&!this.embed&&i.auth.can("page:move")?(k(),A(He,{key:7},{activator:g(({props:d})=>[f(I,pe(d,{onClick:t[11]||(t[11]=Ee(()=>{},["stop"]))}),{default:g(()=>[f(D,{"prepend-icon":"mdi-content-paste",variant:"text"},{default:g(()=>[S(x(e.$gettext("Paste")),1)]),_:1})]),_:1},16)]),default:g(()=>[f(I,null,{default:g(()=>[f(D,{"prepend-icon":"mdi-arrow-up",variant:"text",onClick:d=>a.move(u,0)},{default:g(()=>[S(x(e.$gettext("Before")),1)]),_:1},8,["onClick"])]),_:2},1024),f(I,null,{default:g(()=>[f(D,{"prepend-icon":"mdi-arrow-right",variant:"text",onClick:d=>a.move(u)},{default:g(()=>[S(x(e.$gettext("Into")),1)]),_:1},8,["onClick"])]),_:2},1024),f(I,null,{default:g(()=>[f(D,{"prepend-icon":"mdi-arrow-down",variant:"text",onClick:d=>a.move(u,1)},{default:g(()=>[S(x(e.$gettext("After")),1)]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)):_("",!0),!this.embed&&i.auth.can("page:add")?(k(),A(He,{key:8},{activator:g(({props:d})=>[f(I,pe(d,{onClick:t[12]||(t[12]=Ee(()=>{},["stop"]))}),{default:g(()=>[f(D,{"prepend-icon":"mdi-content-paste",variant:"text"},{default:g(()=>[S(x(e.$gettext("Insert")),1)]),_:1})]),_:1},16)]),default:g(()=>[f(I,null,{default:g(()=>[f(D,{"prepend-icon":"mdi-arrow-up",variant:"text",onClick:d=>a.insert(u,0)},{default:g(()=>[S(x(e.$gettext("Before")),1)]),_:1},8,["onClick"])]),_:2},1024),f(I,null,{default:g(()=>[f(D,{"prepend-icon":"mdi-arrow-right",variant:"text",onClick:d=>a.insert(u)},{default:g(()=>[S(x(e.$gettext("Into")),1)]),_:1},8,["onClick"])]),_:2},1024),f(I,null,{default:g(()=>[f(D,{"prepend-icon":"mdi-arrow-down",variant:"text",onClick:d=>a.insert(u,1)},{default:g(()=>[S(x(e.$gettext("After")),1)]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)):_("",!0),f(Be),!r.deleted_at&&i.auth.can("page:drop")?(k(),A(I,{key:9},{default:g(()=>[f(D,{"prepend-icon":"mdi-delete",variant:"text",onClick:d=>a.drop(u)},{default:g(()=>[S(x(e.$gettext("Delete")),1)]),_:1},8,["onClick"])]),_:2},1024)):_("",!0),r.deleted_at&&i.auth.can("page:keep")?(k(),A(I,{key:10},{default:g(()=>[f(D,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:d=>a.keep(u)},{default:g(()=>[S(x(e.$gettext("Restore")),1)]),_:1},8,["onClick"])]),_:2},1024)):_("",!0),i.auth.can("page:purge")?(k(),A(I,{key:11},{default:g(()=>[f(D,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:d=>a.purge(u)},{default:g(()=>[S(x(e.$gettext("Purge")),1)]),_:1},8,["onClick"])]),_:2},1024)):_("",!0)]}),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"]))]),O("div",{class:de(["item-content",{"status-hidden":r.status==2,"status-enabled":r.status==1,"status-disabled":!r.status,trashed:r.deleted_at,cut:u.cut}]),title:a.title(r)},[O("div",{class:"item-text",onClick:o=>e.$emit("select",r)},[O("div",Un,[r.lang?(k(),L("span",Kn,x(r.lang),1)):_("",!0),r.publish_at?(k(),A(Ge,{key:1,class:"publish-at",icon:"mdi-clock-outline"})):_("",!0),r.status>1?(k(),A(Ge,{key:2,class:"item-status",icon:"mdi-eye-off-outline"})):_("",!0),O("span",Mn,x(r.name||e.$gettext("New")),1)]),r.title?(k(),L("div",zn,x(r.title),1)):_("",!0)],8,Hn),O("a",{class:"item-aux",href:a.url(r),target:"_blank",draggable:"false"},[O("div",jn,x(r.domain),1),O("span",Wn,x(a.url(r)),1),r.to?(k(),L("span",Yn," ➔ "+x(r.to),1)):_("",!0)],8,Rn)],10,Bn)]),_:1},8,["modelValue","disableDrag","rtl"]),l.loading?(k(),L("p",Xn,[S(x(e.$gettext("Loading"))+" ",1),t[17]||(t[17]=O("svg",{class:"spinner",width:"32",height:"32",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},[O("circle",{class:"spin1",cx:"4",cy:"12",r:"3"}),O("circle",{class:"spin1 spin2",cx:"12",cy:"12",r:"3"}),O("circle",{class:"spin1 spin3",cx:"20",cy:"12",r:"3"})],-1))])):_("",!0),!l.loading&&!l.items.length?(k(),L("p",qn,x(e.$gettext("No entries found")),1)):_("",!0),!l.loading&&!l.items.length&&!this.embed&&this.auth.can("page:add")?(k(),L("div",Zn,[f(D,{onClick:t[15]||(t[15]=r=>a.add()),title:e.$gettext("Add page"),icon:"mdi-folder-plus",color:"primary",variant:"flat"},null,8,["title"])])):_("",!0)],64)}const Gn=dt(Tn,[["render",Jn]]),Qn={components:{PageListItems:Gn,PageDetail:Qe,Navigation:Ut,AsideList:Ht,User:Bt},inject:["locales","transcribe","openView"],data:()=>({chat:"",response:"",audio:null,help:!1,shortmsg:!0,synthesizing:!1,dictating:!1,filter:{view:"tree",trashed:"WITHOUT",publish:null,status:null,editor:null,cache:null,lang:null}}),setup(){const e=ut(),t=Tt();return{auth:ct(),drawer:t,messages:e}},computed:{message(){if(!this.response)return this.chat;const e=this.response.indexOf(`
---
`);return this.shortmsg?this.$pgettext("ai",this.response.slice(0,e)):this.response.substring(e>0?e+5:0)}},methods:{languages(){const e=[{title:this.$gettext("All"),icon:"mdi-playlist-check",value:{lang:null}}];for(const t of this.locales())e.push({title:t.title,icon:"mdi-translate",value:{lang:t.value}});return e},open(e){this.openView(Qe,{item:e})},record(){if(!this.audio)return this.audio=Lt().start();this.audio.then(e=>{this.dictating=!0,this.audio=null,e.stop().then(t=>{this.transcribe(t).then(n=>{this.chat=n.asText()}).finally(()=>{this.dictating=!1})})})},same(e,t){if(!e||!t)return!1;const n=Object.keys(e),i=Object.keys(t);return n.length===i.length&&n.every(l=>e[l]===t[l])},synthesize(){const e=this.chat.trim();this.chat&&(this.synthesizing=!0,this.$apollo.mutate({mutation:K`mutation($prompt: String!) {
            synthesize(prompt: $prompt)
          }`,variables:{prompt:e}}).then(t=>{var i,l;if(t.errors)throw t;this.response=((i=t.data)==null?void 0:i.synthesize)||"",this.chat=this.message;const n={view:"list",publish:"DRAFT",trashed:"WITHOUT",editor:(l=this.auth.me)==null?void 0:l.email,cache:null,lang:null,status:0};this.same(n,this.filter)?this.$refs.pagelist.reload():this.filter=n,this.synthesizing=null}).catch(t=>{this.messages.add(this.$gettext("Error synthesizing content")+`:
`+t,"error"),this.$log("PageDetailContentList::synthesize(): Error synthesizing content",t)}).finally(()=>{setTimeout(()=>{this.synthesizing=!1},3e3)}))}}},ea={key:0,fill:"currentColor",width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},ta={key:1,fill:"currentColor",width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},na={key:0,fill:"currentColor",width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},aa={key:1,fill:"currentColor",width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},ia={key:0,class:"help"};function ra(e,t,n,i,l,a){var c;const s=ae("User"),r=ae("Navigation"),u=ae("PageListItems"),o=ae("AsideList");return k(),L(ue,null,[f(Ot,{elevation:0,density:"compact"},{prepend:g(()=>[f(D,{onClick:t[0]||(t[0]=d=>i.drawer.toggle("nav")),title:i.drawer.nav?e.$gettext("Close navigation"):e.$gettext("Open navigation"),icon:i.drawer.nav?"mdi-close":"mdi-menu"},null,8,["title","icon"])]),append:g(()=>[f(s),f(D,{onClick:t[1]||(t[1]=d=>i.drawer.toggle("aside")),title:e.$gettext("Toggle side menu"),icon:i.drawer.aside?"mdi-chevron-right":"mdi-chevron-left"},null,8,["title","icon"])]),default:g(()=>[f(It,null,{default:g(()=>[S(x(e.$gettext("Pages")),1)]),_:1})]),_:1}),f(r),f(Pt,{class:"page-list"},{default:g(()=>[f(At,null,{default:g(()=>[f(Vt,{class:"box scroll"},{default:g(()=>[f(Nt,{modelValue:e.chat,"onUpdate:modelValue":t[6]||(t[6]=d=>e.chat=d),loading:e.synthesizing,placeholder:e.$gettext("Describe the page and content you want to create"),onDblclick:t[7]||(t[7]=d=>{e.shortmsg=!e.shortmsg,e.chat=a.message}),variant:"outlined",class:"prompt",rounded:"lg","hide-details":"",autofocus:"","auto-grow":"",clearable:"",outlined:"",rows:"1"},{prepend:g(()=>[f(D,{onClick:t[2]||(t[2]=d=>e.help=!e.help),title:e.help?e.$gettext("Hide help"):e.$gettext("Show help"),variant:"text",icon:""},{default:g(()=>[...t[10]||(t[10]=[O("svg",{fill:"currentColor",width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[O("path",{d:"M11,18H13V16H11V18M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,6A4,4 0 0,0 8,10H10A2,2 0 0,1 12,8A2,2 0 0,1 14,10C14,12 11,11.75 11,15H13C13,12.75 16,12.5 16,10A4,4 0 0,0 12,6Z"})],-1)])]),_:1},8,["title"])]),append:g(()=>[e.chat?(k(),A(D,{key:0,onClick:t[3]||(t[3]=d=>e.synthesizing||a.synthesize()),onKeydown:t[4]||(t[4]=Ft(d=>e.synthesizing||a.synthesize(),["enter"])),title:e.synthesizing?e.$gettext("Generating ..."):e.$gettext("Generate page based on prompt"),loading:e.synthesizing,variant:"text",icon:""},{default:g(()=>[e.synthesizing===!1?(k(),L("svg",ea,[...t[11]||(t[11]=[O("path",{d:"M22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2A10,10 0 0,1 22,12M6,13H14L10.5,16.5L11.92,17.92L17.84,12L11.92,6.08L10.5,7.5L14,11H6V13Z"},null,-1)])])):_("",!0),e.synthesizing===null?(k(),L("svg",ta,[...t[12]||(t[12]=[O("path",{d:"M9,20.42L2.79,14.21L5.62,11.38L9,14.77L18.88,4.88L21.71,7.71L9,20.42Z"},null,-1)])])):_("",!0)]),_:1},8,["title","loading"])):(k(),A(D,{key:1,onClick:t[5]||(t[5]=d=>a.record()),title:e.$gettext("Dictate"),class:de({dictating:e.audio}),loading:e.dictating,variant:"text",icon:""},{default:g(()=>[e.audio?(k(),L("svg",na,[...t[13]||(t[13]=[O("path",{d:"M17.3,11C17.3,14 14.76,16.1 12,16.1C9.24,16.1 6.7,14 6.7,11H5C5,14.41 7.72,17.23 11,17.72V21H13V17.72C16.28,17.23 19,14.41 19,11M10.8,4.9C10.8,4.24 11.34,3.7 12,3.7C12.66,3.7 13.2,4.24 13.2,4.9L13.19,11.1C13.19,11.76 12.66,12.3 12,12.3C11.34,12.3 10.8,11.76 10.8,11.1M12,14A3,3 0 0,0 15,11V5A3,3 0 0,0 12,2A3,3 0 0,0 9,5V11A3,3 0 0,0 12,14Z"},null,-1)])])):(k(),L("svg",aa,[...t[14]||(t[14]=[O("path",{d:"M12,2A3,3 0 0,1 15,5V11A3,3 0 0,1 12,14A3,3 0 0,1 9,11V5A3,3 0 0,1 12,2M19,11C19,14.53 16.39,17.44 13,17.93V21H11V17.93C7.61,17.44 5,14.53 5,11H7A5,5 0 0,0 12,16A5,5 0 0,0 17,11H19Z"},null,-1)])]))]),_:1},8,["title","class","loading"]))]),_:1},8,["modelValue","loading","placeholder"]),e.help?(k(),L("div",ia,[O("ul",null,[O("li",null,x(e.$gettext("AI can create a page and content based on your input and add it to the page tree")),1),O("li",null,x(e.$gettext("Double click on the response in the input field to display full response")),1)])])):_("",!0),f(u,{ref:"pagelist",onSelect:t[8]||(t[8]=d=>a.open(d)),filter:e.filter},null,8,["filter"])]),_:1})]),_:1})]),_:1}),f(o,{filter:e.filter,"onUpdate:filter":t[9]||(t[9]=d=>e.filter=d),content:[{key:"view",title:e.$gettext("view"),items:[{title:e.$gettext("Tree"),icon:"mdi-file-tree",value:{view:"tree"}},{title:e.$gettext("List"),icon:"mdi-format-list-bulleted-square",value:{view:"list"}}]},{key:"publish",title:e.$gettext("publish"),items:[{title:e.$gettext("All"),icon:"mdi-playlist-check",value:{publish:null}},{title:e.$gettext("Published"),icon:"mdi-publish",value:{publish:"PUBLISHED"}},{title:e.$gettext("Scheduled"),icon:"mdi-clock-outline",value:{publish:"SCHEDULED"}},{title:e.$gettext("Drafts"),icon:"mdi-pencil",value:{publish:"DRAFT"}}]},{key:"trashed",title:e.$gettext("trashed"),items:[{title:e.$gettext("All"),icon:"mdi-playlist-check",value:{trashed:"WITH"}},{title:e.$gettext("Available only"),icon:"mdi-delete-off",value:{trashed:"WITHOUT"}},{title:e.$gettext("Only trashed"),icon:"mdi-delete",value:{trashed:"ONLY"}}]},{key:"status",title:e.$gettext("status"),items:[{title:e.$gettext("All"),icon:"mdi-playlist-check",value:{status:null}},{title:e.$gettext("Enabled"),icon:"mdi-eye",value:{status:1}},{title:e.$gettext("Hidden"),icon:"mdi-eye-off-outline",value:{status:2}},{title:e.$gettext("Disabled"),icon:"mdi-eye-off",value:{status:0}}]},{key:"cache",title:e.$gettext("cache"),items:[{title:e.$gettext("All"),icon:"mdi-playlist-check",value:{cache:null}},{title:e.$gettext("No cache"),icon:"mdi-clock-alert-outline",value:{cache:0}}]},{key:"editor",title:e.$gettext("editor"),items:[{title:e.$gettext("All"),icon:"mdi-playlist-check",value:{editor:null}},{title:e.$gettext("Edited by me"),icon:"mdi-account",value:{editor:(c=this.auth.me)==null?void 0:c.email}}]},{key:"lang",title:e.$gettext("languages"),items:a.languages()}]},null,8,["filter","content"])],64)}const ha=dt(Qn,[["render",ra],["__scopeId","data-v-635cebcd"]]);export{ha as default};
