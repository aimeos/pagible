import{_ as J,c as p,o as u,a as l,d as y,f as C,w as n,ad as E,F as _,a5 as T,b as V,k as d,a6 as I,ae as L,r as M,af as q,ag as z,ah as S,a9 as G,ai as R,aj as W,l as g,t as f,i as U,j as k,ak as H,m as x,al as K,h as Q,n as X}from"./index-BbU18Jta.js";import{l as Y}from"./vue-draggable-plus-BuDKqo2a.js";const Z={components:{VueDraggable:Y},props:{modelValue:{type:Array},config:{type:Object,default:()=>{}},assets:{type:Object,default:()=>{}},readonly:{type:Boolean,default:!1},context:{type:Object}},emits:["update:modelValue","error","addFile","removeFile"],inject:["compose","translate","transcribe","txlocales"],data(){return{translating:{},dictating:{},composing:{},errors:[],items:[],menu:[],panel:[],audio:{}}},setup(){return{clipboard:L()}},computed:{rules(){return[e=>!this.config.max||this.config.max&&e.length<=this.config.max||this.$gettext("Maximum is %{num} entries",{num:this.config.max}),e=>(this.config.min??1)&&e.length>=(this.config.min??1)||this.$gettext("Minimum is %{num} entries",{num:this.config.min??1})]}},methods:{add(){this.items.push({}),this.panel.push(this.items.length-1),this.$emit("update:modelValue",this.items)},change(){this.$emit("update:modelValue",this.items)},composeText(e,t){var a,r,w,h,i,s,c,b,m,N,O,j,A,D,F,P;const o=['generate for field "'+(((r=(a=this.config.item)==null?void 0:a[t])==null?void 0:r.label)||t)+'"','required output format is "'+((h=(w=this.config.item)==null?void 0:w[t])==null?void 0:h.type)+'"',(s=(i=this.config.item)==null?void 0:i[t])!=null&&s.min?"minimum characters: "+((b=(c=this.config.item)==null?void 0:c[t])==null?void 0:b.min):null,(N=(m=this.config.item)==null?void 0:m[t])!=null&&N.max?"maximum characters: "+((j=(O=this.config.item)==null?void 0:O[t])==null?void 0:j.max):null,(D=(A=this.config.item)==null?void 0:A[t])!=null&&D.placeholder?"hint text: "+((P=(F=this.config.item)==null?void 0:F[t])==null?void 0:P.placeholder):null,"context information as JSON: "+JSON.stringify(this.items[e])],v=this.items[e][t]||(this.items[e].title?'Write a sentence about "'+this.items[e].title+'"':"");this.composing[e+t]=!0,this.compose(v,o).then(B=>{this.update(e,t,B)}).finally(()=>{this.composing[e+t]=!1})},copy(e){this.clipboard.set("items-content",JSON.parse(JSON.stringify(this.items[e])))},cut(e){this.clipboard.set("items-content",JSON.parse(JSON.stringify(this.items[e]))),this.items.splice(e,1),this.$emit("update:modelValue",this.items)},insert(e){this.items.splice(e,0,{}),this.panel.push(e),this.$emit("update:modelValue",this.items)},paste(e=null){e===null&&(e=this.items.length),this.items.splice(e,0,this.clipboard.get("items-content")),this.$emit("update:modelValue",this.items)},record(e,t){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");if(!this.audio[e+t])return this.audio[e+t]=I().start();this.audio[e+t].then(o=>{this.dictating[e+t]=!0,this.audio[e+t]=null,o.stop().then(v=>{this.transcribe(v).then(a=>{this.update(e,t,a.asText())}).finally(()=>{this.dictating[e+t]=!1})})})},remove(e){this.items.splice(e,1),this.$emit("update:modelValue",this.items)},title(e){return(e.title||e.text||Object.values(e||{}).map(t=>t&&typeof t!="object"&&typeof t!="boolean"?t:null).filter(t=>!!t).join(" - ")).substring(0,100)||""},toName(e){var t;return((t=e==null?void 0:e.charAt(0))==null?void 0:t.toUpperCase())+(e==null?void 0:e.slice(1))},translateText(e,t,o){this.translating[e+t]=!0,this.translate([this.items[e][t]],o).then(v=>{this.update(e,t,v[0]||"")}).finally(()=>{this.translating[e+t]=!1})},update(e,t,o){this.items[e]||(this.items[e]={}),this.items[e][t]=o,this.$emit("update:modelValue",this.items)}},watch:{modelValue:{immediate:!0,handler(e){this.items=Array.isArray(e)?e:this.config.default??[],this.$emit("error",!this.rules.every(t=>t(this.items)===!0))}}}},$={class:"element-title"},ee={class:"label"},te={key:0,class:"actions"},ie={key:0,class:"v-input--error"},ne={class:"v-input__details",role:"alert","aria-live":"polite"},le={class:"v-messages"},ae={class:"btn-group"};function se(e,t,o,v,a,r){const w=M("VueDraggable");return u(),p(_,null,[l(E,{class:"items",modelValue:a.panel,"onUpdate:modelValue":t[4]||(t[4]=h=>a.panel=h),elevation:"0",multiple:""},{default:n(()=>[l(w,{modelValue:a.items,"onUpdate:modelValue":t[2]||(t[2]=h=>a.items=h),onUpdate:t[3]||(t[3]=h=>r.change()),disabled:o.readonly||e.$vuetify.display.smAndDown,forceFallback:!0,fallbackTolerance:"10",draggable:".item",group:"items",animation:"500"},{default:n(()=>[(u(!0),p(_,null,T(a.items,(h,i)=>(u(),V(q,{key:i,class:"item"},{default:n(()=>[l(z,null,{default:n(()=>[o.readonly?y("",!0):(u(),V(S(e.$vuetify.display.xs?"v-dialog":"v-menu"),{key:0,modelValue:a.menu[i],"onUpdate:modelValue":s=>a.menu[i]=s,transition:"scale-transition",location:"end center","max-width":"300"},{activator:n(({props:s})=>[l(d,x({ref_for:!0},s,{title:e.$gettext("Actions"),icon:"mdi-dots-vertical",variant:"text"}),null,16,["title"])]),default:n(()=>[l(G,null,{default:n(()=>[l(R,{density:"compact"},{default:n(()=>[l(W,null,{default:n(()=>[g(f(e.$gettext("Actions")),1)]),_:1}),l(d,{icon:"mdi-close",onClick:s=>a.menu[i]=!1},null,8,["onClick"])]),_:2},1024),l(U,{onClick:s=>a.menu[i]=!1},{default:n(()=>[l(k,null,{default:n(()=>[l(d,{"prepend-icon":"mdi-content-copy",variant:"text",onClick:s=>r.copy(i)},{default:n(()=>[g(f(e.$gettext("Copy")),1)]),_:1},8,["onClick"])]),_:2},1024),l(k,null,{default:n(()=>[l(d,{"prepend-icon":"mdi-content-cut",variant:"text",onClick:s=>r.cut(i)},{default:n(()=>[g(f(e.$gettext("Cut")),1)]),_:1},8,["onClick"])]),_:2},1024),l(k,null,{default:n(()=>[l(d,{"prepend-icon":"mdi-delete",variant:"text",onClick:s=>r.remove(i)},{default:n(()=>[g(f(e.$gettext("Delete")),1)]),_:1},8,["onClick"])]),_:2},1024),l(H),a.menu[i]&&v.clipboard.get("items-content")?(u(),V(k,{key:0},{default:n(()=>[l(d,{"prepend-icon":"mdi-arrow-up",variant:"text",onClick:s=>r.paste(i)},{default:n(()=>[g(f(e.$gettext("Paste before")),1)]),_:1},8,["onClick"])]),_:2},1024)):y("",!0),a.menu[i]&&v.clipboard.get("items-content")?(u(),V(k,{key:1},{default:n(()=>[l(d,{"prepend-icon":"mdi-arrow-down",variant:"text",onClick:s=>r.paste(i+1)},{default:n(()=>[g(f(e.$gettext("Paste after")),1)]),_:1},8,["onClick"])]),_:2},1024)):y("",!0),l(k,null,{default:n(()=>[l(d,{"prepend-icon":"mdi-arrow-up",variant:"text",onClick:s=>r.insert(i)},{default:n(()=>[g(f(e.$gettext("Insert before")),1)]),_:1},8,["onClick"])]),_:2},1024),l(k,null,{default:n(()=>[l(d,{"prepend-icon":"mdi-arrow-down",variant:"text",onClick:s=>r.insert(i+1)},{default:n(()=>[g(f(e.$gettext("Insert after")),1)]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])),C("div",$,f(r.title(h)),1)]),_:2},1024),l(K,null,{default:n(()=>[(u(!0),p(_,null,T(o.config.item||{},(s,c)=>{var b;return u(),p("div",{key:c,class:"field"},[C("div",ee,[g(f(s.label||c)+" ",1),!o.readonly&&["markdown","plaintext","string","text"].includes(s.type)?(u(),p("div",te,[l(Q,null,{activator:n(({props:m})=>[l(d,x({ref_for:!0},m,{title:e.$gettext("Translate"),loading:a.translating[i+c],icon:"mdi-translate",variant:"text"}),null,16,["title","loading"])]),default:n(()=>[l(U,null,{default:n(()=>[(u(!0),p(_,null,T(r.txlocales(),m=>(u(),V(k,{key:m.code},{default:n(()=>[l(d,{onClick:N=>r.translateText(i,c,m.code),"prepend-icon":"mdi-arrow-right-thin",variant:"text"},{default:n(()=>[g(f(m.name),1)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1024),l(d,{title:e.$gettext("Generate text"),loading:a.composing[i+c],onClick:m=>r.composeText(i,c),icon:"mdi-creation",variant:"text"},null,8,["title","loading","onClick"]),l(d,{onClick:m=>r.record(i,c),class:X({dictating:a.audio[i+c]}),icon:a.audio[i+c]?"mdi-microphone-outline":"mdi-microphone",title:e.$gettext("Dictate"),loading:a.dictating[i+c],variant:"text"},null,8,["onClick","class","icon","title","loading"])])):y("",!0)]),(u(),V(S(r.toName(s.type)),{modelValue:(b=a.items[i])==null?void 0:b[c],"onUpdate:modelValue":m=>r.update(i,c,m),onAddFile:t[0]||(t[0]=m=>e.$emit("addFile",m)),onRemoveFile:t[1]||(t[1]=m=>e.$emit("removeFile",m)),readonly:o.readonly,context:a.items[i],assets:o.assets,config:s},null,40,["modelValue","onUpdate:modelValue","readonly","context","assets","config"]))])}),128))]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue","disabled"])]),_:1},8,["modelValue"]),a.errors.length?(u(),p("div",ie,[C("div",ne,[C("div",le,[(u(!0),p(_,null,T(a.errors,(h,i)=>(u(),p("div",{key:i,class:"v-messages__message"},f(h),1))),128))])])])):y("",!0),C("div",ae,[!o.readonly&&(!o.config.max||o.config.max&&+a.items.length<+o.config.max)?(u(),V(d,{key:0,title:e.$gettext("Add element"),icon:"mdi-view-grid-plus",onClick:t[5]||(t[5]=h=>r.add())},null,8,["title"])):y("",!0)])],64)}const me=J(Z,[["render",se],["__scopeId","data-v-79425790"]]);export{me as default};
