import{_ as O,c,o as r,a as u,d as k,f as v,w as h,ad as P,F as V,a5 as _,b as y,k as f,a6 as U,r as E,ae as I,af as L,t as C,ag as M,l as B,h as S,i as J,j as R,m as q,n as z,ah as G}from"./index-CYOThFeL.js";import{l as W}from"./vue-draggable-plus-4nkNolhH.js";const H={components:{VueDraggable:W},props:{modelValue:{type:Array},config:{type:Object,default:()=>{}},assets:{type:Object,default:()=>{}},readonly:{type:Boolean,default:!1},context:{type:Object}},emits:["update:modelValue","error","addFile","removeFile"],inject:["compose","translate","transcribe","txlocales"],data(){return{translating:{},dictating:{},composing:{},errors:[],items:[],panel:[],audio:{}}},computed:{rules(){return[t=>!this.config.max||this.config.max&&t.length<=this.config.max||this.$gettext("Maximum is %{num} entries",{num:this.config.max}),t=>(this.config.min??1)&&t.length>=(this.config.min??1)||this.$gettext("Minimum is %{num} entries",{num:this.config.min??1})]}},methods:{add(){this.items.push({}),this.panel.push(this.items.length-1),this.$emit("update:modelValue",this.items)},change(){this.$emit("update:modelValue",this.items)},composeText(t,e){var i,o,b,m,n,g,a,p,l,x,T,F,j,N,w,A;const s=['generate for field "'+(((o=(i=this.config.item)==null?void 0:i[e])==null?void 0:o.label)||e)+'"','required output format is "'+((m=(b=this.config.item)==null?void 0:b[e])==null?void 0:m.type)+'"',(g=(n=this.config.item)==null?void 0:n[e])!=null&&g.min?"minimum characters: "+((p=(a=this.config.item)==null?void 0:a[e])==null?void 0:p.min):null,(x=(l=this.config.item)==null?void 0:l[e])!=null&&x.max?"maximum characters: "+((F=(T=this.config.item)==null?void 0:T[e])==null?void 0:F.max):null,(N=(j=this.config.item)==null?void 0:j[e])!=null&&N.placeholder?"hint text: "+((A=(w=this.config.item)==null?void 0:w[e])==null?void 0:A.placeholder):null,"context information as JSON: "+JSON.stringify(this.items[t])],d=this.items[t][e]||(this.items[t].title?'Write a sentence about "'+this.items[t].title+'"':"");this.composing[t+e]=!0,this.compose(d,s).then(D=>{this.update(t,e,D)}).finally(()=>{this.composing[t+e]=!1})},record(t,e){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");if(!this.audio[t+e])return this.audio[t+e]=U().start();this.audio[t+e].then(s=>{this.dictating[t+e]=!0,this.audio[t+e]=null,s.stop().then(d=>{this.transcribe(d).then(i=>{this.update(t,e,i.asText())}).finally(()=>{this.dictating[t+e]=!1})})})},remove(t){this.items.splice(t,1),this.$emit("update:modelValue",this.items)},title(t){return(t.title||t.text||Object.values(t||{}).map(e=>e&&typeof e!="object"&&typeof e!="boolean"?e:null).filter(e=>!!e).join(" - ")).substring(0,100)||""},toName(t){var e;return((e=t==null?void 0:t.charAt(0))==null?void 0:e.toUpperCase())+(t==null?void 0:t.slice(1))},translateText(t,e,s){this.translating[t+e]=!0,this.translate([this.items[t][e]],s).then(d=>{this.update(t,e,d[0]||"")}).finally(()=>{this.translating[t+e]=!1})},update(t,e,s){this.items[t]||(this.items[t]={}),this.items[t][e]=s,this.$emit("update:modelValue",this.items)}},watch:{modelValue:{immediate:!0,handler(t){this.items=Array.isArray(t)?t:this.config.default??[],this.$emit("error",!this.rules.every(e=>e(this.items)===!0))}}}},K={class:"element-title"},Q={class:"label"},X={key:0,class:"actions"},Y={key:0,class:"v-input--error"},Z={class:"v-input__details",role:"alert","aria-live":"polite"},$={class:"v-messages"},ee={class:"btn-group"};function te(t,e,s,d,i,o){const b=E("VueDraggable");return r(),c(V,null,[u(P,{class:"items",modelValue:i.panel,"onUpdate:modelValue":e[4]||(e[4]=m=>i.panel=m),elevation:"0",multiple:""},{default:h(()=>[u(b,{modelValue:i.items,"onUpdate:modelValue":e[2]||(e[2]=m=>i.items=m),onUpdate:e[3]||(e[3]=m=>o.change()),disabled:s.readonly||i.panel.length,forceFallback:!0,fallbackTolerance:"10",draggable:".item",group:"items",animation:"500"},{default:h(()=>[(r(!0),c(V,null,_(i.items,(m,n)=>(r(),y(I,{key:n,class:"item"},{default:h(()=>[u(L,null,{default:h(()=>[s.readonly?k("",!0):(r(),y(f,{key:0,onClick:g=>o.remove(n),title:t.$gettext("Remove element"),icon:"mdi-trash-can",variant:"plain"},null,8,["onClick","title"])),v("div",K,C(o.title(m)),1)]),_:2},1024),u(M,null,{default:h(()=>[(r(!0),c(V,null,_(s.config.item||{},(g,a)=>{var p;return r(),c("div",{key:a,class:"field"},[v("div",Q,[B(C(g.label||a)+" ",1),!s.readonly&&["markdown","plaintext","string","text"].includes(g.type)?(r(),c("div",X,[u(S,null,{activator:h(({props:l})=>[u(f,q({ref_for:!0},l,{title:t.$gettext("Translate %{code} field",{code:a}),loading:i.translating[n+a],icon:"mdi-translate",variant:"text"}),null,16,["title","loading"])]),default:h(()=>[u(J,null,{default:h(()=>[(r(!0),c(V,null,_(o.txlocales(),l=>(r(),y(R,{key:l.code},{default:h(()=>[u(f,{onClick:x=>o.translateText(n,a,l.code),"prepend-icon":"mdi-arrow-right-thin",variant:"text"},{default:h(()=>[B(C(l.name),1)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1024),u(f,{title:t.$gettext("Generate text for %{code} field",{code:a}),loading:i.composing[n+a],onClick:l=>o.composeText(n,a),icon:"mdi-creation",variant:"text"},null,8,["title","loading","onClick"]),u(f,{onClick:l=>o.record(n,a),class:z({dictating:i.audio[n+a]}),icon:i.audio[n+a]?"mdi-microphone-outline":"mdi-microphone",title:t.$gettext("Dictate"),loading:i.dictating[n+a],variant:"text"},null,8,["onClick","class","icon","title","loading"])])):k("",!0)]),(r(),y(G(o.toName(g.type)),{modelValue:(p=i.items[n])==null?void 0:p[a],"onUpdate:modelValue":l=>o.update(n,a,l),onAddFile:e[0]||(e[0]=l=>t.$emit("addFile",l)),onRemoveFile:e[1]||(e[1]=l=>t.$emit("removeFile",l)),readonly:s.readonly,context:i.items[n],assets:s.assets,config:g},null,40,["modelValue","onUpdate:modelValue","readonly","context","assets","config"]))])}),128))]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue","disabled"])]),_:1},8,["modelValue"]),i.errors.length?(r(),c("div",Y,[v("div",Z,[v("div",$,[(r(!0),c(V,null,_(i.errors,(m,n)=>(r(),c("div",{key:n,class:"v-messages__message"},C(m),1))),128))])])])):k("",!0),v("div",ee,[!s.readonly&&(!s.config.max||s.config.max&&+i.items.length<+s.config.max)?(r(),y(f,{key:0,title:t.$gettext("Add element"),icon:"mdi-view-grid-plus",onClick:e[5]||(e[5]=m=>o.add())},null,8,["title"])):k("",!0)])],64)}const ne=O(H,[["render",te],["__scopeId","data-v-ae700b42"]]);export{ne as default};
