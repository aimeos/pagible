import{_ as U,aS as de,b,w as d,aX as oe,o as h,a as u,i as O,aY as ue,c as p,F as V,a7 as x,j as k,f as v,aZ as he,l as f,t as m,a_ as ce,a$ as me,aA as le,ae as P,ah as fe,aB as M,b0 as ge,d as C,b1 as j,b2 as ee,n as I,a4 as te,aP as se,k as y,aG as H,b3 as pe,a9 as ve,az as ne,af as G,ag as Y,m as q,ad as F,b4 as ye,aL as be,b5 as _e,aM as ke,b6 as Ce,L,a5 as we,aH as ie,I as Ve,h as $e,aI as xe,T as Ie,r as Ee,aj as N,aJ as z,aK as Pe}from"./index-8Ib2nsHy.js";const Te={props:{item:{type:Object,required:!0}},setup(){return{drawer:de()}},computed:{values(){const e={};return this.item.id&&(e[this.$gettext("id")]=this.item.id),this.item.mime&&(e[this.$gettext("mime")]=this.item.mime),this.item.editor&&(e[this.$gettext("editor")]=this.item.editor),this.item.created_at&&(e[this.$gettext("created")]=new Date(this.item.created_at).toLocaleString(this.$vuetify.locale.current)),this.item.updated_at&&(e[this.$gettext("updated")]=new Date(this.item.updated_at).toLocaleString(this.$vuetify.locale.current)),this.item.deleted_at&&(e[this.$gettext("deleted")]=new Date(this.item.deleted_at).toLocaleString(this.$vuetify.locale.current)),e}}};function De(e,t,s,n,o,a){return h(),b(oe,{modelValue:n.drawer.aside,"onUpdate:modelValue":t[0]||(t[0]=r=>n.drawer.aside=r),"mobile-breakpoint":"md",location:"end"},{default:d(()=>[u(O,{opened:[0]},{default:d(()=>[u(ue,{value:0},{activator:d(({props:r})=>[u(k,ce(me(r)),{default:d(()=>[f(m(e.$gettext("Meta data")),1)]),_:1},16)]),default:d(()=>[(h(!0),p(V,null,x(a.values,(r,l)=>(h(),b(k,{key:l,rounded:"lg"},{default:d(()=>[u(he,{class:"name"},{default:d(()=>[f(m(l),1)]),_:2},1024),v("div",null,m(r),1)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])}const wt=U(Te,[["render",De],["__scopeId","data-v-af9b22b1"]]);class ae{diff(t,s,n={}){let o;typeof n=="function"?(o=n,n={}):"callback"in n&&(o=n.callback);const a=this.castInput(t,n),r=this.castInput(s,n),l=this.removeEmpty(this.tokenize(a,n)),i=this.removeEmpty(this.tokenize(r,n));return this.diffWithOptionsObj(l,i,n,o)}diffWithOptionsObj(t,s,n,o){var a;const r=_=>{if(_=this.postProcess(_,n),o){setTimeout(function(){o(_)},0);return}else return _},l=s.length,i=t.length;let c=1,g=l+i;n.maxEditLength!=null&&(g=Math.min(g,n.maxEditLength));const w=(a=n.timeout)!==null&&a!==void 0?a:1/0,E=Date.now()+w,$=[{oldPos:-1,lastComponent:void 0}];let T=this.extractCommon($[0],s,t,0,n);if($[0].oldPos+1>=i&&T+1>=l)return r(this.buildValues($[0].lastComponent,s,t));let W=-1/0,R=1/0;const Q=()=>{for(let _=Math.max(W,-c);_<=Math.min(R,c);_+=2){let D;const S=$[_-1],A=$[_+1];S&&($[_-1]=void 0);let J=!1;if(A){const X=A.oldPos-_;J=A&&0<=X&&X<l}const Z=S&&S.oldPos+1<i;if(!J&&!Z){$[_]=void 0;continue}if(!Z||J&&S.oldPos<A.oldPos?D=this.addToPath(A,!0,!1,0,n):D=this.addToPath(S,!1,!0,1,n),T=this.extractCommon(D,s,t,_,n),D.oldPos+1>=i&&T+1>=l)return r(this.buildValues(D.lastComponent,s,t))||!0;$[_]=D,D.oldPos+1>=i&&(R=Math.min(R,_-1)),T+1>=l&&(W=Math.max(W,_+1))}c++};if(o)(function _(){setTimeout(function(){if(c>g||Date.now()>E)return o(void 0);Q()||_()},0)})();else for(;c<=g&&Date.now()<=E;){const _=Q();if(_)return _}}addToPath(t,s,n,o,a){const r=t.lastComponent;return r&&!a.oneChangePerToken&&r.added===s&&r.removed===n?{oldPos:t.oldPos+o,lastComponent:{count:r.count+1,added:s,removed:n,previousComponent:r.previousComponent}}:{oldPos:t.oldPos+o,lastComponent:{count:1,added:s,removed:n,previousComponent:r}}}extractCommon(t,s,n,o,a){const r=s.length,l=n.length;let i=t.oldPos,c=i-o,g=0;for(;c+1<r&&i+1<l&&this.equals(n[i+1],s[c+1],a);)c++,i++,g++,a.oneChangePerToken&&(t.lastComponent={count:1,previousComponent:t.lastComponent,added:!1,removed:!1});return g&&!a.oneChangePerToken&&(t.lastComponent={count:g,previousComponent:t.lastComponent,added:!1,removed:!1}),t.oldPos=i,c}equals(t,s,n){return n.comparator?n.comparator(t,s):t===s||!!n.ignoreCase&&t.toLowerCase()===s.toLowerCase()}removeEmpty(t){const s=[];for(let n=0;n<t.length;n++)t[n]&&s.push(t[n]);return s}castInput(t,s){return t}tokenize(t,s){return Array.from(t)}join(t){return t.join("")}postProcess(t,s){return t}get useLongestToken(){return!1}buildValues(t,s,n){const o=[];let a;for(;t;)o.push(t),a=t.previousComponent,delete t.previousComponent,t=a;o.reverse();const r=o.length;let l=0,i=0,c=0;for(;l<r;l++){const g=o[l];if(g.removed)g.value=this.join(n.slice(c,c+g.count)),c+=g.count;else{if(!g.added&&this.useLongestToken){let w=s.slice(i,i+g.count);w=w.map(function(E,$){const T=n[c+$];return T.length>E.length?T:E}),g.value=this.join(w)}else g.value=this.join(s.slice(i,i+g.count));i+=g.count,g.added||(c+=g.count)}}return o}}class Le extends ae{constructor(){super(...arguments),this.tokenize=re}equals(t,s,n){return n.ignoreWhitespace?((!n.newlineIsToken||!t.includes(`
`))&&(t=t.trim()),(!n.newlineIsToken||!s.includes(`
`))&&(s=s.trim())):n.ignoreNewlineAtEof&&!n.newlineIsToken&&(t.endsWith(`
`)&&(t=t.slice(0,-1)),s.endsWith(`
`)&&(s=s.slice(0,-1))),super.equals(t,s,n)}}new Le;function re(e,t){t.stripTrailingCr&&(e=e.replace(/\r\n/g,`
`));const s=[],n=e.split(/(\n|\r\n)/);n[n.length-1]||n.pop();for(let o=0;o<n.length;o++){const a=n[o];o%2&&!t.newlineIsToken?s[s.length-1]+=a:s.push(a)}return s}class Oe extends ae{constructor(){super(...arguments),this.tokenize=re}get useLongestToken(){return!0}castInput(t,s){const{undefinedReplacement:n,stringifyReplacer:o=(a,r)=>typeof r>"u"?n:r}=s;return typeof t=="string"?t:JSON.stringify(K(t,null,null,o),null,"  ")}equals(t,s,n){return super.equals(t.replace(/,([\r\n])/g,"$1"),s.replace(/,([\r\n])/g,"$1"),n)}}const B=new Oe;function K(e,t,s,n,o){t=t||[],s=s||[],n&&(e=n(o===void 0?"":o,e));let a;for(a=0;a<t.length;a+=1)if(t[a]===e)return s[a];let r;if(Object.prototype.toString.call(e)==="[object Array]"){for(t.push(e),r=new Array(e.length),s.push(r),a=0;a<e.length;a+=1)r[a]=K(e[a],t,s,n,String(a));return t.pop(),s.pop(),r}if(e&&e.toJSON&&(e=e.toJSON()),typeof e=="object"&&e!==null){t.push(e),r={},s.push(r);const l=[];let i;for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&l.push(i);for(l.sort(),a=0;a<l.length;a+=1)i=l[a],r[i]=K(e[i],t,s,n,i);t.pop(),s.pop()}else r=e;return r}const Se=B.castInput;B.castInput=function(e,t){let s=Se.call(this,e,t);return typeof s=="string"&&(s=s.replace(/\\n/g,`
`)),s};const Ae={props:{modelValue:{type:Boolean,required:!0},current:{type:Object,required:!0},load:{type:Function,required:!0}},emit:["update:modelValue","use","revert"],inject:["url","srcset"],data:()=>({list:[],latest:null,loading:!1,show:!1}),computed:{versions(){return this.list.filter(e=>this.isModified(e,this.current)||e.published||e.publish_at)}},methods:{diff(e,t){return e&&t?B.diff(e,t):t?[t]:[]},filesdiff(e,t){const s=Object.keys(e||{}),n=Object.keys(t||{}),o=s.filter(i=>!n.includes(i)),a=n.filter(i=>!s.includes(i)),r=Object.fromEntries(Object.entries(e||{}).filter(([i])=>o.includes(i)).map(([i,c])=>[i,{...c,css:"added"}])),l=Object.fromEntries(Object.entries(t||{}).filter(([i])=>a.includes(i)).map(([i,c])=>[i,{...c,css:"removed"}]));return{...r,...l}},isModified(e,t){return!e||!t?!1:B.diff(e.data||{},t.data||{}).length!==1},reset(){this.list=[],this.latest=null}},watch:{modelValue:{immediate:!0,handler(e){e&&!this.latest&&(this.loading=!0,this.load().then(t=>{this.list=t||[],this.latest=(t==null?void 0:t.shift())||null}).finally(()=>{this.loading=!1}))}}}},Ne={class:"loading"},ze={class:"media-list"},Ue=["poster","src"],je={key:2},Me=["src"],qe={key:3},Fe=["onClick"],Be={class:"media-list"},We=["poster","src"],Re={key:2},Je=["src"],He={key:3};function Ge(e,t,s,n,o,a){return h(),b(le,{modelValue:s.modelValue,onAfterLeave:t[4]||(t[4]=r=>e.$emit("update:modelValue",!1)),"max-width":"1200",scrollable:""},{default:d(()=>[u(P,{"prepend-icon":"mdi-history"},{append:d(()=>[u(y,{title:e.$gettext("Close"),onClick:t[0]||(t[0]=r=>e.$emit("update:modelValue",!1)),icon:"mdi-close",variant:"text"},null,8,["title"])]),title:d(()=>[f(m(e.$gettext("History")),1)]),default:d(()=>[u(fe),u(M,null,{default:d(()=>[u(ge,{side:"end",align:"start"},{default:d(()=>[e.loading?(h(),b(j,{key:0,"dot-color":"grey-lighten-1",size:"small",width:"100%"},{default:d(()=>[v("div",Ne,[f(m(e.$gettext("Loading"))+" ",1),t[5]||(t[5]=v("svg",{class:"spinner",width:"32",height:"32",fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[v("circle",{class:"spin1",cx:"4",cy:"12",r:"3"}),v("circle",{class:"spin1 spin2",cx:"12",cy:"12",r:"3"}),v("circle",{class:"spin1 spin3",cx:"20",cy:"12",r:"3"})],-1))])]),_:1})):C("",!0),!e.loading&&!(e.latest&&a.isModified(e.latest,s.current)||a.versions.length)?(h(),b(j,{key:1,"dot-color":"grey-lighten-1",width:"100%",size:"small"},{default:d(()=>[f(m(e.$gettext("No changes")),1)]),_:1})):C("",!0),!e.loading&&e.latest&&a.isModified(e.latest,s.current)?(h(),b(j,{key:2,"dot-color":"blue",width:"100%",size:"small"},{default:d(()=>[u(P,{class:"elevation-2"},{default:d(()=>[u(ee,{onClick:t[1]||(t[1]=r=>e.show=!e.show)},{default:d(()=>[f(m(e.$gettext("Current")),1)]),_:1}),u(M,null,{default:d(()=>{var r,l;return[v("div",{class:I(["diff",{show:e.show}]),onClick:t[2]||(t[2]=i=>e.show=!e.show)},[(h(!0),p(V,null,x(a.diff((r=e.latest)==null?void 0:r.data,s.current.data),i=>(h(),p("span",{class:I({added:i.added,removed:i.removed})},m(i.value||i),3))),256))],2),v("div",ze,[(h(!0),p(V,null,x(a.filesdiff(s.current.files,(l=e.latest)==null?void 0:l.files),i=>{var c,g,w;return h(),p("div",{key:i.id,class:I([i.css,"file"])},[(c=i.mime)!=null&&c.startsWith("image/")?(h(),b(te,{key:0,srcset:a.srcset(i.previews),src:a.url(i.path),alt:i.name,draggable:"false",loading:"lazy"},null,8,["srcset","src","alt"])):(g=i.mime)!=null&&g.startsWith("video/")?(h(),p("video",{key:1,poster:a.url(Object.values(i.previews).shift()),src:a.url(i.path),crossorigin:"anonymous",draggable:"false",loading:"lazy",controls:""},null,8,Ue)):(w=i.mime)!=null&&w.startsWith("audio/")?(h(),p("div",je,[v("audio",{src:a.url(i.path),crossorigin:"anonymous",draggable:"false",loading:"lazy",controls:""},null,8,Me),f(" "+m(i.name),1)])):(h(),p("div",qe,m(i.name),1))],2)}),128))])]}),_:1}),u(se,null,{default:d(()=>[u(y,{variant:"outlined",onClick:t[3]||(t[3]=H(r=>e.$emit("revert",e.latest),["stop"]))},{default:d(()=>[f(m(e.$gettext("Revert")),1)]),_:1})]),_:1})]),_:1})]),_:1})):C("",!0),(h(!0),p(V,null,x(a.versions,(r,l)=>(h(),b(j,{key:l,"dot-color":r.published?"success":"grey-lighten-1",class:I({publish:r.publish_at}),width:"100%",size:"small"},{default:d(()=>[u(P,{class:"elevation-2"},{default:d(()=>[u(ee,{onClick:i=>r._show=!r._show},{default:d(()=>[f(m(new Date(r.publish_at||r.created_at).toLocaleString(e.$vuetify.locale.current)),1)]),_:2},1032,["onClick"]),u(pe,{onClick:i=>r._show=!r._show},{default:d(()=>[f(m(r.editor),1)]),_:2},1032,["onClick"]),u(M,null,{default:d(()=>[v("div",{class:I(["diff",{show:r._show}]),onClick:i=>r._show=!r._show},[(h(!0),p(V,null,x(a.diff(r.data,s.current.data),i=>(h(),p("span",{class:I({added:i.removed,removed:i.added})},m(i.value||i),3))),256))],10,Fe),v("div",Be,[(h(!0),p(V,null,x(a.filesdiff(r.files,s.current.files),i=>{var c,g,w;return h(),p("div",{key:i.id,class:I([i.css,"file"])},[(c=i.mime)!=null&&c.startsWith("image/")?(h(),b(te,{key:0,srcset:a.srcset(i.previews),src:a.url(i.path),alt:i.name,draggable:"false",loading:"lazy"},null,8,["srcset","src","alt"])):(g=i.mime)!=null&&g.startsWith("video/")?(h(),p("video",{key:1,poster:a.url(Object.values(i.previews).shift()),src:a.url(i.path),crossorigin:"anonymous",draggable:"false",loading:"lazy",controls:""},null,8,We)):(w=i.mime)!=null&&w.startsWith("audio/")?(h(),p("div",Re,[v("audio",{src:a.url(i.path),crossorigin:"anonymous",draggable:"false",loading:"lazy",controls:""},null,8,Je),f(" "+m(i.name),1)])):(h(),p("div",He,m(i.name),1))],2)}),128))])]),_:2},1024),u(se,null,{default:d(()=>[u(y,{variant:"outlined",onClick:H(i=>e.$emit("use",r),["stop"])},{default:d(()=>[f(m(e.$gettext("Use version")),1)]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["dot-color","class"]))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}const Vt=U(Ae,[["render",Ge],["__scopeId","data-v-c2a4882e"]]),Ye={props:{data:{type:Object,default:()=>{}},files:{type:Array,default:()=>[]},assets:{type:Object,default:()=>{}},readonly:{type:Boolean,default:!1},fields:{type:Object,required:!0},type:{type:String,default:""}},emits:["change","error","update:files"],inject:["write","translate","transcribe","txlocales"],data(){return{translating:{},dictating:{},composing:{},errors:{},audio:{},menu:{}}},setup(){return{messages:ne()}},methods:{addFile(e){if(!(e!=null&&e.id)){this.$log("Fields::addFile(): Invalid item without ID",e);return}const t=[...this.files];t.push(e.id),this.assets[e.id]=e,this.$emit("update:files",t)},writeText(e){const t=['generate for field "'+(this.fields[e].label||e)+'"','required output format is "'+this.fields[e].type+'"',this.fields[e].min?"minimum characters: "+this.fields[e].min:null,this.fields[e].max?"maximum characters: "+this.fields[e].max:null,this.fields[e].placeholder?"hint text: "+this.fields[e].placeholder:null,"context information as JSON: "+JSON.stringify(this.data)];this.composing[e]=!0,this.write(this.data[e]||"Create a suitable text based on the context",t).then(s=>{this.update(e,s)}).finally(()=>{this.composing[e]=!1})},error(e,t){this.errors[e]=t,this.$emit("error",Object.values(this.errors).includes(!0))},record(e){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");if(!this.audio[e])return this.audio[e]=ve().start();this.audio[e].then(t=>{this.dictating[e]=!0,this.audio[e]=null,t.stop().then(s=>{this.transcribe(s).then(n=>{this.update(e,n.asText())}).finally(()=>{this.dictating[e]=!1})})})},removeFile(e){if(!e){this.$log("Fields::removeFile(): Invalid ID",e);return}const t=[...this.files],s=t.findIndex(n=>n===e);s!==-1&&t.splice(s,1),this.$emit("update:files",t)},toName(e){var t;return((t=e==null?void 0:e.charAt(0))==null?void 0:t.toUpperCase())+(e==null?void 0:e.slice(1))},translateText(e,t){this.translating[e]=!0,this.translate([this.data[e]],t).then(s=>{this.update(e,s[0]||"")}).finally(()=>{this.translating[e]=!1})},update(e,t){this.data[e]=t,this.$emit("change",this.data[e])}},watch:{type:{immediate:!0,handler(e){this.errors={}}}}},Ke={key:0,class:"label"},Qe={key:0,class:"actions"};function Ze(e,t,s,n,o,a){return h(!0),p(V,null,x(s.fields,(r,l)=>(h(),p("div",{key:l,class:I(["item",{error:o.errors[l]}])},[r.type!=="hidden"?(h(),p("div",Ke,[f(m(e.$pgettext("fn",r.label||l).replace(/-|_/g," "))+" ",1),!s.readonly&&["markdown","plaintext","string","text"].includes(r.type)?(h(),p("div",Qe,[s.readonly?C("",!0):(h(),b(F(e.$vuetify.display.xs?"v-dialog":"v-menu"),{key:0,modelValue:o.menu[l],"onUpdate:modelValue":i=>o.menu[l]=i,transition:"scale-transition",location:"end center","max-width":"300"},{activator:d(({props:i})=>[u(y,q({ref_for:!0},i,{title:e.$gettext("Translate"),loading:o.translating[l],icon:"mdi-translate",variant:"text"}),null,16,["title","loading"])]),default:d(()=>[u(P,null,{default:d(()=>[u(G,{density:"compact"},{default:d(()=>[u(Y,null,{default:d(()=>[f(m(e.$gettext("Translate")),1)]),_:1}),u(y,{icon:"mdi-close",onClick:i=>o.menu[l]=!1},null,8,["onClick"])]),_:2},1024),u(O,{onClick:i=>o.menu[l]=!1},{default:d(()=>[(h(!0),p(V,null,x(a.txlocales(),i=>(h(),b(k,{key:i.code},{default:d(()=>[u(y,{onClick:c=>a.translateText(l,i.code),"prepend-icon":"mdi-arrow-right-thin",variant:"text"},{default:d(()=>[f(m(i.name),1)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])),u(y,{title:e.$gettext("Generate text"),loading:o.composing[l],onClick:i=>a.writeText(l),icon:"mdi-creation",variant:"text"},null,8,["title","loading","onClick"]),u(y,{onClick:i=>a.record(l),class:I({dictating:o.audio[l]}),icon:o.audio[l]?"mdi-microphone-outline":"mdi-microphone",title:e.$gettext("Dictate"),loading:o.dictating[l],variant:"text"},null,8,["onClick","class","icon","title","loading"])])):C("",!0)])):C("",!0),(h(),b(F(a.toName(r.type)),{key:r.type+"-"+l,context:s.data,assets:s.assets,config:r,readonly:s.readonly,modelValue:s.data[l],onAddFile:t[0]||(t[0]=i=>a.addFile(i)),onRemoveFile:t[1]||(t[1]=i=>a.removeFile(i)),"onUpdate:modelValue":i=>a.update(l,i),onError:i=>a.error(l,i)},null,40,["context","assets","config","readonly","modelValue","onUpdate:modelValue","onError"]))],2))),128)}const $t=U(Ye,[["render",Ze],["__scopeId","data-v-be883067"]]);/**
 * @license LGPL, https://opensource.org/license/lgpl-3-0
 */const xt=(function(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",t=new Date("2025-01-01T00:00:00Z").getTime();let s=0;return function(){const n=(Date.now()-t)/4096<<7|s;return s=s+1&127,Array.from({length:6},(o,a)=>{const r=n>>6*(5-a)&63;return e[a===0?r%52:r]}).join("")}})(),Xe={props:{type:{type:String,required:!0}},emits:["add"],data:()=>({tab:["basic"]}),setup(){return{schemas:ye()}},computed:{groups(){const e={};for(const t in this.schemas[this.type]||{}){const s=this.schemas[this.type][t],n=s.group||this.$gettext("uncategorized");s.type=t,e[n]=e[n]||[],e[n].push(s)}return e}},methods:{add(e){this.$emit("add",{type:e.type})}}},et=["innerHTML"];function tt(e,t,s,n,o,a){return h(),p(V,null,[u(be,{modelValue:e.tab,"onUpdate:modelValue":t[0]||(t[0]=r=>e.tab=r)},{default:d(()=>[(h(!0),p(V,null,x(a.groups,(r,l)=>(h(),b(ke,{key:l,value:l},{default:d(()=>[f(m(e.$pgettext("sg",l)),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),u(_e,{modelValue:e.tab,"onUpdate:modelValue":t[1]||(t[1]=r=>e.tab=r)},{default:d(()=>[(h(!0),p(V,null,x(Object.keys(a.groups),r=>(h(),b(Ce,{key:r,value:r},{default:d(()=>[u(P,null,{default:d(()=>[(h(!0),p(V,null,x(a.groups[r],l=>(h(),b(y,{key:l.type,onClick:i=>a.add(l),variant:"text",stacked:""},{prepend:d(()=>[v("span",{class:"icon",innerHTML:l.icon},null,8,et)]),default:d(()=>[f(" "+m(e.$pgettext("st",l.label||l.type)),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])],64)}const st=U(Xe,[["render",tt],["__scopeId","data-v-31ee5f6c"]]),it={components:{SchemaItems:st},props:{embed:{type:Boolean,default:!1},filter:{type:Object,default:()=>({})}},emits:["select"],inject:["debounce"],data(){return{items:[],menu:[],term:"",sort:{column:"ID",order:"DESC"},page:1,last:1,limit:100,vschemas:!1,actions:!1,checked:!1,loading:!0,trash:!1}},setup(){const e=ne();return{auth:we(),messages:e}},created(){this.search(),this.searchd=this.debounce(this.search,500)},computed:{canTrash(){return this.items.some(e=>e._checked&&!e.deleted_at)},isChecked(){return this.items.some(e=>e._checked)},isTrashed(){return this.items.some(e=>e._checked&&e.deleted_at)}},methods:{add(e){if(this.embed||!this.auth.can("element:add")){this.messages.add(this.$gettext("Permission denied"),"error");return}return this.$apollo.mutate({mutation:L`mutation($input: ElementInput!) {
            addElement(input: $input) {
              id
              lang
              name
              type
              data
              editor
              created_at
              updated_at
              deleted_at
            }
          }`,variables:{input:{type:e.type,name:this.$gettext("New shared element"),data:"{}"}}}).then(t=>{var n;if(t.errors)throw t.errors;const s=((n=t.data)==null?void 0:n.addElement)||{};return s.data=JSON.parse(s.data)||{},s.published=!0,this.vschemas=!1,this.items.unshift(s),this.$emit("select",s),this.invalidate(),s}).catch(t=>{this.$log("ElementListItems::add(): Error adding shared element",t)})},drop(e){if(!this.auth.can("element:drop")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.items.filter(s=>s._checked);t.length&&this.$apollo.mutate({mutation:L`
            mutation($id: [ID!]!) {
              dropElement(id: $id) {
                id
              }
            }
          `,variables:{id:t.map(s=>s.id)}}).then(s=>{if(s.errors)throw s.errors;this.invalidate(),this.search()}).catch(s=>{this.messages.add(this.$gettext("Error trashing shared element")+`:
`+s,"error"),this.$log("ElementListItems::drop(): Error trashing shared element",t,s)})},invalidate(){const e=this.$apollo.provider.defaultClient.cache;e.evict({id:"ROOT_QUERY",fieldName:"elements"}),e.gc()},keep(e){if(!this.auth.can("element:keep")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.items.filter(s=>s._checked);t.length&&this.$apollo.mutate({mutation:L`
            mutation($id: [ID!]!) {
              keepElement(id: $id) {
                id
              }
            }
          `,variables:{id:t.map(s=>s.id)}}).then(s=>{if(s.errors)throw s.errors;t.forEach(n=>{n.deleted_at=null}),this.invalidate(),this.search()}).catch(s=>{this.messages.add(this.$gettext("Error restoring shared element")+`:
`+s,"error"),this.$log("ElementListItems::keep(): Error restoring shared element",t,s)})},publish(e){if(!this.auth.can("element:publish")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.items.filter(s=>s._checked&&s.id&&!s.published);t.length&&this.$apollo.mutate({mutation:L`mutation ($id: [ID!]!) {
            pubElement(id: $id) {
              id
            }
          }`,variables:{id:t.map(s=>s.id)}}).then(s=>{if(s.errors)throw s.errors;t.forEach(n=>{n.published=!0,n._checked=!1}),this.invalidate(),this.search()}).catch(s=>{this.messages.add(this.$gettext("Error publishing shared element")+`:
`+s,"error"),this.$log("ElementListItems::publish(): Error publishing shared element",t,s)})},purge(e){if(!this.auth.can("element:purge")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.items.filter(s=>s._checked);t.length&&this.$apollo.mutate({mutation:L`
            mutation($id: [ID!]!) {
              purgeElement(id: $id) {
                id
              }
            }
          `,variables:{id:t.map(s=>s.id)}}).then(s=>{if(s.errors)throw s.errors;this.invalidate(),this.search()}).catch(s=>{this.messages.add(this.$gettext("Error purging shared element")+`:
`+s,"error"),this.$log("ElementListItems::purge(): Error purging shared element",t,s)})},search(){if(!this.auth.can("element:view"))return this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve([]);const e=this.filter.publish||null,t=this.filter.trashed||"WITHOUT",s={...this.filter};return delete s.publish,delete s.trashed,this.term&&(s.any=this.term),this.loading=!0,this.$apollo.query({query:L`
            query($filter: ElementFilter, $sort: [QueryElementsSortOrderByClause!], $limit: Int!, $page: Int!, $trashed: Trashed, $publish: Publish) {
              elements(filter: $filter, sort: $sort, first: $limit, page: $page, trashed: $trashed, publish: $publish) {
                data {
                  id
                  lang
                  name
                  type
                  data
                  editor
                  created_at
                  updated_at
                  deleted_at
                  latest {
                    id
                    published
                    publish_at
                    data
                    editor
                    created_at
                  }
                }
                paginatorInfo {
                  lastPage
                }
              }
            }
          `,variables:{filter:s,page:this.page,limit:this.limit,sort:[this.sort],trashed:t,publish:e}}).then(n=>{var a;if(n.errors)throw n.errors;const o=n.data.elements||{};return this.last=((a=o.paginatorInfo)==null?void 0:a.lastPage)||1,this.items=[...o.data||[]].map(r=>{var i,c,g,w,E,$;const l=(i=r.latest)!=null&&i.data?JSON.parse((c=r.latest)==null?void 0:c.data):{...r,data:JSON.parse(r.data||"{}")};return Object.assign(l,{id:r.id,deleted_at:r.deleted_at,created_at:r.created_at,updated_at:((g=r.latest)==null?void 0:g.created_at)||r.updated_at,editor:((w=r.latest)==null?void 0:w.editor)||r.editor,published:((E=r.latest)==null?void 0:E.published)??!0,publish_at:(($=r.latest)==null?void 0:$.publish_at)||null,latest:r.latest})}),this.checked=!1,this.loading=!1,this.items}).catch(n=>{this.messages.add(this.$gettext("Error fetching shared elements")+`:
`+n,"error"),this.$log("ElementListItems::search(): Error fetching shared element",n)})},title(e){const t=[];return e.publish_at&&t.push("Publish at: "+new Date(e.publish_at).toLocaleDateString()),t.join(`
`)},toggle(){this.items.forEach(e=>{e._checked=!e._checked})}},watch:{filter:{deep:!0,handler(){this.search()}},term(){this.searchd()},page(){this.search()},sort(){this.search()}}},lt={class:"header"},nt={class:"bulk"},at={class:"search"},rt={class:"layout"},dt={class:"actions"},ot=["onClick","title"],ut={class:"item-text"},ht={class:"item-head"},ct={key:0,class:"item-lang"},mt={class:"item-title"},ft={class:"item-type item-subtitle"},gt={class:"item-aux"},pt={class:"item-editor"},vt={class:"item-modified item-subtitle"},yt={key:0,class:"loading"},bt={key:1,class:"notfound"},_t={key:3,class:"btn-group"};function kt(e,t,s,n,o,a){const r=Ee("SchemaItems");return h(),p(V,null,[v("div",lt,[v("div",nt,[u(ie,{modelValue:o.checked,"onUpdate:modelValue":t[0]||(t[0]=l=>o.checked=l),onClick:t[1]||(t[1]=H(l=>a.toggle(),["stop"]))},null,8,["modelValue"]),(h(),b(F(e.$vuetify.display.xs?"v-dialog":"v-menu"),{modelValue:o.actions,"onUpdate:modelValue":t[8]||(t[8]=l=>o.actions=l),transition:"scale-transition",location:"end center","max-width":"300"},{activator:d(({props:l})=>[u(y,q(l,{disabled:!a.isChecked||s.embed||!n.auth.can("element:add"),title:e.$gettext("Actions"),icon:"mdi-dots-vertical",variant:"text"}),null,16,["disabled","title"])]),default:d(()=>[u(P,null,{default:d(()=>[u(G,{density:"compact"},{default:d(()=>[u(Y,null,{default:d(()=>[f(m(e.$gettext("Actions")),1)]),_:1}),u(y,{icon:"mdi-close",onClick:t[2]||(t[2]=l=>o.actions=!1)})]),_:1}),u(O,{onClick:t[7]||(t[7]=l=>o.actions=!1)},{default:d(()=>[N(u(k,null,{default:d(()=>[u(y,{"prepend-icon":"mdi-publish",variant:"text",onClick:t[3]||(t[3]=l=>a.publish())},{default:d(()=>[f(m(e.$gettext("Publish")),1)]),_:1})]),_:1},512),[[z,a.isChecked&&n.auth.can("element:publish")]]),N(u(k,null,{default:d(()=>[u(y,{"prepend-icon":"mdi-delete",variant:"text",onClick:t[4]||(t[4]=l=>a.drop())},{default:d(()=>[f(m(e.$gettext("Delete")),1)]),_:1})]),_:1},512),[[z,a.canTrash&&n.auth.can("element:drop")]]),N(u(k,null,{default:d(()=>[u(y,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:t[5]||(t[5]=l=>a.keep())},{default:d(()=>[f(m(e.$gettext("Restore")),1)]),_:1})]),_:1},512),[[z,a.isTrashed&&n.auth.can("element:keep")]]),N(u(k,null,{default:d(()=>[u(y,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:t[6]||(t[6]=l=>a.purge())},{default:d(()=>[f(m(e.$gettext("Purge")),1)]),_:1})]),_:1},512),[[z,a.isChecked&&n.auth.can("element:purge")]])]),_:1})]),_:1})]),_:1},8,["modelValue"])),!this.embed&&this.auth.can("element:add")?(h(),b(y,{key:0,onClick:t[9]||(t[9]=l=>o.vschemas=!0),title:e.$gettext("Add element"),disabled:o.loading,icon:"mdi-plus",color:"primary",variant:"tonal"},null,8,["title","disabled"])):C("",!0)]),v("div",at,[u(Ve,{modelValue:o.term,"onUpdate:modelValue":t[10]||(t[10]=l=>o.term=l),"prepend-inner-icon":"mdi-magnify",variant:"underlined",label:e.$gettext("Search for"),"hide-details":"",clearable:""},null,8,["modelValue","label"])]),v("div",rt,[u($e,null,{activator:d(({props:l})=>[u(y,q(l,{title:e.$gettext("Sort by"),"append-icon":"mdi-menu-down","prepend-icon":"mdi-sort",variant:"text"}),{default:d(()=>{var i,c,g;return[f(m(((i=o.sort)==null?void 0:i.column)==="ID"?((c=o.sort)==null?void 0:c.order)==="DESC"?e.$gettext("latest"):e.$gettext("oldest"):((g=o.sort)==null?void 0:g.column)||""),1)]}),_:1},16,["title"])]),default:d(()=>[u(O,null,{default:d(()=>[u(k,null,{default:d(()=>[u(y,{variant:"text",onClick:t[11]||(t[11]=l=>o.sort={column:"ID",order:"DESC"})},{default:d(()=>[f(m(e.$gettext("latest")),1)]),_:1})]),_:1}),u(k,null,{default:d(()=>[u(y,{variant:"text",onClick:t[12]||(t[12]=l=>o.sort={column:"ID",order:"ASC"})},{default:d(()=>[f(m(e.$gettext("oldest")),1)]),_:1})]),_:1}),u(k,null,{default:d(()=>[u(y,{variant:"text",onClick:t[13]||(t[13]=l=>o.sort={column:"NAME",order:"ASC"})},{default:d(()=>[f(m(e.$gettext("name")),1)]),_:1})]),_:1}),u(k,null,{default:d(()=>[u(y,{variant:"text",onClick:t[14]||(t[14]=l=>o.sort={column:"TYPE",order:"ASC"})},{default:d(()=>[f(m(e.$gettext("type")),1)]),_:1})]),_:1}),u(k,null,{default:d(()=>[u(y,{variant:"text",onClick:t[15]||(t[15]=l=>o.sort={column:"EDITOR",order:"ASC"})},{default:d(()=>[f(m(e.$gettext("editor")),1)]),_:1})]),_:1})]),_:1})]),_:1})])]),u(O,{class:"items"},{default:d(()=>[(h(!0),p(V,null,x(o.items,(l,i)=>(h(),b(k,{key:i},{default:d(()=>[v("div",dt,[u(ie,{modelValue:l._checked,"onUpdate:modelValue":c=>l._checked=c,class:I([{draft:!l.published},"item-check"])},null,8,["modelValue","onUpdate:modelValue","class"]),(h(),b(F(e.$vuetify.display.xs?"v-dialog":"v-menu"),{modelValue:o.menu[i],"onUpdate:modelValue":c=>o.menu[i]=c,transition:"scale-transition",location:"end center","max-width":"300"},{activator:d(({props:c})=>[u(y,q({ref_for:!0},c,{title:e.$gettext("Actions"),icon:"mdi-dots-vertical",variant:"text"}),null,16,["title"])]),default:d(()=>[u(P,null,{default:d(()=>[u(G,{density:"compact"},{default:d(()=>[u(Y,null,{default:d(()=>[f(m(e.$gettext("Actions")),1)]),_:1}),u(y,{icon:"mdi-close",onClick:c=>o.menu[i]=!1},null,8,["onClick"])]),_:2},1024),u(O,{onClick:c=>o.menu[i]=!1},{default:d(()=>[N(u(k,null,{default:d(()=>[u(y,{"prepend-icon":"mdi-publish",variant:"text",onClick:c=>a.publish(l)},{default:d(()=>[f(m(e.$gettext("Publish")),1)]),_:1},8,["onClick"])]),_:2},1536),[[z,!l.deleted_at&&!l.published&&this.auth.can("element:publish")]]),!l.deleted_at&&this.auth.can("element:drop")?(h(),b(k,{key:0},{default:d(()=>[u(y,{"prepend-icon":"mdi-delete",variant:"text",onClick:c=>a.drop(l)},{default:d(()=>[f(m(e.$gettext("Delete")),1)]),_:1},8,["onClick"])]),_:2},1024)):C("",!0),l.deleted_at&&this.auth.can("element:keep")?(h(),b(k,{key:1},{default:d(()=>[u(y,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:c=>a.keep(l)},{default:d(()=>[f(m(e.$gettext("Restore")),1)]),_:1},8,["onClick"])]),_:2},1024)):C("",!0),this.auth.can("element:purge")?(h(),b(k,{key:2},{default:d(()=>[u(y,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:c=>a.purge(l)},{default:d(()=>[f(m(e.$gettext("Purge")),1)]),_:1},8,["onClick"])]),_:2},1024)):C("",!0)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"]))]),v("a",{href:"#",class:I(["item-content",{trashed:l.deleted_at}]),onClick:c=>e.$emit("select",l),title:a.title(l)},[v("div",ut,[v("div",ht,[l.lang?(h(),p("span",ct,m(l.lang),1)):C("",!0),l.publish_at?(h(),b(Pe,{key:1,class:"publish-at",icon:"mdi-clock-outline"})):C("",!0),v("span",mt,m(l.name),1)]),v("div",ft,m(l.type),1)]),v("div",gt,[v("div",pt,m(l.editor),1),v("div",vt,m(new Date(l.updated_at).toLocaleString()),1)])],10,ot)]),_:2},1024))),128))]),_:1}),o.loading?(h(),p("p",yt,[f(m(e.$gettext("Loading"))+" ",1),t[21]||(t[21]=v("svg",{class:"spinner",width:"32",height:"32",fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[v("circle",{class:"spin1",cx:"4",cy:"12",r:"3"}),v("circle",{class:"spin1 spin2",cx:"12",cy:"12",r:"3"}),v("circle",{class:"spin1 spin3",cx:"20",cy:"12",r:"3"})],-1))])):C("",!0),!o.loading&&!o.items.length?(h(),p("p",bt,m(e.$gettext("No entries found")),1)):C("",!0),o.last>1?(h(),b(xe,{key:2,modelValue:o.page,"onUpdate:modelValue":t[16]||(t[16]=l=>o.page=l),length:o.last},null,8,["modelValue","length"])):C("",!0),!this.embed&&this.auth.can("element:add")?(h(),p("div",_t,[u(y,{onClick:t[17]||(t[17]=l=>o.vschemas=!0),title:e.$gettext("Add element"),disabled:o.loading,icon:"mdi-plus",color:"primary",variant:"tonal"},null,8,["title","disabled"])])):C("",!0),(h(),b(Ie,{to:"body"},[u(le,{modelValue:o.vschemas,"onUpdate:modelValue":t[19]||(t[19]=l=>o.vschemas=l),onAfterLeave:t[20]||(t[20]=l=>o.vschemas=!1),scrollable:"",width:"auto"},{default:d(()=>[u(P,null,{default:d(()=>[u(M,null,{default:d(()=>[u(r,{type:"content",onAdd:t[18]||(t[18]=l=>a.add(l))})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))],64)}const It=U(it,[["render",kt],["__scopeId","data-v-c7d3170e"]]);export{wt as A,It as E,$t as F,Vt as H,st as S,xt as u};
