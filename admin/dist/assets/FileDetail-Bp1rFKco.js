import{_ as Ae,L as I,a5 as ze,b as x,w as d,aD as jt,o as g,a as l,aE as zt,a8 as fi,d as V,ab as Ge,ac as Je,l as y,t as b,ai as Ze,aF as Qe,f as w,c as D,F as j,a7 as q,az as Ye,a6 as pt,aG as tt,aH as Et,ad as $e,k as v,I as Yt,h as Xt,n as J,i as ae,aI as mi,ae as se,af as pe,ag as ge,j as T,m as ie,aj as pi,aJ as gi,a4 as Fe,aK as He,a9 as _t,aA as it,r as ye,aB as at,a3 as Be,aL as ke,aM as ve,aN as vi,aO as bi,T as qt,V as ce,e as te,ap as wi,aP as Vt,al as Re,aQ as rt,aR as We,aS as yi,aT as xi,aU as Ci,aV as ki,a0 as Di,aW as Ei}from"./index-BEvZ_zYI.js";import{H as Vi,A as Ti}from"./ElementListItems-DK0Qs-d9.js";import{P as Mi}from"./PageDetail-DEhqbkXS.js";import{E as Oi}from"./ElementDetail-CNlB_jUE.js";const $i={props:{item:{type:Object,required:!0}},emits:[],inject:["openView"],data:()=>({panel:[0,1,2],versions:{},file:{}}),setup(){return{auth:ze()}},methods:{openElement(t){this.openView(Oi,{item:{...t}})},openPage(t){this.openView(Mi,{item:{...t}})}},watch:{item:{immediate:!0,handler(t){!t.id||!this.auth.can("file:view")||this.$apollo.query({query:I`query ($id: ID!) {
              file(id: $id) {
                id
                bypages {
                  id
                  path
                  name
                }
                byelements {
                  id
                  type
                  name
                }
                byversions {
                  id
                  versionable_id
                  versionable_type
                  published
                  publish_at
                }
              }
            }`,variables:{id:t.id}}).then(e=>{var i,a,r;if(e.errors)throw e.errors;this.file=((i=e.data)==null?void 0:i.file)||{},this.versions=(((r=(a=e.data)==null?void 0:a.file)==null?void 0:r.byversions)||[]).map(n=>({id:n.versionable_id,type:n.versionable_type.split("\\").at(-1),published:n.published?this.$gettext("yes"):n.publish_at?new Date(n.publish_at).toLocaleDateString():this.$gettext("no")})).filter(n=>this.auth.can(n.type.toLowerCase()+":view"))}).catch(e=>{this.$log("FileDetailRef::watch(item): Error fetching file",t,e)})}}}},Si=["onClick"],Ni=["onClick"];function Ii(t,e,i,a,r,n){return g(),x(jt,null,{default:d(()=>[l(zt,{class:"scroll"},{default:d(()=>[l(fi,{modelValue:t.panel,"onUpdate:modelValue":e[0]||(e[0]=s=>t.panel=s),elevation:"0",multiple:""},{default:d(()=>{var s,o,m;return[(s=t.file.bypages)!=null&&s.length&&a.auth.can("page:view")?(g(),x(Ge,{key:0},{default:d(()=>[l(Je,null,{default:d(()=>[y(b(t.$gettext("Pages")),1)]),_:1}),l(Ze,null,{default:d(()=>[l(Qe,{class:"pages",density:"comfortable",hover:""},{default:d(()=>[w("thead",null,[w("tr",null,[w("th",null,b(t.$gettext("ID")),1),w("th",null,b(t.$gettext("URL")),1),w("th",null,b(t.$gettext("Name")),1)])]),w("tbody",null,[(g(!0),D(j,null,q(t.file.bypages,u=>(g(),D("tr",{key:u.id,onClick:c=>n.openPage(u)},[w("td",null,b(u.id),1),w("td",null,b("/"+u.path),1),w("td",null,b(u.name),1)],8,Si))),128))])]),_:1})]),_:1})]),_:1})):V("",!0),(o=t.file.byelements)!=null&&o.length&&a.auth.can("element:view")?(g(),x(Ge,{key:1},{default:d(()=>[l(Je,null,{default:d(()=>[y(b(t.$gettext("Elements")),1)]),_:1}),l(Ze,null,{default:d(()=>[l(Qe,{class:"elements",density:"comfortable",hover:""},{default:d(()=>[w("thead",null,[w("tr",null,[w("th",null,b(t.$gettext("ID")),1),w("th",null,b(t.$gettext("Type")),1),w("th",null,b(t.$gettext("Name")),1)])]),w("tbody",null,[(g(!0),D(j,null,q(t.file.byelements,u=>(g(),D("tr",{key:u.id,onClick:c=>n.openElement(u)},[w("td",null,b(u.id),1),w("td",null,b(u.type),1),w("td",null,b(u.name),1)],8,Ni))),128))])]),_:1})]),_:1})]),_:1})):V("",!0),(m=t.versions)!=null&&m.length?(g(),x(Ge,{key:2},{default:d(()=>[l(Je,null,{default:d(()=>[y(b(t.$gettext("Versions")),1)]),_:1}),l(Ze,null,{default:d(()=>[l(Qe,{density:"comfortable",hover:""},{default:d(()=>[w("thead",null,[w("tr",null,[w("th",null,b(t.$gettext("ID")),1),w("th",null,b(t.$gettext("Type")),1),w("th",null,b(t.$gettext("Published")),1)])]),w("tbody",null,[(g(!0),D(j,null,q(t.versions,u=>(g(),D("tr",{key:u.id},[w("td",null,b(u.id),1),w("td",null,b(u.type),1),w("td",null,b(u.published),1)]))),128))])]),_:1})]),_:1})]),_:1})):V("",!0)]}),_:1},8,["modelValue"])]),_:1})]),_:1})}const Ai=Ae($i,[["render",Ii],["__scopeId","data-v-791df981"]]);/*!
 * Cropper.js v1.6.2
 * https://fengyuanchen.github.io/cropperjs
 *
 * Copyright 2015-present Chen Fengyuan
 * Released under the MIT license
 *
 * Date: 2024-04-21T07:43:05.335Z
 */function Tt(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),i.push.apply(i,a)}return i}function Gt(t){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?Tt(Object(i),!0).forEach(function(a){Pi(t,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Tt(Object(i)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(i,a))})}return t}function Li(t,e){if(typeof t!="object"||!t)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var a=i.call(t,e);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}function Jt(t){var e=Li(t,"string");return typeof e=="symbol"?e:e+""}function nt(t){"@babel/helpers - typeof";return nt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},nt(t)}function Ri(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Mt(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,Jt(a.key),a)}}function Ui(t,e,i){return e&&Mt(t.prototype,e),i&&Mt(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function Pi(t,e,i){return e=Jt(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Zt(t){return Bi(t)||Fi(t)||Hi(t)||Wi()}function Bi(t){if(Array.isArray(t))return st(t)}function Fi(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Hi(t,e){if(t){if(typeof t=="string")return st(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);if(i==="Object"&&t.constructor&&(i=t.constructor.name),i==="Map"||i==="Set")return Array.from(t);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return st(t,e)}}function st(t,e){(e==null||e>t.length)&&(e=t.length);for(var i=0,a=new Array(e);i<e;i++)a[i]=t[i];return a}function Wi(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Xe=typeof window<"u"&&typeof window.document<"u",Q=Xe?window:{},gt=Xe&&Q.document.documentElement?"ontouchstart"in Q.document.documentElement:!1,vt=Xe?"PointerEvent"in Q:!1,S="cropper",bt="all",Qt="crop",Kt="move",ei="zoom",fe="e",me="w",we="s",ne="n",Ve="ne",Te="nw",Me="se",Oe="sw",lt="".concat(S,"-crop"),Ot="".concat(S,"-disabled"),W="".concat(S,"-hidden"),$t="".concat(S,"-hide"),ji="".concat(S,"-invisible"),je="".concat(S,"-modal"),ot="".concat(S,"-move"),Ne="".concat(S,"Action"),Ue="".concat(S,"Preview"),wt="crop",ti="move",ii="none",dt="crop",ht="cropend",ut="cropmove",ct="cropstart",St="dblclick",zi=gt?"touchstart":"mousedown",Yi=gt?"touchmove":"mousemove",Xi=gt?"touchend touchcancel":"mouseup",Nt=vt?"pointerdown":zi,It=vt?"pointermove":Yi,At=vt?"pointerup pointercancel":Xi,Lt="ready",Rt="resize",Ut="wheel",ft="zoom",Pt="image/jpeg",_i=/^e|w|s|n|se|sw|ne|nw|all|crop|move|zoom$/,qi=/^data:/,Gi=/^data:image\/jpeg;base64,/,Ji=/^img|canvas$/i,ai=200,ri=100,Bt={viewMode:0,dragMode:wt,initialAspectRatio:NaN,aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:ai,minContainerHeight:ri,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},Zi='<div class="cropper-container" touch-action="none"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-cropper-action="e"></span><span class="cropper-line line-n" data-cropper-action="n"></span><span class="cropper-line line-w" data-cropper-action="w"></span><span class="cropper-line line-s" data-cropper-action="s"></span><span class="cropper-point point-e" data-cropper-action="e"></span><span class="cropper-point point-n" data-cropper-action="n"></span><span class="cropper-point point-w" data-cropper-action="w"></span><span class="cropper-point point-s" data-cropper-action="s"></span><span class="cropper-point point-ne" data-cropper-action="ne"></span><span class="cropper-point point-nw" data-cropper-action="nw"></span><span class="cropper-point point-sw" data-cropper-action="sw"></span><span class="cropper-point point-se" data-cropper-action="se"></span></div></div>',Qi=Number.isNaN||Q.isNaN;function E(t){return typeof t=="number"&&!Qi(t)}var Ft=function(e){return e>0&&e<1/0};function Ke(t){return typeof t>"u"}function be(t){return nt(t)==="object"&&t!==null}var Ki=Object.prototype.hasOwnProperty;function xe(t){if(!be(t))return!1;try{var e=t.constructor,i=e.prototype;return e&&i&&Ki.call(i,"isPrototypeOf")}catch{return!1}}function H(t){return typeof t=="function"}var ea=Array.prototype.slice;function ni(t){return Array.from?Array.from(t):ea.call(t)}function L(t,e){return t&&H(e)&&(Array.isArray(t)||E(t.length)?ni(t).forEach(function(i,a){e.call(t,i,a,t)}):be(t)&&Object.keys(t).forEach(function(i){e.call(t,t[i],i,t)})),t}var N=Object.assign||function(e){for(var i=arguments.length,a=new Array(i>1?i-1:0),r=1;r<i;r++)a[r-1]=arguments[r];return be(e)&&a.length>0&&a.forEach(function(n){be(n)&&Object.keys(n).forEach(function(s){e[s]=n[s]})}),e},ta=/\.\d*(?:0|9){12}\d*$/;function De(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e11;return ta.test(t)?Math.round(t*e)/e:t}var ia=/^width|height|left|top|marginLeft|marginTop$/;function le(t,e){var i=t.style;L(e,function(a,r){ia.test(r)&&E(a)&&(a="".concat(a,"px")),i[r]=a})}function aa(t,e){return t.classList?t.classList.contains(e):t.className.indexOf(e)>-1}function B(t,e){if(e){if(E(t.length)){L(t,function(a){B(a,e)});return}if(t.classList){t.classList.add(e);return}var i=t.className.trim();i?i.indexOf(e)<0&&(t.className="".concat(i," ").concat(e)):t.className=e}}function Z(t,e){if(e){if(E(t.length)){L(t,function(i){Z(i,e)});return}if(t.classList){t.classList.remove(e);return}t.className.indexOf(e)>=0&&(t.className=t.className.replace(e,""))}}function Ce(t,e,i){if(e){if(E(t.length)){L(t,function(a){Ce(a,e,i)});return}i?B(t,e):Z(t,e)}}var ra=/([a-z\d])([A-Z])/g;function yt(t){return t.replace(ra,"$1-$2").toLowerCase()}function mt(t,e){return be(t[e])?t[e]:t.dataset?t.dataset[e]:t.getAttribute("data-".concat(yt(e)))}function Ie(t,e,i){be(i)?t[e]=i:t.dataset?t.dataset[e]=i:t.setAttribute("data-".concat(yt(e)),i)}function na(t,e){if(be(t[e]))try{delete t[e]}catch{t[e]=void 0}else if(t.dataset)try{delete t.dataset[e]}catch{t.dataset[e]=void 0}else t.removeAttribute("data-".concat(yt(e)))}var si=/\s\s*/,li=(function(){var t=!1;if(Xe){var e=!1,i=function(){},a=Object.defineProperty({},"once",{get:function(){return t=!0,e},set:function(n){e=n}});Q.addEventListener("test",i,a),Q.removeEventListener("test",i,a)}return t})();function _(t,e,i){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},r=i;e.trim().split(si).forEach(function(n){if(!li){var s=t.listeners;s&&s[n]&&s[n][i]&&(r=s[n][i],delete s[n][i],Object.keys(s[n]).length===0&&delete s[n],Object.keys(s).length===0&&delete t.listeners)}t.removeEventListener(n,r,a)})}function X(t,e,i){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},r=i;e.trim().split(si).forEach(function(n){if(a.once&&!li){var s=t.listeners,o=s===void 0?{}:s;r=function(){delete o[n][i],t.removeEventListener(n,r,a);for(var u=arguments.length,c=new Array(u),f=0;f<u;f++)c[f]=arguments[f];i.apply(t,c)},o[n]||(o[n]={}),o[n][i]&&t.removeEventListener(n,o[n][i],a),o[n][i]=r,t.listeners=o}t.addEventListener(n,r,a)})}function Ee(t,e,i){var a;return H(Event)&&H(CustomEvent)?a=new CustomEvent(e,{detail:i,bubbles:!0,cancelable:!0}):(a=document.createEvent("CustomEvent"),a.initCustomEvent(e,!0,!0,i)),t.dispatchEvent(a)}function oi(t){var e=t.getBoundingClientRect();return{left:e.left+(window.pageXOffset-document.documentElement.clientLeft),top:e.top+(window.pageYOffset-document.documentElement.clientTop)}}var et=Q.location,sa=/^(\w+:)\/\/([^:/?#]*):?(\d*)/i;function Ht(t){var e=t.match(sa);return e!==null&&(e[1]!==et.protocol||e[2]!==et.hostname||e[3]!==et.port)}function Wt(t){var e="timestamp=".concat(new Date().getTime());return t+(t.indexOf("?")===-1?"?":"&")+e}function Se(t){var e=t.rotate,i=t.scaleX,a=t.scaleY,r=t.translateX,n=t.translateY,s=[];E(r)&&r!==0&&s.push("translateX(".concat(r,"px)")),E(n)&&n!==0&&s.push("translateY(".concat(n,"px)")),E(e)&&e!==0&&s.push("rotate(".concat(e,"deg)")),E(i)&&i!==1&&s.push("scaleX(".concat(i,")")),E(a)&&a!==1&&s.push("scaleY(".concat(a,")"));var o=s.length?s.join(" "):"none";return{WebkitTransform:o,msTransform:o,transform:o}}function la(t){var e=Gt({},t),i=0;return L(t,function(a,r){delete e[r],L(e,function(n){var s=Math.abs(a.startX-n.startX),o=Math.abs(a.startY-n.startY),m=Math.abs(a.endX-n.endX),u=Math.abs(a.endY-n.endY),c=Math.sqrt(s*s+o*o),f=Math.sqrt(m*m+u*u),h=(f-c)/c;Math.abs(h)>Math.abs(i)&&(i=h)})}),i}function Pe(t,e){var i=t.pageX,a=t.pageY,r={endX:i,endY:a};return e?r:Gt({startX:i,startY:a},r)}function oa(t){var e=0,i=0,a=0;return L(t,function(r){var n=r.startX,s=r.startY;e+=n,i+=s,a+=1}),e/=a,i/=a,{pageX:e,pageY:i}}function oe(t){var e=t.aspectRatio,i=t.height,a=t.width,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"contain",n=Ft(a),s=Ft(i);if(n&&s){var o=i*e;r==="contain"&&o>a||r==="cover"&&o<a?i=a/e:a=i*e}else n?i=a/e:s&&(a=i*e);return{width:a,height:i}}function da(t){var e=t.width,i=t.height,a=t.degree;if(a=Math.abs(a)%180,a===90)return{width:i,height:e};var r=a%90*Math.PI/180,n=Math.sin(r),s=Math.cos(r),o=e*s+i*n,m=e*n+i*s;return a>90?{width:m,height:o}:{width:o,height:m}}function ha(t,e,i,a){var r=e.aspectRatio,n=e.naturalWidth,s=e.naturalHeight,o=e.rotate,m=o===void 0?0:o,u=e.scaleX,c=u===void 0?1:u,f=e.scaleY,h=f===void 0?1:f,C=i.aspectRatio,k=i.naturalWidth,$=i.naturalHeight,M=a.fillColor,R=M===void 0?"transparent":M,P=a.imageSmoothingEnabled,A=P===void 0?!0:P,K=a.imageSmoothingQuality,z=K===void 0?"low":K,p=a.maxWidth,O=p===void 0?1/0:p,U=a.maxHeight,Y=U===void 0?1/0:U,ee=a.minWidth,de=ee===void 0?0:ee,he=a.minHeight,re=he===void 0?0:he,G=document.createElement("canvas"),F=G.getContext("2d"),ue=oe({aspectRatio:C,width:O,height:Y}),Le=oe({aspectRatio:C,width:de,height:re},"cover"),_e=Math.min(ue.width,Math.max(Le.width,k)),qe=Math.min(ue.height,Math.max(Le.height,$)),xt=oe({aspectRatio:r,width:O,height:Y}),Ct=oe({aspectRatio:r,width:de,height:re},"cover"),kt=Math.min(xt.width,Math.max(Ct.width,n)),Dt=Math.min(xt.height,Math.max(Ct.height,s)),ui=[-kt/2,-Dt/2,kt,Dt];return G.width=De(_e),G.height=De(qe),F.fillStyle=R,F.fillRect(0,0,_e,qe),F.save(),F.translate(_e/2,qe/2),F.rotate(m*Math.PI/180),F.scale(c,h),F.imageSmoothingEnabled=A,F.imageSmoothingQuality=z,F.drawImage.apply(F,[t].concat(Zt(ui.map(function(ci){return Math.floor(De(ci))})))),F.restore(),G}var di=String.fromCharCode;function ua(t,e,i){var a="";i+=e;for(var r=e;r<i;r+=1)a+=di(t.getUint8(r));return a}var ca=/^data:.*,/;function fa(t){var e=t.replace(ca,""),i=atob(e),a=new ArrayBuffer(i.length),r=new Uint8Array(a);return L(r,function(n,s){r[s]=i.charCodeAt(s)}),a}function ma(t,e){for(var i=[],a=8192,r=new Uint8Array(t);r.length>0;)i.push(di.apply(null,ni(r.subarray(0,a)))),r=r.subarray(a);return"data:".concat(e,";base64,").concat(btoa(i.join("")))}function pa(t){var e=new DataView(t),i;try{var a,r,n;if(e.getUint8(0)===255&&e.getUint8(1)===216)for(var s=e.byteLength,o=2;o+1<s;){if(e.getUint8(o)===255&&e.getUint8(o+1)===225){r=o;break}o+=1}if(r){var m=r+4,u=r+10;if(ua(e,m,4)==="Exif"){var c=e.getUint16(u);if(a=c===18761,(a||c===19789)&&e.getUint16(u+2,a)===42){var f=e.getUint32(u+4,a);f>=8&&(n=u+f)}}}if(n){var h=e.getUint16(n,a),C,k;for(k=0;k<h;k+=1)if(C=n+k*12+2,e.getUint16(C,a)===274){C+=8,i=e.getUint16(C,a),e.setUint16(C,1,a);break}}}catch{i=1}return i}function ga(t){var e=0,i=1,a=1;switch(t){case 2:i=-1;break;case 3:e=-180;break;case 4:a=-1;break;case 5:e=90,a=-1;break;case 6:e=90;break;case 7:e=90,i=-1;break;case 8:e=-90;break}return{rotate:e,scaleX:i,scaleY:a}}var va={render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var e=this.element,i=this.options,a=this.container,r=this.cropper,n=Number(i.minContainerWidth),s=Number(i.minContainerHeight);B(r,W),Z(e,W);var o={width:Math.max(a.offsetWidth,n>=0?n:ai),height:Math.max(a.offsetHeight,s>=0?s:ri)};this.containerData=o,le(r,{width:o.width,height:o.height}),B(e,W),Z(r,W)},initCanvas:function(){var e=this.containerData,i=this.imageData,a=this.options.viewMode,r=Math.abs(i.rotate)%180===90,n=r?i.naturalHeight:i.naturalWidth,s=r?i.naturalWidth:i.naturalHeight,o=n/s,m=e.width,u=e.height;e.height*o>e.width?a===3?m=e.height*o:u=e.width/o:a===3?u=e.width/o:m=e.height*o;var c={aspectRatio:o,naturalWidth:n,naturalHeight:s,width:m,height:u};this.canvasData=c,this.limited=a===1||a===2,this.limitCanvas(!0,!0),c.width=Math.min(Math.max(c.width,c.minWidth),c.maxWidth),c.height=Math.min(Math.max(c.height,c.minHeight),c.maxHeight),c.left=(e.width-c.width)/2,c.top=(e.height-c.height)/2,c.oldLeft=c.left,c.oldTop=c.top,this.initialCanvasData=N({},c)},limitCanvas:function(e,i){var a=this.options,r=this.containerData,n=this.canvasData,s=this.cropBoxData,o=a.viewMode,m=n.aspectRatio,u=this.cropped&&s;if(e){var c=Number(a.minCanvasWidth)||0,f=Number(a.minCanvasHeight)||0;o>1?(c=Math.max(c,r.width),f=Math.max(f,r.height),o===3&&(f*m>c?c=f*m:f=c/m)):o>0&&(c?c=Math.max(c,u?s.width:0):f?f=Math.max(f,u?s.height:0):u&&(c=s.width,f=s.height,f*m>c?c=f*m:f=c/m));var h=oe({aspectRatio:m,width:c,height:f});c=h.width,f=h.height,n.minWidth=c,n.minHeight=f,n.maxWidth=1/0,n.maxHeight=1/0}if(i)if(o>(u?0:1)){var C=r.width-n.width,k=r.height-n.height;n.minLeft=Math.min(0,C),n.minTop=Math.min(0,k),n.maxLeft=Math.max(0,C),n.maxTop=Math.max(0,k),u&&this.limited&&(n.minLeft=Math.min(s.left,s.left+(s.width-n.width)),n.minTop=Math.min(s.top,s.top+(s.height-n.height)),n.maxLeft=s.left,n.maxTop=s.top,o===2&&(n.width>=r.width&&(n.minLeft=Math.min(0,C),n.maxLeft=Math.max(0,C)),n.height>=r.height&&(n.minTop=Math.min(0,k),n.maxTop=Math.max(0,k))))}else n.minLeft=-n.width,n.minTop=-n.height,n.maxLeft=r.width,n.maxTop=r.height},renderCanvas:function(e,i){var a=this.canvasData,r=this.imageData;if(i){var n=da({width:r.naturalWidth*Math.abs(r.scaleX||1),height:r.naturalHeight*Math.abs(r.scaleY||1),degree:r.rotate||0}),s=n.width,o=n.height,m=a.width*(s/a.naturalWidth),u=a.height*(o/a.naturalHeight);a.left-=(m-a.width)/2,a.top-=(u-a.height)/2,a.width=m,a.height=u,a.aspectRatio=s/o,a.naturalWidth=s,a.naturalHeight=o,this.limitCanvas(!0,!1)}(a.width>a.maxWidth||a.width<a.minWidth)&&(a.left=a.oldLeft),(a.height>a.maxHeight||a.height<a.minHeight)&&(a.top=a.oldTop),a.width=Math.min(Math.max(a.width,a.minWidth),a.maxWidth),a.height=Math.min(Math.max(a.height,a.minHeight),a.maxHeight),this.limitCanvas(!1,!0),a.left=Math.min(Math.max(a.left,a.minLeft),a.maxLeft),a.top=Math.min(Math.max(a.top,a.minTop),a.maxTop),a.oldLeft=a.left,a.oldTop=a.top,le(this.canvas,N({width:a.width,height:a.height},Se({translateX:a.left,translateY:a.top}))),this.renderImage(e),this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage:function(e){var i=this.canvasData,a=this.imageData,r=a.naturalWidth*(i.width/i.naturalWidth),n=a.naturalHeight*(i.height/i.naturalHeight);N(a,{width:r,height:n,left:(i.width-r)/2,top:(i.height-n)/2}),le(this.image,N({width:a.width,height:a.height},Se(N({translateX:a.left,translateY:a.top},a)))),e&&this.output()},initCropBox:function(){var e=this.options,i=this.canvasData,a=e.aspectRatio||e.initialAspectRatio,r=Number(e.autoCropArea)||.8,n={width:i.width,height:i.height};a&&(i.height*a>i.width?n.height=n.width/a:n.width=n.height*a),this.cropBoxData=n,this.limitCropBox(!0,!0),n.width=Math.min(Math.max(n.width,n.minWidth),n.maxWidth),n.height=Math.min(Math.max(n.height,n.minHeight),n.maxHeight),n.width=Math.max(n.minWidth,n.width*r),n.height=Math.max(n.minHeight,n.height*r),n.left=i.left+(i.width-n.width)/2,n.top=i.top+(i.height-n.height)/2,n.oldLeft=n.left,n.oldTop=n.top,this.initialCropBoxData=N({},n)},limitCropBox:function(e,i){var a=this.options,r=this.containerData,n=this.canvasData,s=this.cropBoxData,o=this.limited,m=a.aspectRatio;if(e){var u=Number(a.minCropBoxWidth)||0,c=Number(a.minCropBoxHeight)||0,f=o?Math.min(r.width,n.width,n.width+n.left,r.width-n.left):r.width,h=o?Math.min(r.height,n.height,n.height+n.top,r.height-n.top):r.height;u=Math.min(u,r.width),c=Math.min(c,r.height),m&&(u&&c?c*m>u?c=u/m:u=c*m:u?c=u/m:c&&(u=c*m),h*m>f?h=f/m:f=h*m),s.minWidth=Math.min(u,f),s.minHeight=Math.min(c,h),s.maxWidth=f,s.maxHeight=h}i&&(o?(s.minLeft=Math.max(0,n.left),s.minTop=Math.max(0,n.top),s.maxLeft=Math.min(r.width,n.left+n.width)-s.width,s.maxTop=Math.min(r.height,n.top+n.height)-s.height):(s.minLeft=0,s.minTop=0,s.maxLeft=r.width-s.width,s.maxTop=r.height-s.height))},renderCropBox:function(){var e=this.options,i=this.containerData,a=this.cropBoxData;(a.width>a.maxWidth||a.width<a.minWidth)&&(a.left=a.oldLeft),(a.height>a.maxHeight||a.height<a.minHeight)&&(a.top=a.oldTop),a.width=Math.min(Math.max(a.width,a.minWidth),a.maxWidth),a.height=Math.min(Math.max(a.height,a.minHeight),a.maxHeight),this.limitCropBox(!1,!0),a.left=Math.min(Math.max(a.left,a.minLeft),a.maxLeft),a.top=Math.min(Math.max(a.top,a.minTop),a.maxTop),a.oldLeft=a.left,a.oldTop=a.top,e.movable&&e.cropBoxMovable&&Ie(this.face,Ne,a.width>=i.width&&a.height>=i.height?Kt:bt),le(this.cropBox,N({width:a.width,height:a.height},Se({translateX:a.left,translateY:a.top}))),this.cropped&&this.limited&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),Ee(this.element,dt,this.getData())}},ba={initPreview:function(){var e=this.element,i=this.crossOrigin,a=this.options.preview,r=i?this.crossOriginUrl:this.url,n=e.alt||"The image to preview",s=document.createElement("img");if(i&&(s.crossOrigin=i),s.src=r,s.alt=n,this.viewBox.appendChild(s),this.viewBoxImage=s,!!a){var o=a;typeof a=="string"?o=e.ownerDocument.querySelectorAll(a):a.querySelector&&(o=[a]),this.previews=o,L(o,function(m){var u=document.createElement("img");Ie(m,Ue,{width:m.offsetWidth,height:m.offsetHeight,html:m.innerHTML}),i&&(u.crossOrigin=i),u.src=r,u.alt=n,u.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"',m.innerHTML="",m.appendChild(u)})}},resetPreview:function(){L(this.previews,function(e){var i=mt(e,Ue);le(e,{width:i.width,height:i.height}),e.innerHTML=i.html,na(e,Ue)})},preview:function(){var e=this.imageData,i=this.canvasData,a=this.cropBoxData,r=a.width,n=a.height,s=e.width,o=e.height,m=a.left-i.left-e.left,u=a.top-i.top-e.top;!this.cropped||this.disabled||(le(this.viewBoxImage,N({width:s,height:o},Se(N({translateX:-m,translateY:-u},e)))),L(this.previews,function(c){var f=mt(c,Ue),h=f.width,C=f.height,k=h,$=C,M=1;r&&(M=h/r,$=n*M),n&&$>C&&(M=C/n,k=r*M,$=C),le(c,{width:k,height:$}),le(c.getElementsByTagName("img")[0],N({width:s*M,height:o*M},Se(N({translateX:-m*M,translateY:-u*M},e))))}))}},wa={bind:function(){var e=this.element,i=this.options,a=this.cropper;H(i.cropstart)&&X(e,ct,i.cropstart),H(i.cropmove)&&X(e,ut,i.cropmove),H(i.cropend)&&X(e,ht,i.cropend),H(i.crop)&&X(e,dt,i.crop),H(i.zoom)&&X(e,ft,i.zoom),X(a,Nt,this.onCropStart=this.cropStart.bind(this)),i.zoomable&&i.zoomOnWheel&&X(a,Ut,this.onWheel=this.wheel.bind(this),{passive:!1,capture:!0}),i.toggleDragModeOnDblclick&&X(a,St,this.onDblclick=this.dblclick.bind(this)),X(e.ownerDocument,It,this.onCropMove=this.cropMove.bind(this)),X(e.ownerDocument,At,this.onCropEnd=this.cropEnd.bind(this)),i.responsive&&X(window,Rt,this.onResize=this.resize.bind(this))},unbind:function(){var e=this.element,i=this.options,a=this.cropper;H(i.cropstart)&&_(e,ct,i.cropstart),H(i.cropmove)&&_(e,ut,i.cropmove),H(i.cropend)&&_(e,ht,i.cropend),H(i.crop)&&_(e,dt,i.crop),H(i.zoom)&&_(e,ft,i.zoom),_(a,Nt,this.onCropStart),i.zoomable&&i.zoomOnWheel&&_(a,Ut,this.onWheel,{passive:!1,capture:!0}),i.toggleDragModeOnDblclick&&_(a,St,this.onDblclick),_(e.ownerDocument,It,this.onCropMove),_(e.ownerDocument,At,this.onCropEnd),i.responsive&&_(window,Rt,this.onResize)}},ya={resize:function(){if(!this.disabled){var e=this.options,i=this.container,a=this.containerData,r=i.offsetWidth/a.width,n=i.offsetHeight/a.height,s=Math.abs(r-1)>Math.abs(n-1)?r:n;if(s!==1){var o,m;e.restore&&(o=this.getCanvasData(),m=this.getCropBoxData()),this.render(),e.restore&&(this.setCanvasData(L(o,function(u,c){o[c]=u*s})),this.setCropBoxData(L(m,function(u,c){m[c]=u*s})))}}},dblclick:function(){this.disabled||this.options.dragMode===ii||this.setDragMode(aa(this.dragBox,lt)?ti:wt)},wheel:function(e){var i=this,a=Number(this.options.wheelZoomRatio)||.1,r=1;this.disabled||(e.preventDefault(),!this.wheeling&&(this.wheeling=!0,setTimeout(function(){i.wheeling=!1},50),e.deltaY?r=e.deltaY>0?1:-1:e.wheelDelta?r=-e.wheelDelta/120:e.detail&&(r=e.detail>0?1:-1),this.zoom(-r*a,e)))},cropStart:function(e){var i=e.buttons,a=e.button;if(!(this.disabled||(e.type==="mousedown"||e.type==="pointerdown"&&e.pointerType==="mouse")&&(E(i)&&i!==1||E(a)&&a!==0||e.ctrlKey))){var r=this.options,n=this.pointers,s;e.changedTouches?L(e.changedTouches,function(o){n[o.identifier]=Pe(o)}):n[e.pointerId||0]=Pe(e),Object.keys(n).length>1&&r.zoomable&&r.zoomOnTouch?s=ei:s=mt(e.target,Ne),_i.test(s)&&Ee(this.element,ct,{originalEvent:e,action:s})!==!1&&(e.preventDefault(),this.action=s,this.cropping=!1,s===Qt&&(this.cropping=!0,B(this.dragBox,je)))}},cropMove:function(e){var i=this.action;if(!(this.disabled||!i)){var a=this.pointers;e.preventDefault(),Ee(this.element,ut,{originalEvent:e,action:i})!==!1&&(e.changedTouches?L(e.changedTouches,function(r){N(a[r.identifier]||{},Pe(r,!0))}):N(a[e.pointerId||0]||{},Pe(e,!0)),this.change(e))}},cropEnd:function(e){if(!this.disabled){var i=this.action,a=this.pointers;e.changedTouches?L(e.changedTouches,function(r){delete a[r.identifier]}):delete a[e.pointerId||0],i&&(e.preventDefault(),Object.keys(a).length||(this.action=""),this.cropping&&(this.cropping=!1,Ce(this.dragBox,je,this.cropped&&this.options.modal)),Ee(this.element,ht,{originalEvent:e,action:i}))}}},xa={change:function(e){var i=this.options,a=this.canvasData,r=this.containerData,n=this.cropBoxData,s=this.pointers,o=this.action,m=i.aspectRatio,u=n.left,c=n.top,f=n.width,h=n.height,C=u+f,k=c+h,$=0,M=0,R=r.width,P=r.height,A=!0,K;!m&&e.shiftKey&&(m=f&&h?f/h:1),this.limited&&($=n.minLeft,M=n.minTop,R=$+Math.min(r.width,a.width,a.left+a.width),P=M+Math.min(r.height,a.height,a.top+a.height));var z=s[Object.keys(s)[0]],p={x:z.endX-z.startX,y:z.endY-z.startY},O=function(Y){switch(Y){case fe:C+p.x>R&&(p.x=R-C);break;case me:u+p.x<$&&(p.x=$-u);break;case ne:c+p.y<M&&(p.y=M-c);break;case we:k+p.y>P&&(p.y=P-k);break}};switch(o){case bt:u+=p.x,c+=p.y;break;case fe:if(p.x>=0&&(C>=R||m&&(c<=M||k>=P))){A=!1;break}O(fe),f+=p.x,f<0&&(o=me,f=-f,u-=f),m&&(h=f/m,c+=(n.height-h)/2);break;case ne:if(p.y<=0&&(c<=M||m&&(u<=$||C>=R))){A=!1;break}O(ne),h-=p.y,c+=p.y,h<0&&(o=we,h=-h,c-=h),m&&(f=h*m,u+=(n.width-f)/2);break;case me:if(p.x<=0&&(u<=$||m&&(c<=M||k>=P))){A=!1;break}O(me),f-=p.x,u+=p.x,f<0&&(o=fe,f=-f,u-=f),m&&(h=f/m,c+=(n.height-h)/2);break;case we:if(p.y>=0&&(k>=P||m&&(u<=$||C>=R))){A=!1;break}O(we),h+=p.y,h<0&&(o=ne,h=-h,c-=h),m&&(f=h*m,u+=(n.width-f)/2);break;case Ve:if(m){if(p.y<=0&&(c<=M||C>=R)){A=!1;break}O(ne),h-=p.y,c+=p.y,f=h*m}else O(ne),O(fe),p.x>=0?C<R?f+=p.x:p.y<=0&&c<=M&&(A=!1):f+=p.x,p.y<=0?c>M&&(h-=p.y,c+=p.y):(h-=p.y,c+=p.y);f<0&&h<0?(o=Oe,h=-h,f=-f,c-=h,u-=f):f<0?(o=Te,f=-f,u-=f):h<0&&(o=Me,h=-h,c-=h);break;case Te:if(m){if(p.y<=0&&(c<=M||u<=$)){A=!1;break}O(ne),h-=p.y,c+=p.y,f=h*m,u+=n.width-f}else O(ne),O(me),p.x<=0?u>$?(f-=p.x,u+=p.x):p.y<=0&&c<=M&&(A=!1):(f-=p.x,u+=p.x),p.y<=0?c>M&&(h-=p.y,c+=p.y):(h-=p.y,c+=p.y);f<0&&h<0?(o=Me,h=-h,f=-f,c-=h,u-=f):f<0?(o=Ve,f=-f,u-=f):h<0&&(o=Oe,h=-h,c-=h);break;case Oe:if(m){if(p.x<=0&&(u<=$||k>=P)){A=!1;break}O(me),f-=p.x,u+=p.x,h=f/m}else O(we),O(me),p.x<=0?u>$?(f-=p.x,u+=p.x):p.y>=0&&k>=P&&(A=!1):(f-=p.x,u+=p.x),p.y>=0?k<P&&(h+=p.y):h+=p.y;f<0&&h<0?(o=Ve,h=-h,f=-f,c-=h,u-=f):f<0?(o=Me,f=-f,u-=f):h<0&&(o=Te,h=-h,c-=h);break;case Me:if(m){if(p.x>=0&&(C>=R||k>=P)){A=!1;break}O(fe),f+=p.x,h=f/m}else O(we),O(fe),p.x>=0?C<R?f+=p.x:p.y>=0&&k>=P&&(A=!1):f+=p.x,p.y>=0?k<P&&(h+=p.y):h+=p.y;f<0&&h<0?(o=Te,h=-h,f=-f,c-=h,u-=f):f<0?(o=Oe,f=-f,u-=f):h<0&&(o=Ve,h=-h,c-=h);break;case Kt:this.move(p.x,p.y),A=!1;break;case ei:this.zoom(la(s),e),A=!1;break;case Qt:if(!p.x||!p.y){A=!1;break}K=oi(this.cropper),u=z.startX-K.left,c=z.startY-K.top,f=n.minWidth,h=n.minHeight,p.x>0?o=p.y>0?Me:Ve:p.x<0&&(u-=f,o=p.y>0?Oe:Te),p.y<0&&(c-=h),this.cropped||(Z(this.cropBox,W),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0));break}A&&(n.width=f,n.height=h,n.left=u,n.top=c,this.action=o,this.renderCropBox()),L(s,function(U){U.startX=U.endX,U.startY=U.endY})}},Ca={crop:function(){return this.ready&&!this.cropped&&!this.disabled&&(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&B(this.dragBox,je),Z(this.cropBox,W),this.setCropBoxData(this.initialCropBoxData)),this},reset:function(){return this.ready&&!this.disabled&&(this.imageData=N({},this.initialImageData),this.canvasData=N({},this.initialCanvasData),this.cropBoxData=N({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox()),this},clear:function(){return this.cropped&&!this.disabled&&(N(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),Z(this.dragBox,je),B(this.cropBox,W)),this},replace:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return!this.disabled&&e&&(this.isImg&&(this.element.src=e),i?(this.url=e,this.image.src=e,this.ready&&(this.viewBoxImage.src=e,L(this.previews,function(a){a.getElementsByTagName("img")[0].src=e}))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.uncreate(),this.load(e))),this},enable:function(){return this.ready&&this.disabled&&(this.disabled=!1,Z(this.cropper,Ot)),this},disable:function(){return this.ready&&!this.disabled&&(this.disabled=!0,B(this.cropper,Ot)),this},destroy:function(){var e=this.element;return e[S]?(e[S]=void 0,this.isImg&&this.replaced&&(e.src=this.originalUrl),this.uncreate(),this):this},move:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e,a=this.canvasData,r=a.left,n=a.top;return this.moveTo(Ke(e)?e:r+Number(e),Ke(i)?i:n+Number(i))},moveTo:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e,a=this.canvasData,r=!1;return e=Number(e),i=Number(i),this.ready&&!this.disabled&&this.options.movable&&(E(e)&&(a.left=e,r=!0),E(i)&&(a.top=i,r=!0),r&&this.renderCanvas(!0)),this},zoom:function(e,i){var a=this.canvasData;return e=Number(e),e<0?e=1/(1-e):e=1+e,this.zoomTo(a.width*e/a.naturalWidth,null,i)},zoomTo:function(e,i,a){var r=this.options,n=this.canvasData,s=n.width,o=n.height,m=n.naturalWidth,u=n.naturalHeight;if(e=Number(e),e>=0&&this.ready&&!this.disabled&&r.zoomable){var c=m*e,f=u*e;if(Ee(this.element,ft,{ratio:e,oldRatio:s/m,originalEvent:a})===!1)return this;if(a){var h=this.pointers,C=oi(this.cropper),k=h&&Object.keys(h).length?oa(h):{pageX:a.pageX,pageY:a.pageY};n.left-=(c-s)*((k.pageX-C.left-n.left)/s),n.top-=(f-o)*((k.pageY-C.top-n.top)/o)}else xe(i)&&E(i.x)&&E(i.y)?(n.left-=(c-s)*((i.x-n.left)/s),n.top-=(f-o)*((i.y-n.top)/o)):(n.left-=(c-s)/2,n.top-=(f-o)/2);n.width=c,n.height=f,this.renderCanvas(!0)}return this},rotate:function(e){return this.rotateTo((this.imageData.rotate||0)+Number(e))},rotateTo:function(e){return e=Number(e),E(e)&&this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=e%360,this.renderCanvas(!0,!0)),this},scaleX:function(e){var i=this.imageData.scaleY;return this.scale(e,E(i)?i:1)},scaleY:function(e){var i=this.imageData.scaleX;return this.scale(E(i)?i:1,e)},scale:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e,a=this.imageData,r=!1;return e=Number(e),i=Number(i),this.ready&&!this.disabled&&this.options.scalable&&(E(e)&&(a.scaleX=e,r=!0),E(i)&&(a.scaleY=i,r=!0),r&&this.renderCanvas(!0,!0)),this},getData:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,i=this.options,a=this.imageData,r=this.canvasData,n=this.cropBoxData,s;if(this.ready&&this.cropped){s={x:n.left-r.left,y:n.top-r.top,width:n.width,height:n.height};var o=a.width/a.naturalWidth;if(L(s,function(c,f){s[f]=c/o}),e){var m=Math.round(s.y+s.height),u=Math.round(s.x+s.width);s.x=Math.round(s.x),s.y=Math.round(s.y),s.width=u-s.x,s.height=m-s.y}}else s={x:0,y:0,width:0,height:0};return i.rotatable&&(s.rotate=a.rotate||0),i.scalable&&(s.scaleX=a.scaleX||1,s.scaleY=a.scaleY||1),s},setData:function(e){var i=this.options,a=this.imageData,r=this.canvasData,n={};if(this.ready&&!this.disabled&&xe(e)){var s=!1;i.rotatable&&E(e.rotate)&&e.rotate!==a.rotate&&(a.rotate=e.rotate,s=!0),i.scalable&&(E(e.scaleX)&&e.scaleX!==a.scaleX&&(a.scaleX=e.scaleX,s=!0),E(e.scaleY)&&e.scaleY!==a.scaleY&&(a.scaleY=e.scaleY,s=!0)),s&&this.renderCanvas(!0,!0);var o=a.width/a.naturalWidth;E(e.x)&&(n.left=e.x*o+r.left),E(e.y)&&(n.top=e.y*o+r.top),E(e.width)&&(n.width=e.width*o),E(e.height)&&(n.height=e.height*o),this.setCropBoxData(n)}return this},getContainerData:function(){return this.ready?N({},this.containerData):{}},getImageData:function(){return this.sized?N({},this.imageData):{}},getCanvasData:function(){var e=this.canvasData,i={};return this.ready&&L(["left","top","width","height","naturalWidth","naturalHeight"],function(a){i[a]=e[a]}),i},setCanvasData:function(e){var i=this.canvasData,a=i.aspectRatio;return this.ready&&!this.disabled&&xe(e)&&(E(e.left)&&(i.left=e.left),E(e.top)&&(i.top=e.top),E(e.width)?(i.width=e.width,i.height=e.width/a):E(e.height)&&(i.height=e.height,i.width=e.height*a),this.renderCanvas(!0)),this},getCropBoxData:function(){var e=this.cropBoxData,i;return this.ready&&this.cropped&&(i={left:e.left,top:e.top,width:e.width,height:e.height}),i||{}},setCropBoxData:function(e){var i=this.cropBoxData,a=this.options.aspectRatio,r,n;return this.ready&&this.cropped&&!this.disabled&&xe(e)&&(E(e.left)&&(i.left=e.left),E(e.top)&&(i.top=e.top),E(e.width)&&e.width!==i.width&&(r=!0,i.width=e.width),E(e.height)&&e.height!==i.height&&(n=!0,i.height=e.height),a&&(r?i.height=i.width/a:n&&(i.width=i.height*a)),this.renderCropBox()),this},getCroppedCanvas:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!this.ready||!window.HTMLCanvasElement)return null;var i=this.canvasData,a=ha(this.image,this.imageData,i,e);if(!this.cropped)return a;var r=this.getData(e.rounded),n=r.x,s=r.y,o=r.width,m=r.height,u=a.width/Math.floor(i.naturalWidth);u!==1&&(n*=u,s*=u,o*=u,m*=u);var c=o/m,f=oe({aspectRatio:c,width:e.maxWidth||1/0,height:e.maxHeight||1/0}),h=oe({aspectRatio:c,width:e.minWidth||0,height:e.minHeight||0},"cover"),C=oe({aspectRatio:c,width:e.width||(u!==1?a.width:o),height:e.height||(u!==1?a.height:m)}),k=C.width,$=C.height;k=Math.min(f.width,Math.max(h.width,k)),$=Math.min(f.height,Math.max(h.height,$));var M=document.createElement("canvas"),R=M.getContext("2d");M.width=De(k),M.height=De($),R.fillStyle=e.fillColor||"transparent",R.fillRect(0,0,k,$);var P=e.imageSmoothingEnabled,A=P===void 0?!0:P,K=e.imageSmoothingQuality;R.imageSmoothingEnabled=A,K&&(R.imageSmoothingQuality=K);var z=a.width,p=a.height,O=n,U=s,Y,ee,de,he,re,G;O<=-o||O>z?(O=0,Y=0,de=0,re=0):O<=0?(de=-O,O=0,Y=Math.min(z,o+O),re=Y):O<=z&&(de=0,Y=Math.min(o,z-O),re=Y),Y<=0||U<=-m||U>p?(U=0,ee=0,he=0,G=0):U<=0?(he=-U,U=0,ee=Math.min(p,m+U),G=ee):U<=p&&(he=0,ee=Math.min(m,p-U),G=ee);var F=[O,U,Y,ee];if(re>0&&G>0){var ue=k/o;F.push(de*ue,he*ue,re*ue,G*ue)}return R.drawImage.apply(R,[a].concat(Zt(F.map(function(Le){return Math.floor(De(Le))})))),M},setAspectRatio:function(e){var i=this.options;return!this.disabled&&!Ke(e)&&(i.aspectRatio=Math.max(0,e)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox())),this},setDragMode:function(e){var i=this.options,a=this.dragBox,r=this.face;if(this.ready&&!this.disabled){var n=e===wt,s=i.movable&&e===ti;e=n||s?e:ii,i.dragMode=e,Ie(a,Ne,e),Ce(a,lt,n),Ce(a,ot,s),i.cropBoxMovable||(Ie(r,Ne,e),Ce(r,lt,n),Ce(r,ot,s))}return this}},ka=Q.Cropper,hi=(function(){function t(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Ri(this,t),!e||!Ji.test(e.tagName))throw new Error("The first argument is required and must be an <img> or <canvas> element.");this.element=e,this.options=N({},Bt,xe(i)&&i),this.cropped=!1,this.disabled=!1,this.pointers={},this.ready=!1,this.reloading=!1,this.replaced=!1,this.sized=!1,this.sizing=!1,this.init()}return Ui(t,[{key:"init",value:function(){var i=this.element,a=i.tagName.toLowerCase(),r;if(!i[S]){if(i[S]=this,a==="img"){if(this.isImg=!0,r=i.getAttribute("src")||"",this.originalUrl=r,!r)return;r=i.src}else a==="canvas"&&window.HTMLCanvasElement&&(r=i.toDataURL());this.load(r)}}},{key:"load",value:function(i){var a=this;if(i){this.url=i,this.imageData={};var r=this.element,n=this.options;if(!n.rotatable&&!n.scalable&&(n.checkOrientation=!1),!n.checkOrientation||!window.ArrayBuffer){this.clone();return}if(qi.test(i)){Gi.test(i)?this.read(fa(i)):this.clone();return}var s=new XMLHttpRequest,o=this.clone.bind(this);this.reloading=!0,this.xhr=s,s.onabort=o,s.onerror=o,s.ontimeout=o,s.onprogress=function(){s.getResponseHeader("content-type")!==Pt&&s.abort()},s.onload=function(){a.read(s.response)},s.onloadend=function(){a.reloading=!1,a.xhr=null},n.checkCrossOrigin&&Ht(i)&&r.crossOrigin&&(i=Wt(i)),s.open("GET",i,!0),s.responseType="arraybuffer",s.withCredentials=r.crossOrigin==="use-credentials",s.send()}}},{key:"read",value:function(i){var a=this.options,r=this.imageData,n=pa(i),s=0,o=1,m=1;if(n>1){this.url=ma(i,Pt);var u=ga(n);s=u.rotate,o=u.scaleX,m=u.scaleY}a.rotatable&&(r.rotate=s),a.scalable&&(r.scaleX=o,r.scaleY=m),this.clone()}},{key:"clone",value:function(){var i=this.element,a=this.url,r=i.crossOrigin,n=a;this.options.checkCrossOrigin&&Ht(a)&&(r||(r="anonymous"),n=Wt(a)),this.crossOrigin=r,this.crossOriginUrl=n;var s=document.createElement("img");r&&(s.crossOrigin=r),s.src=n||a,s.alt=i.alt||"The image to crop",this.image=s,s.onload=this.start.bind(this),s.onerror=this.stop.bind(this),B(s,$t),i.parentNode.insertBefore(s,i.nextSibling)}},{key:"start",value:function(){var i=this,a=this.image;a.onload=null,a.onerror=null,this.sizing=!0;var r=Q.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(Q.navigator.userAgent),n=function(u,c){N(i.imageData,{naturalWidth:u,naturalHeight:c,aspectRatio:u/c}),i.initialImageData=N({},i.imageData),i.sizing=!1,i.sized=!0,i.build()};if(a.naturalWidth&&!r){n(a.naturalWidth,a.naturalHeight);return}var s=document.createElement("img"),o=document.body||document.documentElement;this.sizingImage=s,s.onload=function(){n(s.width,s.height),r||o.removeChild(s)},s.src=a.src,r||(s.style.cssText="left:0;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;opacity:0;position:absolute;top:0;z-index:-1;",o.appendChild(s))}},{key:"stop",value:function(){var i=this.image;i.onload=null,i.onerror=null,i.parentNode.removeChild(i),this.image=null}},{key:"build",value:function(){if(!(!this.sized||this.ready)){var i=this.element,a=this.options,r=this.image,n=i.parentNode,s=document.createElement("div");s.innerHTML=Zi;var o=s.querySelector(".".concat(S,"-container")),m=o.querySelector(".".concat(S,"-canvas")),u=o.querySelector(".".concat(S,"-drag-box")),c=o.querySelector(".".concat(S,"-crop-box")),f=c.querySelector(".".concat(S,"-face"));this.container=n,this.cropper=o,this.canvas=m,this.dragBox=u,this.cropBox=c,this.viewBox=o.querySelector(".".concat(S,"-view-box")),this.face=f,m.appendChild(r),B(i,W),n.insertBefore(o,i.nextSibling),Z(r,$t),this.initPreview(),this.bind(),a.initialAspectRatio=Math.max(0,a.initialAspectRatio)||NaN,a.aspectRatio=Math.max(0,a.aspectRatio)||NaN,a.viewMode=Math.max(0,Math.min(3,Math.round(a.viewMode)))||0,B(c,W),a.guides||B(c.getElementsByClassName("".concat(S,"-dashed")),W),a.center||B(c.getElementsByClassName("".concat(S,"-center")),W),a.background&&B(o,"".concat(S,"-bg")),a.highlight||B(f,ji),a.cropBoxMovable&&(B(f,ot),Ie(f,Ne,bt)),a.cropBoxResizable||(B(c.getElementsByClassName("".concat(S,"-line")),W),B(c.getElementsByClassName("".concat(S,"-point")),W)),this.render(),this.ready=!0,this.setDragMode(a.dragMode),a.autoCrop&&this.crop(),this.setData(a.data),H(a.ready)&&X(i,Lt,a.ready,{once:!0}),Ee(i,Lt)}}},{key:"unbuild",value:function(){if(this.ready){this.ready=!1,this.unbind(),this.resetPreview();var i=this.cropper.parentNode;i&&i.removeChild(this.cropper),Z(this.element,W)}}},{key:"uncreate",value:function(){this.ready?(this.unbuild(),this.ready=!1,this.cropped=!1):this.sizing?(this.sizingImage.onload=null,this.sizing=!1,this.sized=!1):this.reloading?(this.xhr.onabort=null,this.xhr.abort()):this.image&&this.stop()}}],[{key:"noConflict",value:function(){return window.Cropper=ka,t}},{key:"setDefaults",value:function(i){N(Bt,xe(i)&&i)}}])})();N(hi.prototype,va,ba,wa,ya,xa,Ca);const Da={props:{grid:{type:Boolean,default:!1},embed:{type:Boolean,default:!1},filter:{type:Object,default:()=>({})}},emits:["select"],inject:["debounce","url","srcset"],data(){return{items:[],menu:[],term:"",sort:{column:"ID",order:"DESC"},page:1,last:1,limit:100,actions:!1,checked:!1,loading:!0,vgrid:!1}},setup(){const t=Ye(),e=ze();return{app:pt(),auth:e,messages:t}},created(){this.searchd=this.debounce(this.search,500),this.vgrid=this.grid,this.search()},computed:{canTrash(){return this.items.some(t=>t._checked&&!t.deleted_at)},isChecked(){return this.items.some(t=>t._checked)},isTrashed(){return this.items.some(t=>t._checked&&t.deleted_at)},order(){var t,e,i,a;return((t=this.sort)==null?void 0:t.column)==="ID"?((e=this.sort)==null?void 0:e.order)==="DESC"?this.$gettext("latest"):this.$gettext("oldest"):((i=this.sort)==null?void 0:i.column)==="BYVERSIONS_COUNT"?this.$gettext("usage"):((a=this.sort)==null?void 0:a.column)||""}},methods:{add(t){if(this.embed||!this.auth.can("file:add")){this.messages.add(this.$gettext("Permission denied"),"error");return}const e=[],i=t.target.files||t.dataTransfer.files||[];if(i.length)return Array.from(i).forEach(a=>{e.push(this.$apollo.mutate({mutation:I`mutation($file: Upload!) {
              addFile(file: $file) {
                id
                lang
                mime
                name
                path
                previews
                description
                transcription
                editor
                created_at
                updated_at
                deleted_at
              }
            }`,variables:{file:a},context:{hasUpload:!0}}).then(r=>{var s;if(r.errors)throw r.errors;const n=((s=r.data)==null?void 0:s.addFile)||{};return n.previews=JSON.parse(n.previews)||{},n.description=JSON.parse(n.description)||{},n.transcription=JSON.parse(n.transcription)||{},n.published=!0,this.items.unshift(n),this.$emit("select",n),n}).catch(r=>{this.messages.add(this.$gettext("Error adding file %{path}",{path:a.name})+`:
`+r,"error"),this.$log("FileListItems::add(): Error adding file",t,r)}))}),Promise.all(e).then(()=>{this.invalidate()})},drop(t){if(!this.auth.can("file:drop")){this.messages.add(this.$gettext("Permission denied"),"error");return}const e=t?[t]:this.items.filter(i=>i._checked);e.length&&this.$apollo.mutate({mutation:I`
            mutation($id: [ID!]!) {
              dropFile(id: $id) {
                id
              }
            }
          `,variables:{id:e.map(i=>i.id)}}).then(i=>{if(i.errors)throw i.errors;this.invalidate(),this.search()}).catch(i=>{this.messages.add(this.$gettext("Error trashing file")+`:
`+i,"error"),this.$log("FileListItems::drop(): Error trashing file",t,i)})},invalidate(){const t=this.$apollo.provider.defaultClient.cache;t.evict({id:"ROOT_QUERY",fieldName:"files"}),t.gc()},keep(t){if(!this.auth.can("file:keep")){this.messages.add(this.$gettext("Permission denied"),"error");return}const e=t?[t]:this.items.filter(i=>i._checked);e.length&&this.$apollo.mutate({mutation:I`
            mutation($id: [ID!]!) {
              keepFile(id: $id) {
                id
              }
            }
          `,variables:{id:e.map(i=>i.id)}}).then(i=>{if(i.errors)throw i.errors;e.forEach(a=>{a.deleted_at=null}),this.invalidate(),this.search()}).catch(i=>{this.messages.add(this.$gettext("Error restoring file")+`:
`+i,"error"),this.$log("FileListItems::keep(): Error restoring file",t,i)})},publish(t){if(!this.auth.can("file:publish")){this.messages.add(this.$gettext("Permission denied"),"error");return}const e=t?[t]:this.items.filter(i=>i._checked&&i.id&&!i.published);e.length&&this.$apollo.mutate({mutation:I`mutation ($id: [ID!]!) {
            pubFile(id: $id) {
              id
            }
          }`,variables:{id:e.map(i=>i.id)}}).then(i=>{if(i.errors)throw i.errors;e.forEach(a=>{a.published=!0,a._checked=!1}),this.invalidate(),this.search()}).catch(i=>{this.messages.add(this.$gettext("Error publishing file")+`:
`+i,"error"),this.$log("FileListItems::publish(): Error publishing file",t,i)})},purge(t){if(!this.auth.can("file:purge")){this.messages.add(this.$gettext("Permission denied"),"error");return}const e=t?[t]:this.items.filter(i=>i._checked);e.length&&this.$apollo.mutate({mutation:I`
            mutation($id: [ID!]!) {
              purgeFile(id: $id) {
                id
              }
            }
          `,variables:{id:e.map(i=>i.id)}}).then(i=>{if(i.errors)throw i.errors;this.invalidate(),this.search()}).catch(i=>{this.messages.add(this.$gettext("Error purging file")+`:
`+i,"error"),this.$log("FileListItems::purge(): Error purging file",t,i)})},search(){if(!this.auth.can("file:view"))return this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve([]);const t=this.filter.publish||null,e=this.filter.trashed||"WITHOUT",i={...this.filter};return delete i.trashed,delete i.publish,this.term&&(i.any=this.term),this.loading=!0,this.$apollo.query({query:I`
            query($filter: FileFilter, $sort: [QueryFilesSortOrderByClause!], $limit: Int!, $page: Int!, $trashed: Trashed, $publish: Publish) {
              files(filter: $filter, sort: $sort, first: $limit, page: $page, trashed: $trashed, publish: $publish) {
                data {
                  id
                  lang
                  name
                  mime
                  path
                  previews
                  description
                  transcription
                  editor
                  created_at
                  updated_at
                  deleted_at
                  latest {
                    id
                    published
                    publish_at
                    data
                    editor
                    created_at
                  }
                  byversions_count
                }
                paginatorInfo {
                  lastPage
                }
              }
            }
          `,variables:{filter:i,page:this.page,limit:this.limit,sort:[this.sort],trashed:e,publish:t}}).then(a=>{var s;if(a.errors)throw a.errors;const r=a.data.files||{},n=["previews","description","transcription"];return this.last=((s=r.paginatorInfo)==null?void 0:s.lastPage)||1,this.items=[...r.data||[]].map(o=>{var u,c,f,h,C,k;const m=(u=o.latest)!=null&&u.data?JSON.parse((c=o.latest)==null?void 0:c.data):{...o,previews:JSON.parse(o.previews||"{}"),description:JSON.parse(o.description||"{}"),transcription:JSON.parse(o.transcription||"{}")};return n.forEach($=>m[$]??(m[$]={})),Object.assign(m,{id:o.id,deleted_at:o.deleted_at,created_at:o.created_at,updated_at:((f=o.latest)==null?void 0:f.created_at)||o.updated_at,editor:((h=o.latest)==null?void 0:h.editor)||o.editor,published:((C=o.latest)==null?void 0:C.published)??!0,publish_at:((k=o.latest)==null?void 0:k.publish_at)||null,latest:o.latest,usage:o.byversions_count})}),this.checked=!1,this.loading=!1,this.items}).catch(a=>{this.messages.add(this.$gettext("Error fetching files")+`:
`+a,"error"),this.$log("FileListItems::search(): Error fetching files",a)})},title(t){const e=[];return t.publish_at&&e.push("Publish at: "+new Date(t.publish_at).toLocaleDateString()),e.join(`
`)},toggle(){this.items.forEach(t=>{t._checked=!t._checked})}},watch:{filter:{deep:!0,handler(){this.search()}},term(){this.searchd()},page(){this.search()},sort(){this.search()}}},Ea={class:"header"},Va={class:"bulk"},Ta={key:0},Ma={class:"search"},Oa={class:"layout"},$a=["onClick","title"],Sa=["onClick","title"],Na={key:2,viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},Ia={key:3,fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Aa={key:4,width:"24",height:"24",viewBox:"0 0 16 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},La=["onClick","title"],Ra={class:"item-text"},Ua={class:"item-head"},Pa={key:0,class:"item-lang"},Ba={class:"item-title"},Fa={class:"item-mime item-subtitle"},Ha={class:"item-aux"},Wa={class:"item-editor"},ja={class:"item-modified item-subtitle"},za={key:0,class:"loading"},Ya={key:1,class:"notfound"},Xa={key:3,class:"btn-group"};function _a(t,e,i,a,r,n){return g(),D(j,null,[w("div",Ea,[w("div",Va,[l(Et,{modelValue:r.checked,"onUpdate:modelValue":e[0]||(e[0]=s=>r.checked=s),onClick:e[1]||(e[1]=tt(s=>n.toggle(),["stop"]))},null,8,["modelValue"]),(g(),x($e(t.$vuetify.display.xs?"v-dialog":"v-menu"),{modelValue:r.actions,"onUpdate:modelValue":e[8]||(e[8]=s=>r.actions=s),transition:"scale-transition",location:"end center","max-width":"300"},{activator:d(({props:s})=>[l(v,ie(s,{disabled:!n.isChecked||i.embed||!a.auth.can("file:add"),title:t.$gettext("Actions"),icon:"mdi-dots-vertical",variant:"text"}),null,16,["disabled","title"])]),default:d(()=>[l(se,null,{default:d(()=>[l(pe,{density:"compact"},{default:d(()=>[l(ge,null,{default:d(()=>[y(b(t.$gettext("Actions")),1)]),_:1}),l(v,{icon:"mdi-close",onClick:e[2]||(e[2]=s=>r.actions=!1)})]),_:1}),l(ae,{onClick:e[7]||(e[7]=s=>r.actions=!1)},{default:d(()=>[n.isChecked&&a.auth.can("file:publish")?(g(),x(T,{key:0},{default:d(()=>[l(v,{"prepend-icon":"mdi-publish",variant:"text",onClick:e[3]||(e[3]=s=>n.publish())},{default:d(()=>[y(b(t.$gettext("Publish")),1)]),_:1})]),_:1})):V("",!0),n.canTrash&&a.auth.can("file:drop")?(g(),x(T,{key:1},{default:d(()=>[l(v,{"prepend-icon":"mdi-delete",variant:"text",onClick:e[4]||(e[4]=s=>n.drop())},{default:d(()=>[y(b(t.$gettext("Delete")),1)]),_:1})]),_:1})):V("",!0),n.isTrashed&&a.auth.can("file:keep")?(g(),x(T,{key:2},{default:d(()=>[l(v,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:e[5]||(e[5]=s=>n.keep())},{default:d(()=>[y(b(t.$gettext("Restore")),1)]),_:1})]),_:1})):V("",!0),n.isChecked&&a.auth.can("file:purge")?(g(),x(T,{key:3},{default:d(()=>[l(v,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:e[6]||(e[6]=s=>n.purge())},{default:d(()=>[y(b(t.$gettext("Purge")),1)]),_:1})]),_:1})):V("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])),!this.embed&&a.auth.can("file:add")?(g(),D("div",Ta,[w("input",{onChange:e[9]||(e[9]=s=>n.add(s)),ref:"upload",type:"file",multiple:"",hidden:""},null,544),l(v,{onClick:e[10]||(e[10]=s=>t.$refs.upload.click()),title:t.$gettext("Add files"),disabled:r.loading,icon:"mdi-plus",color:"primary",variant:"tonal"},null,8,["title","disabled"])])):V("",!0)]),w("div",Ma,[l(Yt,{modelValue:r.term,"onUpdate:modelValue":e[11]||(e[11]=s=>r.term=s),label:t.$gettext("Search for"),"prepend-inner-icon":"mdi-magnify",variant:"underlined","hide-details":"",clearable:""},null,8,["modelValue","label"])]),w("div",Oa,[r.vgrid?V("",!0):(g(),x(v,{key:0,onClick:e[12]||(e[12]=s=>r.vgrid=!0),title:t.$gettext("Grid view"),icon:"mdi-view-grid-outline",variant:"text"},null,8,["title"])),r.vgrid?(g(),x(v,{key:1,onClick:e[13]||(e[13]=s=>r.vgrid=!1),title:t.$gettext("List view"),icon:"mdi-format-list-bulleted-square",variant:"text"},null,8,["title"])):V("",!0),l(Xt,null,{activator:d(({props:s})=>[l(v,ie(s,{title:t.$gettext("Sort by"),"append-icon":"mdi-menu-down","prepend-icon":"mdi-sort",variant:"text"}),{default:d(()=>[y(b(n.order),1)]),_:1},16,["title"])]),default:d(()=>[l(ae,null,{default:d(()=>[l(T,null,{default:d(()=>[l(v,{variant:"text",onClick:e[14]||(e[14]=s=>r.sort={column:"ID",order:"DESC"})},{default:d(()=>[y(b(t.$gettext("latest")),1)]),_:1})]),_:1}),l(T,null,{default:d(()=>[l(v,{variant:"text",onClick:e[15]||(e[15]=s=>r.sort={column:"ID",order:"ASC"})},{default:d(()=>[y(b(t.$gettext("oldest")),1)]),_:1})]),_:1}),l(T,null,{default:d(()=>[l(v,{variant:"text",onClick:e[16]||(e[16]=s=>r.sort={column:"NAME",order:"ASC"})},{default:d(()=>[y(b(t.$gettext("name")),1)]),_:1})]),_:1}),l(T,null,{default:d(()=>[l(v,{variant:"text",onClick:e[17]||(e[17]=s=>r.sort={column:"MIME",order:"ASC"})},{default:d(()=>[y(b(t.$gettext("mime")),1)]),_:1})]),_:1}),l(T,null,{default:d(()=>[l(v,{variant:"text",onClick:e[18]||(e[18]=s=>r.sort={column:"LANG",order:"ASC"})},{default:d(()=>[y(b(t.$gettext("language")),1)]),_:1})]),_:1}),l(T,null,{default:d(()=>[l(v,{variant:"text",onClick:e[19]||(e[19]=s=>r.sort={column:"EDITOR",order:"ASC"})},{default:d(()=>[y(b(t.$gettext("editor")),1)]),_:1})]),_:1}),l(T,null,{default:d(()=>[l(v,{variant:"text",onClick:e[20]||(e[20]=s=>r.sort={column:"BYVERSIONS_COUNT",order:"ASC"})},{default:d(()=>[y(b(t.$gettext("usage")),1)]),_:1})]),_:1})]),_:1})]),_:1})])]),l(ae,{class:J(["items",{grid:r.vgrid,list:!r.vgrid}])},{default:d(()=>[(g(!0),D(j,null,q(r.items,(s,o)=>(g(),x(T,{key:o},{default:d(()=>{var m,u,c,f;return[l(Et,{modelValue:s._checked,"onUpdate:modelValue":h=>s._checked=h,class:J([{draft:!s.published},"item-check"])},null,8,["modelValue","onUpdate:modelValue","class"]),(g(),x($e(t.$vuetify.display.xs?"v-dialog":"v-menu"),{modelValue:r.menu[o],"onUpdate:modelValue":h=>r.menu[o]=h,transition:"scale-transition",location:r.vgrid?"start":"end center","max-width":"300"},{activator:d(({props:h})=>[l(v,ie({ref_for:!0},h,{title:t.$gettext("Actions"),icon:"mdi-dots-vertical",class:"item-menu",variant:"text"}),null,16,["title"])]),default:d(()=>[l(se,null,{default:d(()=>[l(pe,{density:"compact"},{default:d(()=>[l(ge,null,{default:d(()=>[y(b(t.$gettext("Actions")),1)]),_:1}),l(v,{icon:"mdi-close",onClick:h=>r.menu[o]=!1},null,8,["onClick"])]),_:2},1024),l(ae,{onClick:h=>r.menu[o]=!1},{default:d(()=>[pi(l(T,null,{default:d(()=>[l(v,{"prepend-icon":"mdi-publish",variant:"text",onClick:h=>n.publish(s)},{default:d(()=>[y(b(t.$gettext("Publish")),1)]),_:1},8,["onClick"])]),_:2},1536),[[gi,!s.deleted_at&&!s.published&&a.auth.can("file:publish")]]),!s.deleted_at&&a.auth.can("file:drop")?(g(),x(T,{key:0},{default:d(()=>[l(v,{"prepend-icon":"mdi-delete",variant:"text",onClick:h=>n.drop(s)},{default:d(()=>[y(b(t.$gettext("Delete")),1)]),_:1},8,["onClick"])]),_:2},1024)):V("",!0),s.deleted_at&&a.auth.can("file:keep")?(g(),x(T,{key:1},{default:d(()=>[l(v,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:h=>n.keep(s)},{default:d(()=>[y(b(t.$gettext("Restore")),1)]),_:1},8,["onClick"])]),_:2},1024)):V("",!0),a.auth.can("file:purge")?(g(),x(T,{key:2},{default:d(()=>[l(v,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:h=>n.purge(s)},{default:d(()=>[y(b(t.$gettext("Purge")),1)]),_:1},8,["onClick"])]),_:2},1024)):V("",!0)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue","location"])),w("div",{class:J(["item-usage",{notused:!s.usage}]),onClick:h=>t.$emit("select",s),title:n.title(s)},b(s.usage||0),11,$a),w("div",{class:"item-preview",onClick:h=>t.$emit("select",s),title:n.title(s)},[(m=s.mime)!=null&&m.startsWith("image/")?(g(),x(Fe,{key:0,src:n.url(s.path),srcset:n.srcset(s.previews),title:s.name},null,8,["src","srcset","title"])):(u=s.mime)!=null&&u.startsWith("video/")&&Object.values(s.previews).length?(g(),x(Fe,{key:1,src:n.url(Object.values(s.previews)[0]??""),srcset:n.srcset(s.previews),title:s.name},null,8,["src","srcset","title"])):(c=s.mime)!=null&&c.startsWith("video/")&&!Object.values(s.previews).length?(g(),D("svg",Na,[...e[24]||(e[24]=[w("path",{d:"M10,15L15.19,12L10,9V15M21.56,7.17C21.69,7.64 21.78,8.27 21.84,9.07C21.91,9.87 21.94,10.56 21.94,11.16L22,12C22,14.19 21.84,15.8 21.56,16.83C21.31,17.73 20.73,18.31 19.83,18.56C19.36,18.69 18.5,18.78 17.18,18.84C15.88,18.91 14.69,18.94 13.59,18.94L12,19C7.81,19 5.2,18.84 4.17,18.56C3.27,18.31 2.69,17.73 2.44,16.83C2.31,16.36 2.22,15.73 2.16,14.93C2.09,14.13 2.06,13.44 2.06,12.84L2,12C2,9.81 2.16,8.2 2.44,7.17C2.69,6.27 3.27,5.69 4.17,5.44C4.64,5.31 5.5,5.22 6.82,5.16C8.12,5.09 9.31,5.06 10.41,5.06L12,5C16.19,5 18.8,5.16 19.83,5.44C20.73,5.69 21.31,6.27 21.56,7.17Z"},null,-1)])])):(f=s.mime)!=null&&f.startsWith("audio/")?(g(),D("svg",Ia,[...e[25]||(e[25]=[w("path",{d:"M21,3V15.5A3.5,3.5 0 0,1 17.5,19A3.5,3.5 0 0,1 14,15.5A3.5,3.5 0 0,1 17.5,12C18.04,12 18.55,12.12 19,12.34V6.47L9,8.6V17.5A3.5,3.5 0 0,1 5.5,21A3.5,3.5 0 0,1 2,17.5A3.5,3.5 0 0,1 5.5,14C6.04,14 6.55,14.12 7,14.34V6L21,3Z"},null,-1)])])):(g(),D("svg",Aa,[...e[26]||(e[26]=[w("path",{d:"M7.05 11.885c0 1.415-.548 2.206-1.524 2.206C4.548 14.09 4 13.3 4 11.885c0-1.412.548-2.203 1.526-2.203.976 0 1.524.79 1.524 2.203m-1.524-1.612c-.542 0-.832.563-.832 1.612q0 .133.006.252l1.559-1.143c-.126-.474-.375-.72-.733-.72zm-.732 2.508c.126.472.372.718.732.718.54 0 .83-.563.83-1.614q0-.129-.006-.25zm6.061.624V14h-3v-.595h1.181V10.5h-.05l-1.136.747v-.688l1.19-.786h.69v3.633z"},null,-1),w("path",{d:"M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2M9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"},null,-1)])]))],8,Sa),w("a",{href:"#",class:J(["item-content",{trashed:s.deleted_at}]),onClick:h=>t.$emit("select",s),title:n.title(s)},[w("div",Ra,[w("div",Ua,[s.lang?(g(),D("span",Pa,b(s.lang),1)):V("",!0),s.publish_at?(g(),x(He,{key:1,class:"publish-at",icon:"mdi-clock-outline"})):V("",!0),w("span",Ba,b(s.name),1)]),w("div",Fa,b(s.mime),1)]),w("div",Ha,[w("div",Wa,b(s.editor),1),w("div",ja,b(new Date(s.updated_at).toLocaleString()),1)])],10,La)]}),_:2},1024))),128))]),_:1},8,["class"]),r.loading?(g(),D("p",za,[y(b(t.$gettext("Loading"))+" ",1),e[27]||(e[27]=w("svg",{class:"spinner",width:"32",height:"32",fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[w("circle",{class:"spin1",cx:"4",cy:"12",r:"3"}),w("circle",{class:"spin1 spin2",cx:"12",cy:"12",r:"3"}),w("circle",{class:"spin1 spin3",cx:"20",cy:"12",r:"3"})],-1))])):V("",!0),!r.loading&&!r.items.length?(g(),D("p",Ya,b(t.$gettext("No entries found")),1)):V("",!0),r.last>1?(g(),x(mi,{key:2,modelValue:r.page,"onUpdate:modelValue":e[21]||(e[21]=s=>r.page=s),length:r.last},null,8,["modelValue","length"])):V("",!0),!this.embed&&a.auth.can("file:add")?(g(),D("div",Xa,[w("input",{onChange:e[22]||(e[22]=s=>n.add(s)),ref:"upload",type:"file",multiple:"",hidden:""},null,544),l(v,{onClick:e[23]||(e[23]=s=>t.$refs.upload.click()),title:t.$gettext("Add files"),disabled:r.loading,icon:"mdi-plus",color:"primary",variant:"tonal"},null,8,["title","disabled"])])):V("",!0)],64)}const qa=Ae(Da,[["render",_a],["__scopeId","data-v-8a56bf09"]]),Ga={components:{FileListItems:qa},props:{modelValue:{type:Boolean,required:!0},context:{type:[Object,null],default:null},files:{type:Array,default:()=>[]}},emits:["update:modelValue","add"],inject:["base64ToBlob","transcribe","url"],setup(){const t=Ye();return{app:pt(),messages:t}},data(){return{audio:null,chat:"",items:[],errors:[],used:[],loading:!1,dictating:!1}},beforeUpdate(){var t,e,i;this.chat=[(t=this.context)==null?void 0:t.title,(e=this.context)==null?void 0:e.text,(i=this.context)==null?void 0:i.description].filter(Boolean).join(`
`),this.used=this.files||[]},unmounted(){this.items.forEach(t=>{t.path.startsWith("blob:")&&URL.revokeObjectURL(t.path)}),this.used=[],this.items=[]},methods:{add(t){if(!t.path.startsWith("blob:")){this.$emit("add",[t]);return}this.loading=!0,fetch(this.url(t.path,!0)).then(e=>e.blob()).then(e=>{const i="ai-image_"+new Date().toISOString().replace(/[^0-9]/g,"")+".png";return this.$apollo.mutate({mutation:I`mutation($input: FileInput, $file: Upload) {
              addFile(input: $input, file: $file) {
                id
                mime
                name
                path
                previews
                updated_at
                editor
              }
            }`,variables:{input:{name:t.name},file:new File([e],i,{type:t.mime})},context:{hasUpload:!0}})}).then(e=>{if(e.errors)throw e.errors;Object.assign(t,e.data.addFile,{previews:JSON.parse(e.data.addFile.previews||"{}")}),this.$refs.filelist.invalidate(),this.$emit("add",[t])}).catch(e=>{this.messages.add(this.$gettext("Error adding file %{path}",{path:t==null?void 0:t.path})+`:
`+e,"error"),this.$log("FileAiDialog::add(): Error adding file",e)}).finally(()=>{this.loading=!1})},create(){var t;!((t=this.chat)!=null&&t.trim())||this.loading||(this.loading=!0,this.original=this.chat,this.$apollo.mutate({mutation:I`mutation($prompt: String!, $context: String, $files: [String!]) {
            imagine(prompt: $prompt, context: $context, files: $files)
          }`,variables:{prompt:this.chat,context:this.context?`Context in JSON format:
`+JSON.stringify(this.context):"",files:this.used.map(e=>e.id)}}).then(e=>{if(e.errors)throw e.errors;e.data.imagine&&this.items.unshift({path:URL.createObjectURL(this.base64ToBlob(e.data.imagine)),name:this.chat.slice(0,this.chat.length>250?this.chat.lastIndexOf(" ",250):250),mime:"image/png"})}).catch(e=>{this.messages.add(this.$gettext("Error creating file")+`:
`+e,"error"),this.$log("FileAiDialog::create(): Error creating file",e)}).finally(()=>{this.loading=!1}))},record(){if(!this.audio)return this.audio=_t().start();this.audio.then(t=>{this.dictating=!0,this.audio=null,t.stop().then(e=>{this.transcribe(e).then(i=>{this.chat=i.asText()}).finally(()=>{this.dictating=!1})})})},remove(t){this.items.splice(t,1)},removeUsed(t){this.used.splice(t,1)},use(t){this.used.find(e=>e.path===t.path)||this.used.push(t)}}},Ja={key:0},Za=["onClick"],Qa=["src"],Ka={key:1},er={class:"item-preview"},tr=["src"];function ir(t,e,i,a,r,n){const s=ye("FileListItems");return g(),x(it,{modelValue:i.modelValue,onAfterLeave:e[5]||(e[5]=o=>t.$emit("update:modelValue",!1)),"max-width":"1200",scrollable:""},{default:d(()=>[l(se,{loading:r.loading?"primary":!1},{append:d(()=>[l(v,{onClick:e[0]||(e[0]=o=>n.record()),class:J({dictating:r.audio}),icon:r.audio?"mdi-microphone-outline":"mdi-microphone",title:t.$gettext("Dictate"),loading:r.dictating,variant:"text"},null,8,["class","icon","title","loading"]),l(v,{onClick:e[1]||(e[1]=o=>t.$emit("update:modelValue",!1)),title:t.$gettext("Close"),icon:"mdi-close",variant:"text"},null,8,["title"])]),title:d(()=>[y(b(t.$gettext("Create image")),1)]),default:d(()=>[l(at,null,{default:d(()=>[l(Be,{modelValue:r.chat,"onUpdate:modelValue":e[2]||(e[2]=o=>r.chat=o),label:t.$gettext("Describe the image content"),variant:"underlined",autofocus:"",clearable:""},null,8,["modelValue","label"]),l(v,{loading:r.loading,disabled:!r.chat,onClick:e[3]||(e[3]=o=>n.create()),variant:"outlined",class:"create"},{default:d(()=>[y(b(t.$gettext("New image")),1)]),_:1},8,["loading","disabled"]),r.items.length?(g(),D("div",Ja,[l(ke,null,{default:d(()=>[l(ve,null,{default:d(()=>[y(b(t.$gettext("Current images")),1)]),_:1})]),_:1}),l(ae,{class:"items grid"},{default:d(()=>[(g(!0),D(j,null,q(r.items,(o,m)=>(g(),x(T,{key:m},{default:d(()=>[l(v,{onClick:u=>n.remove(m),title:t.$gettext("Remove"),class:"btn-overlay",icon:"mdi-delete"},null,8,["onClick","title"]),w("div",{class:"item-preview",onClick:u=>n.add(o)},[w("img",{src:n.url(o.path)},null,8,Qa)],8,Za)]),_:2},1024))),128))]),_:1})])):V("",!0),r.used.length?(g(),D("div",Ka,[l(ke,null,{default:d(()=>[l(ve,null,{default:d(()=>[y(b(t.$gettext("Images used")),1)]),_:1})]),_:1}),l(ae,{class:"items grid"},{default:d(()=>[(g(!0),D(j,null,q(r.used,(o,m)=>(g(),x(T,{key:m},{default:d(()=>[l(v,{icon:"mdi-delete",onClick:u=>n.removeUsed(m),class:"btn-overlay",title:t.$gettext("Remove")},null,8,["onClick","title"]),w("div",er,[w("img",{src:n.url(o.path)},null,8,tr)])]),_:2},1024))),128))]),_:1})])):V("",!0),l(ke,null,{default:d(()=>[l(ve,null,{default:d(()=>[y(b(t.$gettext("Select images")),1)]),_:1})]),_:1}),l(s,{ref:"filelist",filter:{mime:"image/"},onSelect:e[4]||(e[4]=o=>n.use(o))},null,512)]),_:1})]),_:1},8,["loading"])]),_:1},8,["modelValue"])}const ar=Ae(Ga,[["render",ir],["__scopeId","data-v-8e48c9df"]]),rr={components:{FileAiDialog:ar},props:{item:{type:Object,required:!0}},emits:["update:item","update:file","error"],inject:["base64ToBlob","compose","locales","transcribe","translate","txlocales","url"],data(){return{vedit:!1,selected:!1,loading:{},tabtrans:null,tabdesc:null,edittext:null,cropLabel:null,cropper:null,audio:null,images:[],menu:{},width:0,height:0,extend:{top:0,right:0,bottom:0,left:0}}},setup(){const t=vi(),e=Ye(),i=bi(),a=ze();return{app:pt(),auth:a,languages:t,messages:e,side:i}},mounted(){this.cropper=this.init()},beforeUnmount(){this.cropper&&this.cropper.destroy(),this.images.forEach(t=>{URL.revokeObjectURL(t.url)})},computed:{desclangs(){return this.languages.available.concat(Object.keys(this.item.description||{})).filter((t,e,i)=>i.indexOf(t)===e)},ratio(){if(!this.cropper)return NaN;const t=this.cropper.getImageData();return t.naturalWidth/t.naturalHeight},readonly(){return!this.auth.can("file:save")}},methods:{addCover(){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");const t=this,e=this.$refs.video;if(!e)return this.messages.add(this.$gettext("No video element found"),"error");const i=this.item.path.replace(/\.[A-Za-z0-9]+$/,".png").split("/").pop(),a=document.createElement("canvas"),r=a.getContext("2d");a.width=e.videoWidth,a.height=e.videoHeight,r.drawImage(e,0,0,e.videoWidth,e.videoHeight),a.toBlob(function(n){const s=new File([n],i,{type:"image/png"});t.loading.cover=!0,t.$apollo.mutate({mutation:I`mutation($id: ID!, $preview: Upload) {
              saveFile(id: $id, input: {}, preview: $preview) {
                id
                latest {
                  data
                  created_at
                }
              }
            }`,variables:{id:t.item.id,preview:s},context:{hasUpload:!0}}).then(o=>{var u,c,f;if(o.errors)throw o.errors;const m=(c=(u=o.data)==null?void 0:u.saveFile)==null?void 0:c.latest;m&&(t.item.previews=((f=JSON.parse(m.data||"{}"))==null?void 0:f.previews)||{},t.item.updated_at=m.created_at)}).catch(o=>{t.messages.add(t.$gettext("Error saving video cover")+`:
`+o,"error"),t.$log("FileDetailItem::addCover(): Error saving video cover",o)}).finally(()=>{t.loading.cover=!1})},"image/png",1)},aspect(t){this.cropper.setAspectRatio(t),this.cropper.setDragMode("crop"),this.$nextTick(()=>{const e=this.cropper.cropper.querySelector(".cropper-crop-box");if(e&&!this.cropLabel){const i=document.createElement("div");i.className="crop-label",e.appendChild(i),this.cropLabel=i}})},clear(){this.cropper.setDragMode("none"),this.cropper.clear(),this.selected=!1,this.cropLabel=null},composeText(){const t=this.desclangs.shift()||this.item.lang||"en",e=`Summarize the content of the file in a few words in plain text format for a title tag in the language with the ISO code "${t}":`;this.loading.compose=!0,this.compose(e,null,[this.item.id]).then(i=>{this.update("description",Object.assign(this.item.description||{},{[t]:i}))}).finally(()=>{this.loading.compose=!1})},crop(){this.updateFile(),this.clear()},download(){this.cropper.getCroppedCanvas().toBlob(t=>{const e=URL.createObjectURL(t),i=document.createElement("a");i.href=e,i.download=this.item.name||"download",i.click(),URL.revokeObjectURL(e)})},erase(){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");const t=this;this.image().then(e=>{t.mask().toBlob(function(i){t.loading.erase=!0,t.$apollo.mutate({mutation:I`mutation($file: Upload!, $mask: Upload!) {
                erase(file: $file, mask: $mask)
              }`,variables:{file:new File([e],"image",{type:t.item.mime}),mask:new File([i],"mask",{type:"image/png"})},context:{hasUpload:!0}}).then(a=>{var r;if(a.errors)throw a.errors;t.replace(t.base64ToBlob((r=a.data)==null?void 0:r.erase))}).catch(a=>{t.messages.add(t.$gettext("Error erasing image part")+`:
`+a,"error"),t.$log("FileDetailItem::erase(): Error erasing image part",a)}).finally(()=>{t.loading.erase=!1,t.clear()})})})},flipX(){this.cropper.scaleX(-1),this.updateFile()},flipY(){this.cropper.scaleY(-1),this.updateFile()},image(){var t,e;return(t=this.images[0])!=null&&t.blob?Promise.resolve((e=this.images[0])==null?void 0:e.blob):fetch(this.url(this.item.path,!0)).then(i=>{if(!i.ok)throw new Error("Network error: "+i.statusText);return i.blob()})},init(){var e;if(this.readonly||!((e=this.item.mime)!=null&&e.startsWith("image/")))return null;this.cropper&&this.cropper.destroy();const t=this;return new hi(this.$refs.image,{aspectRatio:NaN,background:!0,dragMode:"none",movable:!1,autoCrop:!1,zoomable:!1,responsive:!1,zoomOnWheel:!1,zoomOnTouch:!1,touchDragZoom:!1,checkCrossOrigin:!1,checkOrientation:!1,viewMode:1,crop(i){if(!t.cropLabel)return;const{width:a,height:r}=i.detail;t.cropLabel.textContent=`${Math.round(a)}  ${Math.round(r)}`,t.selected=!0},ready(){const i=this.cropper.getImageData();t.height=i.naturalHeight,t.width=i.naturalWidth}})},inpaint(){var e;if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");if(!((e=this.edittext)!=null&&e.trim()))return;const t=this;this.image().then(i=>{t.mask().toBlob(function(a){t.loading.paint=!0,t.$apollo.mutate({mutation:I`mutation($file: Upload!, $mask: Upload!, $prompt: String!) {
                inpaint(file: $file, mask: $mask, prompt: $prompt)
              }`,variables:{file:new File([i],"image",{type:t.item.mime}),mask:new File([a],"mask",{type:"image/png"}),prompt:t.edittext},context:{hasUpload:!0}}).then(r=>{var n;if(r.errors)throw r.errors;t.replace(t.base64ToBlob((n=r.data)==null?void 0:n.inpaint))}).catch(r=>{t.messages.add(t.$gettext("Error editing image part")+`:
`+r,"error"),t.$log("FileDetailItem::inpaint(): Error editing image part",r)}).finally(()=>{t.loading.paint=!1,t.clear()})})})},isolate(){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");const t=this;this.cropper.getCroppedCanvas().toBlob(function(e){t.loading.isolate=!0,t.$apollo.mutate({mutation:I`mutation($file: Upload!) {
              isolate(file: $file)
            }`,variables:{file:new File([e],"image.png",{type:"image/png"})},context:{hasUpload:!0}}).then(i=>{var a;if(i.errors)throw i.errors;t.replace(t.base64ToBlob((a=i.data)==null?void 0:a.isolate))}).catch(i=>{t.messages.add(t.$gettext("Error removing background")+`:
`+i,"error"),t.$log("FileDetailItem::isolate(): Error removing background",i)}).finally(()=>{t.loading.isolate=!1})})},mask(){const t=document.createElement("canvas"),e=t.getContext("2d"),i=this.cropper.getImageData(),a=this.cropper.getData();return t.width=i.naturalWidth,t.height=i.naturalHeight,e.fillStyle="black",e.fillRect(0,0,t.width,t.height),e.fillStyle="white",e.fillRect(a.x,a.y,a.width,a.height),t},record(){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");if(!this.audio)return this.audio=_t().start();this.audio.then(t=>{this.loading.dictate=!0,this.audio=null,t.stop().then(e=>{this.transcribe(e).then(i=>{const a=this.desclangs[0]||this.item.lang||"en";this.update("description",Object.assign(this.item.description||{},{[a]:i.asText()}))}).finally(()=>{this.loading.dictate=!1})})})},removeCover(){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");this.loading.cover=!0,this.item.previews={},this.$apollo.mutate({mutation:I`mutation($id: ID!, $preview: Boolean) {
            saveFile(id: $id, input: {}, preview: $preview) {
              id
              latest {
                data
                created_at
              }
            }
          }`,variables:{id:this.item.id,preview:!1}}).then(t=>{var i,a,r;if(t.errors)throw t.errors;const e=(a=(i=t.data)==null?void 0:i.saveFile)==null?void 0:a.latest;e&&(this.item.previews=((r=JSON.parse(e.data||"{}"))==null?void 0:r.previews)||{},this.item.updated_at=e.created_at)}).catch(t=>{this.messages.add(this.$gettext("Error removing video cover")+`:
`+t,"error"),this.$log("FileDetailItem::removeCover(): Error removing video cover",t)}).finally(()=>{this.loading.cover=!1})},repaint(){var e;if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");if(!((e=this.edittext)!=null&&e.trim()))return;const t=this;this.image().then(i=>{t.loading.paint=!0,t.$apollo.mutate({mutation:I`mutation($file: Upload!, $prompt: String!) {
              repaint(file: $file, prompt: $prompt)
            }`,variables:{file:new File([i],"image",{type:t.item.mime}),prompt:t.edittext},context:{hasUpload:!0}}).then(a=>{var r;if(a.errors)throw a.errors;t.replace(t.base64ToBlob((r=a.data)==null?void 0:r.repaint))}).catch(a=>{t.messages.add(t.$gettext("Error editing image")+`:
`+a,"error"),t.$log("FileDetailItem::repaint(): Error editing image",a)}).finally(()=>{t.loading.paint=!1,t.clear()})})},replace(t,e=null){let i=null;if(t){const a=URL.createObjectURL(t);this.cropper.replace(a),e!==null?this.images.unshift(...this.images.splice(e,1)):this.images.unshift({blob:t,url:a}),this.images.splice(10).forEach(r=>{URL.revokeObjectURL(r.url)}),i=new File([t],this.item.path.split("/").pop(),{type:"image/png"})}this.$emit("update:file",i),this.reset()},reset(){this.selected=!1,this.cropper.reset(),this.cropper.clear()},rotate(t){this.cropper.rotate(t),this.updateFile(),this.$nextTick(()=>{const e=this.cropper.getContainerData(),i=this.cropper.getImageData();let a,r;Math.abs(Math.abs(i.rotate)-180)===90?(a=e.width/i.naturalHeight,r=e.height/i.naturalWidth):(a=e.width/i.naturalWidth,r=e.height/i.naturalHeight),this.cropper.zoomTo(Math.min(a,r))})},transcribeFile(){var t,e;if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");if(!((t=this.item.mime)!=null&&t.startsWith("audio/"))&&!((e=this.item.mime)!=null&&e.startsWith("video/")))return this.messages.add(this.$gettext("Transcription is only available for audio and video files"),"error");this.loading.transcribe=!0,this.transcribe(this.item.path).then(i=>{const a=this.desclangs[0]||this.item.lang||"en";this.update("transcription",Object.assign(this.item.transcription||{},{[a]:i.asText()}))}).finally(()=>{this.loading.transcribe=!1})},translateText(t){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");if(!t||typeof t!="object"){this.$log("FileDetailItem::translateText(): Invalid map object",t);return}const e=[],[i,a]=Object.entries(t||{}).find(([r,n])=>!!n);return this.loading.translate=!0,this.txlocales(i).map(r=>r.code).forEach(r=>{e.push(this.translate(a,r).then(n=>{n[0]&&(t[r]=n[0])}).catch(n=>{this.$log("FileDetailItem::translateText(): Error translating text",n)}))}),Promise.all(e).then(()=>(this.$emit("update:item",this.item),this.loading.translate=!1,t))},translateVTT(t){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");if(!t||typeof t!="object"){this.$log("FileDetailItem::translateVTT(): Invalid map object",t);return}const e=/^\d{2}:\d{2}:\d{2}\.\d{3} --\> \d{2}:\d{2}:\d{2}\.\d{3}(?: .*)?$/,i={...t};for(const[a,r]of Object.entries(i))r&&(i[a]=r.split(`
`).map(n=>n.startsWith("WEBVTT")||e.test(n)?`<x>${n}</x>`:n).filter(n=>n.trim()!=="").join(""));this.translateText(i).then(a=>{for(const[r,n]of Object.entries(a))a[r]&&(t[r]=a[r].replaceAll(/\<x\>/g,`

`).replaceAll(/\<\/x\>/g,`
`).trim());this.$emit("update:item",this.item)}).catch(a=>{this.$log("FileDetailItem::translateVTT(): Error translating VTT",a)})},uncrop(){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");if(!this.extend.top&&!this.extend.right&&!this.extend.bottom&&!this.extend.left)return;const t=this;this.cropper.getCroppedCanvas().toBlob(function(e){t.loading.uncrop=!0,t.$apollo.mutate({mutation:I`mutation($file: Upload!, $top: Int!, $right: Int!, $bottom: Int, $left: Int) {
              uncrop(file: $file, top: $top, right: $right, bottom: $bottom, left: $left)
            }`,variables:{file:new File([e],"image.png",{type:"image/png"}),top:t.extend.top??0,right:t.extend.right??0,bottom:t.extend.bottom??0,left:t.extend.left??0},context:{hasUpload:!0}}).then(i=>{var a;if(i.errors)throw i.errors;t.replace(t.base64ToBlob((a=i.data)==null?void 0:a.uncrop))}).catch(i=>{t.messages.add(t.$gettext("Error uncropping image")+`:
`+i,"error"),t.$log("FileDetailItem::uncrop(): Error uncropping image",i)}).finally(()=>{t.loading.uncrop=!1})})},update(t,e){this.item[t]=e,this.$emit("update:item",this.item)},updateFile(){this.readonly||this.cropper.getCroppedCanvas().toBlob(t=>{const e=URL.createObjectURL(t);this.images.unshift({blob:t,url:e}),this.images.splice(10).forEach(i=>{URL.revokeObjectURL(i.url)}),this.cropper.replace(e),this.$emit("update:file",new File([t],this.item.path.split("/").pop(),{type:"image/png"}))})},uploadCover(t){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");const e=t.target.files[0];if(!e)return this.messages.add(this.$gettext("No file selected"),"error");this.loading.cover=!0,this.$apollo.mutate({mutation:I`mutation($id: ID!, $preview: Upload) {
            saveFile(id: $id, input: {}, preview: $preview) {
              id
              latest {
                data
                created_at
              }
            }
          }`,variables:{id:this.item.id,preview:e},context:{hasUpload:!0}}).then(i=>{var r,n,s;if(i.errors)throw i.errors;const a=(n=(r=i.data)==null?void 0:r.saveFile)==null?void 0:n.latest;a&&(this.item.previews=((s=JSON.parse(a.data||"{}"))==null?void 0:s.previews)||{},this.item.updated_at=a.created_at)}).catch(i=>{this.messages.add(this.$gettext("Error uploading video cover")+`:
`+i,"error"),this.$log("FileDetailItem::uploadCover(): Error uploading video cover",i)}).finally(()=>{this.loading.cover=!1})},upscale(t){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");const e=this;this.cropper.getCroppedCanvas().toBlob(function(i){e.loading.upscale=!0,e.$apollo.mutate({mutation:I`mutation($file: Upload!, $factor: Int!) {
              upscale(file: $file, factor: $factor)
            }`,variables:{file:new File([i],"image.png",{type:"image/png"}),factor:t},context:{hasUpload:!0}}).then(a=>{var r;if(a.errors)throw a.errors;e.replace(e.base64ToBlob((r=a.data)==null?void 0:r.upscale))}).catch(a=>{e.messages.add(e.$gettext("Error upscaling image")+`:
`+a,"error"),e.$log("FileDetailItem::upscale(): Error upscaling image",a)}).finally(()=>{e.loading.upscale=!1})})},use(t){t!=null&&t.length&&(this.vedit=!1,this.item.path=t[0].path,this.item.mime=t[0].mime,this.cropper.replace(this.url(this.item.path,!0)),this.$emit("update:file",null),this.reset())}},watch:{item:function(t,e){t.path!==e.path&&this.$nextTick(()=>{this.init()})}}},nr={key:0,ref:"editorContainer",class:"editor-container"},sr=["src"],lr={key:0,class:"toolbar"},or={key:1,class:"editor-container"},dr=["src"],hr={key:0,class:"toolbar"},ur=["src"],cr={key:1},fr=["src"],mr={key:3,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 16 16",fill:"currentColor"},pr={class:"label"},gr={key:0,class:"actions"},vr={class:"label"},br={key:0,class:"actions"};function wr(t,e,i,a,r,n){const s=ye("FileAiDialog");return g(),D(j,null,[l(jt,null,{default:d(()=>[l(zt,{class:"scroll"},{default:d(()=>{var o,m;return[l(ce,null,{default:d(()=>[l(te,{cols:"12",md:"6"},{default:d(()=>[l(Yt,{ref:"name",readonly:n.readonly,modelValue:i.item.name,"onUpdate:modelValue":e[0]||(e[0]=u=>n.update("name",u)),variant:"underlined",label:t.$gettext("Name"),counter:"255",maxlength:"255"},null,8,["readonly","modelValue","label"])]),_:1}),l(te,{cols:"12",md:"6"},{default:d(()=>[l(wi,{ref:"lang",items:n.locales(!0),readonly:n.readonly,modelValue:i.item.lang,"onUpdate:modelValue":e[1]||(e[1]=u=>n.update("lang",u)),variant:"underlined",label:t.$gettext("Language")},null,8,["items","readonly","modelValue","label"])]),_:1})]),_:1}),l(ce,null,{default:d(()=>[i.item?(g(),x(te,{key:0,cols:"12",class:"preview"},{default:d(()=>{var u,c,f;return[(u=i.item.mime)!=null&&u.startsWith("image/")?(g(),D("div",nr,[w("img",{ref:"image",src:n.url(i.item.path,!0),class:"element",crossorigin:"anonymous"},null,8,sr),n.readonly?V("",!0):(g(),D("div",lr,[r.selected?(g(),x(v,{key:0,onClick:e[2]||(e[2]=h=>n.clear()),title:t.$gettext("Cancel"),icon:"mdi-close",class:"no-rtl"},null,8,["title"])):(g(),x($e(t.$vuetify.display.xs?"v-dialog":"v-menu"),{key:1,modelValue:r.menu.select,"onUpdate:modelValue":e[12]||(e[12]=h=>r.menu.select=h),transition:"scale-transition",location:"end center","max-width":"300"},{activator:d(({props:h})=>[l(v,ie(h,{title:t.$gettext("Select area"),icon:"mdi-crop-free",class:"no-rtl"}),null,16,["title"])]),default:d(()=>[l(se,null,{default:d(()=>[l(pe,{density:"compact"},{default:d(()=>[l(ge,null,{default:d(()=>[y(b(t.$gettext("Select area")),1)]),_:1}),l(v,{icon:"mdi-close",onClick:e[3]||(e[3]=h=>r.menu.select=!1)})]),_:1}),l(ae,{onClick:e[11]||(e[11]=h=>r.menu.select=!1)},{default:d(()=>[l(T,null,{default:d(()=>[l(v,{"prepend-icon":"mdi-crop-free",class:"no-rtl",variant:"text",onClick:e[4]||(e[4]=h=>n.aspect(n.ratio))},{default:d(()=>[y(b(t.$gettext("Original ratio")),1)]),_:1})]),_:1}),l(T,null,{default:d(()=>[l(v,{"prepend-icon":"mdi-crop-free",class:"no-rtl",variant:"text",onClick:e[5]||(e[5]=h=>n.aspect(NaN))},{default:d(()=>[y(b(t.$gettext("No ratio")),1)]),_:1})]),_:1}),l(T,null,{default:d(()=>[l(v,{"prepend-icon":"mdi-crop-free",class:"no-rtl",variant:"text",onClick:e[6]||(e[6]=h=>n.aspect(1))},{default:d(()=>[y(b(t.$gettext("Square")),1)]),_:1})]),_:1}),l(T,null,{default:d(()=>[l(v,{"prepend-icon":"mdi-crop-free",class:"no-rtl",variant:"text",onClick:e[7]||(e[7]=h=>n.aspect(3/2))},{default:d(()=>[...e[56]||(e[56]=[y("3:2",-1)])]),_:1})]),_:1}),l(T,null,{default:d(()=>[l(v,{"prepend-icon":"mdi-crop-free",class:"no-rtl",variant:"text",onClick:e[8]||(e[8]=h=>n.aspect(4/3))},{default:d(()=>[...e[57]||(e[57]=[y("4:3",-1)])]),_:1})]),_:1}),l(T,null,{default:d(()=>[l(v,{"prepend-icon":"mdi-crop-free",class:"no-rtl",variant:"text",onClick:e[9]||(e[9]=h=>n.aspect(5/3))},{default:d(()=>[...e[58]||(e[58]=[y("5:3",-1)])]),_:1})]),_:1}),l(T,null,{default:d(()=>[l(v,{"prepend-icon":"mdi-crop-free",class:"no-rtl",variant:"text",onClick:e[10]||(e[10]=h=>n.aspect(16/9))},{default:d(()=>[...e[59]||(e[59]=[y("16:9",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])),l(v,{onClick:e[13]||(e[13]=h=>n.crop()),disabled:!r.selected,title:t.$gettext("Crop selected area"),icon:"mdi-crop",class:"no-rtl"},null,8,["disabled","title"]),l(v,{onClick:e[14]||(e[14]=h=>n.erase()),disabled:!r.selected,loading:r.loading.erase,title:t.$gettext("Erase selected area"),icon:"mdi-eraser",class:"no-rtl"},null,8,["disabled","loading","title"]),l(it,{modelValue:r.menu.paint,"onUpdate:modelValue":e[18]||(e[18]=h=>r.menu.paint=h),transition:"scale-transition","max-width":"600"},{activator:d(({props:h})=>[l(v,ie(h,{loading:r.loading.paint,title:t.$gettext("Edit image"),icon:"mdi-image-edit",class:"no-rtl"}),null,16,["loading","title"])]),default:d(()=>[l(se,null,{default:d(()=>[l(pe,{density:"compact"},{default:d(()=>[l(ge,null,{default:d(()=>[y(b(t.$gettext("Edit image")),1)]),_:1}),l(v,{icon:"mdi-close",onClick:e[15]||(e[15]=h=>r.menu.paint=!1)})]),_:1}),l(at,null,{default:d(()=>[l(Be,{modelValue:r.edittext,"onUpdate:modelValue":e[16]||(e[16]=h=>r.edittext=h),label:t.$gettext("Describe the changes"),variant:"underlined",autofocus:"",clearable:"","auto-grow":""},null,8,["modelValue","label"])]),_:1}),l(Vt,null,{default:d(()=>[l(v,{variant:"outlined",disabled:!r.edittext,onClick:e[17]||(e[17]=h=>{r.selected?n.inpaint():n.repaint(),r.menu.paint=!1})},{default:d(()=>[y(b(t.$gettext("Edit image")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(v,{onClick:e[19]||(e[19]=h=>n.isolate()),title:t.$gettext("Remove background"),loading:r.loading.isolate,icon:"mdi-image-filter-black-white",class:"no-rtl"},null,8,["title","loading"]),l(it,{modelValue:r.menu.uncrop,"onUpdate:modelValue":e[26]||(e[26]=h=>r.menu.uncrop=h),transition:"scale-transition","max-width":"300"},{activator:d(({props:h})=>[l(v,ie(h,{loading:r.loading.uncrop,title:t.$gettext("Expand image"),icon:"mdi-arrow-expand-all",class:"no-rtl"}),null,16,["loading","title"])]),default:d(()=>[l(se,{class:"uncrop"},{default:d(()=>[l(pe,{density:"compact"},{default:d(()=>[l(ge,null,{default:d(()=>[y(b(t.$gettext("Expand image")),1)]),_:1}),l(v,{icon:"mdi-close",onClick:e[20]||(e[20]=h=>r.menu.uncrop=!1)})]),_:1}),l(at,null,{default:d(()=>[l(ce,{class:"single"},{default:d(()=>[l(te,{cols:"6"},{default:d(()=>[l(Re,{modelValue:r.extend.top,"onUpdate:modelValue":e[21]||(e[21]=h=>r.extend.top=h),variant:"outlined",controlVariant:"hidden",label:t.$gettext("Top"),max:2e3,min:0},null,8,["modelValue","label"])]),_:1})]),_:1}),l(ce,null,{default:d(()=>[l(te,{cols:"6"},{default:d(()=>[l(Re,{modelValue:r.extend.left,"onUpdate:modelValue":e[22]||(e[22]=h=>r.extend.left=h),variant:"outlined",controlVariant:"hidden",label:t.$gettext("Left"),max:2e3,min:0},null,8,["modelValue","label"])]),_:1}),l(te,{cols:"6"},{default:d(()=>[l(Re,{modelValue:r.extend.right,"onUpdate:modelValue":e[23]||(e[23]=h=>r.extend.right=h),variant:"outlined",controlVariant:"hidden",label:t.$gettext("Right"),max:2e3,min:0},null,8,["modelValue","label"])]),_:1})]),_:1}),l(ce,{class:"single"},{default:d(()=>[l(te,{cols:"6"},{default:d(()=>[l(Re,{modelValue:r.extend.bottom,"onUpdate:modelValue":e[24]||(e[24]=h=>r.extend.bottom=h),variant:"outlined",controlVariant:"hidden",label:t.$gettext("Bottom"),max:2e3,min:0},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1}),l(Vt,null,{default:d(()=>[l(v,{variant:"outlined",onClick:e[25]||(e[25]=h=>{n.uncrop(r.extend.top,r.extend.right,r.extend.bottom,r.extend.left),r.menu.uncrop=!1})},{default:d(()=>[y(b(t.$gettext("Expand image")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),(g(),x($e(t.$vuetify.display.xs?"v-dialog":"v-menu"),{modelValue:r.menu.upscale,"onUpdate:modelValue":e[33]||(e[33]=h=>r.menu.upscale=h),transition:"scale-transition",location:"end center","max-width":"300"},{activator:d(({props:h})=>[l(v,ie(h,{loading:r.loading.upscale,disabled:r.width>=4096&&r.height>=4096,title:t.$gettext("Upscale image"),icon:"mdi-magnify-expand",class:"no-rtl"}),null,16,["loading","disabled","title"])]),default:d(()=>[l(se,null,{default:d(()=>[l(pe,{density:"compact"},{default:d(()=>[l(ge,null,{default:d(()=>[y(b(t.$gettext("Upscale image")),1)]),_:1}),l(v,{icon:"mdi-close",onClick:e[27]||(e[27]=h=>r.menu.upscale=!1)})]),_:1}),l(ae,{onClick:e[32]||(e[32]=h=>r.menu.upscale=!1)},{default:d(()=>[r.width*16<=4096&&r.height*16<=4096?(g(),x(T,{key:0},{default:d(()=>[l(v,{"prepend-icon":"mdi-magnify-expand",class:"no-rtl",variant:"text",onClick:e[28]||(e[28]=h=>n.upscale(16))},{default:d(()=>[y(b(t.$gettext("Scale %{factor}",{factor:"16x"})),1)]),_:1})]),_:1})):V("",!0),r.width*8<=4096&&r.height*8<=4096?(g(),x(T,{key:1},{default:d(()=>[l(v,{"prepend-icon":"mdi-magnify-expand",class:"no-rtl",variant:"text",onClick:e[29]||(e[29]=h=>n.upscale(8))},{default:d(()=>[y(b(t.$gettext("Scale %{factor}",{factor:"8x"})),1)]),_:1})]),_:1})):V("",!0),r.width*4<=4096&&r.height*4<=4096?(g(),x(T,{key:2},{default:d(()=>[l(v,{"prepend-icon":"mdi-magnify-expand",class:"no-rtl",variant:"text",onClick:e[30]||(e[30]=h=>n.upscale(4))},{default:d(()=>[y(b(t.$gettext("Scale %{factor}",{factor:"4x"})),1)]),_:1})]),_:1})):V("",!0),r.width*2<=4096&&r.height*2<=4096?(g(),x(T,{key:3},{default:d(()=>[l(v,{"prepend-icon":"mdi-magnify-expand",class:"no-rtl",variant:"text",onClick:e[31]||(e[31]=h=>n.upscale(2))},{default:d(()=>[y(b(t.$gettext("Scale %{factor}",{factor:"2x"})),1)]),_:1})]),_:1})):V("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])),l(v,{icon:"mdi-rotate-left",class:"no-rtl",onClick:e[34]||(e[34]=h=>n.rotate(-90)),title:t.$gettext("Rotate counter-clockwise")},null,8,["title"]),l(v,{icon:"mdi-rotate-right",class:"no-rtl",onClick:e[35]||(e[35]=h=>n.rotate(90)),title:t.$gettext("Rotate clockwise")},null,8,["title"]),l(v,{icon:"mdi-flip-horizontal",class:"no-rtl",onClick:n.flipX,title:t.$gettext("Flip horizontally")},null,8,["onClick","title"]),l(v,{icon:"mdi-flip-vertical",class:"no-rtl",onClick:n.flipY,title:t.$gettext("Flip vertically")},null,8,["onClick","title"]),l(v,{icon:"mdi-download",class:"no-rtl",onClick:e[36]||(e[36]=h=>n.download()),title:t.$gettext("Download")},null,8,["title"]),(g(),x($e(t.$vuetify.display.xs?"v-dialog":"v-menu"),{modelValue:r.menu.undo,"onUpdate:modelValue":e[40]||(e[40]=h=>r.menu.undo=h),transition:"scale-transition",location:"end center","max-width":"300"},{activator:d(({props:h})=>[l(v,ie(h,{disabled:!r.images.length,title:t.$gettext("Undo"),icon:"mdi-history",class:"no-rtl"}),null,16,["disabled","title"])]),default:d(()=>[l(se,null,{default:d(()=>[l(pe,{density:"compact"},{default:d(()=>[l(ge,null,{default:d(()=>[y(b(t.$gettext("Undo")),1)]),_:1}),l(v,{icon:"mdi-close",onClick:e[37]||(e[37]=h=>r.menu.undo=!1)})]),_:1}),l(ae,{onClick:e[39]||(e[39]=h=>r.menu.undo=!1)},{default:d(()=>[(g(!0),D(j,null,q(r.images.slice(1),(h,C)=>(g(),x(T,{key:C},{default:d(()=>[l(Fe,{src:h.url,onClick:k=>n.replace(h.blob,C+1)},null,8,["src","onClick"])]),_:2},1024))),128)),l(T,null,{default:d(()=>[l(Fe,{src:n.url(i.item.path),onClick:e[38]||(e[38]=h=>n.use([i.item]))},null,8,["src"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))]))],512)):(c=i.item.mime)!=null&&c.startsWith("video/")?(g(),D("div",or,[w("video",{ref:"video",src:n.url(i.item.path),crossorigin:"anonymous",class:"element",controls:""},null,8,dr),n.readonly?V("",!0):(g(),D("div",hr,[Object.values(i.item.previews).length?(g(),D("img",{key:0,class:"video-preview",src:n.url(Object.values(i.item.previews).shift()),onClick:e[41]||(e[41]=h=>n.removeCover())},null,8,ur)):(g(),D("div",cr,[l(v,{icon:"mdi-tooltip-image",loading:r.loading.cover,title:t.$gettext("Use as cover image"),onClick:e[42]||(e[42]=h=>n.addCover())},null,8,["loading","title"]),l(v,{icon:"",loading:r.loading.cover,title:t.$gettext("Upload cover image"),onClick:e[44]||(e[44]=h=>t.$refs.coverInput.click())},{default:d(()=>[l(He,null,{default:d(()=>[...e[60]||(e[60]=[y("mdi-image-plus",-1)])]),_:1}),w("input",{ref:"coverInput",type:"file",class:"cover-input",onChange:e[43]||(e[43]=h=>n.uploadCover(h))},null,544)]),_:1},8,["loading","title"])]))]))])):(f=i.item.mime)!=null&&f.startsWith("audio/")?(g(),D("audio",{key:2,src:n.url(i.item.path),crossorigin:"anonymous",class:"element",controls:""},null,8,fr)):(g(),D("svg",mr,[...e[61]||(e[61]=[w("path",{d:"M7.05 11.885c0 1.415-.548 2.206-1.524 2.206C4.548 14.09 4 13.3 4 11.885c0-1.412.548-2.203 1.526-2.203.976 0 1.524.79 1.524 2.203m-1.524-1.612c-.542 0-.832.563-.832 1.612q0 .133.006.252l1.559-1.143c-.126-.474-.375-.72-.733-.72zm-.732 2.508c.126.472.372.718.732.718.54 0 .83-.563.83-1.614q0-.129-.006-.25zm6.061.624V14h-3v-.595h1.181V10.5h-.05l-1.136.747v-.688l1.19-.786h.69v3.633z"},null,-1),w("path",{d:"M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2M9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"},null,-1)])]))]}),_:1})):V("",!0)]),_:1}),l(ce,null,{default:d(()=>[l(te,{cols:"12",class:"description"},{default:d(()=>[w("div",pr,[y(b(t.$gettext("Descriptions"))+" ",1),n.readonly?V("",!0):(g(),D("div",gr,[Object.values(i.item.description||{}).find(u=>!!u)?(g(),x(v,{key:0,onClick:e[45]||(e[45]=u=>n.translateText(i.item.description)),title:t.$gettext("Translate text"),loading:r.loading.translate,icon:"mdi-translate",variant:"text"},null,8,["title","loading"])):V("",!0),l(v,{onClick:e[46]||(e[46]=u=>n.composeText()),title:t.$gettext("Generate description"),loading:r.loading.compose,icon:"mdi-creation",variant:"text"},null,8,["title","loading"]),l(v,{onClick:e[47]||(e[47]=u=>n.record()),class:J({dictating:r.audio}),icon:r.audio?"mdi-microphone-outline":"mdi-microphone",title:t.$gettext("Dictate"),loading:r.loading.dictate,variant:"text"},null,8,["class","icon","title","loading"])]))]),l(ke,{modelValue:r.tabdesc,"onUpdate:modelValue":e[48]||(e[48]=u=>r.tabdesc=u)},{default:d(()=>[(g(!0),D(j,null,q(n.locales(),u=>(g(),x(ve,{value:u.value},{default:d(()=>[y(b(u.title),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"]),l(rt,{modelValue:r.tabdesc,"onUpdate:modelValue":e[49]||(e[49]=u=>r.tabdesc=u),touch:!1},{default:d(()=>[(g(!0),D(j,null,q(n.locales(),u=>(g(),x(We,{value:u.value},{default:d(()=>{var c;return[l(Be,{ref_for:!0,ref:"description","onUpdate:modelValue":f=>{i.item.description[u.value]=f,t.$emit("update:item",i.item)},label:t.$gettext("Description (%{lang})",{lang:u.value}),modelValue:((c=i.item.description)==null?void 0:c[u.value])||"",readonly:n.readonly,variant:"underlined",counter:"500",rows:"2","auto-grow":"",clearable:""},null,8,["onUpdate:modelValue","label","modelValue","readonly"])]}),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1}),(o=i.item.mime)!=null&&o.startsWith("audio/")||(m=i.item.mime)!=null&&m.startsWith("video/")?(g(),x(ce,{key:0},{default:d(()=>[l(te,{cols:"12",class:"transcription"},{default:d(()=>[w("div",vr,[y(b(t.$gettext("Transcriptions"))+" ",1),n.readonly?V("",!0):(g(),D("div",br,[Object.values(i.item.transcription||{}).find(u=>!!u)?(g(),x(v,{key:0,onClick:e[50]||(e[50]=u=>n.translateVTT(i.item.transcription)),title:t.$gettext("Translate text"),loading:r.loading.translate,icon:"mdi-translate",variant:"text"},null,8,["title","loading"])):V("",!0),l(v,{onClick:e[51]||(e[51]=u=>n.transcribeFile()),title:t.$gettext("Transcribe file content"),loading:r.loading.transcribe,icon:"mdi-creation",variant:"text"},null,8,["title","loading"])]))]),l(ke,{modelValue:r.tabtrans,"onUpdate:modelValue":e[52]||(e[52]=u=>r.tabtrans=u)},{default:d(()=>[(g(!0),D(j,null,q(n.locales(),u=>(g(),x(ve,{value:u.value},{default:d(()=>[y(b(u.title),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"]),l(rt,{modelValue:r.tabtrans,"onUpdate:modelValue":e[53]||(e[53]=u=>r.tabtrans=u),touch:!1},{default:d(()=>[(g(!0),D(j,null,q(n.locales(),u=>(g(),x(We,{value:u.value},{default:d(()=>{var c;return[l(Be,{ref_for:!0,ref:"transcription","onUpdate:modelValue":f=>{i.item.transcription[u.value]=f,t.$emit("update:item",i.item)},label:t.$gettext("Transcription (%{lang})",{lang:u.value}),modelValue:((c=i.item.transcription)==null?void 0:c[u.value])||"",readonly:n.readonly,variant:"underlined",rows:"10","auto-grow":"",clearable:""},null,8,["onUpdate:modelValue","label","modelValue","readonly"])]}),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1})):V("",!0)]}),_:1})]),_:1}),(g(),x(qt,{to:"body"},[l(s,{modelValue:r.vedit,"onUpdate:modelValue":e[54]||(e[54]=o=>r.vedit=o),files:[i.item],onAdd:e[55]||(e[55]=o=>n.use(o))},null,8,["modelValue","files"])]))],64)}const yr=Ae(rr,[["render",wr],["__scopeId","data-v-b3489593"]]),xr={components:{AsideMeta:Ti,HistoryDialog:Vi,FileDetailItem:yr,FileDetailRefs:Ai},inject:["closeView"],props:{item:{type:Object,required:!0}},data:()=>({file:null,error:!1,changed:!1,publishAt:null,publishing:!1,pubmenu:!1,saving:!1,vhistory:!1,tab:"file"}),setup(){const t=Ye(),e=yi();return{auth:ze(),drawer:e,messages:t}},methods:{publish(t=null){if(!this.auth.can("file:publish")){this.messages.add(this.$gettext("Permission denied"),"error");return}this.publishing=!0,this.save(!0).then(e=>{var i,a;e&&this.$apollo.mutate({mutation:I`mutation ($id: [ID!]!, $at: DateTime) {
              pubFile(id: $id, at: $at) {
                id
              }
            }`,variables:{id:[this.item.id],at:(a=(i=t==null?void 0:t.toISOString())==null?void 0:i.substring(0,19))==null?void 0:a.replace("T"," ")}}).then(r=>{if(r.errors)throw r.errors;t?(this.item.publish_at=t,this.messages.add(this.$gettext("File scheduled for publishing at %{date}",{date:t.toLocaleDateString()}),"info")):(this.item.published=!0,this.messages.add(this.$gettext("File published successfully"),"success")),this.closeView()}).catch(r=>{this.messages.add(this.$gettext("Error publishing file")+`:
`+r,"error"),this.$log("FileDetail::publish(): Error publishing file",t,r)}).finally(()=>{this.publishing=!1})})},reset(){this.changed=!1,this.error=!1},save(t=!1){return this.auth.can("file:save")?this.error?(this.messages.add(this.$gettext("There are invalid fields, please resolve the errors first"),"error"),Promise.resolve(!1)):this.changed?(this.saving=!0,this.$apollo.mutate({mutation:I`mutation ($id: ID!, $input: FileInput!, $file: Upload) {
            saveFile(id: $id, input: $input, file: $file) {
              id
              latest {
                id
                data
                created_at
              }
            }
          }`,variables:{id:this.item.id,input:{transcription:JSON.stringify(this.item.transcription||{}),description:JSON.stringify(this.item.description||{}),previews:JSON.stringify(this.item.previews||{}),path:this.item.path,name:this.item.name,lang:this.item.lang},file:this.file},context:{hasUpload:!0}}).then(e=>{var a,r;if(e.errors)throw e.errors;const i=(r=(a=e.data)==null?void 0:a.saveFile)==null?void 0:r.latest;return Object.assign(this.item,JSON.parse((i==null?void 0:i.data)||"{}")),this.item.updated_at=i==null?void 0:i.created_at,this.item.published=!1,this.reset(),t||this.messages.add(this.$gettext("File saved successfully"),"success"),!0}).catch(e=>{this.messages.add(this.$gettext("Error saving file")+`:
`+e,"error"),this.$log("FileDetail::save(): Error saving file",e)}).finally(()=>{this.saving=!1})):Promise.resolve(!0):(this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve(!1))},use(t){Object.assign(this.item,t.data),this.vhistory=!1,this.changed=!0},versions(t){return this.auth.can("file:view")?t?this.$apollo.query({query:I`query($id: ID!) {
            file(id: $id) {
              id
              versions {
                id
                published
                publish_at
                data
                editor
                created_at
              }
            }
          }`,variables:{id:t}}).then(e=>{if(e.errors||!e.data.file)throw e;const i=["previews","description","transcription"];return(e.data.file.versions||[]).map(a=>{const r={...a,data:JSON.parse(a.data||"{}")};return i.forEach(n=>r[n]??(r[n]={})),r}).reverse()}).catch(e=>{this.messages.add(this.$gettext("Error fetching file versions")+`:
`+e,"error"),this.$log("FileDetail::versions(): Error fetching file versions",t,e)}):Promise.resolve([]):(this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve([]))}}},Cr={class:"app-title"},kr={class:"menu-content"};function Dr(t,e,i,a,r,n){const s=ye("FileDetailItem"),o=ye("FileDetailRefs"),m=ye("AsideMeta"),u=ye("HistoryDialog");return g(),D(j,null,[l(xi,{elevation:0,density:"compact"},{prepend:d(()=>[l(v,{onClick:e[0]||(e[0]=c=>n.closeView()),title:t.$gettext("Back to list view"),icon:"mdi-keyboard-backspace"},null,8,["title"])]),append:d(()=>[l(v,{onClick:e[1]||(e[1]=c=>t.vhistory=!0),class:J([{hidden:i.item.published&&!t.changed&&!i.item.latest},"no-rtl"]),title:t.$gettext("View history"),icon:"mdi-history"},null,8,["class","title"]),l(v,{onClick:e[2]||(e[2]=c=>n.save()),loading:t.saving,title:t.$gettext("Save"),class:J([{error:t.error},"menu-save"]),disabled:!t.changed||t.error||!a.auth.can("file:save"),variant:!t.changed||t.error||!a.auth.can("file:save")?"plain":"flat",color:!t.changed||t.error||!a.auth.can("file:save")?"":"blue-darken-1",icon:"mdi-database-arrow-down"},null,8,["loading","title","class","disabled","variant","color"]),l(Xt,{modelValue:t.pubmenu,"onUpdate:modelValue":e[5]||(e[5]=c=>t.pubmenu=c),"close-on-content-click":!1},{activator:d(({props:c})=>[l(v,ie(c,{icon:"",loading:t.publishing,title:t.$gettext("Schedule publishing"),class:[{error:t.error},"menu-publish"],disabled:i.item.published&&!t.changed||t.error||!a.auth.can("file:publish"),variant:i.item.published&&!t.changed||t.error||!a.auth.can("file:publish")?"plain":"flat",color:i.item.published&&!t.changed||t.error||!a.auth.can("file:publish")?"":"blue-darken-2"}),{default:d(()=>[l(He,null,{default:d(()=>[...e[17]||(e[17]=[w("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},[w("path",{d:"M2,1V3H16V1H2 M2,10H6V19H12V10H16L9,3L2,10Z"}),w("path",{d:"M16.7 11.4C16.7 11.4 16.61 11.4 16.7 11.4C13.19 11.49 10.4 14.28 10.4 17.7C10.4 21.21 13.19 24 16.7 24S23 21.21 23 17.7 20.21 11.4 16.7 11.4M16.7 22.2C14.18 22.2 12.2 20.22 12.2 17.7S14.18 13.2 16.7 13.2 21.2 15.18 21.2 17.7 19.22 22.2 16.7 22.2M15.6 13.1V17.6L18.84 19.58L19.56 18.5L16.95 16.97V13.1H15.6Z"})],-1)])]),_:1})]),_:1},16,["loading","title","class","disabled","variant","color"])]),default:d(()=>[w("div",kr,[l(Di,{modelValue:t.publishAt,"onUpdate:modelValue":e[3]||(e[3]=c=>t.publishAt=c),"hide-header":"","show-adjacent-months":""},null,8,["modelValue"]),l(v,{onClick:e[4]||(e[4]=c=>{n.publish(t.publishAt),t.pubmenu=!1}),disabled:!t.publishAt||t.error,color:t.publishAt?"primary":"",variant:"text"},{default:d(()=>[y(b(t.$gettext("Publish")),1)]),_:1},8,["disabled","color"])])]),_:1},8,["modelValue"]),l(v,{icon:"",onClick:e[6]||(e[6]=c=>n.publish()),loading:t.publishing,title:t.$gettext("Publish"),class:J([{error:t.error},"menu-publish"]),disabled:i.item.published&&!t.changed||t.error||!a.auth.can("file:publish"),variant:i.item.published&&!t.changed||t.error||!a.auth.can("file:publish")?"plain":"flat",color:i.item.published&&!t.changed||t.error||!a.auth.can("file:publish")?"":"blue-darken-2"},{default:d(()=>[l(He,null,{default:d(()=>[...e[18]||(e[18]=[w("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},[w("path",{d:"M5,2V4H19V2H5 M5,12H9V21H15V12H19L12,5L5,12Z"})],-1)])]),_:1})]),_:1},8,["loading","title","class","disabled","variant","color"]),l(v,{onClick:e[7]||(e[7]=tt(c=>a.drawer.toggle("aside"),["stop"])),title:t.$gettext("Toggle side menu"),icon:a.drawer.aside?"mdi-chevron-right":"mdi-chevron-left"},null,8,["title","icon"])]),default:d(()=>[l(ki,null,{default:d(()=>[w("div",Cr,b(t.$gettext("File"))+": "+b(i.item.name),1)]),_:1})]),_:1}),l(Ci,{class:"file-details"},{default:d(()=>[l(Ei,{onSubmit:e[13]||(e[13]=tt(()=>{},["prevent"]))},{default:d(()=>[l(ke,{"fixed-tabs":"",modelValue:t.tab,"onUpdate:modelValue":e[8]||(e[8]=c=>t.tab=c)},{default:d(()=>[l(ve,{value:"file",class:J({changed:t.changed,error:t.error})},{default:d(()=>[y(b(t.$gettext("File")),1)]),_:1},8,["class"]),l(ve,{value:"refs"},{default:d(()=>[y(b(t.$gettext("Used by")),1)]),_:1})]),_:1},8,["modelValue"]),l(rt,{modelValue:t.tab,"onUpdate:modelValue":e[12]||(e[12]=c=>t.tab=c),touch:!1},{default:d(()=>[l(We,{value:"file"},{default:d(()=>[l(s,{"onUpdate:item":e[9]||(e[9]=c=>{t.$emit("update:item",i.item),t.changed=!0}),"onUpdate:file":e[10]||(e[10]=c=>{t.file=c,t.changed=!0}),onError:e[11]||(e[11]=c=>t.error=c),item:i.item},null,8,["item"])]),_:1}),l(We,{value:"refs"},{default:d(()=>[l(o,{item:i.item},null,8,["item"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(m,{item:i.item},null,8,["item"]),(g(),x(qt,{to:"body"},[l(u,{modelValue:t.vhistory,"onUpdate:modelValue":e[14]||(e[14]=c=>t.vhistory=c),current:{data:{lang:i.item.lang,name:i.item.name,mime:i.item.mime,path:i.item.path,previews:i.item.previews,description:i.item.description,transcription:i.item.transcription}},load:()=>n.versions(i.item.id),onUse:e[15]||(e[15]=c=>n.use(c)),onRevert:e[16]||(e[16]=c=>{n.use(c),n.reset()})},null,8,["modelValue","current","load"])]))],64)}const Or=Ae(xr,[["render",Dr],["__scopeId","data-v-f2cc69cb"]]);export{ar as F,qa as a,Or as b};
