import{_ as h,b as f,o as g,w as t,aM as p,n,aN as w,bi as l,a7 as V,a3 as b,a as r,a9 as $,aa as v,ai as C,I as u,aF as y,l as o,t as i,ba as c,aQ as A,aZ as S,k as F}from"./index-CYOThFeL.js";const M={data:()=>({creds:{email:"",password:""},form:null,error:null,loading:!1,login:!1,show:!1}),setup(){const e=V();return{auth:b(),messages:e}},created(){const e=window.__APP_CONFIG__||{};this.creds.email=e.email??"",this.creds.password=e.password??"",this.auth.isAuthenticated().then(s=>{if(!s)throw s;l.replace(this.next())}).catch(s=>{this.login=!0})},methods:{cmslogin(){if(!this.creds.email||!this.creds.password)return!1;this.error=null,this.loading=!0,this.auth.login(this.creds.email,this.creds.password).then(e=>{Object.values(e.permission||{}).some(s=>s===!0)?l.replace(this.next()):this.error=this.$gettext("Not a CMS editor")}).catch(e=>{this.error=e.message}).finally(()=>{this.loading=!1})},next(){var s;const e=this.auth.intended()||((s=l.getRoutes().find(d=>this.auth.can(d.name)))==null?void 0:s.path);return e||this.messages.add(this.$gettext("Access denied"),"error"),e||"/"}}};function k(e,s,d,I,N,m){return g(),f(w,{class:n(["login",{show:e.login}]),modelValue:e.form,"onUpdate:modelValue":s[4]||(s[4]=a=>e.form=a),onSubmit:s[5]||(s[5]=p(a=>m.cmslogin(),["prevent"]))},{default:t(()=>[r($,{loading:e.loading,class:n(["elevation-2",{error:e.error}])},{title:t(()=>[...s[6]||(s[6]=[o(" PagibleAI CMS ",-1)])]),default:t(()=>[r(v,null,{default:t(()=>[r(u,{modelValue:e.creds.email,"onUpdate:modelValue":s[0]||(s[0]=a=>e.creds.email=a),label:e.$gettext("E-Mail"),rules:[a=>!!a||e.$gettext("Field is required"),a=>!!a.match(/.+@.+/)||e.$gettext("Invalid e-mail address")],autocomplete:"username",variant:"underlined","validate-on":"blur",autofocus:""},null,8,["modelValue","label","rules"]),r(u,{modelValue:e.creds.password,"onUpdate:modelValue":s[3]||(s[3]=a=>e.creds.password=a),type:e.show?"text":"password",label:e.$gettext("Password"),rules:[a=>!!a||e.$gettext("Field is required")],autocomplete:"current-password",variant:"underlined"},{"append-inner":t(()=>[r(y,{onClick:s[1]||(s[1]=a=>e.show=!e.show),onKeydown:s[2]||(s[2]=a=>[13,32].includes(a.keyCode)?e.show=!e.show:!1)},{default:t(()=>[o(i(e.show?"mdi-eye-off":"mdi-eye"),1)]),_:1})]),_:1},8,["modelValue","type","label","rules"]),C(r(c,{color:"error",icon:"mdi-alert-octagon"},{default:t(()=>[o(i(e.$gettext("Error")+": "+e.error),1)]),_:1},512),[[A,e.error]])]),_:1}),r(S,null,{default:t(()=>[r(F,{type:"submit",variant:"outlined",disabled:e.form!=!0},{default:t(()=>[o(i(e.$gettext("Login")),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["loading","class"])]),_:1},8,["class","modelValue"])}const B=h(M,[["render",k]]);export{B as default};
