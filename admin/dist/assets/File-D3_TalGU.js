import{_ as U,L,a6 as C,a3 as j,a4 as O,c as V,o as u,a as l,b as p,w as i,V as h,r as y,T as b,F as R,d as c,e as n,f as g,n as D,l as r,g as _,t as o,h as A,i as B,j as F,k as v,m as M,p as I}from"./index-qpWCrkU6.js";import{a as k,F as S}from"./FileListItems-Dne_Hszx.js";import{a as q,F as z}from"./FileDialog-DO1EeOEz.js";import"./ElementListItems-C8-aF-jx.js";import"./PageDetail-B5VKHwFC.js";import"./vue-draggable-plus-fZ9LdmPx.js";import"./ElementDetail-B7Dd7gZ7.js";const E={components:{FileListItems:S,FileUrlDialog:z,FileDetail:k,FileDialog:q},inject:["openView","url","srcset"],props:{modelValue:{type:[Object,null],default:()=>null},config:{type:Object,default:()=>{}},assets:{type:Object,default:()=>{}},readonly:{type:Boolean,default:!1},context:{type:Object}},emits:["update:modelValue","error","addFile","removeFile"],data(){return{file:{},index:Math.floor(Math.random()*1e5),selected:null,vfiles:!1,vurls:!1}},setup(){const e=C(),t=j();return{app:O(),auth:t,messages:e}},unmounted(){var e,t;(t=(e=this.file)==null?void 0:e.path)!=null&&t.startsWith("blob:")&&URL.revokeObjectURL(this.file.path)},computed:{description(){return Object.values(this.file.description||{}).shift()||""},rules(){return[e=>!this.config.required||!!(e!=null&&e.path)||this.$gettext("File is required")]}},methods:{add(e){if(!this.auth.can("file:add")){this.messages.add(this.$gettext("Permission denied"),"error");return}if(!e)return;const t=URL.createObjectURL(e);return this.file={path:t,uploading:!0},this.$apollo.mutate({mutation:L`mutation($file: Upload!) {
            addFile(file: $file) {
              id
              mime
              name
              path
              previews
              updated_at
              editor
            }
          }`,variables:{file:e},context:{hasUpload:!0}}).then(d=>{var a;if(d.errors)throw d.errors;const f=((a=d.data)==null?void 0:a.addFile)||{};return f.previews=JSON.parse(f.previews)||{},delete f.__typename,this.handle(f,t)}).catch(d=>{this.messages.add(this.$gettext("Error adding file %{path}",{path:e.name})+`:
`+d,"error"),this.$log("File::addFile(): Error adding file",e,d)}).finally(()=>{this.selected=null})},handle(e,t){if(!(e!=null&&e.id)){this.$log("File::handle(): Invalid item without ID",e);return}return this.file={...e},this.$emit("addFile",e),this.$emit("update:modelValue",{id:e.id,type:"file"}),t!=null&&t.startsWith("blob:")&&URL.revokeObjectURL(t),e},open(e){this.openView(k,{item:e})},remove(){this.file.path.startsWith("blob:")&&URL.revokeObjectURL(this.file.path),this.file.id&&this.$emit("removeFile",this.file.id),this.$emit("update:modelValue",null),this.file={}},select(e){if(!Array.isArray(e)||!e.length){this.$log("File::select(): Items must be a non-empty array",e);return}const t=e.shift();this.file={...t},this.$emit("addFile",t),this.$emit("update:modelValue",{id:t.id,type:"file"})}},watch:{assets:{handler(e){!this.file.path&&this.modelValue&&e[this.modelValue.id]&&(this.file=e[this.modelValue.id]),this.$emit("error",!this.rules.every(t=>t(this.file)===!0))}},modelValue:{immediate:!0,handler(e){!this.file.path&&e&&this.assets[e.id]&&(this.file=this.assets[e.id]),this.$emit("error",!this.rules.every(t=>t(this.file)===!0))}}}},N=["title"],$={key:1,class:"file"};function P(e,t,d,f,a,m){const w=y("FileDialog"),x=y("FileUrlDialog");return u(),V(R,null,[l(h,null,{default:i(()=>[l(n,{cols:"12",md:"6"},{default:i(()=>[g("div",{class:D(["files",{readonly:d.readonly}])},[a.file.id?(u(),V("div",{key:0,class:"file",onClick:t[2]||(t[2]=s=>m.open(a.file)),title:e.$gettext("Edit")},[a.file.uploading?(u(),p(_,{key:0,color:"primary",height:"5",indeterminate:"",rounded:""})):c("",!0),t[11]||(t[11]=g("svg",{draggable:"false",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-file-earmark-binary",viewBox:"0 0 16 16"},[g("path",{d:"M7.05 11.885c0 1.415-.548 2.206-1.524 2.206C4.548 14.09 4 13.3 4 11.885c0-1.412.548-2.203 1.526-2.203.976 0 1.524.79 1.524 2.203m-1.524-1.612c-.542 0-.832.563-.832 1.612q0 .133.006.252l1.559-1.143c-.126-.474-.375-.72-.733-.72zm-.732 2.508c.126.472.372.718.732.718.54 0 .83-.563.83-1.614q0-.129-.006-.25zm6.061.624V14h-3v-.595h1.181V10.5h-.05l-1.136.747v-.688l1.19-.786h.69v3.633z"}),g("path",{d:"M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2M9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"})],-1)),r(" "+o(a.file.name)+" ",1),a.file.id&&!d.readonly?(u(),p(A,{key:1,location:"center"},{activator:i(({props:s})=>[l(v,M(s,{title:e.$gettext("Open menu"),icon:"mdi-dots-vertical",class:"btn-overlay",variant:"text",elevation:"0"}),null,16,["title"])]),default:i(()=>[l(B,null,{default:i(()=>[f.auth.can("file:view")?(u(),p(F,{key:0},{default:i(()=>[l(v,{onClick:t[0]||(t[0]=s=>m.open(a.file)),"prepend-icon":"mdi-pencil",variant:"text",elevation:"0"},{default:i(()=>[r(o(e.$gettext("Edit")),1)]),_:1})]),_:1})):c("",!0),l(F,null,{default:i(()=>[l(v,{onClick:t[1]||(t[1]=s=>m.remove()),"prepend-icon":"mdi-trash-can",variant:"text",elevation:"0"},{default:i(()=>[r(o(e.$gettext("Remove")),1)]),_:1})]),_:1})]),_:1})]),_:1})):c("",!0)],8,N)):d.readonly?c("",!0):(u(),V("div",$,[f.auth.can("file:view")?(u(),p(v,{key:0,onClick:t[3]||(t[3]=s=>a.vfiles=!0),title:e.$gettext("Add file"),icon:"mdi-button-cursor",variant:"text",elevation:"0"},null,8,["title"])):c("",!0),l(v,{onClick:t[4]||(t[4]=s=>a.vurls=!0),title:e.$gettext("Add file from URL"),icon:"mdi-link-variant-plus",variant:"text",elevation:"0"},null,8,["title"]),l(v,{title:e.$gettext("Upload file"),icon:"mdi-upload",variant:"text",elevation:"0"},{default:i(()=>[l(I,{modelValue:a.selected,"onUpdate:modelValue":[t[5]||(t[5]=s=>a.selected=s),t[6]||(t[6]=s=>m.add(s))],accept:d.config.accept||"*","hide-input":!0,"prepend-icon":"mdi-upload"},null,8,["modelValue","accept"])]),_:1},8,["title"])]))],2)]),_:1}),a.file.path?(u(),p(n,{key:0,cols:"12",md:"6",class:"meta"},{default:i(()=>[l(h,null,{default:i(()=>[l(n,{cols:"12",md:"3",class:"name"},{default:i(()=>[r(o(e.$gettext("name"))+":",1)]),_:1}),l(n,{cols:"12",md:"9"},{default:i(()=>[r(o(a.file.name),1)]),_:1})]),_:1}),l(h,null,{default:i(()=>[l(n,{cols:"12",md:"3",class:"name"},{default:i(()=>[r(o(e.$gettext("description"))+":",1)]),_:1}),l(n,{cols:"12",md:"9"},{default:i(()=>[r(o(m.description),1)]),_:1})]),_:1}),l(h,null,{default:i(()=>[l(n,{cols:"12",md:"3",class:"name"},{default:i(()=>[r(o(e.$gettext("mime"))+":",1)]),_:1}),l(n,{cols:"12",md:"9"},{default:i(()=>[r(o(a.file.mime),1)]),_:1})]),_:1}),l(h,null,{default:i(()=>[l(n,{cols:"12",md:"3",class:"name"},{default:i(()=>[r(o(e.$gettext("editor"))+":",1)]),_:1}),l(n,{cols:"12",md:"9"},{default:i(()=>[r(o(a.file.editor),1)]),_:1})]),_:1}),l(h,null,{default:i(()=>[l(n,{cols:"12",md:"3",class:"name"},{default:i(()=>[r(o(e.$gettext("updated"))+":",1)]),_:1}),l(n,{cols:"12",md:"9"},{default:i(()=>[r(o(new Date(a.file.updated_at).toLocaleString()),1)]),_:1})]),_:1})]),_:1})):c("",!0)]),_:1}),(u(),p(b,{to:"body"},[l(w,{modelValue:a.vfiles,"onUpdate:modelValue":t[7]||(t[7]=s=>a.vfiles=s),onAdd:t[8]||(t[8]=s=>{m.handle(s),a.vfiles=!1})},null,8,["modelValue"])])),(u(),p(b,{to:"body"},[l(x,{modelValue:a.vurls,"onUpdate:modelValue":t[9]||(t[9]=s=>a.vurls=s),onAdd:t[10]||(t[10]=s=>{m.select(s),a.vurls=!1})},null,8,["modelValue"])]))],64)}const X=U(E,[["render",P]]);export{X as default};
