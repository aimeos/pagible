import{l as U}from"./vue-draggable-plus-0RIXdDcg.js";import{_ as D,c as h,o as a,a as c,d as b,f as k,w as u,ac as E,F as f,a5 as _,b as p,k as v,r as P,ad as L,ae as I,t as x,af as M,ag as S,l as B,h as J,i as R,j as q,m as G,ah as W}from"./index-BhtgBCMu.js";const z={components:{VueDraggable:U},props:{modelValue:{type:Array},config:{type:Object,default:()=>{}},assets:{type:Object,default:()=>{}},readonly:{type:Boolean,default:!1},context:{type:Object}},emits:["update:modelValue","error","addFile","removeFile"],inject:["compose","translate","txlocales"],data(){return{translating:{},composing:{},errors:[],items:[],panel:[]}},computed:{rules(){return[t=>!this.config.max||this.config.max&&t.length<=this.config.max||this.$gettext("Maximum is %{num} entries",{num:this.config.max}),t=>(this.config.min??1)&&t.length>=(this.config.min??1)||this.$gettext("Minimum is %{num} entries",{num:this.config.min??1})]}},methods:{add(){this.items.push({}),this.panel.push(this.items.length-1),this.$emit("update:modelValue",this.items)},change(){this.$emit("update:modelValue",this.items)},composeText(t,e){var l,r,y,m,n,d,o,g,s,C,F,T,j,N,w,A;const i=['generate for field "'+(((r=(l=this.config.item)==null?void 0:l[e])==null?void 0:r.label)||e)+'"','required output format is "'+((m=(y=this.config.item)==null?void 0:y[e])==null?void 0:m.type)+'"',(d=(n=this.config.item)==null?void 0:n[e])!=null&&d.min?"minimum characters: "+((g=(o=this.config.item)==null?void 0:o[e])==null?void 0:g.min):null,(C=(s=this.config.item)==null?void 0:s[e])!=null&&C.max?"maximum characters: "+((T=(F=this.config.item)==null?void 0:F[e])==null?void 0:T.max):null,(N=(j=this.config.item)==null?void 0:j[e])!=null&&N.placeholder?"hint text: "+((A=(w=this.config.item)==null?void 0:w[e])==null?void 0:A.placeholder):null,"context information as JSON: "+JSON.stringify(this.items[t])],V=this.items[t][e]||(this.items[t].title?'Write a sentence about "'+this.items[t].title+'"':"");this.composing[t+e]=!0,this.compose(V,i).then(O=>{this.update(t,e,O)}).finally(()=>{this.composing[t+e]=!1})},remove(t){this.items.splice(t,1),this.$emit("update:modelValue",this.items)},title(t){return(t.title||t.text||Object.values(t||{}).map(e=>e&&typeof e!="object"&&typeof e!="boolean"?e:null).filter(e=>!!e).join(" - ")).substring(0,100)||""},toName(t){var e;return((e=t==null?void 0:t.charAt(0))==null?void 0:e.toUpperCase())+(t==null?void 0:t.slice(1))},translateText(t,e,i){this.translating[t+e]=!0,this.translate([this.items[t][e]],i).then(V=>{this.update(t,e,V[0]||"")}).finally(()=>{this.translating[t+e]=!1})},update(t,e,i){this.items[t]||(this.items[t]={}),this.items[t][e]=i,this.$emit("update:modelValue",this.items)}},watch:{modelValue:{immediate:!0,handler(t){this.items=Array.isArray(t)?t:this.config.default??[],this.$emit("error",!this.rules.every(e=>e(this.items)===!0))}}}},H={class:"element-title"},K={key:0,class:"actions"},Q={key:0,class:"v-input--error"},X={class:"v-input__details",role:"alert","aria-live":"polite"},Y={class:"v-messages"},Z={class:"btn-group"};function $(t,e,i,V,l,r){const y=P("VueDraggable");return a(),h(f,null,[c(E,{class:"items",modelValue:l.panel,"onUpdate:modelValue":e[4]||(e[4]=m=>l.panel=m),elevation:"0",multiple:""},{default:u(()=>[c(y,{modelValue:l.items,"onUpdate:modelValue":e[2]||(e[2]=m=>l.items=m),onUpdate:e[3]||(e[3]=m=>r.change()),disabled:i.readonly||l.panel.length,forceFallback:!0,fallbackTolerance:"10",draggable:".item",group:"items",animation:"500"},{default:u(()=>[(a(!0),h(f,null,_(l.items,(m,n)=>(a(),p(L,{key:n,class:"item"},{default:u(()=>[c(I,null,{default:u(()=>[i.readonly?b("",!0):(a(),p(v,{key:0,onClick:d=>r.remove(n),title:t.$gettext("Remove element"),icon:"mdi-trash-can",variant:"plain"},null,8,["onClick","title"])),k("div",H,x(r.title(m)),1)]),_:2},1024),c(M,null,{default:u(()=>[(a(!0),h(f,null,_(i.config.item||{},(d,o)=>{var g;return a(),h("div",{key:o,class:"field"},[c(S,null,{default:u(()=>[B(x(d.label||o)+" ",1),!i.readonly&&["markdown","plaintext","string","text"].includes(d.type)?(a(),h("div",K,[c(J,null,{activator:u(({props:s})=>[c(v,G({ref_for:!0},s,{title:t.$gettext("Translate %{code} field",{code:o}),loading:l.translating[n+o],icon:"mdi-translate",variant:"text",elevation:"0"}),null,16,["title","loading"])]),default:u(()=>[c(R,null,{default:u(()=>[(a(!0),h(f,null,_(r.txlocales(),s=>(a(),p(q,{key:s.code},{default:u(()=>[c(v,{onClick:C=>r.translateText(n,o,s.code),"prepend-icon":"mdi-arrow-right-thin",variant:"text"},{default:u(()=>[B(x(s.name),1)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1024),c(v,{title:t.$gettext("Generate text for %{code} field",{code:o}),loading:l.composing[n+o],onClick:s=>r.composeText(n,o),icon:"mdi-creation",variant:"text",elevation:"0"},null,8,["title","loading","onClick"])])):b("",!0)]),_:2},1024),(a(),p(W(r.toName(d.type)),{modelValue:((g=l.items[n])==null?void 0:g[o])??i.config.default??[],"onUpdate:modelValue":s=>r.update(n,o,s),onAddFile:e[0]||(e[0]=s=>t.$emit("addFile",s)),onRemoveFile:e[1]||(e[1]=s=>t.$emit("removeFile",s)),readonly:i.readonly,context:l.items[n],assets:i.assets,config:d},null,40,["modelValue","onUpdate:modelValue","readonly","context","assets","config"]))])}),128))]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue","disabled"])]),_:1},8,["modelValue"]),l.errors.length?(a(),h("div",Q,[k("div",X,[k("div",Y,[(a(!0),h(f,null,_(l.errors,(m,n)=>(a(),h("div",{key:n,class:"v-messages__message"},x(m),1))),128))])])])):b("",!0),k("div",Z,[!i.readonly&&(!i.config.max||i.config.max&&+l.items.length<+i.config.max)?(a(),p(v,{key:0,title:t.$gettext("Add element"),icon:"mdi-view-grid-plus",onClick:e[5]||(e[5]=m=>r.add())},null,8,["title"])):b("",!0)])],64)}const ie=D(z,[["render",$],["__scopeId","data-v-b5fb3c51"]]);export{ie as default};
