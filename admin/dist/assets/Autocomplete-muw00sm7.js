import{_ as a,L as n,b as u,o as c,M as d}from"./index-ChCAXbjI.js";const h={props:{modelValue:{type:[Object,String,Number,Boolean,null]},config:{type:Object,default:()=>{}},assets:{type:Object,default:()=>{}},readonly:{type:Boolean,default:!1},context:{type:Object}},emits:["update:modelValue","error"],inject:["debounce"],data(){return{list:this.config.options||[],loading:!1}},created(){this.graphql=this.debounce(this.graphql,500),this.rest=this.debounce(this.rest,500)},computed:{rules(){return[l=>!this.config.required||!!l||this.$gettext("Value is required")]}},methods:{get(l,t){return t.reduce((e,i)=>typeof e=="object"&&e!==null?e[i]:e,l)},graphql(l){var e;if(!((e=this.config)!=null&&e.query))return;const t=this.config.query.replace(/_term_/g,l?JSON.stringify(l):'""');this.loading=!0,this.$apollo.query({query:n`${t}`}).then(i=>{const s=this.toList(i.data).map(o=>{var r;return Object.assign({...o},JSON.parse(((r=o.latest)==null?void 0:r.data)||"{}"))});this.list=this.items(s),this.loading=!1}).catch(i=>{this.$log("Autocomplete::graphql(): Error fetching data",l,i)})},items(l){const t=this.config["item-title"].split("/"),e=this.config["item-value"].split("/");return(l||[]).map(i=>typeof i=="object"&&i!==null?t?{label:this.get(i,t),value:this.get(i,e)}:this.get(i,e):i)},rest(l){var t;(t=this.config)!=null&&t.url&&(this.loading=!0,fetch(this.config.url.replace(/_term_/g,l||""),{mode:"cors"}).then(e=>{if(!e.ok)throw e;return e.json()}).then(e=>{this.list=this.items(this.toList(e)),this.loading=!1}).catch(e=>{this.$log("Autocomplete::rest(): Error fetching data",l,e)}))},search(l){var t;switch((t=this.config)==null?void 0:t["api-type"]){case"GQL":this.graphql(l);break;case"REST":this.rest(l);break}},toList(l){return this.config["list-key"]?this.config["list-key"].split("/").reduce((t,e)=>typeof t=="object"&&t!==null?t[e]:t,l):l}},watch:{modelValue:{immediate:!0,handler(l){this.$emit("error",!this.rules.every(t=>t(l??this.config.default??null)===!0))}}}};function g(l,t,e,i,s,o){return c(),u(d,{rules:o.rules,items:s.list,loading:s.loading,readonly:e.readonly,clearable:!e.readonly,"no-data-text":s.loading?l.$gettext("Loading")+" ...":e.config["empty-text"]||l.$gettext("No data available"),placeholder:e.config.placeholder||"","return-object":!!e.config["item-title"],multiple:e.config.multiple,chips:e.config.multiple,modelValue:e.modelValue??e.config.default??null,"onUpdate:modelValue":t[0]||(t[0]=r=>l.$emit("update:modelValue",r)),"onUpdate:search":t[1]||(t[1]=r=>o.search(r)),"onUpdate:menu":t[2]||(t[2]=r=>o.search("")),density:"comfortable","hide-details":"auto",variant:"outlined","item-title":"label","item-value":"value"},null,8,["rules","items","loading","readonly","clearable","no-data-text","placeholder","return-object","multiple","chips","modelValue"])}const m=a(h,[["render",g]]);export{m as default};
