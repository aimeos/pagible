import{_ as Lt,L as W,a3 as Pt,b as T,o as v,w as f,ay as Re,a as c,az as Le,ac as ai,d as O,ad as Ht,ae as Wt,l as C,t as b,af as zt,aA as Yt,f as g,c as N,F as q,a5 as et,aB as ri,a6 as ne,aC as si,a4 as Pe,V as Ot,e as gt,I as Be,am as ni,k as w,h as Dt,i as xt,j as V,m as Ct,aD as Vt,ag as ge,aa as jt,ab as It,aE as qt,aF as At,a1 as ve,aG as oi,aH as li,aI as hi,r as Nt,T as di,aJ as ui,n as ht,Z as ci,aK as Gt,aL as fi,aM as be,aN as pi,aO as mi,aP as gi,a2 as vi}from"./index-Dw2ft2R6.js";import{u as bi,H as wi,A as yi}from"./utils-BwZpxNvT.js";const xi={props:{item:{type:Object,required:!0}},emits:[],data:()=>({panel:[0,1,2],versions:{},file:{}}),setup(){return{auth:Pt()}},watch:{item:{immediate:!0,handler(i){!i.id||!this.auth.can("file:view")||this.$apollo.query({query:W`query ($id: ID!) {
              file(id: $id) {
                id
                bypages {
                  id
                  path
                  name
                }
                byelements {
                  id
                  type
                  name
                }
                byversions {
                  id
                  versionable_id
                  versionable_type
                  published
                  publish_at
                }
              }
            }`,variables:{id:i.id}}).then(t=>{var e,a,s;if(t.errors)throw t.errors;this.file=((e=t.data)==null?void 0:e.file)||{},this.versions=(((s=(a=t.data)==null?void 0:a.file)==null?void 0:s.byversions)||[]).map(r=>({id:r.versionable_id,type:r.versionable_type.split("\\").at(-1),published:r.published?this.$gettext("yes"):r.publish_at?new Date(r.publish_at).toLocaleDateString():this.$gettext("no")})).filter(r=>this.auth.can(r.type.toLowerCase()+":view"))}).catch(t=>{this.$log("FileDetailRef::watch(item): Error fetching file",i,t)})}}}};function Di(i,t,e,a,s,r){return v(),T(Re,null,{default:f(()=>[c(Le,{class:"scroll"},{default:f(()=>[c(ai,{modelValue:i.panel,"onUpdate:modelValue":t[0]||(t[0]=n=>i.panel=n),elevation:"0",multiple:""},{default:f(()=>{var n,o,h;return[(n=i.file.bypages)!=null&&n.length&&a.auth.can("page:view")?(v(),T(Ht,{key:0},{default:f(()=>[c(Wt,null,{default:f(()=>[C(b(i.$gettext("Pages")),1)]),_:1}),c(zt,null,{default:f(()=>[c(Yt,{density:"comfortable",hover:""},{default:f(()=>[g("thead",null,[g("tr",null,[g("th",null,b(i.$gettext("ID")),1),g("th",null,b(i.$gettext("URL")),1),g("th",null,b(i.$gettext("Name")),1)])]),g("tbody",null,[(v(!0),N(q,null,et(i.file.bypages,u=>(v(),N("tr",{key:u.id},[g("td",null,b(u.id),1),g("td",null,b(u.path),1),g("td",null,b(u.name),1)]))),128))])]),_:1})]),_:1})]),_:1})):O("",!0),(o=i.file.byelements)!=null&&o.length&&a.auth.can("element:view")?(v(),T(Ht,{key:1},{default:f(()=>[c(Wt,null,{default:f(()=>[C(b(i.$gettext("Elements")),1)]),_:1}),c(zt,null,{default:f(()=>[c(Yt,{density:"comfortable",hover:""},{default:f(()=>[g("thead",null,[g("tr",null,[g("th",null,b(i.$gettext("ID")),1),g("th",null,b(i.$gettext("Type")),1),g("th",null,b(i.$gettext("Name")),1)])]),g("tbody",null,[(v(!0),N(q,null,et(i.file.byelements,u=>(v(),N("tr",{key:u.id},[g("td",null,b(u.id),1),g("td",null,b(u.type),1),g("td",null,b(u.name),1)]))),128))])]),_:1})]),_:1})]),_:1})):O("",!0),(h=i.versions)!=null&&h.length?(v(),T(Ht,{key:2},{default:f(()=>[c(Wt,null,{default:f(()=>[C(b(i.$gettext("Versions")),1)]),_:1}),c(zt,null,{default:f(()=>[c(Yt,{density:"comfortable",hover:""},{default:f(()=>[g("thead",null,[g("tr",null,[g("th",null,b(i.$gettext("ID")),1),g("th",null,b(i.$gettext("Type")),1),g("th",null,b(i.$gettext("Published")),1)])]),g("tbody",null,[(v(!0),N(q,null,et(i.versions,u=>(v(),N("tr",{key:u.id},[g("td",null,b(u.id),1),g("td",null,b(u.type),1),g("td",null,b(u.published),1)]))),128))])]),_:1})]),_:1})]),_:1})):O("",!0)]}),_:1},8,["modelValue"])]),_:1})]),_:1})}const Ci=Lt(xi,[["render",Di],["__scopeId","data-v-40aa6549"]]);/*!
 * Cropper.js v1.6.2
 * https://fengyuanchen.github.io/cropperjs
 *
 * Copyright 2015-present Chen Fengyuan
 * Released under the MIT license
 *
 * Date: 2024-04-21T07:43:05.335Z
 */function we(i,t){var e=Object.keys(i);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(i);t&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(i,s).enumerable})),e.push.apply(e,a)}return e}function _e(i){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?we(Object(e),!0).forEach(function(a){Mi(i,a,e[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(e)):we(Object(e)).forEach(function(a){Object.defineProperty(i,a,Object.getOwnPropertyDescriptor(e,a))})}return i}function Ei(i,t){if(typeof i!="object"||!i)return i;var e=i[Symbol.toPrimitive];if(e!==void 0){var a=e.call(i,t);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}function Ue(i){var t=Ei(i,"string");return typeof t=="symbol"?t:t+""}function Jt(i){"@babel/helpers - typeof";return Jt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Jt(i)}function ki(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function ye(i,t){for(var e=0;e<t.length;e++){var a=t[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(i,Ue(a.key),a)}}function Ti(i,t,e){return t&&ye(i.prototype,t),e&&ye(i,e),Object.defineProperty(i,"prototype",{writable:!1}),i}function Mi(i,t,e){return t=Ue(t),t in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}function He(i){return Oi(i)||Ni(i)||Si(i)||$i()}function Oi(i){if(Array.isArray(i))return Zt(i)}function Ni(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function Si(i,t){if(i){if(typeof i=="string")return Zt(i,t);var e=Object.prototype.toString.call(i).slice(8,-1);if(e==="Object"&&i.constructor&&(e=i.constructor.name),e==="Map"||e==="Set")return Array.from(i);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Zt(i,t)}}function Zt(i,t){(t==null||t>i.length)&&(t=i.length);for(var e=0,a=new Array(t);e<t;e++)a[e]=i[e];return a}function $i(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Bt=typeof window<"u"&&typeof window.document<"u",J=Bt?window:{},oe=Bt&&J.document.documentElement?"ontouchstart"in J.document.documentElement:!1,le=Bt?"PointerEvent"in J:!1,S="cropper",he="all",We="crop",ze="move",Ye="zoom",ot="e",lt="w",ut="s",tt="n",vt="ne",bt="nw",wt="se",yt="sw",Qt="".concat(S,"-crop"),xe="".concat(S,"-disabled"),H="".concat(S,"-hidden"),De="".concat(S,"-hide"),Vi="".concat(S,"-invisible"),Rt="".concat(S,"-modal"),Kt="".concat(S,"-move"),kt="".concat(S,"Action"),St="".concat(S,"Preview"),de="crop",Fe="move",Xe="none",te="crop",ee="cropend",ie="cropmove",ae="cropstart",Ce="dblclick",Ii=oe?"touchstart":"mousedown",Ai=oe?"touchmove":"mousemove",Ri=oe?"touchend touchcancel":"mouseup",Ee=le?"pointerdown":Ii,ke=le?"pointermove":Ai,Te=le?"pointerup pointercancel":Ri,Me="ready",Oe="resize",Ne="wheel",re="zoom",Se="image/jpeg",Li=/^e|w|s|n|se|sw|ne|nw|all|crop|move|zoom$/,Pi=/^data:/,Bi=/^data:image\/jpeg;base64,/,_i=/^img|canvas$/i,je=200,qe=100,$e={viewMode:0,dragMode:de,initialAspectRatio:NaN,aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:je,minContainerHeight:qe,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},Ui='<div class="cropper-container" touch-action="none"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-cropper-action="e"></span><span class="cropper-line line-n" data-cropper-action="n"></span><span class="cropper-line line-w" data-cropper-action="w"></span><span class="cropper-line line-s" data-cropper-action="s"></span><span class="cropper-point point-e" data-cropper-action="e"></span><span class="cropper-point point-n" data-cropper-action="n"></span><span class="cropper-point point-w" data-cropper-action="w"></span><span class="cropper-point point-s" data-cropper-action="s"></span><span class="cropper-point point-ne" data-cropper-action="ne"></span><span class="cropper-point point-nw" data-cropper-action="nw"></span><span class="cropper-point point-sw" data-cropper-action="sw"></span><span class="cropper-point point-se" data-cropper-action="se"></span></div></div>',Hi=Number.isNaN||J.isNaN;function D(i){return typeof i=="number"&&!Hi(i)}var Ve=function(t){return t>0&&t<1/0};function Ft(i){return typeof i>"u"}function dt(i){return Jt(i)==="object"&&i!==null}var Wi=Object.prototype.hasOwnProperty;function ct(i){if(!dt(i))return!1;try{var t=i.constructor,e=t.prototype;return t&&e&&Wi.call(e,"isPrototypeOf")}catch{return!1}}function U(i){return typeof i=="function"}var zi=Array.prototype.slice;function Ge(i){return Array.from?Array.from(i):zi.call(i)}function A(i,t){return i&&U(t)&&(Array.isArray(i)||D(i.length)?Ge(i).forEach(function(e,a){t.call(i,e,a,i)}):dt(i)&&Object.keys(i).forEach(function(e){t.call(i,i[e],e,i)})),i}var $=Object.assign||function(t){for(var e=arguments.length,a=new Array(e>1?e-1:0),s=1;s<e;s++)a[s-1]=arguments[s];return dt(t)&&a.length>0&&a.forEach(function(r){dt(r)&&Object.keys(r).forEach(function(n){t[n]=r[n]})}),t},Yi=/\.\d*(?:0|9){12}\d*$/;function pt(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e11;return Yi.test(i)?Math.round(i*t)/t:i}var Fi=/^width|height|left|top|marginLeft|marginTop$/;function it(i,t){var e=i.style;A(t,function(a,s){Fi.test(s)&&D(a)&&(a="".concat(a,"px")),e[s]=a})}function Xi(i,t){return i.classList?i.classList.contains(t):i.className.indexOf(t)>-1}function B(i,t){if(t){if(D(i.length)){A(i,function(a){B(a,t)});return}if(i.classList){i.classList.add(t);return}var e=i.className.trim();e?e.indexOf(t)<0&&(i.className="".concat(e," ").concat(t)):i.className=t}}function G(i,t){if(t){if(D(i.length)){A(i,function(e){G(e,t)});return}if(i.classList){i.classList.remove(t);return}i.className.indexOf(t)>=0&&(i.className=i.className.replace(t,""))}}function ft(i,t,e){if(t){if(D(i.length)){A(i,function(a){ft(a,t,e)});return}e?B(i,t):G(i,t)}}var ji=/([a-z\d])([A-Z])/g;function ue(i){return i.replace(ji,"$1-$2").toLowerCase()}function se(i,t){return dt(i[t])?i[t]:i.dataset?i.dataset[t]:i.getAttribute("data-".concat(ue(t)))}function Tt(i,t,e){dt(e)?i[t]=e:i.dataset?i.dataset[t]=e:i.setAttribute("data-".concat(ue(t)),e)}function qi(i,t){if(dt(i[t]))try{delete i[t]}catch{i[t]=void 0}else if(i.dataset)try{delete i.dataset[t]}catch{i.dataset[t]=void 0}else i.removeAttribute("data-".concat(ue(t)))}var Je=/\s\s*/,Ze=(function(){var i=!1;if(Bt){var t=!1,e=function(){},a=Object.defineProperty({},"once",{get:function(){return i=!0,t},set:function(r){t=r}});J.addEventListener("test",e,a),J.removeEventListener("test",e,a)}return i})();function X(i,t,e){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},s=e;t.trim().split(Je).forEach(function(r){if(!Ze){var n=i.listeners;n&&n[r]&&n[r][e]&&(s=n[r][e],delete n[r][e],Object.keys(n[r]).length===0&&delete n[r],Object.keys(n).length===0&&delete i.listeners)}i.removeEventListener(r,s,a)})}function F(i,t,e){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},s=e;t.trim().split(Je).forEach(function(r){if(a.once&&!Ze){var n=i.listeners,o=n===void 0?{}:n;s=function(){delete o[r][e],i.removeEventListener(r,s,a);for(var u=arguments.length,l=new Array(u),d=0;d<u;d++)l[d]=arguments[d];e.apply(i,l)},o[r]||(o[r]={}),o[r][e]&&i.removeEventListener(r,o[r][e],a),o[r][e]=s,i.listeners=o}i.addEventListener(r,s,a)})}function mt(i,t,e){var a;return U(Event)&&U(CustomEvent)?a=new CustomEvent(t,{detail:e,bubbles:!0,cancelable:!0}):(a=document.createEvent("CustomEvent"),a.initCustomEvent(t,!0,!0,e)),i.dispatchEvent(a)}function Qe(i){var t=i.getBoundingClientRect();return{left:t.left+(window.pageXOffset-document.documentElement.clientLeft),top:t.top+(window.pageYOffset-document.documentElement.clientTop)}}var Xt=J.location,Gi=/^(\w+:)\/\/([^:/?#]*):?(\d*)/i;function Ie(i){var t=i.match(Gi);return t!==null&&(t[1]!==Xt.protocol||t[2]!==Xt.hostname||t[3]!==Xt.port)}function Ae(i){var t="timestamp=".concat(new Date().getTime());return i+(i.indexOf("?")===-1?"?":"&")+t}function Et(i){var t=i.rotate,e=i.scaleX,a=i.scaleY,s=i.translateX,r=i.translateY,n=[];D(s)&&s!==0&&n.push("translateX(".concat(s,"px)")),D(r)&&r!==0&&n.push("translateY(".concat(r,"px)")),D(t)&&t!==0&&n.push("rotate(".concat(t,"deg)")),D(e)&&e!==1&&n.push("scaleX(".concat(e,")")),D(a)&&a!==1&&n.push("scaleY(".concat(a,")"));var o=n.length?n.join(" "):"none";return{WebkitTransform:o,msTransform:o,transform:o}}function Ji(i){var t=_e({},i),e=0;return A(i,function(a,s){delete t[s],A(t,function(r){var n=Math.abs(a.startX-r.startX),o=Math.abs(a.startY-r.startY),h=Math.abs(a.endX-r.endX),u=Math.abs(a.endY-r.endY),l=Math.sqrt(n*n+o*o),d=Math.sqrt(h*h+u*u),p=(d-l)/l;Math.abs(p)>Math.abs(e)&&(e=p)})}),e}function $t(i,t){var e=i.pageX,a=i.pageY,s={endX:e,endY:a};return t?s:_e({startX:e,startY:a},s)}function Zi(i){var t=0,e=0,a=0;return A(i,function(s){var r=s.startX,n=s.startY;t+=r,e+=n,a+=1}),t/=a,e/=a,{pageX:t,pageY:e}}function at(i){var t=i.aspectRatio,e=i.height,a=i.width,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"contain",r=Ve(a),n=Ve(e);if(r&&n){var o=e*t;s==="contain"&&o>a||s==="cover"&&o<a?e=a/t:a=e*t}else r?e=a/t:n&&(a=e*t);return{width:a,height:e}}function Qi(i){var t=i.width,e=i.height,a=i.degree;if(a=Math.abs(a)%180,a===90)return{width:e,height:t};var s=a%90*Math.PI/180,r=Math.sin(s),n=Math.cos(s),o=t*n+e*r,h=t*r+e*n;return a>90?{width:h,height:o}:{width:o,height:h}}function Ki(i,t,e,a){var s=t.aspectRatio,r=t.naturalWidth,n=t.naturalHeight,o=t.rotate,h=o===void 0?0:o,u=t.scaleX,l=u===void 0?1:u,d=t.scaleY,p=d===void 0?1:d,x=e.aspectRatio,y=e.naturalWidth,M=e.naturalHeight,E=a.fillColor,R=E===void 0?"transparent":E,P=a.imageSmoothingEnabled,I=P===void 0?!0:P,Z=a.imageSmoothingQuality,z=Z===void 0?"low":Z,m=a.maxWidth,k=m===void 0?1/0:m,L=a.maxHeight,Y=L===void 0?1/0:L,Q=a.minWidth,rt=Q===void 0?0:Q,st=a.minHeight,K=st===void 0?0:st,j=document.createElement("canvas"),_=j.getContext("2d"),nt=at({aspectRatio:x,width:k,height:Y}),Mt=at({aspectRatio:x,width:rt,height:K},"cover"),_t=Math.min(nt.width,Math.max(Mt.width,y)),Ut=Math.min(nt.height,Math.max(Mt.height,M)),ce=at({aspectRatio:s,width:k,height:Y}),fe=at({aspectRatio:s,width:rt,height:K},"cover"),pe=Math.min(ce.width,Math.max(fe.width,r)),me=Math.min(ce.height,Math.max(fe.height,n)),ei=[-pe/2,-me/2,pe,me];return j.width=pt(_t),j.height=pt(Ut),_.fillStyle=R,_.fillRect(0,0,_t,Ut),_.save(),_.translate(_t/2,Ut/2),_.rotate(h*Math.PI/180),_.scale(l,p),_.imageSmoothingEnabled=I,_.imageSmoothingQuality=z,_.drawImage.apply(_,[i].concat(He(ei.map(function(ii){return Math.floor(pt(ii))})))),_.restore(),j}var Ke=String.fromCharCode;function ta(i,t,e){var a="";e+=t;for(var s=t;s<e;s+=1)a+=Ke(i.getUint8(s));return a}var ea=/^data:.*,/;function ia(i){var t=i.replace(ea,""),e=atob(t),a=new ArrayBuffer(e.length),s=new Uint8Array(a);return A(s,function(r,n){s[n]=e.charCodeAt(n)}),a}function aa(i,t){for(var e=[],a=8192,s=new Uint8Array(i);s.length>0;)e.push(Ke.apply(null,Ge(s.subarray(0,a)))),s=s.subarray(a);return"data:".concat(t,";base64,").concat(btoa(e.join("")))}function ra(i){var t=new DataView(i),e;try{var a,s,r;if(t.getUint8(0)===255&&t.getUint8(1)===216)for(var n=t.byteLength,o=2;o+1<n;){if(t.getUint8(o)===255&&t.getUint8(o+1)===225){s=o;break}o+=1}if(s){var h=s+4,u=s+10;if(ta(t,h,4)==="Exif"){var l=t.getUint16(u);if(a=l===18761,(a||l===19789)&&t.getUint16(u+2,a)===42){var d=t.getUint32(u+4,a);d>=8&&(r=u+d)}}}if(r){var p=t.getUint16(r,a),x,y;for(y=0;y<p;y+=1)if(x=r+y*12+2,t.getUint16(x,a)===274){x+=8,e=t.getUint16(x,a),t.setUint16(x,1,a);break}}}catch{e=1}return e}function sa(i){var t=0,e=1,a=1;switch(i){case 2:e=-1;break;case 3:t=-180;break;case 4:a=-1;break;case 5:t=90,a=-1;break;case 6:t=90;break;case 7:t=90,e=-1;break;case 8:t=-90;break}return{rotate:t,scaleX:e,scaleY:a}}var na={render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var t=this.element,e=this.options,a=this.container,s=this.cropper,r=Number(e.minContainerWidth),n=Number(e.minContainerHeight);B(s,H),G(t,H);var o={width:Math.max(a.offsetWidth,r>=0?r:je),height:Math.max(a.offsetHeight,n>=0?n:qe)};this.containerData=o,it(s,{width:o.width,height:o.height}),B(t,H),G(s,H)},initCanvas:function(){var t=this.containerData,e=this.imageData,a=this.options.viewMode,s=Math.abs(e.rotate)%180===90,r=s?e.naturalHeight:e.naturalWidth,n=s?e.naturalWidth:e.naturalHeight,o=r/n,h=t.width,u=t.height;t.height*o>t.width?a===3?h=t.height*o:u=t.width/o:a===3?u=t.width/o:h=t.height*o;var l={aspectRatio:o,naturalWidth:r,naturalHeight:n,width:h,height:u};this.canvasData=l,this.limited=a===1||a===2,this.limitCanvas(!0,!0),l.width=Math.min(Math.max(l.width,l.minWidth),l.maxWidth),l.height=Math.min(Math.max(l.height,l.minHeight),l.maxHeight),l.left=(t.width-l.width)/2,l.top=(t.height-l.height)/2,l.oldLeft=l.left,l.oldTop=l.top,this.initialCanvasData=$({},l)},limitCanvas:function(t,e){var a=this.options,s=this.containerData,r=this.canvasData,n=this.cropBoxData,o=a.viewMode,h=r.aspectRatio,u=this.cropped&&n;if(t){var l=Number(a.minCanvasWidth)||0,d=Number(a.minCanvasHeight)||0;o>1?(l=Math.max(l,s.width),d=Math.max(d,s.height),o===3&&(d*h>l?l=d*h:d=l/h)):o>0&&(l?l=Math.max(l,u?n.width:0):d?d=Math.max(d,u?n.height:0):u&&(l=n.width,d=n.height,d*h>l?l=d*h:d=l/h));var p=at({aspectRatio:h,width:l,height:d});l=p.width,d=p.height,r.minWidth=l,r.minHeight=d,r.maxWidth=1/0,r.maxHeight=1/0}if(e)if(o>(u?0:1)){var x=s.width-r.width,y=s.height-r.height;r.minLeft=Math.min(0,x),r.minTop=Math.min(0,y),r.maxLeft=Math.max(0,x),r.maxTop=Math.max(0,y),u&&this.limited&&(r.minLeft=Math.min(n.left,n.left+(n.width-r.width)),r.minTop=Math.min(n.top,n.top+(n.height-r.height)),r.maxLeft=n.left,r.maxTop=n.top,o===2&&(r.width>=s.width&&(r.minLeft=Math.min(0,x),r.maxLeft=Math.max(0,x)),r.height>=s.height&&(r.minTop=Math.min(0,y),r.maxTop=Math.max(0,y))))}else r.minLeft=-r.width,r.minTop=-r.height,r.maxLeft=s.width,r.maxTop=s.height},renderCanvas:function(t,e){var a=this.canvasData,s=this.imageData;if(e){var r=Qi({width:s.naturalWidth*Math.abs(s.scaleX||1),height:s.naturalHeight*Math.abs(s.scaleY||1),degree:s.rotate||0}),n=r.width,o=r.height,h=a.width*(n/a.naturalWidth),u=a.height*(o/a.naturalHeight);a.left-=(h-a.width)/2,a.top-=(u-a.height)/2,a.width=h,a.height=u,a.aspectRatio=n/o,a.naturalWidth=n,a.naturalHeight=o,this.limitCanvas(!0,!1)}(a.width>a.maxWidth||a.width<a.minWidth)&&(a.left=a.oldLeft),(a.height>a.maxHeight||a.height<a.minHeight)&&(a.top=a.oldTop),a.width=Math.min(Math.max(a.width,a.minWidth),a.maxWidth),a.height=Math.min(Math.max(a.height,a.minHeight),a.maxHeight),this.limitCanvas(!1,!0),a.left=Math.min(Math.max(a.left,a.minLeft),a.maxLeft),a.top=Math.min(Math.max(a.top,a.minTop),a.maxTop),a.oldLeft=a.left,a.oldTop=a.top,it(this.canvas,$({width:a.width,height:a.height},Et({translateX:a.left,translateY:a.top}))),this.renderImage(t),this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage:function(t){var e=this.canvasData,a=this.imageData,s=a.naturalWidth*(e.width/e.naturalWidth),r=a.naturalHeight*(e.height/e.naturalHeight);$(a,{width:s,height:r,left:(e.width-s)/2,top:(e.height-r)/2}),it(this.image,$({width:a.width,height:a.height},Et($({translateX:a.left,translateY:a.top},a)))),t&&this.output()},initCropBox:function(){var t=this.options,e=this.canvasData,a=t.aspectRatio||t.initialAspectRatio,s=Number(t.autoCropArea)||.8,r={width:e.width,height:e.height};a&&(e.height*a>e.width?r.height=r.width/a:r.width=r.height*a),this.cropBoxData=r,this.limitCropBox(!0,!0),r.width=Math.min(Math.max(r.width,r.minWidth),r.maxWidth),r.height=Math.min(Math.max(r.height,r.minHeight),r.maxHeight),r.width=Math.max(r.minWidth,r.width*s),r.height=Math.max(r.minHeight,r.height*s),r.left=e.left+(e.width-r.width)/2,r.top=e.top+(e.height-r.height)/2,r.oldLeft=r.left,r.oldTop=r.top,this.initialCropBoxData=$({},r)},limitCropBox:function(t,e){var a=this.options,s=this.containerData,r=this.canvasData,n=this.cropBoxData,o=this.limited,h=a.aspectRatio;if(t){var u=Number(a.minCropBoxWidth)||0,l=Number(a.minCropBoxHeight)||0,d=o?Math.min(s.width,r.width,r.width+r.left,s.width-r.left):s.width,p=o?Math.min(s.height,r.height,r.height+r.top,s.height-r.top):s.height;u=Math.min(u,s.width),l=Math.min(l,s.height),h&&(u&&l?l*h>u?l=u/h:u=l*h:u?l=u/h:l&&(u=l*h),p*h>d?p=d/h:d=p*h),n.minWidth=Math.min(u,d),n.minHeight=Math.min(l,p),n.maxWidth=d,n.maxHeight=p}e&&(o?(n.minLeft=Math.max(0,r.left),n.minTop=Math.max(0,r.top),n.maxLeft=Math.min(s.width,r.left+r.width)-n.width,n.maxTop=Math.min(s.height,r.top+r.height)-n.height):(n.minLeft=0,n.minTop=0,n.maxLeft=s.width-n.width,n.maxTop=s.height-n.height))},renderCropBox:function(){var t=this.options,e=this.containerData,a=this.cropBoxData;(a.width>a.maxWidth||a.width<a.minWidth)&&(a.left=a.oldLeft),(a.height>a.maxHeight||a.height<a.minHeight)&&(a.top=a.oldTop),a.width=Math.min(Math.max(a.width,a.minWidth),a.maxWidth),a.height=Math.min(Math.max(a.height,a.minHeight),a.maxHeight),this.limitCropBox(!1,!0),a.left=Math.min(Math.max(a.left,a.minLeft),a.maxLeft),a.top=Math.min(Math.max(a.top,a.minTop),a.maxTop),a.oldLeft=a.left,a.oldTop=a.top,t.movable&&t.cropBoxMovable&&Tt(this.face,kt,a.width>=e.width&&a.height>=e.height?ze:he),it(this.cropBox,$({width:a.width,height:a.height},Et({translateX:a.left,translateY:a.top}))),this.cropped&&this.limited&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),mt(this.element,te,this.getData())}},oa={initPreview:function(){var t=this.element,e=this.crossOrigin,a=this.options.preview,s=e?this.crossOriginUrl:this.url,r=t.alt||"The image to preview",n=document.createElement("img");if(e&&(n.crossOrigin=e),n.src=s,n.alt=r,this.viewBox.appendChild(n),this.viewBoxImage=n,!!a){var o=a;typeof a=="string"?o=t.ownerDocument.querySelectorAll(a):a.querySelector&&(o=[a]),this.previews=o,A(o,function(h){var u=document.createElement("img");Tt(h,St,{width:h.offsetWidth,height:h.offsetHeight,html:h.innerHTML}),e&&(u.crossOrigin=e),u.src=s,u.alt=r,u.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"',h.innerHTML="",h.appendChild(u)})}},resetPreview:function(){A(this.previews,function(t){var e=se(t,St);it(t,{width:e.width,height:e.height}),t.innerHTML=e.html,qi(t,St)})},preview:function(){var t=this.imageData,e=this.canvasData,a=this.cropBoxData,s=a.width,r=a.height,n=t.width,o=t.height,h=a.left-e.left-t.left,u=a.top-e.top-t.top;!this.cropped||this.disabled||(it(this.viewBoxImage,$({width:n,height:o},Et($({translateX:-h,translateY:-u},t)))),A(this.previews,function(l){var d=se(l,St),p=d.width,x=d.height,y=p,M=x,E=1;s&&(E=p/s,M=r*E),r&&M>x&&(E=x/r,y=s*E,M=x),it(l,{width:y,height:M}),it(l.getElementsByTagName("img")[0],$({width:n*E,height:o*E},Et($({translateX:-h*E,translateY:-u*E},t))))}))}},la={bind:function(){var t=this.element,e=this.options,a=this.cropper;U(e.cropstart)&&F(t,ae,e.cropstart),U(e.cropmove)&&F(t,ie,e.cropmove),U(e.cropend)&&F(t,ee,e.cropend),U(e.crop)&&F(t,te,e.crop),U(e.zoom)&&F(t,re,e.zoom),F(a,Ee,this.onCropStart=this.cropStart.bind(this)),e.zoomable&&e.zoomOnWheel&&F(a,Ne,this.onWheel=this.wheel.bind(this),{passive:!1,capture:!0}),e.toggleDragModeOnDblclick&&F(a,Ce,this.onDblclick=this.dblclick.bind(this)),F(t.ownerDocument,ke,this.onCropMove=this.cropMove.bind(this)),F(t.ownerDocument,Te,this.onCropEnd=this.cropEnd.bind(this)),e.responsive&&F(window,Oe,this.onResize=this.resize.bind(this))},unbind:function(){var t=this.element,e=this.options,a=this.cropper;U(e.cropstart)&&X(t,ae,e.cropstart),U(e.cropmove)&&X(t,ie,e.cropmove),U(e.cropend)&&X(t,ee,e.cropend),U(e.crop)&&X(t,te,e.crop),U(e.zoom)&&X(t,re,e.zoom),X(a,Ee,this.onCropStart),e.zoomable&&e.zoomOnWheel&&X(a,Ne,this.onWheel,{passive:!1,capture:!0}),e.toggleDragModeOnDblclick&&X(a,Ce,this.onDblclick),X(t.ownerDocument,ke,this.onCropMove),X(t.ownerDocument,Te,this.onCropEnd),e.responsive&&X(window,Oe,this.onResize)}},ha={resize:function(){if(!this.disabled){var t=this.options,e=this.container,a=this.containerData,s=e.offsetWidth/a.width,r=e.offsetHeight/a.height,n=Math.abs(s-1)>Math.abs(r-1)?s:r;if(n!==1){var o,h;t.restore&&(o=this.getCanvasData(),h=this.getCropBoxData()),this.render(),t.restore&&(this.setCanvasData(A(o,function(u,l){o[l]=u*n})),this.setCropBoxData(A(h,function(u,l){h[l]=u*n})))}}},dblclick:function(){this.disabled||this.options.dragMode===Xe||this.setDragMode(Xi(this.dragBox,Qt)?Fe:de)},wheel:function(t){var e=this,a=Number(this.options.wheelZoomRatio)||.1,s=1;this.disabled||(t.preventDefault(),!this.wheeling&&(this.wheeling=!0,setTimeout(function(){e.wheeling=!1},50),t.deltaY?s=t.deltaY>0?1:-1:t.wheelDelta?s=-t.wheelDelta/120:t.detail&&(s=t.detail>0?1:-1),this.zoom(-s*a,t)))},cropStart:function(t){var e=t.buttons,a=t.button;if(!(this.disabled||(t.type==="mousedown"||t.type==="pointerdown"&&t.pointerType==="mouse")&&(D(e)&&e!==1||D(a)&&a!==0||t.ctrlKey))){var s=this.options,r=this.pointers,n;t.changedTouches?A(t.changedTouches,function(o){r[o.identifier]=$t(o)}):r[t.pointerId||0]=$t(t),Object.keys(r).length>1&&s.zoomable&&s.zoomOnTouch?n=Ye:n=se(t.target,kt),Li.test(n)&&mt(this.element,ae,{originalEvent:t,action:n})!==!1&&(t.preventDefault(),this.action=n,this.cropping=!1,n===We&&(this.cropping=!0,B(this.dragBox,Rt)))}},cropMove:function(t){var e=this.action;if(!(this.disabled||!e)){var a=this.pointers;t.preventDefault(),mt(this.element,ie,{originalEvent:t,action:e})!==!1&&(t.changedTouches?A(t.changedTouches,function(s){$(a[s.identifier]||{},$t(s,!0))}):$(a[t.pointerId||0]||{},$t(t,!0)),this.change(t))}},cropEnd:function(t){if(!this.disabled){var e=this.action,a=this.pointers;t.changedTouches?A(t.changedTouches,function(s){delete a[s.identifier]}):delete a[t.pointerId||0],e&&(t.preventDefault(),Object.keys(a).length||(this.action=""),this.cropping&&(this.cropping=!1,ft(this.dragBox,Rt,this.cropped&&this.options.modal)),mt(this.element,ee,{originalEvent:t,action:e}))}}},da={change:function(t){var e=this.options,a=this.canvasData,s=this.containerData,r=this.cropBoxData,n=this.pointers,o=this.action,h=e.aspectRatio,u=r.left,l=r.top,d=r.width,p=r.height,x=u+d,y=l+p,M=0,E=0,R=s.width,P=s.height,I=!0,Z;!h&&t.shiftKey&&(h=d&&p?d/p:1),this.limited&&(M=r.minLeft,E=r.minTop,R=M+Math.min(s.width,a.width,a.left+a.width),P=E+Math.min(s.height,a.height,a.top+a.height));var z=n[Object.keys(n)[0]],m={x:z.endX-z.startX,y:z.endY-z.startY},k=function(Y){switch(Y){case ot:x+m.x>R&&(m.x=R-x);break;case lt:u+m.x<M&&(m.x=M-u);break;case tt:l+m.y<E&&(m.y=E-l);break;case ut:y+m.y>P&&(m.y=P-y);break}};switch(o){case he:u+=m.x,l+=m.y;break;case ot:if(m.x>=0&&(x>=R||h&&(l<=E||y>=P))){I=!1;break}k(ot),d+=m.x,d<0&&(o=lt,d=-d,u-=d),h&&(p=d/h,l+=(r.height-p)/2);break;case tt:if(m.y<=0&&(l<=E||h&&(u<=M||x>=R))){I=!1;break}k(tt),p-=m.y,l+=m.y,p<0&&(o=ut,p=-p,l-=p),h&&(d=p*h,u+=(r.width-d)/2);break;case lt:if(m.x<=0&&(u<=M||h&&(l<=E||y>=P))){I=!1;break}k(lt),d-=m.x,u+=m.x,d<0&&(o=ot,d=-d,u-=d),h&&(p=d/h,l+=(r.height-p)/2);break;case ut:if(m.y>=0&&(y>=P||h&&(u<=M||x>=R))){I=!1;break}k(ut),p+=m.y,p<0&&(o=tt,p=-p,l-=p),h&&(d=p*h,u+=(r.width-d)/2);break;case vt:if(h){if(m.y<=0&&(l<=E||x>=R)){I=!1;break}k(tt),p-=m.y,l+=m.y,d=p*h}else k(tt),k(ot),m.x>=0?x<R?d+=m.x:m.y<=0&&l<=E&&(I=!1):d+=m.x,m.y<=0?l>E&&(p-=m.y,l+=m.y):(p-=m.y,l+=m.y);d<0&&p<0?(o=yt,p=-p,d=-d,l-=p,u-=d):d<0?(o=bt,d=-d,u-=d):p<0&&(o=wt,p=-p,l-=p);break;case bt:if(h){if(m.y<=0&&(l<=E||u<=M)){I=!1;break}k(tt),p-=m.y,l+=m.y,d=p*h,u+=r.width-d}else k(tt),k(lt),m.x<=0?u>M?(d-=m.x,u+=m.x):m.y<=0&&l<=E&&(I=!1):(d-=m.x,u+=m.x),m.y<=0?l>E&&(p-=m.y,l+=m.y):(p-=m.y,l+=m.y);d<0&&p<0?(o=wt,p=-p,d=-d,l-=p,u-=d):d<0?(o=vt,d=-d,u-=d):p<0&&(o=yt,p=-p,l-=p);break;case yt:if(h){if(m.x<=0&&(u<=M||y>=P)){I=!1;break}k(lt),d-=m.x,u+=m.x,p=d/h}else k(ut),k(lt),m.x<=0?u>M?(d-=m.x,u+=m.x):m.y>=0&&y>=P&&(I=!1):(d-=m.x,u+=m.x),m.y>=0?y<P&&(p+=m.y):p+=m.y;d<0&&p<0?(o=vt,p=-p,d=-d,l-=p,u-=d):d<0?(o=wt,d=-d,u-=d):p<0&&(o=bt,p=-p,l-=p);break;case wt:if(h){if(m.x>=0&&(x>=R||y>=P)){I=!1;break}k(ot),d+=m.x,p=d/h}else k(ut),k(ot),m.x>=0?x<R?d+=m.x:m.y>=0&&y>=P&&(I=!1):d+=m.x,m.y>=0?y<P&&(p+=m.y):p+=m.y;d<0&&p<0?(o=bt,p=-p,d=-d,l-=p,u-=d):d<0?(o=yt,d=-d,u-=d):p<0&&(o=vt,p=-p,l-=p);break;case ze:this.move(m.x,m.y),I=!1;break;case Ye:this.zoom(Ji(n),t),I=!1;break;case We:if(!m.x||!m.y){I=!1;break}Z=Qe(this.cropper),u=z.startX-Z.left,l=z.startY-Z.top,d=r.minWidth,p=r.minHeight,m.x>0?o=m.y>0?wt:vt:m.x<0&&(u-=d,o=m.y>0?yt:bt),m.y<0&&(l-=p),this.cropped||(G(this.cropBox,H),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0));break}I&&(r.width=d,r.height=p,r.left=u,r.top=l,this.action=o,this.renderCropBox()),A(n,function(L){L.startX=L.endX,L.startY=L.endY})}},ua={crop:function(){return this.ready&&!this.cropped&&!this.disabled&&(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&B(this.dragBox,Rt),G(this.cropBox,H),this.setCropBoxData(this.initialCropBoxData)),this},reset:function(){return this.ready&&!this.disabled&&(this.imageData=$({},this.initialImageData),this.canvasData=$({},this.initialCanvasData),this.cropBoxData=$({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox()),this},clear:function(){return this.cropped&&!this.disabled&&($(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),G(this.dragBox,Rt),B(this.cropBox,H)),this},replace:function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return!this.disabled&&t&&(this.isImg&&(this.element.src=t),e?(this.url=t,this.image.src=t,this.ready&&(this.viewBoxImage.src=t,A(this.previews,function(a){a.getElementsByTagName("img")[0].src=t}))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.uncreate(),this.load(t))),this},enable:function(){return this.ready&&this.disabled&&(this.disabled=!1,G(this.cropper,xe)),this},disable:function(){return this.ready&&!this.disabled&&(this.disabled=!0,B(this.cropper,xe)),this},destroy:function(){var t=this.element;return t[S]?(t[S]=void 0,this.isImg&&this.replaced&&(t.src=this.originalUrl),this.uncreate(),this):this},move:function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,a=this.canvasData,s=a.left,r=a.top;return this.moveTo(Ft(t)?t:s+Number(t),Ft(e)?e:r+Number(e))},moveTo:function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,a=this.canvasData,s=!1;return t=Number(t),e=Number(e),this.ready&&!this.disabled&&this.options.movable&&(D(t)&&(a.left=t,s=!0),D(e)&&(a.top=e,s=!0),s&&this.renderCanvas(!0)),this},zoom:function(t,e){var a=this.canvasData;return t=Number(t),t<0?t=1/(1-t):t=1+t,this.zoomTo(a.width*t/a.naturalWidth,null,e)},zoomTo:function(t,e,a){var s=this.options,r=this.canvasData,n=r.width,o=r.height,h=r.naturalWidth,u=r.naturalHeight;if(t=Number(t),t>=0&&this.ready&&!this.disabled&&s.zoomable){var l=h*t,d=u*t;if(mt(this.element,re,{ratio:t,oldRatio:n/h,originalEvent:a})===!1)return this;if(a){var p=this.pointers,x=Qe(this.cropper),y=p&&Object.keys(p).length?Zi(p):{pageX:a.pageX,pageY:a.pageY};r.left-=(l-n)*((y.pageX-x.left-r.left)/n),r.top-=(d-o)*((y.pageY-x.top-r.top)/o)}else ct(e)&&D(e.x)&&D(e.y)?(r.left-=(l-n)*((e.x-r.left)/n),r.top-=(d-o)*((e.y-r.top)/o)):(r.left-=(l-n)/2,r.top-=(d-o)/2);r.width=l,r.height=d,this.renderCanvas(!0)}return this},rotate:function(t){return this.rotateTo((this.imageData.rotate||0)+Number(t))},rotateTo:function(t){return t=Number(t),D(t)&&this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=t%360,this.renderCanvas(!0,!0)),this},scaleX:function(t){var e=this.imageData.scaleY;return this.scale(t,D(e)?e:1)},scaleY:function(t){var e=this.imageData.scaleX;return this.scale(D(e)?e:1,t)},scale:function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,a=this.imageData,s=!1;return t=Number(t),e=Number(e),this.ready&&!this.disabled&&this.options.scalable&&(D(t)&&(a.scaleX=t,s=!0),D(e)&&(a.scaleY=e,s=!0),s&&this.renderCanvas(!0,!0)),this},getData:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,e=this.options,a=this.imageData,s=this.canvasData,r=this.cropBoxData,n;if(this.ready&&this.cropped){n={x:r.left-s.left,y:r.top-s.top,width:r.width,height:r.height};var o=a.width/a.naturalWidth;if(A(n,function(l,d){n[d]=l/o}),t){var h=Math.round(n.y+n.height),u=Math.round(n.x+n.width);n.x=Math.round(n.x),n.y=Math.round(n.y),n.width=u-n.x,n.height=h-n.y}}else n={x:0,y:0,width:0,height:0};return e.rotatable&&(n.rotate=a.rotate||0),e.scalable&&(n.scaleX=a.scaleX||1,n.scaleY=a.scaleY||1),n},setData:function(t){var e=this.options,a=this.imageData,s=this.canvasData,r={};if(this.ready&&!this.disabled&&ct(t)){var n=!1;e.rotatable&&D(t.rotate)&&t.rotate!==a.rotate&&(a.rotate=t.rotate,n=!0),e.scalable&&(D(t.scaleX)&&t.scaleX!==a.scaleX&&(a.scaleX=t.scaleX,n=!0),D(t.scaleY)&&t.scaleY!==a.scaleY&&(a.scaleY=t.scaleY,n=!0)),n&&this.renderCanvas(!0,!0);var o=a.width/a.naturalWidth;D(t.x)&&(r.left=t.x*o+s.left),D(t.y)&&(r.top=t.y*o+s.top),D(t.width)&&(r.width=t.width*o),D(t.height)&&(r.height=t.height*o),this.setCropBoxData(r)}return this},getContainerData:function(){return this.ready?$({},this.containerData):{}},getImageData:function(){return this.sized?$({},this.imageData):{}},getCanvasData:function(){var t=this.canvasData,e={};return this.ready&&A(["left","top","width","height","naturalWidth","naturalHeight"],function(a){e[a]=t[a]}),e},setCanvasData:function(t){var e=this.canvasData,a=e.aspectRatio;return this.ready&&!this.disabled&&ct(t)&&(D(t.left)&&(e.left=t.left),D(t.top)&&(e.top=t.top),D(t.width)?(e.width=t.width,e.height=t.width/a):D(t.height)&&(e.height=t.height,e.width=t.height*a),this.renderCanvas(!0)),this},getCropBoxData:function(){var t=this.cropBoxData,e;return this.ready&&this.cropped&&(e={left:t.left,top:t.top,width:t.width,height:t.height}),e||{}},setCropBoxData:function(t){var e=this.cropBoxData,a=this.options.aspectRatio,s,r;return this.ready&&this.cropped&&!this.disabled&&ct(t)&&(D(t.left)&&(e.left=t.left),D(t.top)&&(e.top=t.top),D(t.width)&&t.width!==e.width&&(s=!0,e.width=t.width),D(t.height)&&t.height!==e.height&&(r=!0,e.height=t.height),a&&(s?e.height=e.width/a:r&&(e.width=e.height*a)),this.renderCropBox()),this},getCroppedCanvas:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!this.ready||!window.HTMLCanvasElement)return null;var e=this.canvasData,a=Ki(this.image,this.imageData,e,t);if(!this.cropped)return a;var s=this.getData(t.rounded),r=s.x,n=s.y,o=s.width,h=s.height,u=a.width/Math.floor(e.naturalWidth);u!==1&&(r*=u,n*=u,o*=u,h*=u);var l=o/h,d=at({aspectRatio:l,width:t.maxWidth||1/0,height:t.maxHeight||1/0}),p=at({aspectRatio:l,width:t.minWidth||0,height:t.minHeight||0},"cover"),x=at({aspectRatio:l,width:t.width||(u!==1?a.width:o),height:t.height||(u!==1?a.height:h)}),y=x.width,M=x.height;y=Math.min(d.width,Math.max(p.width,y)),M=Math.min(d.height,Math.max(p.height,M));var E=document.createElement("canvas"),R=E.getContext("2d");E.width=pt(y),E.height=pt(M),R.fillStyle=t.fillColor||"transparent",R.fillRect(0,0,y,M);var P=t.imageSmoothingEnabled,I=P===void 0?!0:P,Z=t.imageSmoothingQuality;R.imageSmoothingEnabled=I,Z&&(R.imageSmoothingQuality=Z);var z=a.width,m=a.height,k=r,L=n,Y,Q,rt,st,K,j;k<=-o||k>z?(k=0,Y=0,rt=0,K=0):k<=0?(rt=-k,k=0,Y=Math.min(z,o+k),K=Y):k<=z&&(rt=0,Y=Math.min(o,z-k),K=Y),Y<=0||L<=-h||L>m?(L=0,Q=0,st=0,j=0):L<=0?(st=-L,L=0,Q=Math.min(m,h+L),j=Q):L<=m&&(st=0,Q=Math.min(h,m-L),j=Q);var _=[k,L,Y,Q];if(K>0&&j>0){var nt=y/o;_.push(rt*nt,st*nt,K*nt,j*nt)}return R.drawImage.apply(R,[a].concat(He(_.map(function(Mt){return Math.floor(pt(Mt))})))),E},setAspectRatio:function(t){var e=this.options;return!this.disabled&&!Ft(t)&&(e.aspectRatio=Math.max(0,t)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox())),this},setDragMode:function(t){var e=this.options,a=this.dragBox,s=this.face;if(this.ready&&!this.disabled){var r=t===de,n=e.movable&&t===Fe;t=r||n?t:Xe,e.dragMode=t,Tt(a,kt,t),ft(a,Qt,r),ft(a,Kt,n),e.cropBoxMovable||(Tt(s,kt,t),ft(s,Qt,r),ft(s,Kt,n))}return this}},ca=J.Cropper,ti=(function(){function i(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(ki(this,i),!t||!_i.test(t.tagName))throw new Error("The first argument is required and must be an <img> or <canvas> element.");this.element=t,this.options=$({},$e,ct(e)&&e),this.cropped=!1,this.disabled=!1,this.pointers={},this.ready=!1,this.reloading=!1,this.replaced=!1,this.sized=!1,this.sizing=!1,this.init()}return Ti(i,[{key:"init",value:function(){var e=this.element,a=e.tagName.toLowerCase(),s;if(!e[S]){if(e[S]=this,a==="img"){if(this.isImg=!0,s=e.getAttribute("src")||"",this.originalUrl=s,!s)return;s=e.src}else a==="canvas"&&window.HTMLCanvasElement&&(s=e.toDataURL());this.load(s)}}},{key:"load",value:function(e){var a=this;if(e){this.url=e,this.imageData={};var s=this.element,r=this.options;if(!r.rotatable&&!r.scalable&&(r.checkOrientation=!1),!r.checkOrientation||!window.ArrayBuffer){this.clone();return}if(Pi.test(e)){Bi.test(e)?this.read(ia(e)):this.clone();return}var n=new XMLHttpRequest,o=this.clone.bind(this);this.reloading=!0,this.xhr=n,n.onabort=o,n.onerror=o,n.ontimeout=o,n.onprogress=function(){n.getResponseHeader("content-type")!==Se&&n.abort()},n.onload=function(){a.read(n.response)},n.onloadend=function(){a.reloading=!1,a.xhr=null},r.checkCrossOrigin&&Ie(e)&&s.crossOrigin&&(e=Ae(e)),n.open("GET",e,!0),n.responseType="arraybuffer",n.withCredentials=s.crossOrigin==="use-credentials",n.send()}}},{key:"read",value:function(e){var a=this.options,s=this.imageData,r=ra(e),n=0,o=1,h=1;if(r>1){this.url=aa(e,Se);var u=sa(r);n=u.rotate,o=u.scaleX,h=u.scaleY}a.rotatable&&(s.rotate=n),a.scalable&&(s.scaleX=o,s.scaleY=h),this.clone()}},{key:"clone",value:function(){var e=this.element,a=this.url,s=e.crossOrigin,r=a;this.options.checkCrossOrigin&&Ie(a)&&(s||(s="anonymous"),r=Ae(a)),this.crossOrigin=s,this.crossOriginUrl=r;var n=document.createElement("img");s&&(n.crossOrigin=s),n.src=r||a,n.alt=e.alt||"The image to crop",this.image=n,n.onload=this.start.bind(this),n.onerror=this.stop.bind(this),B(n,De),e.parentNode.insertBefore(n,e.nextSibling)}},{key:"start",value:function(){var e=this,a=this.image;a.onload=null,a.onerror=null,this.sizing=!0;var s=J.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(J.navigator.userAgent),r=function(u,l){$(e.imageData,{naturalWidth:u,naturalHeight:l,aspectRatio:u/l}),e.initialImageData=$({},e.imageData),e.sizing=!1,e.sized=!0,e.build()};if(a.naturalWidth&&!s){r(a.naturalWidth,a.naturalHeight);return}var n=document.createElement("img"),o=document.body||document.documentElement;this.sizingImage=n,n.onload=function(){r(n.width,n.height),s||o.removeChild(n)},n.src=a.src,s||(n.style.cssText="left:0;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;opacity:0;position:absolute;top:0;z-index:-1;",o.appendChild(n))}},{key:"stop",value:function(){var e=this.image;e.onload=null,e.onerror=null,e.parentNode.removeChild(e),this.image=null}},{key:"build",value:function(){if(!(!this.sized||this.ready)){var e=this.element,a=this.options,s=this.image,r=e.parentNode,n=document.createElement("div");n.innerHTML=Ui;var o=n.querySelector(".".concat(S,"-container")),h=o.querySelector(".".concat(S,"-canvas")),u=o.querySelector(".".concat(S,"-drag-box")),l=o.querySelector(".".concat(S,"-crop-box")),d=l.querySelector(".".concat(S,"-face"));this.container=r,this.cropper=o,this.canvas=h,this.dragBox=u,this.cropBox=l,this.viewBox=o.querySelector(".".concat(S,"-view-box")),this.face=d,h.appendChild(s),B(e,H),r.insertBefore(o,e.nextSibling),G(s,De),this.initPreview(),this.bind(),a.initialAspectRatio=Math.max(0,a.initialAspectRatio)||NaN,a.aspectRatio=Math.max(0,a.aspectRatio)||NaN,a.viewMode=Math.max(0,Math.min(3,Math.round(a.viewMode)))||0,B(l,H),a.guides||B(l.getElementsByClassName("".concat(S,"-dashed")),H),a.center||B(l.getElementsByClassName("".concat(S,"-center")),H),a.background&&B(o,"".concat(S,"-bg")),a.highlight||B(d,Vi),a.cropBoxMovable&&(B(d,Kt),Tt(d,kt,he)),a.cropBoxResizable||(B(l.getElementsByClassName("".concat(S,"-line")),H),B(l.getElementsByClassName("".concat(S,"-point")),H)),this.render(),this.ready=!0,this.setDragMode(a.dragMode),a.autoCrop&&this.crop(),this.setData(a.data),U(a.ready)&&F(e,Me,a.ready,{once:!0}),mt(e,Me)}}},{key:"unbuild",value:function(){if(this.ready){this.ready=!1,this.unbind(),this.resetPreview();var e=this.cropper.parentNode;e&&e.removeChild(this.cropper),G(this.element,H)}}},{key:"uncreate",value:function(){this.ready?(this.unbuild(),this.ready=!1,this.cropped=!1):this.sizing?(this.sizingImage.onload=null,this.sizing=!1,this.sized=!1):this.reloading?(this.xhr.onabort=null,this.xhr.abort()):this.image&&this.stop()}}],[{key:"noConflict",value:function(){return window.Cropper=ca,i}},{key:"setDefaults",value:function(e){$($e,ct(e)&&e)}}])})();$(ti.prototype,na,oa,la,ha,da,ua);const fa={props:{item:{type:Object,required:!0},save:{type:Object,required:!0}},emits:["update:item","update:file","error"],inject:["compose","locales","translate","txlocales","url"],data(){return{transcribing:!1,translating:!1,composing:!1,cropping:!1,covering:!1,tabtrans:null,tabdesc:null,cropper:null,cropLabel:null,scaleX:1,scaleY:1}},setup(){const i=ri(),t=ne(),e=si(),a=Pt();return{app:Pe(),auth:a,languages:i,messages:t,side:e}},mounted(){this.init()},beforeUnmount(){this.cropper&&this.cropper.destroy()},computed:{desclangs(){return this.languages.available.concat(Object.keys(this.item.description||{})).filter((i,t,e)=>e.indexOf(i)===t)},ratio(){if(!this.cropper)return NaN;const i=this.cropper.getImageData();return i.naturalWidth/i.naturalHeight},readonly(){return!this.auth.can("file:save")}},methods:{addCover(){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");const i=this,t=this.$refs.video;if(!t)return this.messages.add(this.$gettext("No video element found"),"error");const e=this.item.path.replace(/\.[A-Za-z0-9]+$/,".png").split("/").pop(),a=document.createElement("canvas"),s=a.getContext("2d");a.width=t.videoWidth,a.height=t.videoHeight,s.drawImage(t,0,0,t.videoWidth,t.videoHeight),a.toBlob(function(r){const n=new File([r],e,{type:"image/png"});i.covering=!0,i.$apollo.mutate({mutation:W`mutation($id: ID!, $preview: Upload) {
              saveFile(id: $id, input: {}, preview: $preview) {
                id
                latest {
                  data
                  created_at
                }
              }
            }`,variables:{id:i.item.id,preview:n},context:{hasUpload:!0}}).then(o=>{var u,l,d;if(o.errors)throw o.errors;const h=(l=(u=o.data)==null?void 0:u.saveFile)==null?void 0:l.latest;h&&(i.item.previews=((d=JSON.parse(h.data||"{}"))==null?void 0:d.previews)||{},i.item.updated_at=h.created_at)}).catch(o=>{i.messages.add(this.$gettext("Error saving video cover")+`:
`+o,"error"),this.$log("FileDetailItem::addCover(): Error saving video cover",o)}).finally(()=>{i.covering=!1})},"image/png",1)},aspect(i){this.cropper.setAspectRatio(i),this.cropper.setDragMode("crop"),this.cropping=!0,this.$nextTick(()=>{const t=this.cropper.cropper.querySelector(".cropper-crop-box");if(t&&!this.cropLabel){const e=document.createElement("div");e.className="crop-label",t.appendChild(e),this.cropLabel=e}})},composeText(){const i=this.desclangs.shift()||this.item.lang||"en",t=`Summarize the content of the file in a few words in plain text format for a title tag in the language with the ISO code "${i}":`;this.composing=!0,this.compose(t,null,[this.item.id]).then(e=>{this.update("description",Object.assign(this.item.description||{},{[i]:e}))}).finally(()=>{this.composing=!1})},crop(){this.cropping=!1,this.cropper.setDragMode("none"),this.cropper.getCroppedCanvas().toBlob(i=>{this.$emit("update:file",i)})},download(){this.cropper.getCroppedCanvas().toBlob(i=>{const t=URL.createObjectURL(i),e=document.createElement("a");e.href=t,e.download=this.item.name||"download",e.click(),URL.revokeObjectURL(t)})},flipX(){this.scaleX=-this.scaleX,this.cropper.scaleX(this.scaleX),this.updateFile()},flipY(){this.scaleY=-this.scaleY,this.cropper.scaleY(this.scaleY),this.updateFile()},init(){var i;if(!this.readonly&&((i=this.item.mime)!=null&&i.startsWith("image/"))){this.cropper&&(this.cropper.destroy(),this.cropper=null);const t=this;this.cropper=new ti(this.$refs.image,{aspectRatio:NaN,background:!0,responsive:!0,dragMode:"none",movable:!1,autoCrop:!1,zoomable:!1,zoomOnWheel:!1,zoomOnTouch:!1,touchDragZoom:!1,checkCrossOrigin:!1,checkOrientation:!1,viewMode:1,crop(e){if(!t.cropLabel)return;const{width:a,height:s}=e.detail;t.cropLabel.textContent=`${Math.round(a)} × ${Math.round(s)}`}})}},removeCover(){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");this.covering=!0,this.item.previews={},this.$apollo.mutate({mutation:W`mutation($id: ID!, $preview: Boolean) {
            saveFile(id: $id, input: {}, preview: $preview) {
              id
              latest {
                data
                created_at
              }
            }
          }`,variables:{id:this.item.id,preview:!1}}).then(i=>{var e,a,s;if(i.errors)throw i.errors;const t=(a=(e=i.data)==null?void 0:e.saveFile)==null?void 0:a.latest;t&&(this.item.previews=((s=JSON.parse(t.data||"{}"))==null?void 0:s.previews)||{},this.item.updated_at=t.created_at)}).catch(i=>{this.messages.add(this.$gettext("Error removing video cover")+`:
`+i,"error"),this.$log("FileDetailItem::removeCover(): Error removing video cover",i)}).finally(()=>{this.covering=!1})},reset(){this.cropping=!1,this.$emit("update:file",null),this.cropper.reset(),this.cropper.clear(),this.scaleX=1,this.scaleY=1},rotate(i){this.cropper.rotate(i),this.updateFile(),this.$nextTick(()=>{const t=this.cropper.getContainerData(),e=this.cropper.getImageData();let a,s;Math.abs(Math.abs(e.rotate)-180)===90?(a=t.width/e.naturalHeight,s=t.height/e.naturalWidth):(a=t.width/e.naturalWidth,s=t.height/e.naturalHeight),this.cropper.zoomTo(Math.min(a,s))})},transcribe(){var i,t;if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");if(!((i=this.item.mime)!=null&&i.startsWith("audio/"))&&!((t=this.item.mime)!=null&&t.startsWith("video/")))return this.messages.add(this.$gettext("Transcription is only available for audio and video files"),"error");this.transcribing=!0,bi(this.url(this.item.path,!0)).then(e=>this.$apollo.mutate({mutation:W`mutation($file: Upload!) {
              transcribe(file: $file)
            }`,variables:{file:new File([e],"audio.mp3",{type:"audio/mpeg"})},context:{hasUpload:!0}})).then(e=>{var s;if(e.errors)throw e;const a=this.desclangs[0]||this.item.lang||"en";this.update("transcription",Object.assign(this.item.transcription||{},{[a]:((s=e.data)==null?void 0:s.transcribe)||""}))}).catch(e=>{this.messages.add(this.$gettext("Error transcribing file")+`:
`+e,"error"),this.$log("FileDetailItem::transcribe(): Error transcribing from media URL",e)}).finally(()=>{this.transcribing=!1})},translateText(i){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");if(!i||typeof i!="object"){this.$log("FileDetailItem::translateText(): Invalid map object",i);return}const t=[],[e,a]=Object.entries(i||{}).find(([s,r])=>!!r);return this.translating=!0,this.txlocales(e).map(s=>s.code).forEach(s=>{t.push(this.translate(a,s).then(r=>{r[0]&&(i[s]=r[0])}).catch(r=>{this.$log("FileDetailItem::translateText(): Error translating text",r)}))}),Promise.all(t).then(()=>(this.$emit("update:item",this.item),this.translating=!1,i))},translateVTT(i){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");if(!i||typeof i!="object"){this.$log("FileDetailItem::translateVTT(): Invalid map object",i);return}const t=/^\d{2}:\d{2}:\d{2}\.\d{3} --\> \d{2}:\d{2}:\d{2}\.\d{3}(?: .*)?$/,e={...i};for(const[a,s]of Object.entries(e))s&&(e[a]=s.split(`
`).map(r=>r.startsWith("WEBVTT")||t.test(r)?`<x>${r}</x>`:r).filter(r=>r.trim()!=="").join(""));this.translateText(e).then(a=>{for(const[s,r]of Object.entries(a))a[s]&&(i[s]=a[s].replaceAll(/\<x\>/g,`

`).replaceAll(/\<\/x\>/g,`
`).trim());this.$emit("update:item",this.item)}).catch(a=>{this.$log("FileDetailItem::translateVTT(): Error translating VTT",a)})},update(i,t){this.item[i]=t,this.$emit("update:item",this.item)},updateFile(){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");this.cropper.getCroppedCanvas().toBlob(i=>{this.$emit("update:file",i)})},uploadCover(i){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");const t=i.target.files[0];if(!t)return this.messages.add(this.$gettext("No file selected"),"error");this.covering=!0,this.$apollo.mutate({mutation:W`mutation($id: ID!, $preview: Upload) {
            saveFile(id: $id, input: {}, preview: $preview) {
              id
              latest {
                data
                created_at
              }
            }
          }`,variables:{id:this.item.id,preview:t},context:{hasUpload:!0}}).then(e=>{var s,r,n;if(e.errors)throw e.errors;const a=(r=(s=e.data)==null?void 0:s.saveFile)==null?void 0:r.latest;a&&(this.item.previews=((n=JSON.parse(a.data||"{}"))==null?void 0:n.previews)||{},this.item.updated_at=a.created_at)}).catch(e=>{this.messages.add(this.$gettext("Error uploading video cover")+`:
`+e,"error"),this.$log("FileDetailItem::uploadCover(): Error uploading video cover",e)}).finally(()=>{this.covering=!1})}},watch:{"save.count":function(){this.save.count>0&&this.$nextTick(()=>{this.init()})}}},pa={key:0,ref:"editorContainer",class:"editor-container"},ma=["src"],ga={key:0,class:"toolbar"},va={class:"toolbar-group"},ba={class:"toolbar-group"},wa={class:"toolbar-group"},ya={class:"toolbar-group"},xa={key:1,class:"editor-container"},Da=["src"],Ca={key:0,class:"toolbar"},Ea={class:"toolbar-group"},ka=["src"],Ta={key:1,class:"toolbar-group"},Ma=["src"],Oa={key:3,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-file-earmark-binary",viewBox:"0 0 16 16"},Na={key:0,class:"actions"},Sa={key:0,class:"actions"};function $a(i,t,e,a,s,r){return v(),T(Re,null,{default:f(()=>[c(Le,{class:"scroll"},{default:f(()=>{var n,o;return[c(Ot,null,{default:f(()=>[c(gt,{cols:"12",md:"6"},{default:f(()=>[c(Be,{ref:"name",readonly:r.readonly,modelValue:e.item.name,"onUpdate:modelValue":t[0]||(t[0]=h=>r.update("name",h)),variant:"underlined",label:i.$gettext("Name"),counter:"255",maxlength:"255"},null,8,["readonly","modelValue","label"])]),_:1}),c(gt,{cols:"12",md:"6"},{default:f(()=>[c(ni,{ref:"lang",items:r.locales(!0),readonly:r.readonly,modelValue:e.item.lang,"onUpdate:modelValue":t[1]||(t[1]=h=>r.update("lang",h)),variant:"underlined",label:i.$gettext("Language")},null,8,["items","readonly","modelValue","label"])]),_:1})]),_:1}),c(Ot,null,{default:f(()=>[e.item?(v(),T(gt,{key:0,cols:"12",class:"preview"},{default:f(()=>{var h,u,l;return[(h=e.item.mime)!=null&&h.startsWith("image/")?(v(),N("div",pa,[g("img",{ref:"image",src:r.url(e.item.path,!0),class:"element",crossorigin:"anonymous"},null,8,ma),r.readonly?O("",!0):(v(),N("div",ga,[g("div",va,[s.cropping?(v(),T(w,{key:0,onClick:t[2]||(t[2]=d=>r.crop()),title:i.$gettext("Use cropped image"),icon:"mdi-image-check",class:"no-rtl"},null,8,["title"])):(v(),T(Dt,{key:1,location:"center"},{activator:f(({props:d})=>[c(w,Ct(d,{icon:"mdi-crop",class:"no-rtl",title:i.$gettext("Crop image")}),null,16,["title"])]),default:f(()=>[c(xt,null,{default:f(()=>[c(V,null,{default:f(()=>[c(w,{"prepend-icon":"mdi-crop",class:"no-rtl",variant:"text",onClick:t[3]||(t[3]=d=>r.aspect(r.ratio))},{default:f(()=>[C(b(i.$gettext("Original ratio")),1)]),_:1})]),_:1}),c(V,null,{default:f(()=>[c(w,{"prepend-icon":"mdi-crop",class:"no-rtl",variant:"text",onClick:t[4]||(t[4]=d=>r.aspect(NaN))},{default:f(()=>[C(b(i.$gettext("No ratio")),1)]),_:1})]),_:1}),c(V,null,{default:f(()=>[c(w,{"prepend-icon":"mdi-crop",class:"no-rtl",variant:"text",onClick:t[5]||(t[5]=d=>r.aspect(1))},{default:f(()=>[C(b(i.$gettext("Square")),1)]),_:1})]),_:1}),c(V,null,{default:f(()=>[c(w,{"prepend-icon":"mdi-crop",class:"no-rtl",variant:"text",onClick:t[6]||(t[6]=d=>r.aspect(3/2))},{default:f(()=>[...t[26]||(t[26]=[C("3:2",-1)])]),_:1})]),_:1}),c(V,null,{default:f(()=>[c(w,{"prepend-icon":"mdi-crop",class:"no-rtl",variant:"text",onClick:t[7]||(t[7]=d=>r.aspect(4/3))},{default:f(()=>[...t[27]||(t[27]=[C("4:3",-1)])]),_:1})]),_:1}),c(V,null,{default:f(()=>[c(w,{"prepend-icon":"mdi-crop",class:"no-rtl",variant:"text",onClick:t[8]||(t[8]=d=>r.aspect(5/3))},{default:f(()=>[...t[28]||(t[28]=[C("5:3",-1)])]),_:1})]),_:1}),c(V,null,{default:f(()=>[c(w,{"prepend-icon":"mdi-crop",class:"no-rtl",variant:"text",onClick:t[9]||(t[9]=d=>r.aspect(16/9))},{default:f(()=>[...t[29]||(t[29]=[C("16:9",-1)])]),_:1})]),_:1})]),_:1})]),_:1}))]),g("div",ba,[c(w,{icon:"mdi-rotate-left",class:"no-rtl",onClick:t[10]||(t[10]=d=>r.rotate(-90)),title:i.$gettext("Rotate counter-clockwise")},null,8,["title"]),c(w,{icon:"mdi-rotate-right",class:"no-rtl",onClick:t[11]||(t[11]=d=>r.rotate(90)),title:i.$gettext("Rotate clockwise")},null,8,["title"])]),g("div",wa,[c(w,{icon:"mdi-flip-horizontal",class:"no-rtl",onClick:r.flipX,title:i.$gettext("Flip horizontally")},null,8,["onClick","title"]),c(w,{icon:"mdi-flip-vertical",class:"no-rtl",onClick:r.flipY,title:i.$gettext("Flip vertically")},null,8,["onClick","title"])]),g("div",ya,[c(w,{icon:"mdi-download",class:"no-rtl",onClick:t[12]||(t[12]=d=>r.download()),title:i.$gettext("Download")},null,8,["title"]),c(w,{icon:"mdi-history",class:"no-rtl",onClick:t[13]||(t[13]=d=>r.reset()),title:i.$gettext("Reset")},null,8,["title"])])]))],512)):(u=e.item.mime)!=null&&u.startsWith("video/")?(v(),N("div",xa,[g("video",{ref:"video",src:r.url(e.item.path),crossorigin:"anonymous",class:"element",controls:""},null,8,Da),r.readonly?O("",!0):(v(),N("div",Ca,[g("div",Ea,[Object.values(e.item.previews).length?(v(),N("img",{key:0,class:"video-preview",src:r.url(Object.values(e.item.previews).shift()),onClick:t[14]||(t[14]=d=>r.removeCover())},null,8,ka)):(v(),N("div",Ta,[c(w,{icon:"mdi-tooltip-image",loading:s.covering,title:i.$gettext("Use as cover image"),onClick:t[15]||(t[15]=d=>r.addCover())},null,8,["loading","title"]),c(w,{icon:"",loading:s.covering,title:i.$gettext("Upload cover image"),onClick:t[17]||(t[17]=d=>i.$refs.coverInput.click())},{default:f(()=>[c(Vt,null,{default:f(()=>[...t[30]||(t[30]=[C("mdi-image-plus",-1)])]),_:1}),g("input",{ref:"coverInput",type:"file",class:"cover-input",onChange:t[16]||(t[16]=d=>r.uploadCover(d))},null,544)]),_:1},8,["loading","title"])]))])]))])):(l=e.item.mime)!=null&&l.startsWith("audio/")?(v(),N("audio",{key:2,src:r.url(e.item.path),crossorigin:"anonymous",class:"element",controls:""},null,8,Ma)):(v(),N("svg",Oa,[...t[31]||(t[31]=[g("path",{d:"M7.05 11.885c0 1.415-.548 2.206-1.524 2.206C4.548 14.09 4 13.3 4 11.885c0-1.412.548-2.203 1.526-2.203.976 0 1.524.79 1.524 2.203m-1.524-1.612c-.542 0-.832.563-.832 1.612q0 .133.006.252l1.559-1.143c-.126-.474-.375-.72-.733-.72zm-.732 2.508c.126.472.372.718.732.718.54 0 .83-.563.83-1.614q0-.129-.006-.25zm6.061.624V14h-3v-.595h1.181V10.5h-.05l-1.136.747v-.688l1.19-.786h.69v3.633z"},null,-1),g("path",{d:"M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2M9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"},null,-1)])]))]}),_:1})):O("",!0)]),_:1}),c(Ot,null,{default:f(()=>[c(gt,{cols:"12",class:"description"},{default:f(()=>[c(ge,null,{default:f(()=>[C(b(i.$gettext("Descriptions"))+" ",1),r.readonly?O("",!0):(v(),N("div",Na,[Object.values(e.item.description||{}).find(h=>!!h)?(v(),T(w,{key:0,onClick:t[18]||(t[18]=h=>r.translateText(e.item.description)),title:i.$gettext("Translate text"),loading:s.translating,icon:"mdi-translate",variant:"text",elevation:"0"},null,8,["title","loading"])):O("",!0),c(w,{onClick:t[19]||(t[19]=h=>r.composeText()),title:i.$gettext("Generate description"),loading:s.composing,icon:"mdi-creation",variant:"text",elevation:"0"},null,8,["title","loading"])]))]),_:1}),c(jt,{modelValue:s.tabdesc,"onUpdate:modelValue":t[20]||(t[20]=h=>s.tabdesc=h)},{default:f(()=>[(v(!0),N(q,null,et(r.locales(),h=>(v(),T(It,{value:h.value},{default:f(()=>[C(b(h.title),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"]),c(qt,{modelValue:s.tabdesc,"onUpdate:modelValue":t[21]||(t[21]=h=>s.tabdesc=h),touch:!1},{default:f(()=>[(v(!0),N(q,null,et(r.locales(),h=>(v(),T(At,{value:h.value},{default:f(()=>{var u;return[c(ve,{ref_for:!0,ref:"description","onUpdate:modelValue":l=>{e.item.description[h.value]=l,i.$emit("update:item",e.item)},label:i.$gettext("Description (%{lang})",{lang:h.value}),modelValue:((u=e.item.description)==null?void 0:u[h.value])||"",readonly:r.readonly,variant:"underlined",counter:"500",rows:"2","auto-grow":"",clearable:""},null,8,["onUpdate:modelValue","label","modelValue","readonly"])]}),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1}),(n=e.item.mime)!=null&&n.startsWith("audio/")||(o=e.item.mime)!=null&&o.startsWith("video/")?(v(),T(Ot,{key:0},{default:f(()=>[c(gt,{cols:"12",class:"transcription"},{default:f(()=>[c(ge,null,{default:f(()=>[C(b(i.$gettext("Transcriptions"))+" ",1),r.readonly?O("",!0):(v(),N("div",Sa,[Object.values(e.item.transcription||{}).find(h=>!!h)?(v(),T(w,{key:0,onClick:t[22]||(t[22]=h=>r.translateVTT(e.item.transcription)),title:i.$gettext("Translate text"),loading:s.translating,icon:"mdi-translate",variant:"text",elevation:"0"},null,8,["title","loading"])):O("",!0),c(w,{onClick:t[23]||(t[23]=h=>r.transcribe()),title:i.$gettext("Transcribe file content"),loading:s.transcribing,icon:"mdi-creation",variant:"text",elevation:"0"},null,8,["title","loading"])]))]),_:1}),c(jt,{modelValue:s.tabtrans,"onUpdate:modelValue":t[24]||(t[24]=h=>s.tabtrans=h)},{default:f(()=>[(v(!0),N(q,null,et(r.locales(),h=>(v(),T(It,{value:h.value},{default:f(()=>[C(b(h.title),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"]),c(qt,{modelValue:s.tabtrans,"onUpdate:modelValue":t[25]||(t[25]=h=>s.tabtrans=h),touch:!1},{default:f(()=>[(v(!0),N(q,null,et(r.locales(),h=>(v(),T(At,{value:h.value},{default:f(()=>{var u;return[c(ve,{ref_for:!0,ref:"transcription","onUpdate:modelValue":l=>{e.item.transcription[h.value]=l,i.$emit("update:item",e.item)},label:i.$gettext("Transcription (%{lang})",{lang:h.value}),modelValue:((u=e.item.transcription)==null?void 0:u[h.value])||"",readonly:r.readonly,variant:"underlined",rows:"20","auto-grow":"",clearable:""},null,8,["onUpdate:modelValue","label","modelValue","readonly"])]}),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1})):O("",!0)]}),_:1})]),_:1})}const Va=Lt(fa,[["render",$a],["__scopeId","data-v-7eeb4263"]]),Ia={components:{AsideMeta:yi,HistoryDialog:wi,FileDetailItem:Va,FileDetailRefs:Ci},inject:["closeView"],props:{item:{type:Object,required:!0}},data:()=>({file:null,error:!1,changed:!1,publishAt:null,pubmenu:!1,vhistory:!1,tab:"file",savecnt:0}),setup(){const i=ne(),t=oi();return{auth:Pt(),drawer:t,messages:i}},methods:{publish(i=null){if(!this.auth.can("file:publish")){this.messages.add(this.$gettext("Permission denied"),"error");return}this.save(!0).then(t=>{var e,a;t&&this.$apollo.mutate({mutation:W`mutation ($id: [ID!]!, $at: DateTime) {
              pubFile(id: $id, at: $at) {
                id
              }
            }`,variables:{id:[this.item.id],at:(a=(e=i==null?void 0:i.toISOString())==null?void 0:e.substring(0,19))==null?void 0:a.replace("T"," ")}}).then(s=>{if(s.errors)throw s.errors;i?(this.item.publish_at=i,this.messages.add(this.$gettext("File scheduled for publishing at %{date}",{date:i.toLocaleDateString()}),"info")):(this.item.published=!0,this.messages.add(this.$gettext("File published successfully"),"success")),this.closeView()}).catch(s=>{this.messages.add(this.$gettext("Error publishing file")+`:
`+s,"error"),this.$log("FileDetail::publish(): Error publishing file",i,s)})})},reset(){this.changed=!1,this.error=!1},save(i=!1){return this.auth.can("file:save")?this.error?(this.messages.add(this.$gettext("There are invalid fields, please resolve the errors first"),"error"),Promise.resolve(!1)):this.changed?this.$apollo.mutate({mutation:W`mutation ($id: ID!, $input: FileInput!, $file: Upload) {
            saveFile(id: $id, input: $input, file: $file) {
              id
              latest {
                id
                data
                created_at
              }
            }
          }`,variables:{id:this.item.id,input:{transcription:JSON.stringify(this.item.transcription||{}),description:JSON.stringify(this.item.description||{}),previews:JSON.stringify(this.item.previews||{}),path:this.item.path,name:this.item.name,lang:this.item.lang},file:this.file},context:{hasUpload:!0}}).then(t=>{var a,s;if(t.errors)throw t.errors;const e=(s=(a=t.data)==null?void 0:a.saveFile)==null?void 0:s.latest;return Object.assign(this.item,JSON.parse((e==null?void 0:e.data)||"{}")),this.item.updated_at=e==null?void 0:e.created_at,this.item.published=!1,this.reset(),i||this.messages.add(this.$gettext("File saved successfully"),"success"),this.savecnt++,!0}).catch(t=>{this.messages.add(this.$gettext("Error saving file")+`:
`+t,"error"),this.$log("FileDetail::save(): Error saving file",t)}):Promise.resolve(!0):(this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve(!1))},use(i){Object.assign(this.item,i.data),this.vhistory=!1,this.changed=!0,this.savecnt++},versions(i){return this.auth.can("file:view")?i?this.$apollo.query({query:W`query($id: ID!) {
            file(id: $id) {
              id
              versions {
                id
                published
                publish_at
                data
                editor
                created_at
              }
            }
          }`,variables:{id:i}}).then(t=>{if(t.errors||!t.data.file)throw t;const e=["previews","description","transcription"];return(t.data.file.versions||[]).map(a=>{const s={...a,data:JSON.parse(a.data||"{}")};return e.forEach(r=>s[r]??(s[r]={})),s}).reverse()}).catch(t=>{this.messages.add(this.$gettext("Error fetching file versions")+`:
`+t,"error"),this.$log("FileDetail::versions(): Error fetching file versions",i,t)}):Promise.resolve([]):(this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve([]))}}},Aa={class:"app-title"},Ra={class:"menu-content"};function La(i,t,e,a,s,r){const n=Nt("FileDetailItem"),o=Nt("FileDetailRefs"),h=Nt("AsideMeta"),u=Nt("HistoryDialog");return v(),N(q,null,[c(li,{elevation:0,density:"compact"},{prepend:f(()=>[c(w,{onClick:t[0]||(t[0]=l=>r.closeView()),title:i.$gettext("Back to list view"),icon:"mdi-keyboard-backspace"},null,8,["title"])]),append:f(()=>[c(w,{onClick:t[1]||(t[1]=l=>i.vhistory=!0),class:ht([{hidden:e.item.published&&!i.changed&&!e.item.latest},"no-rtl"]),title:i.$gettext("View history"),icon:"mdi-history"},null,8,["class","title"]),c(w,{onClick:t[2]||(t[2]=l=>r.save()),title:i.$gettext("Save"),class:ht([{error:i.error},"menu-save"]),disabled:!i.changed||i.error||!a.auth.can("file:save"),variant:!i.changed||i.error||!a.auth.can("file:save")?"plain":"flat",color:!i.changed||i.error||!a.auth.can("file:save")?"":"blue-darken-1",icon:"mdi-database-arrow-down"},null,8,["title","class","disabled","variant","color"]),c(Dt,{modelValue:i.pubmenu,"onUpdate:modelValue":t[5]||(t[5]=l=>i.pubmenu=l),"close-on-content-click":!1},{activator:f(({props:l})=>[c(w,Ct(l,{icon:"",title:i.$gettext("Schedule publishing"),class:[{error:i.error},"menu-publish"],disabled:e.item.published&&!i.changed||i.error||!a.auth.can("file:publish"),variant:e.item.published&&!i.changed||i.error||!a.auth.can("file:publish")?"plain":"flat",color:e.item.published&&!i.changed||i.error||!a.auth.can("file:publish")?"":"blue-darken-2"}),{default:f(()=>[c(Vt,null,{default:f(()=>[...t[17]||(t[17]=[g("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},[g("path",{d:"M2,1V3H16V1H2 M2,10H6V19H12V10H16L9,3L2,10Z"}),g("path",{d:"M16.7 11.4C16.7 11.4 16.61 11.4 16.7 11.4C13.19 11.49 10.4 14.28 10.4 17.7C10.4 21.21 13.19 24 16.7 24S23 21.21 23 17.7 20.21 11.4 16.7 11.4M16.7 22.2C14.18 22.2 12.2 20.22 12.2 17.7S14.18 13.2 16.7 13.2 21.2 15.18 21.2 17.7 19.22 22.2 16.7 22.2M15.6 13.1V17.6L18.84 19.58L19.56 18.5L16.95 16.97V13.1H15.6Z"})],-1)])]),_:1})]),_:1},16,["title","class","disabled","variant","color"])]),default:f(()=>[g("div",Ra,[c(ci,{modelValue:i.publishAt,"onUpdate:modelValue":t[3]||(t[3]=l=>i.publishAt=l),"hide-header":"","show-adjacent-months":""},null,8,["modelValue"]),c(w,{onClick:t[4]||(t[4]=l=>{r.publish(i.publishAt),i.pubmenu=!1}),disabled:!i.publishAt||i.error,color:i.publishAt?"primary":"",variant:"text",elevation:"0"},{default:f(()=>[C(b(i.$gettext("Publish")),1)]),_:1},8,["disabled","color"])])]),_:1},8,["modelValue"]),c(w,{icon:"",onClick:t[6]||(t[6]=l=>r.publish()),title:i.$gettext("Publish"),class:ht([{error:i.error},"menu-publish"]),disabled:e.item.published&&!i.changed||i.error||!a.auth.can("file:publish"),variant:e.item.published&&!i.changed||i.error||!a.auth.can("file:publish")?"plain":"flat",color:e.item.published&&!i.changed||i.error||!a.auth.can("file:publish")?"":"blue-darken-2"},{default:f(()=>[c(Vt,null,{default:f(()=>[...t[18]||(t[18]=[g("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},[g("path",{d:"M5,2V4H19V2H5 M5,12H9V21H15V12H19L12,5L5,12Z"})],-1)])]),_:1})]),_:1},8,["title","class","disabled","variant","color"]),c(w,{onClick:t[7]||(t[7]=Gt(l=>a.drawer.toggle("aside"),["stop"])),title:i.$gettext("Toggle side menu"),icon:a.drawer.aside?"mdi-chevron-right":"mdi-chevron-left"},null,8,["title","icon"])]),default:f(()=>[c(ui,null,{default:f(()=>[g("div",Aa,b(i.$gettext("File"))+": "+b(e.item.name),1)]),_:1})]),_:1}),c(hi,{class:"file-details"},{default:f(()=>[c(fi,{onSubmit:t[13]||(t[13]=Gt(()=>{},["prevent"]))},{default:f(()=>[c(jt,{"fixed-tabs":"",modelValue:i.tab,"onUpdate:modelValue":t[8]||(t[8]=l=>i.tab=l)},{default:f(()=>[c(It,{value:"file",class:ht({changed:i.changed,error:i.error})},{default:f(()=>[C(b(i.$gettext("File")),1)]),_:1},8,["class"]),c(It,{value:"refs"},{default:f(()=>[C(b(i.$gettext("Used by")),1)]),_:1})]),_:1},8,["modelValue"]),c(qt,{modelValue:i.tab,"onUpdate:modelValue":t[12]||(t[12]=l=>i.tab=l),touch:!1},{default:f(()=>[c(At,{value:"file"},{default:f(()=>[c(n,{"onUpdate:item":t[9]||(t[9]=l=>{this.$emit("update:item",e.item),i.changed=!0}),"onUpdate:file":t[10]||(t[10]=l=>{this.file=l,i.changed=!0}),onError:t[11]||(t[11]=l=>i.error=l),save:{count:i.savecnt},item:e.item},null,8,["save","item"])]),_:1}),c(At,{value:"refs"},{default:f(()=>[c(o,{item:e.item},null,8,["item"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),c(h,{item:e.item},null,8,["item"]),(v(),T(di,{to:"body"},[c(u,{modelValue:i.vhistory,"onUpdate:modelValue":t[14]||(t[14]=l=>i.vhistory=l),current:{data:{lang:e.item.lang,name:e.item.name,mime:e.item.mime,path:e.item.path,previews:e.item.previews,description:e.item.description,transcription:e.item.transcription}},load:()=>r.versions(e.item.id),onUse:t[15]||(t[15]=l=>r.use(l)),onRevert:t[16]||(t[16]=l=>{r.use(l),r.reset()})},null,8,["modelValue","current","load"])]))],64)}const rr=Lt(Ia,[["render",La],["__scopeId","data-v-a499e16b"]]),Pa={props:{grid:{type:Boolean,default:!1},embed:{type:Boolean,default:!1},filter:{type:Object,default:()=>({})}},emits:["select"],inject:["debounce","url","srcset"],data(){return{items:[],term:"",sort:{column:"ID",order:"DESC"},page:1,last:1,limit:100,checked:!1,loading:!0,vgrid:!1}},setup(){const i=ne(),t=Pt();return{app:Pe(),auth:t,messages:i}},created(){this.searchd=this.debounce(this.search,500),this.vgrid=this.grid,this.search()},computed:{canTrash(){return this.items.some(i=>i._checked&&!i.deleted_at)},isChecked(){return this.items.some(i=>i._checked)},isTrashed(){return this.items.some(i=>i._checked&&i.deleted_at)}},methods:{add(i){if(this.embed||!this.auth.can("file:add")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=[],e=i.target.files||i.dataTransfer.files||[];if(e.length)return Array.from(e).forEach(a=>{t.push(this.$apollo.mutate({mutation:W`mutation($file: Upload!) {
              addFile(file: $file) {
                id
                lang
                mime
                name
                path
                previews
                description
                transcription
                editor
                created_at
                updated_at
                deleted_at
              }
            }`,variables:{file:a},context:{hasUpload:!0}}).then(s=>{var n;if(s.errors)throw s.errors;const r=((n=s.data)==null?void 0:n.addFile)||{};return r.previews=JSON.parse(r.previews)||{},r.description=JSON.parse(r.description)||{},r.transcription=JSON.parse(r.transcription)||{},r.published=!0,this.items.unshift(r),this.$emit("select",r),r}).catch(s=>{this.messages.add(this.$gettext("Error adding file %{path}",{path:a.name})+`:
`+s,"error"),this.$log("FileListItems::add(): Error adding file",i,s)}))}),Promise.all(t).then(()=>{this.invalidate()})},drop(i){if(!this.auth.can("file:drop")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=i?[i]:this.items.filter(e=>e._checked);t.length&&this.$apollo.mutate({mutation:W`
            mutation($id: [ID!]!) {
              dropFile(id: $id) {
                id
              }
            }
          `,variables:{id:t.map(e=>e.id)}}).then(e=>{if(e.errors)throw e.errors;this.invalidate(),this.search()}).catch(e=>{this.messages.add(this.$gettext("Error trashing file")+`:
`+e,"error"),this.$log("FileListItems::drop(): Error trashing file",i,e)})},invalidate(){const i=this.$apollo.provider.defaultClient.cache;i.evict({id:"ROOT_QUERY",fieldName:"files"}),i.gc()},keep(i){if(!this.auth.can("file:keep")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=i?[i]:this.items.filter(e=>e._checked);t.length&&this.$apollo.mutate({mutation:W`
            mutation($id: [ID!]!) {
              keepFile(id: $id) {
                id
              }
            }
          `,variables:{id:t.map(e=>e.id)}}).then(e=>{if(e.errors)throw e.errors;t.forEach(a=>{a.deleted_at=null}),this.invalidate(),this.search()}).catch(e=>{this.messages.add(this.$gettext("Error restoring file")+`:
`+e,"error"),this.$log("FileListItems::keep(): Error restoring file",i,e)})},publish(i){if(!this.auth.can("file:publish")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=i?[i]:this.items.filter(e=>e._checked&&e.id&&!e.published);t.length&&this.$apollo.mutate({mutation:W`mutation ($id: [ID!]!) {
            pubFile(id: $id) {
              id
            }
          }`,variables:{id:t.map(e=>e.id)}}).then(e=>{if(e.errors)throw e.errors;t.forEach(a=>{a.published=!0,a._checked=!1}),this.invalidate(),this.search()}).catch(e=>{this.messages.add(this.$gettext("Error publishing file")+`:
`+e,"error"),this.$log("FileListItems::publish(): Error publishing file",i,e)})},purge(i){if(!this.auth.can("file:purge")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=i?[i]:this.items.filter(e=>e._checked);t.length&&this.$apollo.mutate({mutation:W`
            mutation($id: [ID!]!) {
              purgeFile(id: $id) {
                id
              }
            }
          `,variables:{id:t.map(e=>e.id)}}).then(e=>{if(e.errors)throw e.errors;this.invalidate(),this.search()}).catch(e=>{this.messages.add(this.$gettext("Error purging file")+`:
`+e,"error"),this.$log("FileListItems::purge(): Error purging file",i,e)})},search(){if(!this.auth.can("file:view"))return this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve([]);const i=this.filter.publish||null,t=this.filter.trashed||"WITHOUT",e={...this.filter};return delete e.trashed,delete e.publish,this.term&&(e.any=this.term),this.loading=!0,this.$apollo.query({query:W`
            query($filter: FileFilter, $sort: [QueryFilesSortOrderByClause!], $limit: Int!, $page: Int!, $trashed: Trashed, $publish: Publish) {
              files(filter: $filter, sort: $sort, first: $limit, page: $page, trashed: $trashed, publish: $publish) {
                data {
                  id
                  lang
                  name
                  mime
                  path
                  previews
                  description
                  transcription
                  editor
                  created_at
                  updated_at
                  deleted_at
                  latest {
                    id
                    published
                    publish_at
                    data
                    editor
                    created_at
                  }
                }
                paginatorInfo {
                  lastPage
                }
              }
            }
          `,variables:{filter:e,page:this.page,limit:this.limit,sort:[this.sort],trashed:t,publish:i}}).then(a=>{var n;if(a.errors)throw a.errors;const s=a.data.files||{},r=["previews","description","transcription"];return this.last=((n=s.paginatorInfo)==null?void 0:n.lastPage)||1,this.items=[...s.data||[]].map(o=>{var u,l,d,p,x,y;const h=(u=o.latest)!=null&&u.data?JSON.parse((l=o.latest)==null?void 0:l.data):{...o,previews:JSON.parse(o.previews||"{}"),description:JSON.parse(o.description||"{}"),transcription:JSON.parse(o.transcription||"{}")};return r.forEach(M=>h[M]??(h[M]={})),Object.assign(h,{id:o.id,deleted_at:o.deleted_at,created_at:o.created_at,updated_at:((d=o.latest)==null?void 0:d.created_at)||o.updated_at,editor:((p=o.latest)==null?void 0:p.editor)||o.editor,published:((x=o.latest)==null?void 0:x.published)??!0,publish_at:((y=o.latest)==null?void 0:y.publish_at)||null,latest:o.latest})}),this.checked=!1,this.loading=!1,this.items}).catch(a=>{this.messages.add(this.$gettext("Error fetching files")+`:
`+a,"error"),this.$log("FileListItems::search(): Error fetching files",a)})},title(i){const t=[];return i.publish_at&&t.push("Publish at: "+new Date(i.publish_at).toLocaleDateString()),t.join(`
`)},toggle(){this.items.forEach(i=>{i._checked=!i._checked})}},watch:{filter:{deep:!0,handler(){this.search()}},term(){this.searchd()},page(){this.search()},sort(){this.search()}}},Ba={class:"header"},_a={class:"bulk"},Ua={class:"search"},Ha={class:"layout"},Wa=["onClick","title"],za=["onClick","title"],Ya={class:"item-text"},Fa={class:"item-head"},Xa={key:0,class:"item-lang"},ja={class:"item-title"},qa={class:"item-mime item-subtitle"},Ga={class:"item-aux"},Ja={class:"item-editor"},Za={class:"item-modified item-subtitle"},Qa={key:0,class:"loading"},Ka={key:1,class:"notfound"},tr={key:3,class:"btn-group"};function er(i,t,e,a,s,r){return v(),N(q,null,[g("div",Ba,[g("div",_a,[c(be,{modelValue:s.checked,"onUpdate:modelValue":t[0]||(t[0]=n=>s.checked=n),onClick:t[1]||(t[1]=Gt(n=>r.toggle(),["stop"]))},null,8,["modelValue"]),c(Dt,null,{activator:f(({props:n})=>[c(w,Ct(n,{disabled:!r.isChecked,"append-icon":"mdi-menu-down",variant:"text"}),{default:f(()=>[C(b(i.$gettext("Actions")),1)]),_:1},16,["disabled"])]),default:f(()=>[c(xt,null,{default:f(()=>[r.isChecked&&a.auth.can("file:publish")?(v(),T(V,{key:0},{default:f(()=>[c(w,{"prepend-icon":"mdi-publish",variant:"text",onClick:t[2]||(t[2]=n=>r.publish())},{default:f(()=>[C(b(i.$gettext("Publish")),1)]),_:1})]),_:1})):O("",!0),!this.embed&&a.auth.can("file:add")?(v(),T(V,{key:1},{default:f(()=>[c(w,{"prepend-icon":"mdi-folder-plus",variant:"text",onClick:t[3]||(t[3]=n=>i.$refs.upload.click())},{default:f(()=>[C(b(i.$gettext("Add files")),1)]),_:1})]),_:1})):O("",!0),r.canTrash&&a.auth.can("file:drop")?(v(),T(V,{key:2},{default:f(()=>[c(w,{"prepend-icon":"mdi-delete",variant:"text",onClick:t[4]||(t[4]=n=>r.drop())},{default:f(()=>[C(b(i.$gettext("Delete")),1)]),_:1})]),_:1})):O("",!0),r.isTrashed&&a.auth.can("file:keep")?(v(),T(V,{key:3},{default:f(()=>[c(w,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:t[5]||(t[5]=n=>r.keep())},{default:f(()=>[C(b(i.$gettext("Restore")),1)]),_:1})]),_:1})):O("",!0),r.isChecked&&a.auth.can("file:purge")?(v(),T(V,{key:4},{default:f(()=>[c(w,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:t[6]||(t[6]=n=>r.purge())},{default:f(()=>[C(b(i.$gettext("Purge")),1)]),_:1})]),_:1})):O("",!0)]),_:1})]),_:1})]),g("div",Ua,[c(Be,{modelValue:s.term,"onUpdate:modelValue":t[7]||(t[7]=n=>s.term=n),label:i.$gettext("Search for"),"prepend-inner-icon":"mdi-magnify",variant:"underlined","hide-details":"",clearable:""},null,8,["modelValue","label"])]),g("div",Ha,[s.vgrid?O("",!0):(v(),T(w,{key:0,onClick:t[8]||(t[8]=n=>s.vgrid=!0),title:i.$gettext("Grid view"),icon:"mdi-view-grid-outline",variant:"text",elevation:"0"},null,8,["title"])),s.vgrid?(v(),T(w,{key:1,onClick:t[9]||(t[9]=n=>s.vgrid=!1),title:i.$gettext("List view"),icon:"mdi-format-list-bulleted-square",variant:"text",elevation:"0"},null,8,["title"])):O("",!0),c(Dt,null,{activator:f(({props:n})=>[c(w,Ct(n,{title:i.$gettext("Sort by"),"append-icon":"mdi-menu-down","prepend-icon":"mdi-sort",variant:"text"}),{default:f(()=>{var o,h,u;return[C(b(((o=s.sort)==null?void 0:o.column)==="ID"?((h=s.sort)==null?void 0:h.order)==="DESC"?i.$gettext("latest"):i.$gettext("oldest"):((u=s.sort)==null?void 0:u.column)||""),1)]}),_:1},16,["title"])]),default:f(()=>[c(xt,null,{default:f(()=>[c(V,null,{default:f(()=>[c(w,{variant:"text",onClick:t[10]||(t[10]=n=>s.sort={column:"ID",order:"DESC"})},{default:f(()=>[C(b(i.$gettext("latest")),1)]),_:1})]),_:1}),c(V,null,{default:f(()=>[c(w,{variant:"text",onClick:t[11]||(t[11]=n=>s.sort={column:"ID",order:"ASC"})},{default:f(()=>[C(b(i.$gettext("oldest")),1)]),_:1})]),_:1}),c(V,null,{default:f(()=>[c(w,{variant:"text",onClick:t[12]||(t[12]=n=>s.sort={column:"NAME",order:"ASC"})},{default:f(()=>[C(b(i.$gettext("name")),1)]),_:1})]),_:1}),c(V,null,{default:f(()=>[c(w,{variant:"text",onClick:t[13]||(t[13]=n=>s.sort={column:"MIME",order:"ASC"})},{default:f(()=>[C(b(i.$gettext("mime")),1)]),_:1})]),_:1}),c(V,null,{default:f(()=>[c(w,{variant:"text",onClick:t[14]||(t[14]=n=>s.sort={column:"LANG",order:"ASC"})},{default:f(()=>[C(b(i.$gettext("language")),1)]),_:1})]),_:1}),c(V,null,{default:f(()=>[c(w,{variant:"text",onClick:t[15]||(t[15]=n=>s.sort={column:"EDITOR",order:"ASC"})},{default:f(()=>[C(b(i.$gettext("editor")),1)]),_:1})]),_:1})]),_:1})]),_:1})])]),c(xt,{class:ht(["items",{grid:s.vgrid,list:!s.vgrid}])},{default:f(()=>[(v(!0),N(q,null,et(s.items,(n,o)=>(v(),T(V,{key:o},{default:f(()=>[c(be,{modelValue:n._checked,"onUpdate:modelValue":h=>n._checked=h,class:ht([{draft:!n.published},"item-check"])},null,8,["modelValue","onUpdate:modelValue","class"]),c(Dt,{location:"center"},{activator:f(({props:h})=>[c(w,Ct({ref_for:!0},h,{title:i.$gettext("Actions"),icon:"mdi-dots-vertical",class:"item-menu",variant:"text"}),null,16,["title"])]),default:f(()=>[c(xt,null,{default:f(()=>[mi(c(V,null,{default:f(()=>[c(w,{"prepend-icon":"mdi-publish",variant:"text",onClick:h=>r.publish(n)},{default:f(()=>[C(b(i.$gettext("Publish")),1)]),_:1},8,["onClick"])]),_:2},1536),[[gi,!n.deleted_at&&!n.published&&a.auth.can("file:publish")]]),!n.deleted_at&&a.auth.can("file:drop")?(v(),T(V,{key:0},{default:f(()=>[c(w,{"prepend-icon":"mdi-delete",variant:"text",onClick:h=>r.drop(n)},{default:f(()=>[C(b(i.$gettext("Delete")),1)]),_:1},8,["onClick"])]),_:2},1024)):O("",!0),n.deleted_at&&a.auth.can("file:keep")?(v(),T(V,{key:1},{default:f(()=>[c(w,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:h=>r.keep(n)},{default:f(()=>[C(b(i.$gettext("Restore")),1)]),_:1},8,["onClick"])]),_:2},1024)):O("",!0),a.auth.can("file:purge")?(v(),T(V,{key:2},{default:f(()=>[c(w,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:h=>r.purge(n)},{default:f(()=>[C(b(i.$gettext("Purge")),1)]),_:1},8,["onClick"])]),_:2},1024)):O("",!0)]),_:2},1024)]),_:2},1024),g("div",{class:"item-preview",onClick:h=>i.$emit("select",n),title:r.title(n)},[n.previews?(v(),T(vi,{key:0,src:r.url(n.path),srcset:r.srcset(n.previews),alt:n.name},null,8,["src","srcset","alt"])):O("",!0)],8,Wa),g("div",{class:ht(["item-content",{trashed:n.deleted_at}]),onClick:h=>i.$emit("select",n),title:r.title(n)},[g("div",Ya,[g("div",Fa,[n.lang?(v(),N("span",Xa,b(n.lang),1)):O("",!0),n.publish_at?(v(),T(Vt,{key:1,class:"publish-at",icon:"mdi-clock-outline"})):O("",!0),g("span",ja,b(n.name),1)]),g("div",qa,b(n.mime),1)]),g("div",Ga,[g("div",Ja,b(n.editor),1),g("div",Za,b(new Date(n.updated_at).toLocaleString()),1)])],10,za)]),_:2},1024))),128))]),_:1},8,["class"]),s.loading?(v(),N("p",Qa,[C(b(i.$gettext("Loading"))+" ",1),t[19]||(t[19]=g("svg",{class:"spinner",width:"32",height:"32",fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[g("circle",{class:"spin1",cx:"4",cy:"12",r:"3"}),g("circle",{class:"spin1 spin2",cx:"12",cy:"12",r:"3"}),g("circle",{class:"spin1 spin3",cx:"20",cy:"12",r:"3"})],-1))])):O("",!0),!s.loading&&!s.items.length?(v(),N("p",Ka,b(i.$gettext("No entries found")),1)):O("",!0),s.last>1?(v(),T(pi,{key:2,modelValue:s.page,"onUpdate:modelValue":t[16]||(t[16]=n=>s.page=n),length:s.last},null,8,["modelValue","length"])):O("",!0),!this.embed&&a.auth.can("file:add")?(v(),N("div",tr,[g("input",{onChange:t[17]||(t[17]=n=>r.add(n)),ref:"upload",type:"file",multiple:"",hidden:""},null,544),c(w,{onClick:t[18]||(t[18]=n=>i.$refs.upload.click()),title:i.$gettext("Add files"),icon:"mdi-folder-plus",color:"primary",variant:"flat"},null,8,["title"])])):O("",!0)],64)}const sr=Lt(Pa,[["render",er],["__scopeId","data-v-44f32082"]]);export{sr as F,rr as a};
