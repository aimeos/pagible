import{_ as O,c,o as r,a as u,d as V,f as y,w as h,ad as P,F as b,a5 as _,b as p,k as d,a6 as U,r as E,ae as M,af as I,t as C,ag as L,l as B,h as S,i as J,j as R,m as q,n as z,ah as G}from"./index-DvizQcpQ.js";import{l as W}from"./vue-draggable-plus-DOtOaqVX.js";const H={components:{VueDraggable:W},props:{modelValue:{type:Array},config:{type:Object,default:()=>{}},assets:{type:Object,default:()=>{}},readonly:{type:Boolean,default:!1},context:{type:Object}},emits:["update:modelValue","error","addFile","removeFile"],inject:["compose","translate","transcribe","txlocales"],data(){return{translating:{},dictating:{},composing:{},errors:[],items:[],panel:[],audio:{}}},computed:{rules(){return[e=>!this.config.max||this.config.max&&e.length<=this.config.max||this.$gettext("Maximum is %{num} entries",{num:this.config.max}),e=>(this.config.min??1)&&e.length>=(this.config.min??1)||this.$gettext("Minimum is %{num} entries",{num:this.config.min??1})]}},methods:{add(){this.items.push({}),this.panel.push(this.items.length-1),this.$emit("update:modelValue",this.items)},change(){this.$emit("update:modelValue",this.items)},composeText(e,t){var i,o,k,m,s,g,a,v,l,x,T,F,j,N,w,A;const n=['generate for field "'+(((o=(i=this.config.item)==null?void 0:i[t])==null?void 0:o.label)||t)+'"','required output format is "'+((m=(k=this.config.item)==null?void 0:k[t])==null?void 0:m.type)+'"',(g=(s=this.config.item)==null?void 0:s[t])!=null&&g.min?"minimum characters: "+((v=(a=this.config.item)==null?void 0:a[t])==null?void 0:v.min):null,(x=(l=this.config.item)==null?void 0:l[t])!=null&&x.max?"maximum characters: "+((F=(T=this.config.item)==null?void 0:T[t])==null?void 0:F.max):null,(N=(j=this.config.item)==null?void 0:j[t])!=null&&N.placeholder?"hint text: "+((A=(w=this.config.item)==null?void 0:w[t])==null?void 0:A.placeholder):null,"context information as JSON: "+JSON.stringify(this.items[e])],f=this.items[e][t]||(this.items[e].title?'Write a sentence about "'+this.items[e].title+'"':"");this.composing[e+t]=!0,this.compose(f,n).then(D=>{this.update(e,t,D)}).finally(()=>{this.composing[e+t]=!1})},record(e,t){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");if(!this.audio[e+t])return this.audio[e+t]=U().start();this.audio[e+t].then(n=>{this.dictating[e+t]=!0,this.audio[e+t]=null,n.stop().then(f=>{this.transcribe(f).then(i=>{this.update(e,t,i.asText())}).finally(()=>{this.dictating[e+t]=!1})})})},remove(e){this.items.splice(e,1),this.$emit("update:modelValue",this.items)},title(e){return(e.title||e.text||Object.values(e||{}).map(t=>t&&typeof t!="object"&&typeof t!="boolean"?t:null).filter(t=>!!t).join(" - ")).substring(0,100)||""},toName(e){var t;return((t=e==null?void 0:e.charAt(0))==null?void 0:t.toUpperCase())+(e==null?void 0:e.slice(1))},translateText(e,t,n){this.translating[e+t]=!0,this.translate([this.items[e][t]],n).then(f=>{this.update(e,t,f[0]||"")}).finally(()=>{this.translating[e+t]=!1})},update(e,t,n){this.items[e]||(this.items[e]={}),this.items[e][t]=n,this.$emit("update:modelValue",this.items)}},watch:{modelValue:{immediate:!0,handler(e){this.items=Array.isArray(e)?e:this.config.default??[],this.$emit("error",!this.rules.every(t=>t(this.items)===!0))}}}},K={class:"element-title"},Q={class:"label"},X={key:0,class:"actions"},Y={key:0,class:"v-input--error"},Z={class:"v-input__details",role:"alert","aria-live":"polite"},$={class:"v-messages"},ee={class:"btn-group"};function te(e,t,n,f,i,o){const k=E("VueDraggable");return r(),c(b,null,[u(P,{class:"items",modelValue:i.panel,"onUpdate:modelValue":t[4]||(t[4]=m=>i.panel=m),elevation:"0",multiple:""},{default:h(()=>[u(k,{modelValue:i.items,"onUpdate:modelValue":t[2]||(t[2]=m=>i.items=m),onUpdate:t[3]||(t[3]=m=>o.change()),disabled:n.readonly,forceFallback:!0,fallbackTolerance:"10",draggable:".item",handle:".handle",group:"items",animation:"500"},{default:h(()=>[(r(!0),c(b,null,_(i.items,(m,s)=>(r(),p(M,{key:s,class:"item"},{default:h(()=>[u(I,null,{default:h(()=>[n.readonly?V("",!0):(r(),p(d,{key:0,title:e.$gettext("Move element"),icon:"mdi-drag-vertical",variant:"plain",class:"handle"},null,8,["title"])),n.readonly?V("",!0):(r(),p(d,{key:1,onClick:g=>o.remove(s),title:e.$gettext("Remove element"),icon:"mdi-trash-can",variant:"plain"},null,8,["onClick","title"])),y("div",K,C(o.title(m)),1)]),_:2},1024),u(L,null,{default:h(()=>[(r(!0),c(b,null,_(n.config.item||{},(g,a)=>{var v;return r(),c("div",{key:a,class:"field"},[y("div",Q,[B(C(g.label||a)+" ",1),!n.readonly&&["markdown","plaintext","string","text"].includes(g.type)?(r(),c("div",X,[u(S,null,{activator:h(({props:l})=>[u(d,q({ref_for:!0},l,{title:e.$gettext("Translate %{code} field",{code:a}),loading:i.translating[s+a],icon:"mdi-translate",variant:"text"}),null,16,["title","loading"])]),default:h(()=>[u(J,null,{default:h(()=>[(r(!0),c(b,null,_(o.txlocales(),l=>(r(),p(R,{key:l.code},{default:h(()=>[u(d,{onClick:x=>o.translateText(s,a,l.code),"prepend-icon":"mdi-arrow-right-thin",variant:"text"},{default:h(()=>[B(C(l.name),1)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1024),u(d,{title:e.$gettext("Generate text for %{code} field",{code:a}),loading:i.composing[s+a],onClick:l=>o.composeText(s,a),icon:"mdi-creation",variant:"text"},null,8,["title","loading","onClick"]),u(d,{onClick:l=>o.record(s,a),class:z({dictating:i.audio[s+a]}),icon:i.audio[s+a]?"mdi-microphone-outline":"mdi-microphone",title:e.$gettext("Dictate"),loading:i.dictating[s+a],variant:"text"},null,8,["onClick","class","icon","title","loading"])])):V("",!0)]),(r(),p(G(o.toName(g.type)),{modelValue:(v=i.items[s])==null?void 0:v[a],"onUpdate:modelValue":l=>o.update(s,a,l),onAddFile:t[0]||(t[0]=l=>e.$emit("addFile",l)),onRemoveFile:t[1]||(t[1]=l=>e.$emit("removeFile",l)),readonly:n.readonly,context:i.items[s],assets:n.assets,config:g},null,40,["modelValue","onUpdate:modelValue","readonly","context","assets","config"]))])}),128))]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue","disabled"])]),_:1},8,["modelValue"]),i.errors.length?(r(),c("div",Y,[y("div",Z,[y("div",$,[(r(!0),c(b,null,_(i.errors,(m,s)=>(r(),c("div",{key:s,class:"v-messages__message"},C(m),1))),128))])])])):V("",!0),y("div",ee,[!n.readonly&&(!n.config.max||n.config.max&&+i.items.length<+n.config.max)?(r(),p(d,{key:0,title:e.$gettext("Add element"),icon:"mdi-view-grid-plus",onClick:t[5]||(t[5]=m=>o.add())},null,8,["title"])):V("",!0)])],64)}const se=O(H,[["render",te],["__scopeId","data-v-5eb9b65c"]]);export{se as default};
