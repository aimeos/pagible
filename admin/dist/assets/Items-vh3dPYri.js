import{_ as L,c as k,a,w as n,a8 as M,e as b,F as _,a7 as T,g as y,b as v,k as d,a9 as q,aa as z,ab as G,a5 as R,r as W,o as c,ac as H,ad as K,ae as A,af as P,ag as B,ah as J,l as p,t as h,i as x,j as V,ai as Q,m as E,aj as X,n as Y}from"./index-DBEQ109X.js";import{l as Z}from"./vue-draggable-plus-BkSmuu_I.js";const $={components:{VueDraggable:Z},props:{modelValue:{type:Array},config:{type:Object,default:()=>{}},assets:{type:Object,default:()=>{}},readonly:{type:Boolean,default:!1},context:{type:Object}},emits:["update:modelValue","error","addFile","removeFile"],inject:["write","translate","transcribe","txlocales"],data(){return{translating:{},dictating:{},composing:{},errors:[],items:[],menu:[],panel:[],audio:{}}},setup(){const e=z(),t=G();return{auth:R(),clipboard:e,messages:t}},computed:{rules(){return[e=>!this.config.max||this.config.max&&e.length<=this.config.max||this.$gettext("Maximum is %{num} entries",{num:this.config.max}),e=>(this.config.min??1)&&e.length>=(this.config.min??1)||this.$gettext("Minimum is %{num} entries",{num:this.config.min??1})]}},methods:{add(){this.items.push({}),this.panel.push(this.items.length-1),this.$emit("update:modelValue",this.items)},change(){this.$emit("update:modelValue",this.items)},writeText(e,t){var l,s,w,g,i,r,m,C,o,N,O,S,U,j,D,F;const u=['generate for field "'+(((s=(l=this.config.item)==null?void 0:l[t])==null?void 0:s.label)||t)+'"','required output format is "'+((g=(w=this.config.item)==null?void 0:w[t])==null?void 0:g.type)+'"',(r=(i=this.config.item)==null?void 0:i[t])!=null&&r.min?"minimum characters: "+((C=(m=this.config.item)==null?void 0:m[t])==null?void 0:C.min):null,(N=(o=this.config.item)==null?void 0:o[t])!=null&&N.max?"maximum characters: "+((S=(O=this.config.item)==null?void 0:O[t])==null?void 0:S.max):null,(j=(U=this.config.item)==null?void 0:U[t])!=null&&j.placeholder?"hint text: "+((F=(D=this.config.item)==null?void 0:D[t])==null?void 0:F.placeholder):null,"context information as JSON: "+JSON.stringify(this.items[e])],f=this.items[e][t]||(this.items[e].title?'Write a sentence about "'+this.items[e].title+'"':"");this.composing[e+t]=!0,this.write(f,u).then(I=>{this.update(e,t,I)}).finally(()=>{this.composing[e+t]=!1})},copy(e){this.clipboard.set("items-content",JSON.parse(JSON.stringify(this.items[e])))},cut(e){this.clipboard.set("items-content",JSON.parse(JSON.stringify(this.items[e]))),this.items.splice(e,1),this.$emit("update:modelValue",this.items)},insert(e){this.items.splice(e,0,{}),this.panel.push(e),this.$emit("update:modelValue",this.items)},paste(e=null){e===null&&(e=this.items.length),this.items.splice(e,0,this.clipboard.get("items-content")),this.$emit("update:modelValue",this.items)},record(e,t){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");if(!this.audio[e+t])return this.audio[e+t]=q().start();this.audio[e+t].then(u=>{var f;this.dictating[e+t]=!0,this.audio[e+t]=null,(f=u.stop())==null||f.then(l=>{this.transcribe(l).then(s=>{this.update(e,t,s.asText())}).finally(()=>{this.dictating[e+t]=!1})})})},remove(e){this.items.splice(e,1),this.$emit("update:modelValue",this.items)},title(e){return(e.title||e.text||Object.values(e||{}).map(t=>t&&typeof t!="object"&&typeof t!="boolean"?t:null).filter(t=>!!t).join(" - ")).substring(0,100)||""},toName(e){var t;return((t=e==null?void 0:e.charAt(0))==null?void 0:t.toUpperCase())+(e==null?void 0:e.slice(1))},translateText(e,t,u){this.translating[e+t]=!0,this.translate([this.items[e][t]],u).then(f=>{this.update(e,t,f[0]||"")}).finally(()=>{this.translating[e+t]=!1})},update(e,t,u){this.items[e]||(this.items[e]={}),this.items[e][t]=u,this.$emit("update:modelValue",this.items)}},watch:{modelValue:{immediate:!0,handler(e){this.items=Array.isArray(e)?e:this.config.default??[],this.$emit("error",!this.rules.every(t=>t(this.items)===!0))}}}},ee={class:"element-title"},te={class:"label"},ie={key:0,class:"actions"},ne={key:0,class:"v-input--error"},le={class:"v-input__details",role:"alert","aria-live":"polite"},ae={class:"v-messages"},se={class:"btn-group"};function re(e,t,u,f,l,s){const w=W("VueDraggable");return c(),k(_,null,[a(M,{class:"items",modelValue:l.panel,"onUpdate:modelValue":t[4]||(t[4]=g=>l.panel=g),elevation:"0",multiple:""},{default:n(()=>[a(w,{modelValue:l.items,"onUpdate:modelValue":t[2]||(t[2]=g=>l.items=g),onUpdate:t[3]||(t[3]=g=>s.change()),disabled:u.readonly||e.$vuetify.display.smAndDown,forceFallback:!0,fallbackTolerance:"10",draggable:".item",group:"items",animation:"500"},{default:n(()=>[(c(!0),k(_,null,T(l.items,(g,i)=>(c(),v(H,{key:i,class:"item"},{default:n(()=>[a(K,null,{default:n(()=>[u.readonly?y("",!0):(c(),v(A(e.$vuetify.display.xs?"v-dialog":"v-menu"),{key:0,modelValue:l.menu[i],"onUpdate:modelValue":r=>l.menu[i]=r,transition:"scale-transition",location:"end center","max-width":"300"},{activator:n(({props:r})=>[a(d,E({ref_for:!0},r,{title:e.$gettext("Actions"),icon:"mdi-dots-vertical",variant:"text"}),null,16,["title"])]),default:n(()=>[a(P,null,{default:n(()=>[a(B,{density:"compact"},{default:n(()=>[a(J,null,{default:n(()=>[p(h(e.$gettext("Actions")),1)]),_:1}),a(d,{icon:"mdi-close",onClick:r=>l.menu[i]=!1},null,8,["onClick"])]),_:2},1024),a(x,{onClick:r=>l.menu[i]=!1},{default:n(()=>[a(V,null,{default:n(()=>[a(d,{"prepend-icon":"mdi-content-copy",variant:"text",onClick:r=>s.copy(i)},{default:n(()=>[p(h(e.$gettext("Copy")),1)]),_:1},8,["onClick"])]),_:2},1024),a(V,null,{default:n(()=>[a(d,{"prepend-icon":"mdi-content-cut",variant:"text",onClick:r=>s.cut(i)},{default:n(()=>[p(h(e.$gettext("Cut")),1)]),_:1},8,["onClick"])]),_:2},1024),a(V,null,{default:n(()=>[a(d,{"prepend-icon":"mdi-delete",variant:"text",onClick:r=>s.remove(i)},{default:n(()=>[p(h(e.$gettext("Delete")),1)]),_:1},8,["onClick"])]),_:2},1024),a(Q),l.menu[i]&&f.clipboard.get("items-content")?(c(),v(V,{key:0},{default:n(()=>[a(d,{"prepend-icon":"mdi-arrow-up",variant:"text",onClick:r=>s.paste(i)},{default:n(()=>[p(h(e.$gettext("Paste before")),1)]),_:1},8,["onClick"])]),_:2},1024)):y("",!0),l.menu[i]&&f.clipboard.get("items-content")?(c(),v(V,{key:1},{default:n(()=>[a(d,{"prepend-icon":"mdi-arrow-down",variant:"text",onClick:r=>s.paste(i+1)},{default:n(()=>[p(h(e.$gettext("Paste after")),1)]),_:1},8,["onClick"])]),_:2},1024)):y("",!0),a(V,null,{default:n(()=>[a(d,{"prepend-icon":"mdi-arrow-up",variant:"text",onClick:r=>s.insert(i)},{default:n(()=>[p(h(e.$gettext("Insert before")),1)]),_:1},8,["onClick"])]),_:2},1024),a(V,null,{default:n(()=>[a(d,{"prepend-icon":"mdi-arrow-down",variant:"text",onClick:r=>s.insert(i+1)},{default:n(()=>[p(h(e.$gettext("Insert after")),1)]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])),b("div",ee,h(s.title(g)),1)]),_:2},1024),a(X,null,{default:n(()=>[(c(!0),k(_,null,T(u.config.item||{},(r,m)=>{var C;return c(),k("div",{key:m,class:"field"},[b("div",te,[p(h(r.label||m)+" ",1),!u.readonly&&["markdown","plaintext","string","text"].includes(r.type)?(c(),k("div",ie,[f.auth.can("text:translate")?(c(),v(A(e.$vuetify.display.xs?"v-dialog":"v-menu"),{key:0,modelValue:l.menu[i+m],"onUpdate:modelValue":o=>l.menu[i+m]=o,transition:"scale-transition",location:"end center","max-width":"300"},{activator:n(({props:o})=>[a(d,E({ref_for:!0},o,{title:e.$gettext("Translate"),loading:l.translating[i+m],icon:"mdi-translate",variant:"text"}),null,16,["title","loading"])]),default:n(()=>[a(P,null,{default:n(()=>[a(B,{density:"compact"},{default:n(()=>[a(J,null,{default:n(()=>[p(h(e.$gettext("Translate")),1)]),_:1}),a(d,{icon:"mdi-close",onClick:o=>l.menu[i+m]=!1},null,8,["onClick"])]),_:2},1024),a(x,{onClick:o=>l.menu[i+m]=!1},{default:n(()=>[(c(!0),k(_,null,T(s.txlocales(),o=>(c(),v(V,{key:o.code},{default:n(()=>[a(d,{onClick:N=>s.translateText(i,m,o.code),"prepend-icon":"mdi-arrow-right-thin",variant:"text"},{default:n(()=>[p(h(o.name),1)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])):y("",!0),f.auth.can("text:write")?(c(),v(d,{key:1,title:e.$gettext("Generate text"),loading:l.composing[i+m],onClick:o=>s.writeText(i,m),icon:"mdi-creation",variant:"text"},null,8,["title","loading","onClick"])):y("",!0),f.auth.can("audio:transcribe")?(c(),v(d,{key:2,onClick:o=>s.record(i,m),class:Y({dictating:l.audio[i+m]}),icon:l.audio[i+m]?"mdi-microphone-outline":"mdi-microphone",title:e.$gettext("Dictate"),loading:l.dictating[i+m],variant:"text"},null,8,["onClick","class","icon","title","loading"])):y("",!0)])):y("",!0)]),(c(),v(A(s.toName(r.type)),{modelValue:(C=l.items[i])==null?void 0:C[m],"onUpdate:modelValue":o=>s.update(i,m,o),onAddFile:t[0]||(t[0]=o=>e.$emit("addFile",o)),onRemoveFile:t[1]||(t[1]=o=>e.$emit("removeFile",o)),readonly:u.readonly,context:l.items[i],assets:u.assets,config:r},null,40,["modelValue","onUpdate:modelValue","readonly","context","assets","config"]))])}),128))]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue","disabled"])]),_:1},8,["modelValue"]),l.errors.length?(c(),k("div",ne,[b("div",le,[b("div",ae,[(c(!0),k(_,null,T(l.errors,(g,i)=>(c(),k("div",{key:i,class:"v-messages__message"},h(g),1))),128))])])])):y("",!0),b("div",se,[!u.readonly&&(!u.config.max||u.config.max&&+l.items.length<+u.config.max)?(c(),v(d,{key:0,title:e.$gettext("Add element"),icon:"mdi-view-grid-plus",onClick:t[5]||(t[5]=g=>s.add())},null,8,["title"])):y("",!0)])],64)}const me=L($,[["render",re],["__scopeId","data-v-cd075023"]]);export{me as default};
