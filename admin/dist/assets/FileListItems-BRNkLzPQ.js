import{_ as Rt,L as W,a3 as Pt,b as k,o as v,w as c,ay as Re,a as f,az as Pe,ac as ri,d as V,ad as Ht,ae as Wt,l as C,t as b,af as zt,aA as Yt,f as g,c as T,F as q,a5 as et,aB as si,a6 as ne,aC as ni,a4 as Be,V as Ot,e as gt,I as _e,am as oi,k as w,h as Ct,i as xt,j as N,m as Dt,aD as $t,ag as ge,aa as jt,ab as At,aE as qt,aF as It,a1 as ve,aG as li,aH as hi,aI as di,r as Vt,T as ui,aJ as ci,n as it,Z as fi,aK as Gt,aL as pi,aM as be,aN as mi,aO as gi,aP as vi,a2 as we}from"./index-BX1pNUVh.js";import{u as bi,H as wi,A as yi}from"./ElementListItems-BlvDVBLU.js";import{P as xi}from"./PageDetail-BfCZYCNh.js";import{E as Ci}from"./ElementDetail-cBuTwYEX.js";const Di={props:{item:{type:Object,required:!0}},emits:[],inject:["openView"],data:()=>({panel:[0,1,2],versions:{},file:{}}),setup(){return{auth:Pt()}},methods:{openElement(i){this.openView(Ci,{item:{...i}})},openPage(i){this.openView(xi,{item:{...i}})}},watch:{item:{immediate:!0,handler(i){!i.id||!this.auth.can("file:view")||this.$apollo.query({query:W`query ($id: ID!) {
              file(id: $id) {
                id
                bypages {
                  id
                  path
                  name
                }
                byelements {
                  id
                  type
                  name
                }
                byversions {
                  id
                  versionable_id
                  versionable_type
                  published
                  publish_at
                }
              }
            }`,variables:{id:i.id}}).then(t=>{var e,a,s;if(t.errors)throw t.errors;this.file=((e=t.data)==null?void 0:e.file)||{},this.versions=(((s=(a=t.data)==null?void 0:a.file)==null?void 0:s.byversions)||[]).map(r=>({id:r.versionable_id,type:r.versionable_type.split("\\").at(-1),published:r.published?this.$gettext("yes"):r.publish_at?new Date(r.publish_at).toLocaleDateString():this.$gettext("no")})).filter(r=>this.auth.can(r.type.toLowerCase()+":view"))}).catch(t=>{this.$log("FileDetailRef::watch(item): Error fetching file",i,t)})}}}},ki=["onClick"],Ei=["onClick"];function Mi(i,t,e,a,s,r){return v(),k(Re,null,{default:c(()=>[f(Pe,{class:"scroll"},{default:c(()=>[f(ri,{modelValue:i.panel,"onUpdate:modelValue":t[0]||(t[0]=n=>i.panel=n),elevation:"0",multiple:""},{default:c(()=>{var n,l,d;return[(n=i.file.bypages)!=null&&n.length&&a.auth.can("page:view")?(v(),k(Ht,{key:0},{default:c(()=>[f(Wt,null,{default:c(()=>[C(b(i.$gettext("Pages")),1)]),_:1}),f(zt,null,{default:c(()=>[f(Yt,{class:"pages",density:"comfortable",hover:""},{default:c(()=>[g("thead",null,[g("tr",null,[g("th",null,b(i.$gettext("ID")),1),g("th",null,b(i.$gettext("URL")),1),g("th",null,b(i.$gettext("Name")),1)])]),g("tbody",null,[(v(!0),T(q,null,et(i.file.bypages,u=>(v(),T("tr",{key:u.id,onClick:o=>r.openPage(u)},[g("td",null,b(u.id),1),g("td",null,b("/"+u.path),1),g("td",null,b(u.name),1)],8,ki))),128))])]),_:1})]),_:1})]),_:1})):V("",!0),(l=i.file.byelements)!=null&&l.length&&a.auth.can("element:view")?(v(),k(Ht,{key:1},{default:c(()=>[f(Wt,null,{default:c(()=>[C(b(i.$gettext("Elements")),1)]),_:1}),f(zt,null,{default:c(()=>[f(Yt,{class:"elements",density:"comfortable",hover:""},{default:c(()=>[g("thead",null,[g("tr",null,[g("th",null,b(i.$gettext("ID")),1),g("th",null,b(i.$gettext("Type")),1),g("th",null,b(i.$gettext("Name")),1)])]),g("tbody",null,[(v(!0),T(q,null,et(i.file.byelements,u=>(v(),T("tr",{key:u.id,onClick:o=>r.openElement(u)},[g("td",null,b(u.id),1),g("td",null,b(u.type),1),g("td",null,b(u.name),1)],8,Ei))),128))])]),_:1})]),_:1})]),_:1})):V("",!0),(d=i.versions)!=null&&d.length?(v(),k(Ht,{key:2},{default:c(()=>[f(Wt,null,{default:c(()=>[C(b(i.$gettext("Versions")),1)]),_:1}),f(zt,null,{default:c(()=>[f(Yt,{density:"comfortable",hover:""},{default:c(()=>[g("thead",null,[g("tr",null,[g("th",null,b(i.$gettext("ID")),1),g("th",null,b(i.$gettext("Type")),1),g("th",null,b(i.$gettext("Published")),1)])]),g("tbody",null,[(v(!0),T(q,null,et(i.versions,u=>(v(),T("tr",{key:u.id},[g("td",null,b(u.id),1),g("td",null,b(u.type),1),g("td",null,b(u.published),1)]))),128))])]),_:1})]),_:1})]),_:1})):V("",!0)]}),_:1},8,["modelValue"])]),_:1})]),_:1})}const Ti=Rt(Di,[["render",Mi],["__scopeId","data-v-bcfff971"]]);/*!
 * Cropper.js v1.6.2
 * https://fengyuanchen.github.io/cropperjs
 *
 * Copyright 2015-present Chen Fengyuan
 * Released under the MIT license
 *
 * Date: 2024-04-21T07:43:05.335Z
 */function ye(i,t){var e=Object.keys(i);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(i);t&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(i,s).enumerable})),e.push.apply(e,a)}return e}function Ue(i){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?ye(Object(e),!0).forEach(function(a){Si(i,a,e[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(e)):ye(Object(e)).forEach(function(a){Object.defineProperty(i,a,Object.getOwnPropertyDescriptor(e,a))})}return i}function Oi(i,t){if(typeof i!="object"||!i)return i;var e=i[Symbol.toPrimitive];if(e!==void 0){var a=e.call(i,t);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}function He(i){var t=Oi(i,"string");return typeof t=="symbol"?t:t+""}function Jt(i){"@babel/helpers - typeof";return Jt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Jt(i)}function Vi(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function xe(i,t){for(var e=0;e<t.length;e++){var a=t[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(i,He(a.key),a)}}function Ni(i,t,e){return t&&xe(i.prototype,t),e&&xe(i,e),Object.defineProperty(i,"prototype",{writable:!1}),i}function Si(i,t,e){return t=He(t),t in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}function We(i){return $i(i)||Ai(i)||Ii(i)||Li()}function $i(i){if(Array.isArray(i))return Zt(i)}function Ai(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function Ii(i,t){if(i){if(typeof i=="string")return Zt(i,t);var e=Object.prototype.toString.call(i).slice(8,-1);if(e==="Object"&&i.constructor&&(e=i.constructor.name),e==="Map"||e==="Set")return Array.from(i);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Zt(i,t)}}function Zt(i,t){(t==null||t>i.length)&&(t=i.length);for(var e=0,a=new Array(t);e<t;e++)a[e]=i[e];return a}function Li(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Bt=typeof window<"u"&&typeof window.document<"u",J=Bt?window:{},oe=Bt&&J.document.documentElement?"ontouchstart"in J.document.documentElement:!1,le=Bt?"PointerEvent"in J:!1,S="cropper",he="all",ze="crop",Ye="move",Fe="zoom",lt="e",ht="w",ut="s",tt="n",vt="ne",bt="nw",wt="se",yt="sw",Qt="".concat(S,"-crop"),Ce="".concat(S,"-disabled"),H="".concat(S,"-hidden"),De="".concat(S,"-hide"),Ri="".concat(S,"-invisible"),Lt="".concat(S,"-modal"),Kt="".concat(S,"-move"),Et="".concat(S,"Action"),Nt="".concat(S,"Preview"),de="crop",Xe="move",je="none",te="crop",ee="cropend",ie="cropmove",ae="cropstart",ke="dblclick",Pi=oe?"touchstart":"mousedown",Bi=oe?"touchmove":"mousemove",_i=oe?"touchend touchcancel":"mouseup",Ee=le?"pointerdown":Pi,Me=le?"pointermove":Bi,Te=le?"pointerup pointercancel":_i,Oe="ready",Ve="resize",Ne="wheel",re="zoom",Se="image/jpeg",Ui=/^e|w|s|n|se|sw|ne|nw|all|crop|move|zoom$/,Hi=/^data:/,Wi=/^data:image\/jpeg;base64,/,zi=/^img|canvas$/i,qe=200,Ge=100,$e={viewMode:0,dragMode:de,initialAspectRatio:NaN,aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:qe,minContainerHeight:Ge,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},Yi='<div class="cropper-container" touch-action="none"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-cropper-action="e"></span><span class="cropper-line line-n" data-cropper-action="n"></span><span class="cropper-line line-w" data-cropper-action="w"></span><span class="cropper-line line-s" data-cropper-action="s"></span><span class="cropper-point point-e" data-cropper-action="e"></span><span class="cropper-point point-n" data-cropper-action="n"></span><span class="cropper-point point-w" data-cropper-action="w"></span><span class="cropper-point point-s" data-cropper-action="s"></span><span class="cropper-point point-ne" data-cropper-action="ne"></span><span class="cropper-point point-nw" data-cropper-action="nw"></span><span class="cropper-point point-sw" data-cropper-action="sw"></span><span class="cropper-point point-se" data-cropper-action="se"></span></div></div>',Fi=Number.isNaN||J.isNaN;function D(i){return typeof i=="number"&&!Fi(i)}var Ae=function(t){return t>0&&t<1/0};function Ft(i){return typeof i>"u"}function dt(i){return Jt(i)==="object"&&i!==null}var Xi=Object.prototype.hasOwnProperty;function ct(i){if(!dt(i))return!1;try{var t=i.constructor,e=t.prototype;return t&&e&&Xi.call(e,"isPrototypeOf")}catch{return!1}}function U(i){return typeof i=="function"}var ji=Array.prototype.slice;function Je(i){return Array.from?Array.from(i):ji.call(i)}function I(i,t){return i&&U(t)&&(Array.isArray(i)||D(i.length)?Je(i).forEach(function(e,a){t.call(i,e,a,i)}):dt(i)&&Object.keys(i).forEach(function(e){t.call(i,i[e],e,i)})),i}var $=Object.assign||function(t){for(var e=arguments.length,a=new Array(e>1?e-1:0),s=1;s<e;s++)a[s-1]=arguments[s];return dt(t)&&a.length>0&&a.forEach(function(r){dt(r)&&Object.keys(r).forEach(function(n){t[n]=r[n]})}),t},qi=/\.\d*(?:0|9){12}\d*$/;function pt(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e11;return qi.test(i)?Math.round(i*t)/t:i}var Gi=/^width|height|left|top|marginLeft|marginTop$/;function at(i,t){var e=i.style;I(t,function(a,s){Gi.test(s)&&D(a)&&(a="".concat(a,"px")),e[s]=a})}function Ji(i,t){return i.classList?i.classList.contains(t):i.className.indexOf(t)>-1}function B(i,t){if(t){if(D(i.length)){I(i,function(a){B(a,t)});return}if(i.classList){i.classList.add(t);return}var e=i.className.trim();e?e.indexOf(t)<0&&(i.className="".concat(e," ").concat(t)):i.className=t}}function G(i,t){if(t){if(D(i.length)){I(i,function(e){G(e,t)});return}if(i.classList){i.classList.remove(t);return}i.className.indexOf(t)>=0&&(i.className=i.className.replace(t,""))}}function ft(i,t,e){if(t){if(D(i.length)){I(i,function(a){ft(a,t,e)});return}e?B(i,t):G(i,t)}}var Zi=/([a-z\d])([A-Z])/g;function ue(i){return i.replace(Zi,"$1-$2").toLowerCase()}function se(i,t){return dt(i[t])?i[t]:i.dataset?i.dataset[t]:i.getAttribute("data-".concat(ue(t)))}function Mt(i,t,e){dt(e)?i[t]=e:i.dataset?i.dataset[t]=e:i.setAttribute("data-".concat(ue(t)),e)}function Qi(i,t){if(dt(i[t]))try{delete i[t]}catch{i[t]=void 0}else if(i.dataset)try{delete i.dataset[t]}catch{i.dataset[t]=void 0}else i.removeAttribute("data-".concat(ue(t)))}var Ze=/\s\s*/,Qe=(function(){var i=!1;if(Bt){var t=!1,e=function(){},a=Object.defineProperty({},"once",{get:function(){return i=!0,t},set:function(r){t=r}});J.addEventListener("test",e,a),J.removeEventListener("test",e,a)}return i})();function X(i,t,e){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},s=e;t.trim().split(Ze).forEach(function(r){if(!Qe){var n=i.listeners;n&&n[r]&&n[r][e]&&(s=n[r][e],delete n[r][e],Object.keys(n[r]).length===0&&delete n[r],Object.keys(n).length===0&&delete i.listeners)}i.removeEventListener(r,s,a)})}function F(i,t,e){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},s=e;t.trim().split(Ze).forEach(function(r){if(a.once&&!Qe){var n=i.listeners,l=n===void 0?{}:n;s=function(){delete l[r][e],i.removeEventListener(r,s,a);for(var u=arguments.length,o=new Array(u),h=0;h<u;h++)o[h]=arguments[h];e.apply(i,o)},l[r]||(l[r]={}),l[r][e]&&i.removeEventListener(r,l[r][e],a),l[r][e]=s,i.listeners=l}i.addEventListener(r,s,a)})}function mt(i,t,e){var a;return U(Event)&&U(CustomEvent)?a=new CustomEvent(t,{detail:e,bubbles:!0,cancelable:!0}):(a=document.createEvent("CustomEvent"),a.initCustomEvent(t,!0,!0,e)),i.dispatchEvent(a)}function Ke(i){var t=i.getBoundingClientRect();return{left:t.left+(window.pageXOffset-document.documentElement.clientLeft),top:t.top+(window.pageYOffset-document.documentElement.clientTop)}}var Xt=J.location,Ki=/^(\w+:)\/\/([^:/?#]*):?(\d*)/i;function Ie(i){var t=i.match(Ki);return t!==null&&(t[1]!==Xt.protocol||t[2]!==Xt.hostname||t[3]!==Xt.port)}function Le(i){var t="timestamp=".concat(new Date().getTime());return i+(i.indexOf("?")===-1?"?":"&")+t}function kt(i){var t=i.rotate,e=i.scaleX,a=i.scaleY,s=i.translateX,r=i.translateY,n=[];D(s)&&s!==0&&n.push("translateX(".concat(s,"px)")),D(r)&&r!==0&&n.push("translateY(".concat(r,"px)")),D(t)&&t!==0&&n.push("rotate(".concat(t,"deg)")),D(e)&&e!==1&&n.push("scaleX(".concat(e,")")),D(a)&&a!==1&&n.push("scaleY(".concat(a,")"));var l=n.length?n.join(" "):"none";return{WebkitTransform:l,msTransform:l,transform:l}}function ta(i){var t=Ue({},i),e=0;return I(i,function(a,s){delete t[s],I(t,function(r){var n=Math.abs(a.startX-r.startX),l=Math.abs(a.startY-r.startY),d=Math.abs(a.endX-r.endX),u=Math.abs(a.endY-r.endY),o=Math.sqrt(n*n+l*l),h=Math.sqrt(d*d+u*u),p=(h-o)/o;Math.abs(p)>Math.abs(e)&&(e=p)})}),e}function St(i,t){var e=i.pageX,a=i.pageY,s={endX:e,endY:a};return t?s:Ue({startX:e,startY:a},s)}function ea(i){var t=0,e=0,a=0;return I(i,function(s){var r=s.startX,n=s.startY;t+=r,e+=n,a+=1}),t/=a,e/=a,{pageX:t,pageY:e}}function rt(i){var t=i.aspectRatio,e=i.height,a=i.width,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"contain",r=Ae(a),n=Ae(e);if(r&&n){var l=e*t;s==="contain"&&l>a||s==="cover"&&l<a?e=a/t:a=e*t}else r?e=a/t:n&&(a=e*t);return{width:a,height:e}}function ia(i){var t=i.width,e=i.height,a=i.degree;if(a=Math.abs(a)%180,a===90)return{width:e,height:t};var s=a%90*Math.PI/180,r=Math.sin(s),n=Math.cos(s),l=t*n+e*r,d=t*r+e*n;return a>90?{width:d,height:l}:{width:l,height:d}}function aa(i,t,e,a){var s=t.aspectRatio,r=t.naturalWidth,n=t.naturalHeight,l=t.rotate,d=l===void 0?0:l,u=t.scaleX,o=u===void 0?1:u,h=t.scaleY,p=h===void 0?1:h,x=e.aspectRatio,y=e.naturalWidth,O=e.naturalHeight,E=a.fillColor,L=E===void 0?"transparent":E,P=a.imageSmoothingEnabled,A=P===void 0?!0:P,Z=a.imageSmoothingQuality,z=Z===void 0?"low":Z,m=a.maxWidth,M=m===void 0?1/0:m,R=a.maxHeight,Y=R===void 0?1/0:R,Q=a.minWidth,st=Q===void 0?0:Q,nt=a.minHeight,K=nt===void 0?0:nt,j=document.createElement("canvas"),_=j.getContext("2d"),ot=rt({aspectRatio:x,width:M,height:Y}),Tt=rt({aspectRatio:x,width:st,height:K},"cover"),_t=Math.min(ot.width,Math.max(Tt.width,y)),Ut=Math.min(ot.height,Math.max(Tt.height,O)),ce=rt({aspectRatio:s,width:M,height:Y}),fe=rt({aspectRatio:s,width:st,height:K},"cover"),pe=Math.min(ce.width,Math.max(fe.width,r)),me=Math.min(ce.height,Math.max(fe.height,n)),ii=[-pe/2,-me/2,pe,me];return j.width=pt(_t),j.height=pt(Ut),_.fillStyle=L,_.fillRect(0,0,_t,Ut),_.save(),_.translate(_t/2,Ut/2),_.rotate(d*Math.PI/180),_.scale(o,p),_.imageSmoothingEnabled=A,_.imageSmoothingQuality=z,_.drawImage.apply(_,[i].concat(We(ii.map(function(ai){return Math.floor(pt(ai))})))),_.restore(),j}var ti=String.fromCharCode;function ra(i,t,e){var a="";e+=t;for(var s=t;s<e;s+=1)a+=ti(i.getUint8(s));return a}var sa=/^data:.*,/;function na(i){var t=i.replace(sa,""),e=atob(t),a=new ArrayBuffer(e.length),s=new Uint8Array(a);return I(s,function(r,n){s[n]=e.charCodeAt(n)}),a}function oa(i,t){for(var e=[],a=8192,s=new Uint8Array(i);s.length>0;)e.push(ti.apply(null,Je(s.subarray(0,a)))),s=s.subarray(a);return"data:".concat(t,";base64,").concat(btoa(e.join("")))}function la(i){var t=new DataView(i),e;try{var a,s,r;if(t.getUint8(0)===255&&t.getUint8(1)===216)for(var n=t.byteLength,l=2;l+1<n;){if(t.getUint8(l)===255&&t.getUint8(l+1)===225){s=l;break}l+=1}if(s){var d=s+4,u=s+10;if(ra(t,d,4)==="Exif"){var o=t.getUint16(u);if(a=o===18761,(a||o===19789)&&t.getUint16(u+2,a)===42){var h=t.getUint32(u+4,a);h>=8&&(r=u+h)}}}if(r){var p=t.getUint16(r,a),x,y;for(y=0;y<p;y+=1)if(x=r+y*12+2,t.getUint16(x,a)===274){x+=8,e=t.getUint16(x,a),t.setUint16(x,1,a);break}}}catch{e=1}return e}function ha(i){var t=0,e=1,a=1;switch(i){case 2:e=-1;break;case 3:t=-180;break;case 4:a=-1;break;case 5:t=90,a=-1;break;case 6:t=90;break;case 7:t=90,e=-1;break;case 8:t=-90;break}return{rotate:t,scaleX:e,scaleY:a}}var da={render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var t=this.element,e=this.options,a=this.container,s=this.cropper,r=Number(e.minContainerWidth),n=Number(e.minContainerHeight);B(s,H),G(t,H);var l={width:Math.max(a.offsetWidth,r>=0?r:qe),height:Math.max(a.offsetHeight,n>=0?n:Ge)};this.containerData=l,at(s,{width:l.width,height:l.height}),B(t,H),G(s,H)},initCanvas:function(){var t=this.containerData,e=this.imageData,a=this.options.viewMode,s=Math.abs(e.rotate)%180===90,r=s?e.naturalHeight:e.naturalWidth,n=s?e.naturalWidth:e.naturalHeight,l=r/n,d=t.width,u=t.height;t.height*l>t.width?a===3?d=t.height*l:u=t.width/l:a===3?u=t.width/l:d=t.height*l;var o={aspectRatio:l,naturalWidth:r,naturalHeight:n,width:d,height:u};this.canvasData=o,this.limited=a===1||a===2,this.limitCanvas(!0,!0),o.width=Math.min(Math.max(o.width,o.minWidth),o.maxWidth),o.height=Math.min(Math.max(o.height,o.minHeight),o.maxHeight),o.left=(t.width-o.width)/2,o.top=(t.height-o.height)/2,o.oldLeft=o.left,o.oldTop=o.top,this.initialCanvasData=$({},o)},limitCanvas:function(t,e){var a=this.options,s=this.containerData,r=this.canvasData,n=this.cropBoxData,l=a.viewMode,d=r.aspectRatio,u=this.cropped&&n;if(t){var o=Number(a.minCanvasWidth)||0,h=Number(a.minCanvasHeight)||0;l>1?(o=Math.max(o,s.width),h=Math.max(h,s.height),l===3&&(h*d>o?o=h*d:h=o/d)):l>0&&(o?o=Math.max(o,u?n.width:0):h?h=Math.max(h,u?n.height:0):u&&(o=n.width,h=n.height,h*d>o?o=h*d:h=o/d));var p=rt({aspectRatio:d,width:o,height:h});o=p.width,h=p.height,r.minWidth=o,r.minHeight=h,r.maxWidth=1/0,r.maxHeight=1/0}if(e)if(l>(u?0:1)){var x=s.width-r.width,y=s.height-r.height;r.minLeft=Math.min(0,x),r.minTop=Math.min(0,y),r.maxLeft=Math.max(0,x),r.maxTop=Math.max(0,y),u&&this.limited&&(r.minLeft=Math.min(n.left,n.left+(n.width-r.width)),r.minTop=Math.min(n.top,n.top+(n.height-r.height)),r.maxLeft=n.left,r.maxTop=n.top,l===2&&(r.width>=s.width&&(r.minLeft=Math.min(0,x),r.maxLeft=Math.max(0,x)),r.height>=s.height&&(r.minTop=Math.min(0,y),r.maxTop=Math.max(0,y))))}else r.minLeft=-r.width,r.minTop=-r.height,r.maxLeft=s.width,r.maxTop=s.height},renderCanvas:function(t,e){var a=this.canvasData,s=this.imageData;if(e){var r=ia({width:s.naturalWidth*Math.abs(s.scaleX||1),height:s.naturalHeight*Math.abs(s.scaleY||1),degree:s.rotate||0}),n=r.width,l=r.height,d=a.width*(n/a.naturalWidth),u=a.height*(l/a.naturalHeight);a.left-=(d-a.width)/2,a.top-=(u-a.height)/2,a.width=d,a.height=u,a.aspectRatio=n/l,a.naturalWidth=n,a.naturalHeight=l,this.limitCanvas(!0,!1)}(a.width>a.maxWidth||a.width<a.minWidth)&&(a.left=a.oldLeft),(a.height>a.maxHeight||a.height<a.minHeight)&&(a.top=a.oldTop),a.width=Math.min(Math.max(a.width,a.minWidth),a.maxWidth),a.height=Math.min(Math.max(a.height,a.minHeight),a.maxHeight),this.limitCanvas(!1,!0),a.left=Math.min(Math.max(a.left,a.minLeft),a.maxLeft),a.top=Math.min(Math.max(a.top,a.minTop),a.maxTop),a.oldLeft=a.left,a.oldTop=a.top,at(this.canvas,$({width:a.width,height:a.height},kt({translateX:a.left,translateY:a.top}))),this.renderImage(t),this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage:function(t){var e=this.canvasData,a=this.imageData,s=a.naturalWidth*(e.width/e.naturalWidth),r=a.naturalHeight*(e.height/e.naturalHeight);$(a,{width:s,height:r,left:(e.width-s)/2,top:(e.height-r)/2}),at(this.image,$({width:a.width,height:a.height},kt($({translateX:a.left,translateY:a.top},a)))),t&&this.output()},initCropBox:function(){var t=this.options,e=this.canvasData,a=t.aspectRatio||t.initialAspectRatio,s=Number(t.autoCropArea)||.8,r={width:e.width,height:e.height};a&&(e.height*a>e.width?r.height=r.width/a:r.width=r.height*a),this.cropBoxData=r,this.limitCropBox(!0,!0),r.width=Math.min(Math.max(r.width,r.minWidth),r.maxWidth),r.height=Math.min(Math.max(r.height,r.minHeight),r.maxHeight),r.width=Math.max(r.minWidth,r.width*s),r.height=Math.max(r.minHeight,r.height*s),r.left=e.left+(e.width-r.width)/2,r.top=e.top+(e.height-r.height)/2,r.oldLeft=r.left,r.oldTop=r.top,this.initialCropBoxData=$({},r)},limitCropBox:function(t,e){var a=this.options,s=this.containerData,r=this.canvasData,n=this.cropBoxData,l=this.limited,d=a.aspectRatio;if(t){var u=Number(a.minCropBoxWidth)||0,o=Number(a.minCropBoxHeight)||0,h=l?Math.min(s.width,r.width,r.width+r.left,s.width-r.left):s.width,p=l?Math.min(s.height,r.height,r.height+r.top,s.height-r.top):s.height;u=Math.min(u,s.width),o=Math.min(o,s.height),d&&(u&&o?o*d>u?o=u/d:u=o*d:u?o=u/d:o&&(u=o*d),p*d>h?p=h/d:h=p*d),n.minWidth=Math.min(u,h),n.minHeight=Math.min(o,p),n.maxWidth=h,n.maxHeight=p}e&&(l?(n.minLeft=Math.max(0,r.left),n.minTop=Math.max(0,r.top),n.maxLeft=Math.min(s.width,r.left+r.width)-n.width,n.maxTop=Math.min(s.height,r.top+r.height)-n.height):(n.minLeft=0,n.minTop=0,n.maxLeft=s.width-n.width,n.maxTop=s.height-n.height))},renderCropBox:function(){var t=this.options,e=this.containerData,a=this.cropBoxData;(a.width>a.maxWidth||a.width<a.minWidth)&&(a.left=a.oldLeft),(a.height>a.maxHeight||a.height<a.minHeight)&&(a.top=a.oldTop),a.width=Math.min(Math.max(a.width,a.minWidth),a.maxWidth),a.height=Math.min(Math.max(a.height,a.minHeight),a.maxHeight),this.limitCropBox(!1,!0),a.left=Math.min(Math.max(a.left,a.minLeft),a.maxLeft),a.top=Math.min(Math.max(a.top,a.minTop),a.maxTop),a.oldLeft=a.left,a.oldTop=a.top,t.movable&&t.cropBoxMovable&&Mt(this.face,Et,a.width>=e.width&&a.height>=e.height?Ye:he),at(this.cropBox,$({width:a.width,height:a.height},kt({translateX:a.left,translateY:a.top}))),this.cropped&&this.limited&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),mt(this.element,te,this.getData())}},ua={initPreview:function(){var t=this.element,e=this.crossOrigin,a=this.options.preview,s=e?this.crossOriginUrl:this.url,r=t.alt||"The image to preview",n=document.createElement("img");if(e&&(n.crossOrigin=e),n.src=s,n.alt=r,this.viewBox.appendChild(n),this.viewBoxImage=n,!!a){var l=a;typeof a=="string"?l=t.ownerDocument.querySelectorAll(a):a.querySelector&&(l=[a]),this.previews=l,I(l,function(d){var u=document.createElement("img");Mt(d,Nt,{width:d.offsetWidth,height:d.offsetHeight,html:d.innerHTML}),e&&(u.crossOrigin=e),u.src=s,u.alt=r,u.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"',d.innerHTML="",d.appendChild(u)})}},resetPreview:function(){I(this.previews,function(t){var e=se(t,Nt);at(t,{width:e.width,height:e.height}),t.innerHTML=e.html,Qi(t,Nt)})},preview:function(){var t=this.imageData,e=this.canvasData,a=this.cropBoxData,s=a.width,r=a.height,n=t.width,l=t.height,d=a.left-e.left-t.left,u=a.top-e.top-t.top;!this.cropped||this.disabled||(at(this.viewBoxImage,$({width:n,height:l},kt($({translateX:-d,translateY:-u},t)))),I(this.previews,function(o){var h=se(o,Nt),p=h.width,x=h.height,y=p,O=x,E=1;s&&(E=p/s,O=r*E),r&&O>x&&(E=x/r,y=s*E,O=x),at(o,{width:y,height:O}),at(o.getElementsByTagName("img")[0],$({width:n*E,height:l*E},kt($({translateX:-d*E,translateY:-u*E},t))))}))}},ca={bind:function(){var t=this.element,e=this.options,a=this.cropper;U(e.cropstart)&&F(t,ae,e.cropstart),U(e.cropmove)&&F(t,ie,e.cropmove),U(e.cropend)&&F(t,ee,e.cropend),U(e.crop)&&F(t,te,e.crop),U(e.zoom)&&F(t,re,e.zoom),F(a,Ee,this.onCropStart=this.cropStart.bind(this)),e.zoomable&&e.zoomOnWheel&&F(a,Ne,this.onWheel=this.wheel.bind(this),{passive:!1,capture:!0}),e.toggleDragModeOnDblclick&&F(a,ke,this.onDblclick=this.dblclick.bind(this)),F(t.ownerDocument,Me,this.onCropMove=this.cropMove.bind(this)),F(t.ownerDocument,Te,this.onCropEnd=this.cropEnd.bind(this)),e.responsive&&F(window,Ve,this.onResize=this.resize.bind(this))},unbind:function(){var t=this.element,e=this.options,a=this.cropper;U(e.cropstart)&&X(t,ae,e.cropstart),U(e.cropmove)&&X(t,ie,e.cropmove),U(e.cropend)&&X(t,ee,e.cropend),U(e.crop)&&X(t,te,e.crop),U(e.zoom)&&X(t,re,e.zoom),X(a,Ee,this.onCropStart),e.zoomable&&e.zoomOnWheel&&X(a,Ne,this.onWheel,{passive:!1,capture:!0}),e.toggleDragModeOnDblclick&&X(a,ke,this.onDblclick),X(t.ownerDocument,Me,this.onCropMove),X(t.ownerDocument,Te,this.onCropEnd),e.responsive&&X(window,Ve,this.onResize)}},fa={resize:function(){if(!this.disabled){var t=this.options,e=this.container,a=this.containerData,s=e.offsetWidth/a.width,r=e.offsetHeight/a.height,n=Math.abs(s-1)>Math.abs(r-1)?s:r;if(n!==1){var l,d;t.restore&&(l=this.getCanvasData(),d=this.getCropBoxData()),this.render(),t.restore&&(this.setCanvasData(I(l,function(u,o){l[o]=u*n})),this.setCropBoxData(I(d,function(u,o){d[o]=u*n})))}}},dblclick:function(){this.disabled||this.options.dragMode===je||this.setDragMode(Ji(this.dragBox,Qt)?Xe:de)},wheel:function(t){var e=this,a=Number(this.options.wheelZoomRatio)||.1,s=1;this.disabled||(t.preventDefault(),!this.wheeling&&(this.wheeling=!0,setTimeout(function(){e.wheeling=!1},50),t.deltaY?s=t.deltaY>0?1:-1:t.wheelDelta?s=-t.wheelDelta/120:t.detail&&(s=t.detail>0?1:-1),this.zoom(-s*a,t)))},cropStart:function(t){var e=t.buttons,a=t.button;if(!(this.disabled||(t.type==="mousedown"||t.type==="pointerdown"&&t.pointerType==="mouse")&&(D(e)&&e!==1||D(a)&&a!==0||t.ctrlKey))){var s=this.options,r=this.pointers,n;t.changedTouches?I(t.changedTouches,function(l){r[l.identifier]=St(l)}):r[t.pointerId||0]=St(t),Object.keys(r).length>1&&s.zoomable&&s.zoomOnTouch?n=Fe:n=se(t.target,Et),Ui.test(n)&&mt(this.element,ae,{originalEvent:t,action:n})!==!1&&(t.preventDefault(),this.action=n,this.cropping=!1,n===ze&&(this.cropping=!0,B(this.dragBox,Lt)))}},cropMove:function(t){var e=this.action;if(!(this.disabled||!e)){var a=this.pointers;t.preventDefault(),mt(this.element,ie,{originalEvent:t,action:e})!==!1&&(t.changedTouches?I(t.changedTouches,function(s){$(a[s.identifier]||{},St(s,!0))}):$(a[t.pointerId||0]||{},St(t,!0)),this.change(t))}},cropEnd:function(t){if(!this.disabled){var e=this.action,a=this.pointers;t.changedTouches?I(t.changedTouches,function(s){delete a[s.identifier]}):delete a[t.pointerId||0],e&&(t.preventDefault(),Object.keys(a).length||(this.action=""),this.cropping&&(this.cropping=!1,ft(this.dragBox,Lt,this.cropped&&this.options.modal)),mt(this.element,ee,{originalEvent:t,action:e}))}}},pa={change:function(t){var e=this.options,a=this.canvasData,s=this.containerData,r=this.cropBoxData,n=this.pointers,l=this.action,d=e.aspectRatio,u=r.left,o=r.top,h=r.width,p=r.height,x=u+h,y=o+p,O=0,E=0,L=s.width,P=s.height,A=!0,Z;!d&&t.shiftKey&&(d=h&&p?h/p:1),this.limited&&(O=r.minLeft,E=r.minTop,L=O+Math.min(s.width,a.width,a.left+a.width),P=E+Math.min(s.height,a.height,a.top+a.height));var z=n[Object.keys(n)[0]],m={x:z.endX-z.startX,y:z.endY-z.startY},M=function(Y){switch(Y){case lt:x+m.x>L&&(m.x=L-x);break;case ht:u+m.x<O&&(m.x=O-u);break;case tt:o+m.y<E&&(m.y=E-o);break;case ut:y+m.y>P&&(m.y=P-y);break}};switch(l){case he:u+=m.x,o+=m.y;break;case lt:if(m.x>=0&&(x>=L||d&&(o<=E||y>=P))){A=!1;break}M(lt),h+=m.x,h<0&&(l=ht,h=-h,u-=h),d&&(p=h/d,o+=(r.height-p)/2);break;case tt:if(m.y<=0&&(o<=E||d&&(u<=O||x>=L))){A=!1;break}M(tt),p-=m.y,o+=m.y,p<0&&(l=ut,p=-p,o-=p),d&&(h=p*d,u+=(r.width-h)/2);break;case ht:if(m.x<=0&&(u<=O||d&&(o<=E||y>=P))){A=!1;break}M(ht),h-=m.x,u+=m.x,h<0&&(l=lt,h=-h,u-=h),d&&(p=h/d,o+=(r.height-p)/2);break;case ut:if(m.y>=0&&(y>=P||d&&(u<=O||x>=L))){A=!1;break}M(ut),p+=m.y,p<0&&(l=tt,p=-p,o-=p),d&&(h=p*d,u+=(r.width-h)/2);break;case vt:if(d){if(m.y<=0&&(o<=E||x>=L)){A=!1;break}M(tt),p-=m.y,o+=m.y,h=p*d}else M(tt),M(lt),m.x>=0?x<L?h+=m.x:m.y<=0&&o<=E&&(A=!1):h+=m.x,m.y<=0?o>E&&(p-=m.y,o+=m.y):(p-=m.y,o+=m.y);h<0&&p<0?(l=yt,p=-p,h=-h,o-=p,u-=h):h<0?(l=bt,h=-h,u-=h):p<0&&(l=wt,p=-p,o-=p);break;case bt:if(d){if(m.y<=0&&(o<=E||u<=O)){A=!1;break}M(tt),p-=m.y,o+=m.y,h=p*d,u+=r.width-h}else M(tt),M(ht),m.x<=0?u>O?(h-=m.x,u+=m.x):m.y<=0&&o<=E&&(A=!1):(h-=m.x,u+=m.x),m.y<=0?o>E&&(p-=m.y,o+=m.y):(p-=m.y,o+=m.y);h<0&&p<0?(l=wt,p=-p,h=-h,o-=p,u-=h):h<0?(l=vt,h=-h,u-=h):p<0&&(l=yt,p=-p,o-=p);break;case yt:if(d){if(m.x<=0&&(u<=O||y>=P)){A=!1;break}M(ht),h-=m.x,u+=m.x,p=h/d}else M(ut),M(ht),m.x<=0?u>O?(h-=m.x,u+=m.x):m.y>=0&&y>=P&&(A=!1):(h-=m.x,u+=m.x),m.y>=0?y<P&&(p+=m.y):p+=m.y;h<0&&p<0?(l=vt,p=-p,h=-h,o-=p,u-=h):h<0?(l=wt,h=-h,u-=h):p<0&&(l=bt,p=-p,o-=p);break;case wt:if(d){if(m.x>=0&&(x>=L||y>=P)){A=!1;break}M(lt),h+=m.x,p=h/d}else M(ut),M(lt),m.x>=0?x<L?h+=m.x:m.y>=0&&y>=P&&(A=!1):h+=m.x,m.y>=0?y<P&&(p+=m.y):p+=m.y;h<0&&p<0?(l=bt,p=-p,h=-h,o-=p,u-=h):h<0?(l=yt,h=-h,u-=h):p<0&&(l=vt,p=-p,o-=p);break;case Ye:this.move(m.x,m.y),A=!1;break;case Fe:this.zoom(ta(n),t),A=!1;break;case ze:if(!m.x||!m.y){A=!1;break}Z=Ke(this.cropper),u=z.startX-Z.left,o=z.startY-Z.top,h=r.minWidth,p=r.minHeight,m.x>0?l=m.y>0?wt:vt:m.x<0&&(u-=h,l=m.y>0?yt:bt),m.y<0&&(o-=p),this.cropped||(G(this.cropBox,H),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0));break}A&&(r.width=h,r.height=p,r.left=u,r.top=o,this.action=l,this.renderCropBox()),I(n,function(R){R.startX=R.endX,R.startY=R.endY})}},ma={crop:function(){return this.ready&&!this.cropped&&!this.disabled&&(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&B(this.dragBox,Lt),G(this.cropBox,H),this.setCropBoxData(this.initialCropBoxData)),this},reset:function(){return this.ready&&!this.disabled&&(this.imageData=$({},this.initialImageData),this.canvasData=$({},this.initialCanvasData),this.cropBoxData=$({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox()),this},clear:function(){return this.cropped&&!this.disabled&&($(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),G(this.dragBox,Lt),B(this.cropBox,H)),this},replace:function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return!this.disabled&&t&&(this.isImg&&(this.element.src=t),e?(this.url=t,this.image.src=t,this.ready&&(this.viewBoxImage.src=t,I(this.previews,function(a){a.getElementsByTagName("img")[0].src=t}))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.uncreate(),this.load(t))),this},enable:function(){return this.ready&&this.disabled&&(this.disabled=!1,G(this.cropper,Ce)),this},disable:function(){return this.ready&&!this.disabled&&(this.disabled=!0,B(this.cropper,Ce)),this},destroy:function(){var t=this.element;return t[S]?(t[S]=void 0,this.isImg&&this.replaced&&(t.src=this.originalUrl),this.uncreate(),this):this},move:function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,a=this.canvasData,s=a.left,r=a.top;return this.moveTo(Ft(t)?t:s+Number(t),Ft(e)?e:r+Number(e))},moveTo:function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,a=this.canvasData,s=!1;return t=Number(t),e=Number(e),this.ready&&!this.disabled&&this.options.movable&&(D(t)&&(a.left=t,s=!0),D(e)&&(a.top=e,s=!0),s&&this.renderCanvas(!0)),this},zoom:function(t,e){var a=this.canvasData;return t=Number(t),t<0?t=1/(1-t):t=1+t,this.zoomTo(a.width*t/a.naturalWidth,null,e)},zoomTo:function(t,e,a){var s=this.options,r=this.canvasData,n=r.width,l=r.height,d=r.naturalWidth,u=r.naturalHeight;if(t=Number(t),t>=0&&this.ready&&!this.disabled&&s.zoomable){var o=d*t,h=u*t;if(mt(this.element,re,{ratio:t,oldRatio:n/d,originalEvent:a})===!1)return this;if(a){var p=this.pointers,x=Ke(this.cropper),y=p&&Object.keys(p).length?ea(p):{pageX:a.pageX,pageY:a.pageY};r.left-=(o-n)*((y.pageX-x.left-r.left)/n),r.top-=(h-l)*((y.pageY-x.top-r.top)/l)}else ct(e)&&D(e.x)&&D(e.y)?(r.left-=(o-n)*((e.x-r.left)/n),r.top-=(h-l)*((e.y-r.top)/l)):(r.left-=(o-n)/2,r.top-=(h-l)/2);r.width=o,r.height=h,this.renderCanvas(!0)}return this},rotate:function(t){return this.rotateTo((this.imageData.rotate||0)+Number(t))},rotateTo:function(t){return t=Number(t),D(t)&&this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=t%360,this.renderCanvas(!0,!0)),this},scaleX:function(t){var e=this.imageData.scaleY;return this.scale(t,D(e)?e:1)},scaleY:function(t){var e=this.imageData.scaleX;return this.scale(D(e)?e:1,t)},scale:function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,a=this.imageData,s=!1;return t=Number(t),e=Number(e),this.ready&&!this.disabled&&this.options.scalable&&(D(t)&&(a.scaleX=t,s=!0),D(e)&&(a.scaleY=e,s=!0),s&&this.renderCanvas(!0,!0)),this},getData:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,e=this.options,a=this.imageData,s=this.canvasData,r=this.cropBoxData,n;if(this.ready&&this.cropped){n={x:r.left-s.left,y:r.top-s.top,width:r.width,height:r.height};var l=a.width/a.naturalWidth;if(I(n,function(o,h){n[h]=o/l}),t){var d=Math.round(n.y+n.height),u=Math.round(n.x+n.width);n.x=Math.round(n.x),n.y=Math.round(n.y),n.width=u-n.x,n.height=d-n.y}}else n={x:0,y:0,width:0,height:0};return e.rotatable&&(n.rotate=a.rotate||0),e.scalable&&(n.scaleX=a.scaleX||1,n.scaleY=a.scaleY||1),n},setData:function(t){var e=this.options,a=this.imageData,s=this.canvasData,r={};if(this.ready&&!this.disabled&&ct(t)){var n=!1;e.rotatable&&D(t.rotate)&&t.rotate!==a.rotate&&(a.rotate=t.rotate,n=!0),e.scalable&&(D(t.scaleX)&&t.scaleX!==a.scaleX&&(a.scaleX=t.scaleX,n=!0),D(t.scaleY)&&t.scaleY!==a.scaleY&&(a.scaleY=t.scaleY,n=!0)),n&&this.renderCanvas(!0,!0);var l=a.width/a.naturalWidth;D(t.x)&&(r.left=t.x*l+s.left),D(t.y)&&(r.top=t.y*l+s.top),D(t.width)&&(r.width=t.width*l),D(t.height)&&(r.height=t.height*l),this.setCropBoxData(r)}return this},getContainerData:function(){return this.ready?$({},this.containerData):{}},getImageData:function(){return this.sized?$({},this.imageData):{}},getCanvasData:function(){var t=this.canvasData,e={};return this.ready&&I(["left","top","width","height","naturalWidth","naturalHeight"],function(a){e[a]=t[a]}),e},setCanvasData:function(t){var e=this.canvasData,a=e.aspectRatio;return this.ready&&!this.disabled&&ct(t)&&(D(t.left)&&(e.left=t.left),D(t.top)&&(e.top=t.top),D(t.width)?(e.width=t.width,e.height=t.width/a):D(t.height)&&(e.height=t.height,e.width=t.height*a),this.renderCanvas(!0)),this},getCropBoxData:function(){var t=this.cropBoxData,e;return this.ready&&this.cropped&&(e={left:t.left,top:t.top,width:t.width,height:t.height}),e||{}},setCropBoxData:function(t){var e=this.cropBoxData,a=this.options.aspectRatio,s,r;return this.ready&&this.cropped&&!this.disabled&&ct(t)&&(D(t.left)&&(e.left=t.left),D(t.top)&&(e.top=t.top),D(t.width)&&t.width!==e.width&&(s=!0,e.width=t.width),D(t.height)&&t.height!==e.height&&(r=!0,e.height=t.height),a&&(s?e.height=e.width/a:r&&(e.width=e.height*a)),this.renderCropBox()),this},getCroppedCanvas:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!this.ready||!window.HTMLCanvasElement)return null;var e=this.canvasData,a=aa(this.image,this.imageData,e,t);if(!this.cropped)return a;var s=this.getData(t.rounded),r=s.x,n=s.y,l=s.width,d=s.height,u=a.width/Math.floor(e.naturalWidth);u!==1&&(r*=u,n*=u,l*=u,d*=u);var o=l/d,h=rt({aspectRatio:o,width:t.maxWidth||1/0,height:t.maxHeight||1/0}),p=rt({aspectRatio:o,width:t.minWidth||0,height:t.minHeight||0},"cover"),x=rt({aspectRatio:o,width:t.width||(u!==1?a.width:l),height:t.height||(u!==1?a.height:d)}),y=x.width,O=x.height;y=Math.min(h.width,Math.max(p.width,y)),O=Math.min(h.height,Math.max(p.height,O));var E=document.createElement("canvas"),L=E.getContext("2d");E.width=pt(y),E.height=pt(O),L.fillStyle=t.fillColor||"transparent",L.fillRect(0,0,y,O);var P=t.imageSmoothingEnabled,A=P===void 0?!0:P,Z=t.imageSmoothingQuality;L.imageSmoothingEnabled=A,Z&&(L.imageSmoothingQuality=Z);var z=a.width,m=a.height,M=r,R=n,Y,Q,st,nt,K,j;M<=-l||M>z?(M=0,Y=0,st=0,K=0):M<=0?(st=-M,M=0,Y=Math.min(z,l+M),K=Y):M<=z&&(st=0,Y=Math.min(l,z-M),K=Y),Y<=0||R<=-d||R>m?(R=0,Q=0,nt=0,j=0):R<=0?(nt=-R,R=0,Q=Math.min(m,d+R),j=Q):R<=m&&(nt=0,Q=Math.min(d,m-R),j=Q);var _=[M,R,Y,Q];if(K>0&&j>0){var ot=y/l;_.push(st*ot,nt*ot,K*ot,j*ot)}return L.drawImage.apply(L,[a].concat(We(_.map(function(Tt){return Math.floor(pt(Tt))})))),E},setAspectRatio:function(t){var e=this.options;return!this.disabled&&!Ft(t)&&(e.aspectRatio=Math.max(0,t)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox())),this},setDragMode:function(t){var e=this.options,a=this.dragBox,s=this.face;if(this.ready&&!this.disabled){var r=t===de,n=e.movable&&t===Xe;t=r||n?t:je,e.dragMode=t,Mt(a,Et,t),ft(a,Qt,r),ft(a,Kt,n),e.cropBoxMovable||(Mt(s,Et,t),ft(s,Qt,r),ft(s,Kt,n))}return this}},ga=J.Cropper,ei=(function(){function i(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Vi(this,i),!t||!zi.test(t.tagName))throw new Error("The first argument is required and must be an <img> or <canvas> element.");this.element=t,this.options=$({},$e,ct(e)&&e),this.cropped=!1,this.disabled=!1,this.pointers={},this.ready=!1,this.reloading=!1,this.replaced=!1,this.sized=!1,this.sizing=!1,this.init()}return Ni(i,[{key:"init",value:function(){var e=this.element,a=e.tagName.toLowerCase(),s;if(!e[S]){if(e[S]=this,a==="img"){if(this.isImg=!0,s=e.getAttribute("src")||"",this.originalUrl=s,!s)return;s=e.src}else a==="canvas"&&window.HTMLCanvasElement&&(s=e.toDataURL());this.load(s)}}},{key:"load",value:function(e){var a=this;if(e){this.url=e,this.imageData={};var s=this.element,r=this.options;if(!r.rotatable&&!r.scalable&&(r.checkOrientation=!1),!r.checkOrientation||!window.ArrayBuffer){this.clone();return}if(Hi.test(e)){Wi.test(e)?this.read(na(e)):this.clone();return}var n=new XMLHttpRequest,l=this.clone.bind(this);this.reloading=!0,this.xhr=n,n.onabort=l,n.onerror=l,n.ontimeout=l,n.onprogress=function(){n.getResponseHeader("content-type")!==Se&&n.abort()},n.onload=function(){a.read(n.response)},n.onloadend=function(){a.reloading=!1,a.xhr=null},r.checkCrossOrigin&&Ie(e)&&s.crossOrigin&&(e=Le(e)),n.open("GET",e,!0),n.responseType="arraybuffer",n.withCredentials=s.crossOrigin==="use-credentials",n.send()}}},{key:"read",value:function(e){var a=this.options,s=this.imageData,r=la(e),n=0,l=1,d=1;if(r>1){this.url=oa(e,Se);var u=ha(r);n=u.rotate,l=u.scaleX,d=u.scaleY}a.rotatable&&(s.rotate=n),a.scalable&&(s.scaleX=l,s.scaleY=d),this.clone()}},{key:"clone",value:function(){var e=this.element,a=this.url,s=e.crossOrigin,r=a;this.options.checkCrossOrigin&&Ie(a)&&(s||(s="anonymous"),r=Le(a)),this.crossOrigin=s,this.crossOriginUrl=r;var n=document.createElement("img");s&&(n.crossOrigin=s),n.src=r||a,n.alt=e.alt||"The image to crop",this.image=n,n.onload=this.start.bind(this),n.onerror=this.stop.bind(this),B(n,De),e.parentNode.insertBefore(n,e.nextSibling)}},{key:"start",value:function(){var e=this,a=this.image;a.onload=null,a.onerror=null,this.sizing=!0;var s=J.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(J.navigator.userAgent),r=function(u,o){$(e.imageData,{naturalWidth:u,naturalHeight:o,aspectRatio:u/o}),e.initialImageData=$({},e.imageData),e.sizing=!1,e.sized=!0,e.build()};if(a.naturalWidth&&!s){r(a.naturalWidth,a.naturalHeight);return}var n=document.createElement("img"),l=document.body||document.documentElement;this.sizingImage=n,n.onload=function(){r(n.width,n.height),s||l.removeChild(n)},n.src=a.src,s||(n.style.cssText="left:0;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;opacity:0;position:absolute;top:0;z-index:-1;",l.appendChild(n))}},{key:"stop",value:function(){var e=this.image;e.onload=null,e.onerror=null,e.parentNode.removeChild(e),this.image=null}},{key:"build",value:function(){if(!(!this.sized||this.ready)){var e=this.element,a=this.options,s=this.image,r=e.parentNode,n=document.createElement("div");n.innerHTML=Yi;var l=n.querySelector(".".concat(S,"-container")),d=l.querySelector(".".concat(S,"-canvas")),u=l.querySelector(".".concat(S,"-drag-box")),o=l.querySelector(".".concat(S,"-crop-box")),h=o.querySelector(".".concat(S,"-face"));this.container=r,this.cropper=l,this.canvas=d,this.dragBox=u,this.cropBox=o,this.viewBox=l.querySelector(".".concat(S,"-view-box")),this.face=h,d.appendChild(s),B(e,H),r.insertBefore(l,e.nextSibling),G(s,De),this.initPreview(),this.bind(),a.initialAspectRatio=Math.max(0,a.initialAspectRatio)||NaN,a.aspectRatio=Math.max(0,a.aspectRatio)||NaN,a.viewMode=Math.max(0,Math.min(3,Math.round(a.viewMode)))||0,B(o,H),a.guides||B(o.getElementsByClassName("".concat(S,"-dashed")),H),a.center||B(o.getElementsByClassName("".concat(S,"-center")),H),a.background&&B(l,"".concat(S,"-bg")),a.highlight||B(h,Ri),a.cropBoxMovable&&(B(h,Kt),Mt(h,Et,he)),a.cropBoxResizable||(B(o.getElementsByClassName("".concat(S,"-line")),H),B(o.getElementsByClassName("".concat(S,"-point")),H)),this.render(),this.ready=!0,this.setDragMode(a.dragMode),a.autoCrop&&this.crop(),this.setData(a.data),U(a.ready)&&F(e,Oe,a.ready,{once:!0}),mt(e,Oe)}}},{key:"unbuild",value:function(){if(this.ready){this.ready=!1,this.unbind(),this.resetPreview();var e=this.cropper.parentNode;e&&e.removeChild(this.cropper),G(this.element,H)}}},{key:"uncreate",value:function(){this.ready?(this.unbuild(),this.ready=!1,this.cropped=!1):this.sizing?(this.sizingImage.onload=null,this.sizing=!1,this.sized=!1):this.reloading?(this.xhr.onabort=null,this.xhr.abort()):this.image&&this.stop()}}],[{key:"noConflict",value:function(){return window.Cropper=ga,i}},{key:"setDefaults",value:function(e){$($e,ct(e)&&e)}}])})();$(ei.prototype,da,ua,ca,fa,pa,ma);const va={props:{item:{type:Object,required:!0},save:{type:Object,required:!0}},emits:["update:item","update:file","error"],inject:["compose","locales","translate","txlocales","url"],data(){return{transcribing:!1,translating:!1,composing:!1,cropping:!1,covering:!1,tabtrans:null,tabdesc:null,cropper:null,cropLabel:null,scaleX:1,scaleY:1}},setup(){const i=si(),t=ne(),e=ni(),a=Pt();return{app:Be(),auth:a,languages:i,messages:t,side:e}},mounted(){this.init()},beforeUnmount(){this.cropper&&this.cropper.destroy()},computed:{desclangs(){return this.languages.available.concat(Object.keys(this.item.description||{})).filter((i,t,e)=>e.indexOf(i)===t)},ratio(){if(!this.cropper)return NaN;const i=this.cropper.getImageData();return i.naturalWidth/i.naturalHeight},readonly(){return!this.auth.can("file:save")}},methods:{addCover(){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");const i=this,t=this.$refs.video;if(!t)return this.messages.add(this.$gettext("No video element found"),"error");const e=this.item.path.replace(/\.[A-Za-z0-9]+$/,".png").split("/").pop(),a=document.createElement("canvas"),s=a.getContext("2d");a.width=t.videoWidth,a.height=t.videoHeight,s.drawImage(t,0,0,t.videoWidth,t.videoHeight),a.toBlob(function(r){const n=new File([r],e,{type:"image/png"});i.covering=!0,i.$apollo.mutate({mutation:W`mutation($id: ID!, $preview: Upload) {
              saveFile(id: $id, input: {}, preview: $preview) {
                id
                latest {
                  data
                  created_at
                }
              }
            }`,variables:{id:i.item.id,preview:n},context:{hasUpload:!0}}).then(l=>{var u,o,h;if(l.errors)throw l.errors;const d=(o=(u=l.data)==null?void 0:u.saveFile)==null?void 0:o.latest;d&&(i.item.previews=((h=JSON.parse(d.data||"{}"))==null?void 0:h.previews)||{},i.item.updated_at=d.created_at)}).catch(l=>{i.messages.add(this.$gettext("Error saving video cover")+`:
`+l,"error"),this.$log("FileDetailItem::addCover(): Error saving video cover",l)}).finally(()=>{i.covering=!1})},"image/png",1)},aspect(i){this.cropper.setAspectRatio(i),this.cropper.setDragMode("crop"),this.cropping=!0,this.$nextTick(()=>{const t=this.cropper.cropper.querySelector(".cropper-crop-box");if(t&&!this.cropLabel){const e=document.createElement("div");e.className="crop-label",t.appendChild(e),this.cropLabel=e}})},composeText(){const i=this.desclangs.shift()||this.item.lang||"en",t=`Summarize the content of the file in a few words in plain text format for a title tag in the language with the ISO code "${i}":`;this.composing=!0,this.compose(t,null,[this.item.id]).then(e=>{this.update("description",Object.assign(this.item.description||{},{[i]:e}))}).finally(()=>{this.composing=!1})},crop(){this.cropping=!1,this.cropper.setDragMode("none"),this.cropper.getCroppedCanvas().toBlob(i=>{this.$emit("update:file",i)})},download(){this.cropper.getCroppedCanvas().toBlob(i=>{const t=URL.createObjectURL(i),e=document.createElement("a");e.href=t,e.download=this.item.name||"download",e.click(),URL.revokeObjectURL(t)})},flipX(){this.scaleX=-this.scaleX,this.cropper.scaleX(this.scaleX),this.updateFile()},flipY(){this.scaleY=-this.scaleY,this.cropper.scaleY(this.scaleY),this.updateFile()},init(){var i;if(!this.readonly&&((i=this.item.mime)!=null&&i.startsWith("image/"))){this.cropper&&(this.cropper.destroy(),this.cropper=null);const t=this;this.cropper=new ei(this.$refs.image,{aspectRatio:NaN,background:!0,responsive:!0,dragMode:"none",movable:!1,autoCrop:!1,zoomable:!1,zoomOnWheel:!1,zoomOnTouch:!1,touchDragZoom:!1,checkCrossOrigin:!1,checkOrientation:!1,viewMode:1,crop(e){if(!t.cropLabel)return;const{width:a,height:s}=e.detail;t.cropLabel.textContent=`${Math.round(a)} Ã— ${Math.round(s)}`}})}},removeCover(){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");this.covering=!0,this.item.previews={},this.$apollo.mutate({mutation:W`mutation($id: ID!, $preview: Boolean) {
            saveFile(id: $id, input: {}, preview: $preview) {
              id
              latest {
                data
                created_at
              }
            }
          }`,variables:{id:this.item.id,preview:!1}}).then(i=>{var e,a,s;if(i.errors)throw i.errors;const t=(a=(e=i.data)==null?void 0:e.saveFile)==null?void 0:a.latest;t&&(this.item.previews=((s=JSON.parse(t.data||"{}"))==null?void 0:s.previews)||{},this.item.updated_at=t.created_at)}).catch(i=>{this.messages.add(this.$gettext("Error removing video cover")+`:
`+i,"error"),this.$log("FileDetailItem::removeCover(): Error removing video cover",i)}).finally(()=>{this.covering=!1})},reset(){this.cropping=!1,this.$emit("update:file",null),this.cropper.reset(),this.cropper.clear(),this.scaleX=1,this.scaleY=1},rotate(i){this.cropper.rotate(i),this.updateFile(),this.$nextTick(()=>{const t=this.cropper.getContainerData(),e=this.cropper.getImageData();let a,s;Math.abs(Math.abs(e.rotate)-180)===90?(a=t.width/e.naturalHeight,s=t.height/e.naturalWidth):(a=t.width/e.naturalWidth,s=t.height/e.naturalHeight),this.cropper.zoomTo(Math.min(a,s))})},transcribe(){var i,t;if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");if(!((i=this.item.mime)!=null&&i.startsWith("audio/"))&&!((t=this.item.mime)!=null&&t.startsWith("video/")))return this.messages.add(this.$gettext("Transcription is only available for audio and video files"),"error");this.transcribing=!0,bi(this.url(this.item.path,!0)).then(e=>this.$apollo.mutate({mutation:W`mutation($file: Upload!) {
              transcribe(file: $file)
            }`,variables:{file:new File([e],"audio.mp3",{type:"audio/mpeg"})},context:{hasUpload:!0}})).then(e=>{var s;if(e.errors)throw e;const a=this.desclangs[0]||this.item.lang||"en";this.update("transcription",Object.assign(this.item.transcription||{},{[a]:((s=e.data)==null?void 0:s.transcribe)||""}))}).catch(e=>{this.messages.add(this.$gettext("Error transcribing file")+`:
`+e,"error"),this.$log("FileDetailItem::transcribe(): Error transcribing from media URL",e)}).finally(()=>{this.transcribing=!1})},translateText(i){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");if(!i||typeof i!="object"){this.$log("FileDetailItem::translateText(): Invalid map object",i);return}const t=[],[e,a]=Object.entries(i||{}).find(([s,r])=>!!r);return this.translating=!0,this.txlocales(e).map(s=>s.code).forEach(s=>{t.push(this.translate(a,s).then(r=>{r[0]&&(i[s]=r[0])}).catch(r=>{this.$log("FileDetailItem::translateText(): Error translating text",r)}))}),Promise.all(t).then(()=>(this.$emit("update:item",this.item),this.translating=!1,i))},translateVTT(i){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");if(!i||typeof i!="object"){this.$log("FileDetailItem::translateVTT(): Invalid map object",i);return}const t=/^\d{2}:\d{2}:\d{2}\.\d{3} --\> \d{2}:\d{2}:\d{2}\.\d{3}(?: .*)?$/,e={...i};for(const[a,s]of Object.entries(e))s&&(e[a]=s.split(`
`).map(r=>r.startsWith("WEBVTT")||t.test(r)?`<x>${r}</x>`:r).filter(r=>r.trim()!=="").join(""));this.translateText(e).then(a=>{for(const[s,r]of Object.entries(a))a[s]&&(i[s]=a[s].replaceAll(/\<x\>/g,`

`).replaceAll(/\<\/x\>/g,`
`).trim());this.$emit("update:item",this.item)}).catch(a=>{this.$log("FileDetailItem::translateVTT(): Error translating VTT",a)})},update(i,t){this.item[i]=t,this.$emit("update:item",this.item)},updateFile(){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");this.cropper.getCroppedCanvas().toBlob(i=>{this.$emit("update:file",i)})},uploadCover(i){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");const t=i.target.files[0];if(!t)return this.messages.add(this.$gettext("No file selected"),"error");this.covering=!0,this.$apollo.mutate({mutation:W`mutation($id: ID!, $preview: Upload) {
            saveFile(id: $id, input: {}, preview: $preview) {
              id
              latest {
                data
                created_at
              }
            }
          }`,variables:{id:this.item.id,preview:t},context:{hasUpload:!0}}).then(e=>{var s,r,n;if(e.errors)throw e.errors;const a=(r=(s=e.data)==null?void 0:s.saveFile)==null?void 0:r.latest;a&&(this.item.previews=((n=JSON.parse(a.data||"{}"))==null?void 0:n.previews)||{},this.item.updated_at=a.created_at)}).catch(e=>{this.messages.add(this.$gettext("Error uploading video cover")+`:
`+e,"error"),this.$log("FileDetailItem::uploadCover(): Error uploading video cover",e)}).finally(()=>{this.covering=!1})}},watch:{"save.count":function(){this.save.count>0&&this.$nextTick(()=>{this.init()})}}},ba={key:0,ref:"editorContainer",class:"editor-container"},wa=["src"],ya={key:0,class:"toolbar"},xa={class:"toolbar-group"},Ca={class:"toolbar-group"},Da={class:"toolbar-group"},ka={class:"toolbar-group"},Ea={key:1,class:"editor-container"},Ma=["src"],Ta={key:0,class:"toolbar"},Oa={class:"toolbar-group"},Va=["src"],Na={key:1,class:"toolbar-group"},Sa=["src"],$a={key:3,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 16 16",fill:"currentColor"},Aa={key:0,class:"actions"},Ia={key:0,class:"actions"};function La(i,t,e,a,s,r){return v(),k(Re,null,{default:c(()=>[f(Pe,{class:"scroll"},{default:c(()=>{var n,l;return[f(Ot,null,{default:c(()=>[f(gt,{cols:"12",md:"6"},{default:c(()=>[f(_e,{ref:"name",readonly:r.readonly,modelValue:e.item.name,"onUpdate:modelValue":t[0]||(t[0]=d=>r.update("name",d)),variant:"underlined",label:i.$gettext("Name"),counter:"255",maxlength:"255"},null,8,["readonly","modelValue","label"])]),_:1}),f(gt,{cols:"12",md:"6"},{default:c(()=>[f(oi,{ref:"lang",items:r.locales(!0),readonly:r.readonly,modelValue:e.item.lang,"onUpdate:modelValue":t[1]||(t[1]=d=>r.update("lang",d)),variant:"underlined",label:i.$gettext("Language")},null,8,["items","readonly","modelValue","label"])]),_:1})]),_:1}),f(Ot,null,{default:c(()=>[e.item?(v(),k(gt,{key:0,cols:"12",class:"preview"},{default:c(()=>{var d,u,o;return[(d=e.item.mime)!=null&&d.startsWith("image/")?(v(),T("div",ba,[g("img",{ref:"image",src:r.url(e.item.path,!0),class:"element",crossorigin:"anonymous"},null,8,wa),r.readonly?V("",!0):(v(),T("div",ya,[g("div",xa,[s.cropping?(v(),k(w,{key:0,onClick:t[2]||(t[2]=h=>r.crop()),title:i.$gettext("Use cropped image"),icon:"mdi-image-check",class:"no-rtl"},null,8,["title"])):(v(),k(Ct,{key:1},{activator:c(({props:h})=>[f(w,Dt(h,{icon:"mdi-crop",class:"no-rtl",title:i.$gettext("Crop image")}),null,16,["title"])]),default:c(()=>[f(xt,null,{default:c(()=>[f(N,null,{default:c(()=>[f(w,{"prepend-icon":"mdi-crop",class:"no-rtl",variant:"text",onClick:t[3]||(t[3]=h=>r.aspect(r.ratio))},{default:c(()=>[C(b(i.$gettext("Original ratio")),1)]),_:1})]),_:1}),f(N,null,{default:c(()=>[f(w,{"prepend-icon":"mdi-crop",class:"no-rtl",variant:"text",onClick:t[4]||(t[4]=h=>r.aspect(NaN))},{default:c(()=>[C(b(i.$gettext("No ratio")),1)]),_:1})]),_:1}),f(N,null,{default:c(()=>[f(w,{"prepend-icon":"mdi-crop",class:"no-rtl",variant:"text",onClick:t[5]||(t[5]=h=>r.aspect(1))},{default:c(()=>[C(b(i.$gettext("Square")),1)]),_:1})]),_:1}),f(N,null,{default:c(()=>[f(w,{"prepend-icon":"mdi-crop",class:"no-rtl",variant:"text",onClick:t[6]||(t[6]=h=>r.aspect(3/2))},{default:c(()=>[...t[26]||(t[26]=[C("3:2",-1)])]),_:1})]),_:1}),f(N,null,{default:c(()=>[f(w,{"prepend-icon":"mdi-crop",class:"no-rtl",variant:"text",onClick:t[7]||(t[7]=h=>r.aspect(4/3))},{default:c(()=>[...t[27]||(t[27]=[C("4:3",-1)])]),_:1})]),_:1}),f(N,null,{default:c(()=>[f(w,{"prepend-icon":"mdi-crop",class:"no-rtl",variant:"text",onClick:t[8]||(t[8]=h=>r.aspect(5/3))},{default:c(()=>[...t[28]||(t[28]=[C("5:3",-1)])]),_:1})]),_:1}),f(N,null,{default:c(()=>[f(w,{"prepend-icon":"mdi-crop",class:"no-rtl",variant:"text",onClick:t[9]||(t[9]=h=>r.aspect(16/9))},{default:c(()=>[...t[29]||(t[29]=[C("16:9",-1)])]),_:1})]),_:1})]),_:1})]),_:1}))]),g("div",Ca,[f(w,{icon:"mdi-rotate-left",class:"no-rtl",onClick:t[10]||(t[10]=h=>r.rotate(-90)),title:i.$gettext("Rotate counter-clockwise")},null,8,["title"]),f(w,{icon:"mdi-rotate-right",class:"no-rtl",onClick:t[11]||(t[11]=h=>r.rotate(90)),title:i.$gettext("Rotate clockwise")},null,8,["title"])]),g("div",Da,[f(w,{icon:"mdi-flip-horizontal",class:"no-rtl",onClick:r.flipX,title:i.$gettext("Flip horizontally")},null,8,["onClick","title"]),f(w,{icon:"mdi-flip-vertical",class:"no-rtl",onClick:r.flipY,title:i.$gettext("Flip vertically")},null,8,["onClick","title"])]),g("div",ka,[f(w,{icon:"mdi-download",class:"no-rtl",onClick:t[12]||(t[12]=h=>r.download()),title:i.$gettext("Download")},null,8,["title"]),f(w,{icon:"mdi-history",class:"no-rtl",onClick:t[13]||(t[13]=h=>r.reset()),title:i.$gettext("Reset")},null,8,["title"])])]))],512)):(u=e.item.mime)!=null&&u.startsWith("video/")?(v(),T("div",Ea,[g("video",{ref:"video",src:r.url(e.item.path),crossorigin:"anonymous",class:"element",controls:""},null,8,Ma),r.readonly?V("",!0):(v(),T("div",Ta,[g("div",Oa,[Object.values(e.item.previews).length?(v(),T("img",{key:0,class:"video-preview",src:r.url(Object.values(e.item.previews).shift()),onClick:t[14]||(t[14]=h=>r.removeCover())},null,8,Va)):(v(),T("div",Na,[f(w,{icon:"mdi-tooltip-image",loading:s.covering,title:i.$gettext("Use as cover image"),onClick:t[15]||(t[15]=h=>r.addCover())},null,8,["loading","title"]),f(w,{icon:"",loading:s.covering,title:i.$gettext("Upload cover image"),onClick:t[17]||(t[17]=h=>i.$refs.coverInput.click())},{default:c(()=>[f($t,null,{default:c(()=>[...t[30]||(t[30]=[C("mdi-image-plus",-1)])]),_:1}),g("input",{ref:"coverInput",type:"file",class:"cover-input",onChange:t[16]||(t[16]=h=>r.uploadCover(h))},null,544)]),_:1},8,["loading","title"])]))])]))])):(o=e.item.mime)!=null&&o.startsWith("audio/")?(v(),T("audio",{key:2,src:r.url(e.item.path),crossorigin:"anonymous",class:"element",controls:""},null,8,Sa)):(v(),T("svg",$a,[...t[31]||(t[31]=[g("path",{d:"M7.05 11.885c0 1.415-.548 2.206-1.524 2.206C4.548 14.09 4 13.3 4 11.885c0-1.412.548-2.203 1.526-2.203.976 0 1.524.79 1.524 2.203m-1.524-1.612c-.542 0-.832.563-.832 1.612q0 .133.006.252l1.559-1.143c-.126-.474-.375-.72-.733-.72zm-.732 2.508c.126.472.372.718.732.718.54 0 .83-.563.83-1.614q0-.129-.006-.25zm6.061.624V14h-3v-.595h1.181V10.5h-.05l-1.136.747v-.688l1.19-.786h.69v3.633z"},null,-1),g("path",{d:"M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2M9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"},null,-1)])]))]}),_:1})):V("",!0)]),_:1}),f(Ot,null,{default:c(()=>[f(gt,{cols:"12",class:"description"},{default:c(()=>[f(ge,null,{default:c(()=>[C(b(i.$gettext("Descriptions"))+" ",1),r.readonly?V("",!0):(v(),T("div",Aa,[Object.values(e.item.description||{}).find(d=>!!d)?(v(),k(w,{key:0,onClick:t[18]||(t[18]=d=>r.translateText(e.item.description)),title:i.$gettext("Translate text"),loading:s.translating,icon:"mdi-translate",variant:"text",elevation:"0"},null,8,["title","loading"])):V("",!0),f(w,{onClick:t[19]||(t[19]=d=>r.composeText()),title:i.$gettext("Generate description"),loading:s.composing,icon:"mdi-creation",variant:"text",elevation:"0"},null,8,["title","loading"])]))]),_:1}),f(jt,{modelValue:s.tabdesc,"onUpdate:modelValue":t[20]||(t[20]=d=>s.tabdesc=d)},{default:c(()=>[(v(!0),T(q,null,et(r.locales(),d=>(v(),k(At,{value:d.value},{default:c(()=>[C(b(d.title),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"]),f(qt,{modelValue:s.tabdesc,"onUpdate:modelValue":t[21]||(t[21]=d=>s.tabdesc=d),touch:!1},{default:c(()=>[(v(!0),T(q,null,et(r.locales(),d=>(v(),k(It,{value:d.value},{default:c(()=>{var u;return[f(ve,{ref_for:!0,ref:"description","onUpdate:modelValue":o=>{e.item.description[d.value]=o,i.$emit("update:item",e.item)},label:i.$gettext("Description (%{lang})",{lang:d.value}),modelValue:((u=e.item.description)==null?void 0:u[d.value])||"",readonly:r.readonly,variant:"underlined",counter:"500",rows:"2","auto-grow":"",clearable:""},null,8,["onUpdate:modelValue","label","modelValue","readonly"])]}),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1}),(n=e.item.mime)!=null&&n.startsWith("audio/")||(l=e.item.mime)!=null&&l.startsWith("video/")?(v(),k(Ot,{key:0},{default:c(()=>[f(gt,{cols:"12",class:"transcription"},{default:c(()=>[f(ge,null,{default:c(()=>[C(b(i.$gettext("Transcriptions"))+" ",1),r.readonly?V("",!0):(v(),T("div",Ia,[Object.values(e.item.transcription||{}).find(d=>!!d)?(v(),k(w,{key:0,onClick:t[22]||(t[22]=d=>r.translateVTT(e.item.transcription)),title:i.$gettext("Translate text"),loading:s.translating,icon:"mdi-translate",variant:"text",elevation:"0"},null,8,["title","loading"])):V("",!0),f(w,{onClick:t[23]||(t[23]=d=>r.transcribe()),title:i.$gettext("Transcribe file content"),loading:s.transcribing,icon:"mdi-creation",variant:"text",elevation:"0"},null,8,["title","loading"])]))]),_:1}),f(jt,{modelValue:s.tabtrans,"onUpdate:modelValue":t[24]||(t[24]=d=>s.tabtrans=d)},{default:c(()=>[(v(!0),T(q,null,et(r.locales(),d=>(v(),k(At,{value:d.value},{default:c(()=>[C(b(d.title),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"]),f(qt,{modelValue:s.tabtrans,"onUpdate:modelValue":t[25]||(t[25]=d=>s.tabtrans=d),touch:!1},{default:c(()=>[(v(!0),T(q,null,et(r.locales(),d=>(v(),k(It,{value:d.value},{default:c(()=>{var u;return[f(ve,{ref_for:!0,ref:"transcription","onUpdate:modelValue":o=>{e.item.transcription[d.value]=o,i.$emit("update:item",e.item)},label:i.$gettext("Transcription (%{lang})",{lang:d.value}),modelValue:((u=e.item.transcription)==null?void 0:u[d.value])||"",readonly:r.readonly,variant:"underlined",rows:"20","auto-grow":"",clearable:""},null,8,["onUpdate:modelValue","label","modelValue","readonly"])]}),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1})):V("",!0)]}),_:1})]),_:1})}const Ra=Rt(va,[["render",La],["__scopeId","data-v-fe4b1e35"]]),Pa={components:{AsideMeta:yi,HistoryDialog:wi,FileDetailItem:Ra,FileDetailRefs:Ti},inject:["closeView"],props:{item:{type:Object,required:!0}},data:()=>({file:null,error:!1,changed:!1,publishAt:null,pubmenu:!1,vhistory:!1,tab:"file",savecnt:0}),setup(){const i=ne(),t=li();return{auth:Pt(),drawer:t,messages:i}},methods:{publish(i=null){if(!this.auth.can("file:publish")){this.messages.add(this.$gettext("Permission denied"),"error");return}this.save(!0).then(t=>{var e,a;t&&this.$apollo.mutate({mutation:W`mutation ($id: [ID!]!, $at: DateTime) {
              pubFile(id: $id, at: $at) {
                id
              }
            }`,variables:{id:[this.item.id],at:(a=(e=i==null?void 0:i.toISOString())==null?void 0:e.substring(0,19))==null?void 0:a.replace("T"," ")}}).then(s=>{if(s.errors)throw s.errors;i?(this.item.publish_at=i,this.messages.add(this.$gettext("File scheduled for publishing at %{date}",{date:i.toLocaleDateString()}),"info")):(this.item.published=!0,this.messages.add(this.$gettext("File published successfully"),"success")),this.closeView()}).catch(s=>{this.messages.add(this.$gettext("Error publishing file")+`:
`+s,"error"),this.$log("FileDetail::publish(): Error publishing file",i,s)})})},reset(){this.changed=!1,this.error=!1},save(i=!1){return this.auth.can("file:save")?this.error?(this.messages.add(this.$gettext("There are invalid fields, please resolve the errors first"),"error"),Promise.resolve(!1)):this.changed?this.$apollo.mutate({mutation:W`mutation ($id: ID!, $input: FileInput!, $file: Upload) {
            saveFile(id: $id, input: $input, file: $file) {
              id
              latest {
                id
                data
                created_at
              }
            }
          }`,variables:{id:this.item.id,input:{transcription:JSON.stringify(this.item.transcription||{}),description:JSON.stringify(this.item.description||{}),previews:JSON.stringify(this.item.previews||{}),path:this.item.path,name:this.item.name,lang:this.item.lang},file:this.file},context:{hasUpload:!0}}).then(t=>{var a,s;if(t.errors)throw t.errors;const e=(s=(a=t.data)==null?void 0:a.saveFile)==null?void 0:s.latest;return Object.assign(this.item,JSON.parse((e==null?void 0:e.data)||"{}")),this.item.updated_at=e==null?void 0:e.created_at,this.item.published=!1,this.reset(),i||this.messages.add(this.$gettext("File saved successfully"),"success"),this.savecnt++,!0}).catch(t=>{this.messages.add(this.$gettext("Error saving file")+`:
`+t,"error"),this.$log("FileDetail::save(): Error saving file",t)}):Promise.resolve(!0):(this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve(!1))},use(i){Object.assign(this.item,i.data),this.vhistory=!1,this.changed=!0,this.savecnt++},versions(i){return this.auth.can("file:view")?i?this.$apollo.query({query:W`query($id: ID!) {
            file(id: $id) {
              id
              versions {
                id
                published
                publish_at
                data
                editor
                created_at
              }
            }
          }`,variables:{id:i}}).then(t=>{if(t.errors||!t.data.file)throw t;const e=["previews","description","transcription"];return(t.data.file.versions||[]).map(a=>{const s={...a,data:JSON.parse(a.data||"{}")};return e.forEach(r=>s[r]??(s[r]={})),s}).reverse()}).catch(t=>{this.messages.add(this.$gettext("Error fetching file versions")+`:
`+t,"error"),this.$log("FileDetail::versions(): Error fetching file versions",i,t)}):Promise.resolve([]):(this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve([]))}}},Ba={class:"app-title"},_a={class:"menu-content"};function Ua(i,t,e,a,s,r){const n=Vt("FileDetailItem"),l=Vt("FileDetailRefs"),d=Vt("AsideMeta"),u=Vt("HistoryDialog");return v(),T(q,null,[f(hi,{elevation:0,density:"compact"},{prepend:c(()=>[f(w,{onClick:t[0]||(t[0]=o=>r.closeView()),title:i.$gettext("Back to list view"),icon:"mdi-keyboard-backspace"},null,8,["title"])]),append:c(()=>[f(w,{onClick:t[1]||(t[1]=o=>i.vhistory=!0),class:it([{hidden:e.item.published&&!i.changed&&!e.item.latest},"no-rtl"]),title:i.$gettext("View history"),icon:"mdi-history"},null,8,["class","title"]),f(w,{onClick:t[2]||(t[2]=o=>r.save()),title:i.$gettext("Save"),class:it([{error:i.error},"menu-save"]),disabled:!i.changed||i.error||!a.auth.can("file:save"),variant:!i.changed||i.error||!a.auth.can("file:save")?"plain":"flat",color:!i.changed||i.error||!a.auth.can("file:save")?"":"blue-darken-1",icon:"mdi-database-arrow-down"},null,8,["title","class","disabled","variant","color"]),f(Ct,{modelValue:i.pubmenu,"onUpdate:modelValue":t[5]||(t[5]=o=>i.pubmenu=o),"close-on-content-click":!1},{activator:c(({props:o})=>[f(w,Dt(o,{icon:"",title:i.$gettext("Schedule publishing"),class:[{error:i.error},"menu-publish"],disabled:e.item.published&&!i.changed||i.error||!a.auth.can("file:publish"),variant:e.item.published&&!i.changed||i.error||!a.auth.can("file:publish")?"plain":"flat",color:e.item.published&&!i.changed||i.error||!a.auth.can("file:publish")?"":"blue-darken-2"}),{default:c(()=>[f($t,null,{default:c(()=>[...t[17]||(t[17]=[g("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},[g("path",{d:"M2,1V3H16V1H2 M2,10H6V19H12V10H16L9,3L2,10Z"}),g("path",{d:"M16.7 11.4C16.7 11.4 16.61 11.4 16.7 11.4C13.19 11.49 10.4 14.28 10.4 17.7C10.4 21.21 13.19 24 16.7 24S23 21.21 23 17.7 20.21 11.4 16.7 11.4M16.7 22.2C14.18 22.2 12.2 20.22 12.2 17.7S14.18 13.2 16.7 13.2 21.2 15.18 21.2 17.7 19.22 22.2 16.7 22.2M15.6 13.1V17.6L18.84 19.58L19.56 18.5L16.95 16.97V13.1H15.6Z"})],-1)])]),_:1})]),_:1},16,["title","class","disabled","variant","color"])]),default:c(()=>[g("div",_a,[f(fi,{modelValue:i.publishAt,"onUpdate:modelValue":t[3]||(t[3]=o=>i.publishAt=o),"hide-header":"","show-adjacent-months":""},null,8,["modelValue"]),f(w,{onClick:t[4]||(t[4]=o=>{r.publish(i.publishAt),i.pubmenu=!1}),disabled:!i.publishAt||i.error,color:i.publishAt?"primary":"",variant:"text",elevation:"0"},{default:c(()=>[C(b(i.$gettext("Publish")),1)]),_:1},8,["disabled","color"])])]),_:1},8,["modelValue"]),f(w,{icon:"",onClick:t[6]||(t[6]=o=>r.publish()),title:i.$gettext("Publish"),class:it([{error:i.error},"menu-publish"]),disabled:e.item.published&&!i.changed||i.error||!a.auth.can("file:publish"),variant:e.item.published&&!i.changed||i.error||!a.auth.can("file:publish")?"plain":"flat",color:e.item.published&&!i.changed||i.error||!a.auth.can("file:publish")?"":"blue-darken-2"},{default:c(()=>[f($t,null,{default:c(()=>[...t[18]||(t[18]=[g("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},[g("path",{d:"M5,2V4H19V2H5 M5,12H9V21H15V12H19L12,5L5,12Z"})],-1)])]),_:1})]),_:1},8,["title","class","disabled","variant","color"]),f(w,{onClick:t[7]||(t[7]=Gt(o=>a.drawer.toggle("aside"),["stop"])),title:i.$gettext("Toggle side menu"),icon:a.drawer.aside?"mdi-chevron-right":"mdi-chevron-left"},null,8,["title","icon"])]),default:c(()=>[f(ci,null,{default:c(()=>[g("div",Ba,b(i.$gettext("File"))+": "+b(e.item.name),1)]),_:1})]),_:1}),f(di,{class:"file-details"},{default:c(()=>[f(pi,{onSubmit:t[13]||(t[13]=Gt(()=>{},["prevent"]))},{default:c(()=>[f(jt,{"fixed-tabs":"",modelValue:i.tab,"onUpdate:modelValue":t[8]||(t[8]=o=>i.tab=o)},{default:c(()=>[f(At,{value:"file",class:it({changed:i.changed,error:i.error})},{default:c(()=>[C(b(i.$gettext("File")),1)]),_:1},8,["class"]),f(At,{value:"refs"},{default:c(()=>[C(b(i.$gettext("Used by")),1)]),_:1})]),_:1},8,["modelValue"]),f(qt,{modelValue:i.tab,"onUpdate:modelValue":t[12]||(t[12]=o=>i.tab=o),touch:!1},{default:c(()=>[f(It,{value:"file"},{default:c(()=>[f(n,{"onUpdate:item":t[9]||(t[9]=o=>{this.$emit("update:item",e.item),i.changed=!0}),"onUpdate:file":t[10]||(t[10]=o=>{this.file=o,i.changed=!0}),onError:t[11]||(t[11]=o=>i.error=o),save:{count:i.savecnt},item:e.item},null,8,["save","item"])]),_:1}),f(It,{value:"refs"},{default:c(()=>[f(l,{item:e.item},null,8,["item"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),f(d,{item:e.item},null,8,["item"]),(v(),k(ui,{to:"body"},[f(u,{modelValue:i.vhistory,"onUpdate:modelValue":t[14]||(t[14]=o=>i.vhistory=o),current:{data:{lang:e.item.lang,name:e.item.name,mime:e.item.mime,path:e.item.path,previews:e.item.previews,description:e.item.description,transcription:e.item.transcription}},load:()=>r.versions(e.item.id),onUse:t[15]||(t[15]=o=>r.use(o)),onRevert:t[16]||(t[16]=o=>{r.use(o),r.reset()})},null,8,["modelValue","current","load"])]))],64)}const pr=Rt(Pa,[["render",Ua],["__scopeId","data-v-a499e16b"]]),Ha={props:{grid:{type:Boolean,default:!1},embed:{type:Boolean,default:!1},filter:{type:Object,default:()=>({})}},emits:["select"],inject:["debounce","url","srcset"],data(){return{items:[],term:"",sort:{column:"ID",order:"DESC"},page:1,last:1,limit:100,checked:!1,loading:!0,vgrid:!1}},setup(){const i=ne(),t=Pt();return{app:Be(),auth:t,messages:i}},created(){this.searchd=this.debounce(this.search,500),this.vgrid=this.grid,this.search()},computed:{canTrash(){return this.items.some(i=>i._checked&&!i.deleted_at)},isChecked(){return this.items.some(i=>i._checked)},isTrashed(){return this.items.some(i=>i._checked&&i.deleted_at)},order(){var i,t,e,a;return((i=this.sort)==null?void 0:i.column)==="ID"?((t=this.sort)==null?void 0:t.order)==="DESC"?this.$gettext("latest"):this.$gettext("oldest"):((e=this.sort)==null?void 0:e.column)==="BYVERSIONS_COUNT"?this.$gettext("usage"):((a=this.sort)==null?void 0:a.column)||""}},methods:{add(i){if(this.embed||!this.auth.can("file:add")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=[],e=i.target.files||i.dataTransfer.files||[];if(e.length)return Array.from(e).forEach(a=>{t.push(this.$apollo.mutate({mutation:W`mutation($file: Upload!) {
              addFile(file: $file) {
                id
                lang
                mime
                name
                path
                previews
                description
                transcription
                editor
                created_at
                updated_at
                deleted_at
              }
            }`,variables:{file:a},context:{hasUpload:!0}}).then(s=>{var n;if(s.errors)throw s.errors;const r=((n=s.data)==null?void 0:n.addFile)||{};return r.previews=JSON.parse(r.previews)||{},r.description=JSON.parse(r.description)||{},r.transcription=JSON.parse(r.transcription)||{},r.published=!0,this.items.unshift(r),this.$emit("select",r),r}).catch(s=>{this.messages.add(this.$gettext("Error adding file %{path}",{path:a.name})+`:
`+s,"error"),this.$log("FileListItems::add(): Error adding file",i,s)}))}),Promise.all(t).then(()=>{this.invalidate()})},drop(i){if(!this.auth.can("file:drop")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=i?[i]:this.items.filter(e=>e._checked);t.length&&this.$apollo.mutate({mutation:W`
            mutation($id: [ID!]!) {
              dropFile(id: $id) {
                id
              }
            }
          `,variables:{id:t.map(e=>e.id)}}).then(e=>{if(e.errors)throw e.errors;this.invalidate(),this.search()}).catch(e=>{this.messages.add(this.$gettext("Error trashing file")+`:
`+e,"error"),this.$log("FileListItems::drop(): Error trashing file",i,e)})},invalidate(){const i=this.$apollo.provider.defaultClient.cache;i.evict({id:"ROOT_QUERY",fieldName:"files"}),i.gc()},keep(i){if(!this.auth.can("file:keep")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=i?[i]:this.items.filter(e=>e._checked);t.length&&this.$apollo.mutate({mutation:W`
            mutation($id: [ID!]!) {
              keepFile(id: $id) {
                id
              }
            }
          `,variables:{id:t.map(e=>e.id)}}).then(e=>{if(e.errors)throw e.errors;t.forEach(a=>{a.deleted_at=null}),this.invalidate(),this.search()}).catch(e=>{this.messages.add(this.$gettext("Error restoring file")+`:
`+e,"error"),this.$log("FileListItems::keep(): Error restoring file",i,e)})},publish(i){if(!this.auth.can("file:publish")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=i?[i]:this.items.filter(e=>e._checked&&e.id&&!e.published);t.length&&this.$apollo.mutate({mutation:W`mutation ($id: [ID!]!) {
            pubFile(id: $id) {
              id
            }
          }`,variables:{id:t.map(e=>e.id)}}).then(e=>{if(e.errors)throw e.errors;t.forEach(a=>{a.published=!0,a._checked=!1}),this.invalidate(),this.search()}).catch(e=>{this.messages.add(this.$gettext("Error publishing file")+`:
`+e,"error"),this.$log("FileListItems::publish(): Error publishing file",i,e)})},purge(i){if(!this.auth.can("file:purge")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=i?[i]:this.items.filter(e=>e._checked);t.length&&this.$apollo.mutate({mutation:W`
            mutation($id: [ID!]!) {
              purgeFile(id: $id) {
                id
              }
            }
          `,variables:{id:t.map(e=>e.id)}}).then(e=>{if(e.errors)throw e.errors;this.invalidate(),this.search()}).catch(e=>{this.messages.add(this.$gettext("Error purging file")+`:
`+e,"error"),this.$log("FileListItems::purge(): Error purging file",i,e)})},search(){if(!this.auth.can("file:view"))return this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve([]);const i=this.filter.publish||null,t=this.filter.trashed||"WITHOUT",e={...this.filter};return delete e.trashed,delete e.publish,this.term&&(e.any=this.term),this.loading=!0,this.$apollo.query({query:W`
            query($filter: FileFilter, $sort: [QueryFilesSortOrderByClause!], $limit: Int!, $page: Int!, $trashed: Trashed, $publish: Publish) {
              files(filter: $filter, sort: $sort, first: $limit, page: $page, trashed: $trashed, publish: $publish) {
                data {
                  id
                  lang
                  name
                  mime
                  path
                  previews
                  description
                  transcription
                  editor
                  created_at
                  updated_at
                  deleted_at
                  latest {
                    id
                    published
                    publish_at
                    data
                    editor
                    created_at
                  }
                  byversions_count
                }
                paginatorInfo {
                  lastPage
                }
              }
            }
          `,variables:{filter:e,page:this.page,limit:this.limit,sort:[this.sort],trashed:t,publish:i}}).then(a=>{var n;if(a.errors)throw a.errors;const s=a.data.files||{},r=["previews","description","transcription"];return this.last=((n=s.paginatorInfo)==null?void 0:n.lastPage)||1,this.items=[...s.data||[]].map(l=>{var u,o,h,p,x,y;const d=(u=l.latest)!=null&&u.data?JSON.parse((o=l.latest)==null?void 0:o.data):{...l,previews:JSON.parse(l.previews||"{}"),description:JSON.parse(l.description||"{}"),transcription:JSON.parse(l.transcription||"{}")};return r.forEach(O=>d[O]??(d[O]={})),Object.assign(d,{id:l.id,deleted_at:l.deleted_at,created_at:l.created_at,updated_at:((h=l.latest)==null?void 0:h.created_at)||l.updated_at,editor:((p=l.latest)==null?void 0:p.editor)||l.editor,published:((x=l.latest)==null?void 0:x.published)??!0,publish_at:((y=l.latest)==null?void 0:y.publish_at)||null,latest:l.latest,usage:l.byversions_count})}),this.checked=!1,this.loading=!1,this.items}).catch(a=>{this.messages.add(this.$gettext("Error fetching files")+`:
`+a,"error"),this.$log("FileListItems::search(): Error fetching files",a)})},title(i){const t=[];return i.publish_at&&t.push("Publish at: "+new Date(i.publish_at).toLocaleDateString()),t.join(`
`)},toggle(){this.items.forEach(i=>{i._checked=!i._checked})}},watch:{filter:{deep:!0,handler(){this.search()}},term(){this.searchd()},page(){this.search()},sort(){this.search()}}},Wa={class:"header"},za={class:"bulk"},Ya={class:"search"},Fa={class:"layout"},Xa=["onClick","title"],ja=["onClick","title"],qa={key:2,viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},Ga={key:3,fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Ja={key:4,width:"24",height:"24",viewBox:"0 0 16 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},Za=["onClick","title"],Qa={class:"item-text"},Ka={class:"item-head"},tr={key:0,class:"item-lang"},er={class:"item-title"},ir={class:"item-mime item-subtitle"},ar={class:"item-aux"},rr={class:"item-editor"},sr={class:"item-modified item-subtitle"},nr={key:0,class:"loading"},or={key:1,class:"notfound"},lr={key:3,class:"btn-group"};function hr(i,t,e,a,s,r){return v(),T(q,null,[g("div",Wa,[g("div",za,[f(be,{modelValue:s.checked,"onUpdate:modelValue":t[0]||(t[0]=n=>s.checked=n),onClick:t[1]||(t[1]=Gt(n=>r.toggle(),["stop"]))},null,8,["modelValue"]),f(Ct,{location:"bottom left"},{activator:c(({props:n})=>[f(w,Dt(n,{disabled:!r.isChecked&&(e.embed||!a.auth.can("file:add")),"append-icon":"mdi-menu-down",variant:"text"}),{default:c(()=>[C(b(i.$gettext("Actions")),1)]),_:1},16,["disabled"])]),default:c(()=>[f(xt,null,{default:c(()=>[!e.embed&&a.auth.can("file:add")?(v(),k(N,{key:0},{default:c(()=>[f(w,{"prepend-icon":"mdi-folder-plus",variant:"text",onClick:t[2]||(t[2]=n=>i.$refs.upload.click())},{default:c(()=>[C(b(i.$gettext("Add files")),1)]),_:1})]),_:1})):V("",!0),r.isChecked&&a.auth.can("file:publish")?(v(),k(N,{key:1},{default:c(()=>[f(w,{"prepend-icon":"mdi-publish",variant:"text",onClick:t[3]||(t[3]=n=>r.publish())},{default:c(()=>[C(b(i.$gettext("Publish")),1)]),_:1})]),_:1})):V("",!0),r.canTrash&&a.auth.can("file:drop")?(v(),k(N,{key:2},{default:c(()=>[f(w,{"prepend-icon":"mdi-delete",variant:"text",onClick:t[4]||(t[4]=n=>r.drop())},{default:c(()=>[C(b(i.$gettext("Delete")),1)]),_:1})]),_:1})):V("",!0),r.isTrashed&&a.auth.can("file:keep")?(v(),k(N,{key:3},{default:c(()=>[f(w,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:t[5]||(t[5]=n=>r.keep())},{default:c(()=>[C(b(i.$gettext("Restore")),1)]),_:1})]),_:1})):V("",!0),r.isChecked&&a.auth.can("file:purge")?(v(),k(N,{key:4},{default:c(()=>[f(w,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:t[6]||(t[6]=n=>r.purge())},{default:c(()=>[C(b(i.$gettext("Purge")),1)]),_:1})]),_:1})):V("",!0)]),_:1})]),_:1})]),g("div",Ya,[f(_e,{modelValue:s.term,"onUpdate:modelValue":t[7]||(t[7]=n=>s.term=n),label:i.$gettext("Search for"),"prepend-inner-icon":"mdi-magnify",variant:"underlined","hide-details":"",clearable:""},null,8,["modelValue","label"])]),g("div",Fa,[s.vgrid?V("",!0):(v(),k(w,{key:0,onClick:t[8]||(t[8]=n=>s.vgrid=!0),title:i.$gettext("Grid view"),icon:"mdi-view-grid-outline",variant:"text",elevation:"0"},null,8,["title"])),s.vgrid?(v(),k(w,{key:1,onClick:t[9]||(t[9]=n=>s.vgrid=!1),title:i.$gettext("List view"),icon:"mdi-format-list-bulleted-square",variant:"text",elevation:"0"},null,8,["title"])):V("",!0),f(Ct,{location:"bottom right"},{activator:c(({props:n})=>[f(w,Dt(n,{title:i.$gettext("Sort by"),"append-icon":"mdi-menu-down","prepend-icon":"mdi-sort",variant:"text"}),{default:c(()=>[C(b(r.order),1)]),_:1},16,["title"])]),default:c(()=>[f(xt,null,{default:c(()=>[f(N,null,{default:c(()=>[f(w,{variant:"text",onClick:t[10]||(t[10]=n=>s.sort={column:"ID",order:"DESC"})},{default:c(()=>[C(b(i.$gettext("latest")),1)]),_:1})]),_:1}),f(N,null,{default:c(()=>[f(w,{variant:"text",onClick:t[11]||(t[11]=n=>s.sort={column:"ID",order:"ASC"})},{default:c(()=>[C(b(i.$gettext("oldest")),1)]),_:1})]),_:1}),f(N,null,{default:c(()=>[f(w,{variant:"text",onClick:t[12]||(t[12]=n=>s.sort={column:"NAME",order:"ASC"})},{default:c(()=>[C(b(i.$gettext("name")),1)]),_:1})]),_:1}),f(N,null,{default:c(()=>[f(w,{variant:"text",onClick:t[13]||(t[13]=n=>s.sort={column:"MIME",order:"ASC"})},{default:c(()=>[C(b(i.$gettext("mime")),1)]),_:1})]),_:1}),f(N,null,{default:c(()=>[f(w,{variant:"text",onClick:t[14]||(t[14]=n=>s.sort={column:"LANG",order:"ASC"})},{default:c(()=>[C(b(i.$gettext("language")),1)]),_:1})]),_:1}),f(N,null,{default:c(()=>[f(w,{variant:"text",onClick:t[15]||(t[15]=n=>s.sort={column:"EDITOR",order:"ASC"})},{default:c(()=>[C(b(i.$gettext("editor")),1)]),_:1})]),_:1}),f(N,null,{default:c(()=>[f(w,{variant:"text",onClick:t[16]||(t[16]=n=>s.sort={column:"BYVERSIONS_COUNT",order:"ASC"})},{default:c(()=>[C(b(i.$gettext("usage")),1)]),_:1})]),_:1})]),_:1})]),_:1})])]),f(xt,{class:it(["items",{grid:s.vgrid,list:!s.vgrid}])},{default:c(()=>[(v(!0),T(q,null,et(s.items,(n,l)=>(v(),k(N,{key:l},{default:c(()=>{var d,u,o,h;return[f(be,{modelValue:n._checked,"onUpdate:modelValue":p=>n._checked=p,class:it([{draft:!n.published},"item-check"])},null,8,["modelValue","onUpdate:modelValue","class"]),f(Ct,{location:"bottom "+(s.vgrid?"right":"left")},{activator:c(({props:p})=>[f(w,Dt({ref_for:!0},p,{title:i.$gettext("Actions"),icon:"mdi-dots-vertical",class:"item-menu",variant:"text"}),null,16,["title"])]),default:c(()=>[f(xt,null,{default:c(()=>[gi(f(N,null,{default:c(()=>[f(w,{"prepend-icon":"mdi-publish",variant:"text",onClick:p=>r.publish(n)},{default:c(()=>[C(b(i.$gettext("Publish")),1)]),_:1},8,["onClick"])]),_:2},1536),[[vi,!n.deleted_at&&!n.published&&a.auth.can("file:publish")]]),!n.deleted_at&&a.auth.can("file:drop")?(v(),k(N,{key:0},{default:c(()=>[f(w,{"prepend-icon":"mdi-delete",variant:"text",onClick:p=>r.drop(n)},{default:c(()=>[C(b(i.$gettext("Delete")),1)]),_:1},8,["onClick"])]),_:2},1024)):V("",!0),n.deleted_at&&a.auth.can("file:keep")?(v(),k(N,{key:1},{default:c(()=>[f(w,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:p=>r.keep(n)},{default:c(()=>[C(b(i.$gettext("Restore")),1)]),_:1},8,["onClick"])]),_:2},1024)):V("",!0),a.auth.can("file:purge")?(v(),k(N,{key:2},{default:c(()=>[f(w,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:p=>r.purge(n)},{default:c(()=>[C(b(i.$gettext("Purge")),1)]),_:1},8,["onClick"])]),_:2},1024)):V("",!0)]),_:2},1024)]),_:2},1032,["location"]),g("div",{class:it(["item-usage",{notused:!n.usage}]),onClick:p=>i.$emit("select",n),title:r.title(n)},b(n.usage),11,Xa),g("div",{class:"item-preview",onClick:p=>i.$emit("select",n),title:r.title(n)},[(d=n.mime)!=null&&d.startsWith("image/")?(v(),k(we,{key:0,src:r.url(n.path),srcset:r.srcset(n.previews),title:n.name},null,8,["src","srcset","title"])):(u=n.mime)!=null&&u.startsWith("video/")&&Object.values(n.previews).length?(v(),k(we,{key:1,src:r.url(Object.values(n.previews)[0]??""),srcset:r.srcset(n.previews),title:n.name},null,8,["src","srcset","title"])):(o=n.mime)!=null&&o.startsWith("video/")&&!Object.values(n.previews).length?(v(),T("svg",qa,[...t[20]||(t[20]=[g("path",{d:"M10,15L15.19,12L10,9V15M21.56,7.17C21.69,7.64 21.78,8.27 21.84,9.07C21.91,9.87 21.94,10.56 21.94,11.16L22,12C22,14.19 21.84,15.8 21.56,16.83C21.31,17.73 20.73,18.31 19.83,18.56C19.36,18.69 18.5,18.78 17.18,18.84C15.88,18.91 14.69,18.94 13.59,18.94L12,19C7.81,19 5.2,18.84 4.17,18.56C3.27,18.31 2.69,17.73 2.44,16.83C2.31,16.36 2.22,15.73 2.16,14.93C2.09,14.13 2.06,13.44 2.06,12.84L2,12C2,9.81 2.16,8.2 2.44,7.17C2.69,6.27 3.27,5.69 4.17,5.44C4.64,5.31 5.5,5.22 6.82,5.16C8.12,5.09 9.31,5.06 10.41,5.06L12,5C16.19,5 18.8,5.16 19.83,5.44C20.73,5.69 21.31,6.27 21.56,7.17Z"},null,-1)])])):(h=n.mime)!=null&&h.startsWith("audio/")?(v(),T("svg",Ga,[...t[21]||(t[21]=[g("path",{d:"M21,3V15.5A3.5,3.5 0 0,1 17.5,19A3.5,3.5 0 0,1 14,15.5A3.5,3.5 0 0,1 17.5,12C18.04,12 18.55,12.12 19,12.34V6.47L9,8.6V17.5A3.5,3.5 0 0,1 5.5,21A3.5,3.5 0 0,1 2,17.5A3.5,3.5 0 0,1 5.5,14C6.04,14 6.55,14.12 7,14.34V6L21,3Z"},null,-1)])])):(v(),T("svg",Ja,[...t[22]||(t[22]=[g("path",{d:"M7.05 11.885c0 1.415-.548 2.206-1.524 2.206C4.548 14.09 4 13.3 4 11.885c0-1.412.548-2.203 1.526-2.203.976 0 1.524.79 1.524 2.203m-1.524-1.612c-.542 0-.832.563-.832 1.612q0 .133.006.252l1.559-1.143c-.126-.474-.375-.72-.733-.72zm-.732 2.508c.126.472.372.718.732.718.54 0 .83-.563.83-1.614q0-.129-.006-.25zm6.061.624V14h-3v-.595h1.181V10.5h-.05l-1.136.747v-.688l1.19-.786h.69v3.633z"},null,-1),g("path",{d:"M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2M9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"},null,-1)])]))],8,ja),g("div",{class:it(["item-content",{trashed:n.deleted_at}]),onClick:p=>i.$emit("select",n),title:r.title(n)},[g("div",Qa,[g("div",Ka,[n.lang?(v(),T("span",tr,b(n.lang),1)):V("",!0),n.publish_at?(v(),k($t,{key:1,class:"publish-at",icon:"mdi-clock-outline"})):V("",!0),g("span",er,b(n.name),1)]),g("div",ir,b(n.mime),1)]),g("div",ar,[g("div",rr,b(n.editor),1),g("div",sr,b(new Date(n.updated_at).toLocaleString()),1)])],10,Za)]}),_:2},1024))),128))]),_:1},8,["class"]),s.loading?(v(),T("p",nr,[C(b(i.$gettext("Loading"))+" ",1),t[23]||(t[23]=g("svg",{class:"spinner",width:"32",height:"32",fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[g("circle",{class:"spin1",cx:"4",cy:"12",r:"3"}),g("circle",{class:"spin1 spin2",cx:"12",cy:"12",r:"3"}),g("circle",{class:"spin1 spin3",cx:"20",cy:"12",r:"3"})],-1))])):V("",!0),!s.loading&&!s.items.length?(v(),T("p",or,b(i.$gettext("No entries found")),1)):V("",!0),s.last>1?(v(),k(mi,{key:2,modelValue:s.page,"onUpdate:modelValue":t[17]||(t[17]=n=>s.page=n),length:s.last},null,8,["modelValue","length"])):V("",!0),!this.embed&&a.auth.can("file:add")?(v(),T("div",lr,[g("input",{onChange:t[18]||(t[18]=n=>r.add(n)),ref:"upload",type:"file",multiple:"",hidden:""},null,544),f(w,{onClick:t[19]||(t[19]=n=>i.$refs.upload.click()),title:i.$gettext("Add files"),icon:"mdi-folder-plus",color:"primary",variant:"flat"},null,8,["title"])])):V("",!0)],64)}const mr=Rt(Ha,[["render",hr],["__scopeId","data-v-79dfa238"]]);export{mr as F,pr as a};
