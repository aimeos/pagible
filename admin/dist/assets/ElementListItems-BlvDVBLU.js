import{_ as M,aG as ne,b as _,o as h,w as d,aQ as re,a as u,i as T,aR as de,c as v,F as $,a5 as V,j as k,f as g,aS as oe,l as p,t as c,aT as ue,aU as he,a7 as se,a8 as z,ax as ce,a9 as U,aV as me,d as w,aW as j,aX as K,n as I,a2 as X,aY as ee,k as y,aK as H,aZ as fe,a6 as ae,h as q,m as F,ag as pe,ah as ge,a_ as ve,aa as ye,a$ as _e,ab as be,b0 as ke,L,a3 as we,aM as te,I as Ce,aN as $e,T as xe,r as Ve,aO as A,aP as N,aD as Ie}from"./index-BX1pNUVh.js";const Ee={props:{item:{type:Object,required:!0}},setup(){return{drawer:ne()}},computed:{values(){const e={};return this.item.id&&(e[this.$gettext("id")]=this.item.id),this.item.mime&&(e[this.$gettext("mime")]=this.item.mime),this.item.editor&&(e[this.$gettext("editor")]=this.item.editor),this.item.created_at&&(e[this.$gettext("created")]=new Date(this.item.created_at).toLocaleString(this.$vuetify.locale.current)),this.item.updated_at&&(e[this.$gettext("updated")]=new Date(this.item.updated_at).toLocaleString(this.$vuetify.locale.current)),this.item.deleted_at&&(e[this.$gettext("deleted")]=new Date(this.item.deleted_at).toLocaleString(this.$vuetify.locale.current)),e}}};function Pe(e,t,s,l,o,n){return h(),_(re,{modelValue:l.drawer.aside,"onUpdate:modelValue":t[0]||(t[0]=r=>l.drawer.aside=r),"mobile-breakpoint":"md",location:"end"},{default:d(()=>[u(T,{opened:[0]},{default:d(()=>[u(de,{value:0},{activator:d(({props:r})=>[u(k,ue(he(r)),{default:d(()=>[p(c(e.$gettext("Meta data")),1)]),_:1},16)]),default:d(()=>[(h(!0),v($,null,V(n.values,(r,i)=>(h(),_(k,{key:i,rounded:"lg"},{default:d(()=>[u(oe,{class:"name"},{default:d(()=>[p(c(i),1)]),_:2},1024),g("div",null,c(r),1)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])}const bt=M(Ee,[["render",Pe],["__scopeId","data-v-602996ad"]]);class ie{diff(t,s,l={}){let o;typeof l=="function"?(o=l,l={}):"callback"in l&&(o=l.callback);const n=this.castInput(t,l),r=this.castInput(s,l),i=this.removeEmpty(this.tokenize(n,l)),a=this.removeEmpty(this.tokenize(r,l));return this.diffWithOptionsObj(i,a,l,o)}diffWithOptionsObj(t,s,l,o){var n;const r=b=>{if(b=this.postProcess(b,l),o){setTimeout(function(){o(b)},0);return}else return b},i=s.length,a=t.length;let m=1,f=i+a;l.maxEditLength!=null&&(f=Math.min(f,l.maxEditLength));const C=(n=l.timeout)!==null&&n!==void 0?n:1/0,E=Date.now()+C,x=[{oldPos:-1,lastComponent:void 0}];let P=this.extractCommon(x[0],s,t,0,l);if(x[0].oldPos+1>=a&&P+1>=i)return r(this.buildValues(x[0].lastComponent,s,t));let R=-1/0,W=1/0;const G=()=>{for(let b=Math.max(R,-m);b<=Math.min(W,m);b+=2){let D;const O=x[b-1],S=x[b+1];O&&(x[b-1]=void 0);let J=!1;if(S){const Z=S.oldPos-b;J=S&&0<=Z&&Z<i}const Q=O&&O.oldPos+1<a;if(!J&&!Q){x[b]=void 0;continue}if(!Q||J&&O.oldPos<S.oldPos?D=this.addToPath(S,!0,!1,0,l):D=this.addToPath(O,!1,!0,1,l),P=this.extractCommon(D,s,t,b,l),D.oldPos+1>=a&&P+1>=i)return r(this.buildValues(D.lastComponent,s,t))||!0;x[b]=D,D.oldPos+1>=a&&(W=Math.min(W,b-1)),P+1>=i&&(R=Math.max(R,b+1))}m++};if(o)(function b(){setTimeout(function(){if(m>f||Date.now()>E)return o(void 0);G()||b()},0)})();else for(;m<=f&&Date.now()<=E;){const b=G();if(b)return b}}addToPath(t,s,l,o,n){const r=t.lastComponent;return r&&!n.oneChangePerToken&&r.added===s&&r.removed===l?{oldPos:t.oldPos+o,lastComponent:{count:r.count+1,added:s,removed:l,previousComponent:r.previousComponent}}:{oldPos:t.oldPos+o,lastComponent:{count:1,added:s,removed:l,previousComponent:r}}}extractCommon(t,s,l,o,n){const r=s.length,i=l.length;let a=t.oldPos,m=a-o,f=0;for(;m+1<r&&a+1<i&&this.equals(l[a+1],s[m+1],n);)m++,a++,f++,n.oneChangePerToken&&(t.lastComponent={count:1,previousComponent:t.lastComponent,added:!1,removed:!1});return f&&!n.oneChangePerToken&&(t.lastComponent={count:f,previousComponent:t.lastComponent,added:!1,removed:!1}),t.oldPos=a,m}equals(t,s,l){return l.comparator?l.comparator(t,s):t===s||!!l.ignoreCase&&t.toLowerCase()===s.toLowerCase()}removeEmpty(t){const s=[];for(let l=0;l<t.length;l++)t[l]&&s.push(t[l]);return s}castInput(t,s){return t}tokenize(t,s){return Array.from(t)}join(t){return t.join("")}postProcess(t,s){return t}get useLongestToken(){return!1}buildValues(t,s,l){const o=[];let n;for(;t;)o.push(t),n=t.previousComponent,delete t.previousComponent,t=n;o.reverse();const r=o.length;let i=0,a=0,m=0;for(;i<r;i++){const f=o[i];if(f.removed)f.value=this.join(l.slice(m,m+f.count)),m+=f.count;else{if(!f.added&&this.useLongestToken){let C=s.slice(a,a+f.count);C=C.map(function(E,x){const P=l[m+x];return P.length>E.length?P:E}),f.value=this.join(C)}else f.value=this.join(s.slice(a,a+f.count));a+=f.count,f.added||(m+=f.count)}}return o}}class De extends ie{constructor(){super(...arguments),this.tokenize=le}equals(t,s,l){return l.ignoreWhitespace?((!l.newlineIsToken||!t.includes(`
`))&&(t=t.trim()),(!l.newlineIsToken||!s.includes(`
`))&&(s=s.trim())):l.ignoreNewlineAtEof&&!l.newlineIsToken&&(t.endsWith(`
`)&&(t=t.slice(0,-1)),s.endsWith(`
`)&&(s=s.slice(0,-1))),super.equals(t,s,l)}}new De;function le(e,t){t.stripTrailingCr&&(e=e.replace(/\r\n/g,`
`));const s=[],l=e.split(/(\n|\r\n)/);l[l.length-1]||l.pop();for(let o=0;o<l.length;o++){const n=l[o];o%2&&!t.newlineIsToken?s[s.length-1]+=n:s.push(n)}return s}class Le extends ie{constructor(){super(...arguments),this.tokenize=le}get useLongestToken(){return!0}castInput(t,s){const{undefinedReplacement:l,stringifyReplacer:o=(n,r)=>typeof r>"u"?l:r}=s;return typeof t=="string"?t:JSON.stringify(Y(t,null,null,o),null,"  ")}equals(t,s,l){return super.equals(t.replace(/,([\r\n])/g,"$1"),s.replace(/,([\r\n])/g,"$1"),l)}}const B=new Le;function Y(e,t,s,l,o){t=t||[],s=s||[],l&&(e=l(o===void 0?"":o,e));let n;for(n=0;n<t.length;n+=1)if(t[n]===e)return s[n];let r;if(Object.prototype.toString.call(e)==="[object Array]"){for(t.push(e),r=new Array(e.length),s.push(r),n=0;n<e.length;n+=1)r[n]=Y(e[n],t,s,l,String(n));return t.pop(),s.pop(),r}if(e&&e.toJSON&&(e=e.toJSON()),typeof e=="object"&&e!==null){t.push(e),r={},s.push(r);const i=[];let a;for(a in e)Object.prototype.hasOwnProperty.call(e,a)&&i.push(a);for(i.sort(),n=0;n<i.length;n+=1)a=i[n],r[a]=Y(e[a],t,s,l,a);t.pop(),s.pop()}else r=e;return r}const Te=B.castInput;B.castInput=function(e,t){let s=Te.call(this,e,t);return typeof s=="string"&&(s=s.replace(/\\n/g,`
`)),s};const Oe={props:{modelValue:{type:Boolean,required:!0},current:{type:Object,required:!0},load:{type:Function,required:!0}},emit:["update:modelValue","use","revert"],inject:["url","srcset"],data:()=>({list:[],latest:null,loading:!1,show:!1}),computed:{versions(){return this.list.filter(e=>this.isModified(e,this.current)||e.published||e.publish_at)}},methods:{diff(e,t){return e&&t?B.diff(e,t):t?[t]:[]},filesdiff(e,t){const s=Object.keys(e||{}),l=Object.keys(t||{}),o=s.filter(a=>!l.includes(a)),n=l.filter(a=>!s.includes(a)),r=Object.fromEntries(Object.entries(e||{}).filter(([a])=>o.includes(a)).map(([a,m])=>[a,{...m,css:"added"}])),i=Object.fromEntries(Object.entries(t||{}).filter(([a])=>n.includes(a)).map(([a,m])=>[a,{...m,css:"removed"}]));return{...r,...i}},isModified(e,t){return!e||!t?!1:B.diff(e.data||{},t.data||{}).length!==1},reset(){this.list=[],this.latest=null}},watch:{modelValue:{immediate:!0,handler(e){e&&!this.latest&&(this.loading=!0,this.load().then(t=>{this.list=t||[],this.latest=(t==null?void 0:t.shift())||null}).finally(()=>{this.loading=!1}))}}}},Se={class:"loading"},Ae={class:"media-list"},Ne=["poster","src"],ze={key:2},Me=["src"],je={key:3},Ue=["onClick"],qe={class:"media-list"},Fe=["poster","src"],Be={key:2},Re=["src"],We={key:3};function Je(e,t,s,l,o,n){return h(),_(se,{modelValue:s.modelValue,onAfterLeave:t[4]||(t[4]=r=>e.$emit("update:modelValue",!1)),"max-width":"1200",scrollable:""},{default:d(()=>[u(z,{"prepend-icon":"mdi-history"},{append:d(()=>[u(y,{title:e.$gettext("Close"),onClick:t[0]||(t[0]=r=>e.$emit("update:modelValue",!1)),icon:"mdi-close",variant:"text",elevation:"0"},null,8,["title"])]),title:d(()=>[p(c(e.$gettext("History")),1)]),default:d(()=>[u(ce),u(U,null,{default:d(()=>[u(me,{side:"end",align:"start"},{default:d(()=>[e.loading?(h(),_(j,{key:0,"dot-color":"grey-lighten-1",size:"small",width:"100%"},{default:d(()=>[g("div",Se,[p(c(e.$gettext("Loading"))+" ",1),t[5]||(t[5]=g("svg",{class:"spinner",width:"32",height:"32",fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[g("circle",{class:"spin1",cx:"4",cy:"12",r:"3"}),g("circle",{class:"spin1 spin2",cx:"12",cy:"12",r:"3"}),g("circle",{class:"spin1 spin3",cx:"20",cy:"12",r:"3"})],-1))])]),_:1})):w("",!0),!e.loading&&!(e.latest&&n.isModified(e.latest,s.current)||n.versions.length)?(h(),_(j,{key:1,"dot-color":"grey-lighten-1",width:"100%",size:"small"},{default:d(()=>[p(c(e.$gettext("No changes")),1)]),_:1})):w("",!0),!e.loading&&e.latest&&n.isModified(e.latest,s.current)?(h(),_(j,{key:2,"dot-color":"blue",width:"100%",size:"small"},{default:d(()=>[u(z,{class:"elevation-2"},{default:d(()=>[u(K,{onClick:t[1]||(t[1]=r=>e.show=!e.show)},{default:d(()=>[p(c(e.$gettext("Current")),1)]),_:1}),u(U,null,{default:d(()=>{var r,i;return[g("div",{class:I(["diff",{show:e.show}]),onClick:t[2]||(t[2]=a=>e.show=!e.show)},[(h(!0),v($,null,V(n.diff((r=e.latest)==null?void 0:r.data,s.current.data),a=>(h(),v("span",{class:I({added:a.added,removed:a.removed})},c(a.value||a),3))),256))],2),g("div",Ae,[(h(!0),v($,null,V(n.filesdiff(s.current.files,(i=e.latest)==null?void 0:i.files),a=>{var m,f,C;return h(),v("div",{key:a.id,class:I([a.css,"file"])},[(m=a.mime)!=null&&m.startsWith("image/")?(h(),_(X,{key:0,srcset:n.srcset(a.previews),src:n.url(a.path),alt:a.name,draggable:"false",loading:"lazy"},null,8,["srcset","src","alt"])):(f=a.mime)!=null&&f.startsWith("video/")?(h(),v("video",{key:1,poster:n.url(Object.values(a.previews).shift()),src:n.url(a.path),crossorigin:"anonymous",draggable:"false",loading:"lazy",controls:""},null,8,Ne)):(C=a.mime)!=null&&C.startsWith("audio/")?(h(),v("div",ze,[g("audio",{src:n.url(a.path),crossorigin:"anonymous",draggable:"false",loading:"lazy",controls:""},null,8,Me),p(" "+c(a.name),1)])):(h(),v("div",je,c(a.name),1))],2)}),128))])]}),_:1}),u(ee,null,{default:d(()=>[u(y,{variant:"outlined",onClick:t[3]||(t[3]=H(r=>e.$emit("revert",e.latest),["stop"]))},{default:d(()=>[p(c(e.$gettext("Revert")),1)]),_:1})]),_:1})]),_:1})]),_:1})):w("",!0),(h(!0),v($,null,V(n.versions,(r,i)=>(h(),_(j,{key:i,"dot-color":r.published?"success":"grey-lighten-1",class:I({publish:r.publish_at}),width:"100%",size:"small"},{default:d(()=>[u(z,{class:"elevation-2"},{default:d(()=>[u(K,{onClick:a=>r._show=!r._show},{default:d(()=>[p(c(new Date(r.publish_at||r.created_at).toLocaleString(e.$vuetify.locale.current)),1)]),_:2},1032,["onClick"]),u(fe,{onClick:a=>r._show=!r._show},{default:d(()=>[p(c(r.editor),1)]),_:2},1032,["onClick"]),u(U,null,{default:d(()=>[g("div",{class:I(["diff",{show:r._show}]),onClick:a=>r._show=!r._show},[(h(!0),v($,null,V(n.diff(r.data,s.current.data),a=>(h(),v("span",{class:I({added:a.removed,removed:a.added})},c(a.value||a),3))),256))],10,Ue),g("div",qe,[(h(!0),v($,null,V(n.filesdiff(r.files,s.current.files),a=>{var m,f,C;return h(),v("div",{key:a.id,class:I([a.css,"file"])},[(m=a.mime)!=null&&m.startsWith("image/")?(h(),_(X,{key:0,srcset:n.srcset(a.previews),src:n.url(a.path),alt:a.name,draggable:"false",loading:"lazy"},null,8,["srcset","src","alt"])):(f=a.mime)!=null&&f.startsWith("video/")?(h(),v("video",{key:1,poster:n.url(Object.values(a.previews).shift()),src:n.url(a.path),crossorigin:"anonymous",draggable:"false",loading:"lazy",controls:""},null,8,Fe)):(C=a.mime)!=null&&C.startsWith("audio/")?(h(),v("div",Be,[g("audio",{src:n.url(a.path),crossorigin:"anonymous",draggable:"false",loading:"lazy",controls:""},null,8,Re),p(" "+c(a.name),1)])):(h(),v("div",We,c(a.name),1))],2)}),128))])]),_:2},1024),u(ee,null,{default:d(()=>[u(y,{variant:"outlined",onClick:H(a=>e.$emit("use",r),["stop"])},{default:d(()=>[p(c(e.$gettext("Use version")),1)]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["dot-color","class"]))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}const kt=M(Oe,[["render",Je],["__scopeId","data-v-3b62810a"]]),He={props:{data:{type:Object,default:()=>{}},files:{type:Array,default:()=>[]},assets:{type:Object,default:()=>{}},readonly:{type:Boolean,default:!1},fields:{type:Object,required:!0},type:{type:String,default:""}},emits:["change","error","update:files"],inject:["compose","translate","txlocales"],data(){return{translating:{},composing:{},errors:{}}},setup(){return{messages:ae()}},methods:{addFile(e){if(!(e!=null&&e.id)){this.$log("Fields::addFile(): Invalid item without ID",e);return}const t=[...this.files];t.push(e.id),this.assets[e.id]=e,this.$emit("update:files",t)},composeText(e){const t=['generate for field "'+(this.fields[e].label||e)+'"','required output format is "'+this.fields[e].type+'"',this.fields[e].min?"minimum characters: "+this.fields[e].min:null,this.fields[e].max?"maximum characters: "+this.fields[e].max:null,this.fields[e].placeholder?"hint text: "+this.fields[e].placeholder:null,"context information as JSON: "+JSON.stringify(this.data)];this.composing[e]=!0,this.compose(this.data[e]||"Create a suitable text based on the context",t).then(s=>{this.update(e,s)}).finally(()=>{this.composing[e]=!1})},error(e,t){this.errors[e]=t,this.$emit("error",Object.values(this.errors).includes(!0))},removeFile(e){if(!e){this.$log("Fields::removeFile(): Invalid ID",e);return}const t=[...this.files],s=t.findIndex(l=>l===e);s!==-1&&t.splice(s,1),this.$emit("update:files",t)},toName(e){var t;return((t=e==null?void 0:e.charAt(0))==null?void 0:t.toUpperCase())+(e==null?void 0:e.slice(1))},translateText(e,t){this.translating[e]=!0,this.translate([this.data[e]],t).then(s=>{this.update(e,s[0]||"")}).finally(()=>{this.translating[e]=!1})},update(e,t){this.data[e]=t,this.$emit("change",this.data[e])}},watch:{type:{immediate:!0,handler(e){this.errors={}}}}},Ye={key:0,class:"actions"};function Ge(e,t,s,l,o,n){return h(!0),v($,null,V(s.fields,(r,i)=>(h(),v("div",{key:i,class:I(["item",{error:o.errors[i]}])},[r.type!=="hidden"?(h(),_(pe,{key:0},{default:d(()=>[p(c(e.$pgettext("fn",r.label||i).replace(/-|_/g," "))+" ",1),!s.readonly&&["markdown","plaintext","string","text"].includes(r.type)?(h(),v("div",Ye,[u(q,null,{activator:d(({props:a})=>[u(y,F({ref_for:!0},a,{title:e.$gettext("Translate %{code} field",{code:i}),loading:o.translating[i],icon:"mdi-translate",variant:"text",elevation:"0"}),null,16,["title","loading"])]),default:d(()=>[u(T,null,{default:d(()=>[(h(!0),v($,null,V(n.txlocales(),a=>(h(),_(k,{key:a.code},{default:d(()=>[u(y,{onClick:m=>n.translateText(i,a.code),"prepend-icon":"mdi-arrow-right-thin",variant:"text"},{default:d(()=>[p(c(a.name),1)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1024),u(y,{title:e.$gettext("Generate text for %{code} field",{code:i}),loading:o.composing[i],onClick:a=>n.composeText(i),icon:"mdi-creation",variant:"text",elevation:"0"},null,8,["title","loading","onClick"])])):w("",!0)]),_:2},1024)):w("",!0),(h(),_(ge(n.toName(r.type)),{key:r.type+"-"+i,context:s.data,assets:s.assets,config:r,readonly:s.readonly,modelValue:s.data[i],onAddFile:t[0]||(t[0]=a=>n.addFile(a)),onRemoveFile:t[1]||(t[1]=a=>n.removeFile(a)),"onUpdate:modelValue":a=>n.update(i,a),onError:a=>n.error(i,a)},null,40,["context","assets","config","readonly","modelValue","onUpdate:modelValue","onError"]))],2))),128)}const wt=M(He,[["render",Ge],["__scopeId","data-v-00783f63"]]),Ct=(function(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",t=new Date("2025-01-01T00:00:00Z").getTime();let s=0;return function(){const l=(Date.now()-t)/4096<<7|s;return s=s+1&127,Array.from({length:6},(o,n)=>{const r=l>>6*(5-n)&63;return e[n===0?r%52:r]}).join("")}})();async function $t(e){const t=new AudioContext,l=await(await fetch(e)).arrayBuffer(),o=await t.decodeAudioData(l),n=[];for(let i=0;i<o.numberOfChannels;i++)n.push(o.getChannelData(i));const r=new Worker(new URL(""+new URL("worker-uYZwUMq5.js",import.meta.url).href,import.meta.url),{type:"module"});return new Promise(i=>{r.onmessage=a=>i(a.data),r.postMessage({channels:n,length:o.length,sampleRate:o.sampleRate},n.map(a=>a.buffer))})}const Qe={props:{type:{type:String,required:!0}},emits:["add"],data:()=>({tab:["basic"]}),setup(){return{schemas:ve()}},computed:{groups(){const e={};for(const t in this.schemas[this.type]||{}){const s=this.schemas[this.type][t],l=s.group||this.$gettext("uncategorized");s.type=t,e[l]=e[l]||[],e[l].push(s)}return e}},methods:{add(e){this.$emit("add",{type:e.type})}}},Ze=["innerHTML"];function Ke(e,t,s,l,o,n){return h(),v($,null,[u(ye,{modelValue:e.tab,"onUpdate:modelValue":t[0]||(t[0]=r=>e.tab=r)},{default:d(()=>[(h(!0),v($,null,V(n.groups,(r,i)=>(h(),_(be,{key:i,value:i},{default:d(()=>[p(c(e.$pgettext("sg",i)),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),u(_e,{modelValue:e.tab,"onUpdate:modelValue":t[1]||(t[1]=r=>e.tab=r)},{default:d(()=>[(h(!0),v($,null,V(Object.keys(n.groups),r=>(h(),_(ke,{key:r,value:r},{default:d(()=>[u(z,null,{default:d(()=>[(h(!0),v($,null,V(n.groups[r],i=>(h(),_(y,{key:i.type,onClick:a=>n.add(i),variant:"text",stacked:""},{prepend:d(()=>[g("span",{class:"icon",innerHTML:i.icon},null,8,Ze)]),default:d(()=>[p(" "+c(e.$pgettext("st",i.label||i.type)),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])],64)}const Xe=M(Qe,[["render",Ke],["__scopeId","data-v-afaa5a81"]]),et={components:{SchemaItems:Xe},props:{embed:{type:Boolean,default:!1},filter:{type:Object,default:()=>({})}},emits:["select"],inject:["debounce"],data(){return{items:[],term:"",sort:{column:"ID",order:"DESC"},page:1,last:1,limit:100,vschemas:!1,checked:!1,loading:!0,trash:!1}},setup(){const e=ae();return{auth:we(),messages:e}},created(){this.search(),this.searchd=this.debounce(this.search,500)},computed:{canTrash(){return this.items.some(e=>e._checked&&!e.deleted_at)},isChecked(){return this.items.some(e=>e._checked)},isTrashed(){return this.items.some(e=>e._checked&&e.deleted_at)}},methods:{add(e){if(this.embed||!this.auth.can("element:add")){this.messages.add(this.$gettext("Permission denied"),"error");return}return this.$apollo.mutate({mutation:L`mutation($input: ElementInput!) {
            addElement(input: $input) {
              id
              lang
              name
              type
              data
              editor
              created_at
              updated_at
              deleted_at
            }
          }`,variables:{input:{type:e.type,name:this.$gettext("New shared element"),data:"{}"}}}).then(t=>{var l;if(t.errors)throw t.errors;const s=((l=t.data)==null?void 0:l.addElement)||{};return s.data=JSON.parse(s.data)||{},s.published=!0,this.vschemas=!1,this.items.unshift(s),this.$emit("select",s),this.invalidate(),s}).catch(t=>{this.$log("ElementListItems::add(): Error adding shared element",t)})},drop(e){if(!this.auth.can("element:drop")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.items.filter(s=>s._checked);t.length&&this.$apollo.mutate({mutation:L`
            mutation($id: [ID!]!) {
              dropElement(id: $id) {
                id
              }
            }
          `,variables:{id:t.map(s=>s.id)}}).then(s=>{if(s.errors)throw s.errors;this.invalidate(),this.search()}).catch(s=>{this.messages.add(this.$gettext("Error trashing shared element")+`:
`+s,"error"),this.$log("ElementListItems::drop(): Error trashing shared element",t,s)})},invalidate(){const e=this.$apollo.provider.defaultClient.cache;e.evict({id:"ROOT_QUERY",fieldName:"elements"}),e.gc()},keep(e){if(!this.auth.can("element:keep")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.items.filter(s=>s._checked);t.length&&this.$apollo.mutate({mutation:L`
            mutation($id: [ID!]!) {
              keepElement(id: $id) {
                id
              }
            }
          `,variables:{id:t.map(s=>s.id)}}).then(s=>{if(s.errors)throw s.errors;t.forEach(l=>{l.deleted_at=null}),this.invalidate(),this.search()}).catch(s=>{this.messages.add(this.$gettext("Error restoring shared element")+`:
`+s,"error"),this.$log("ElementListItems::keep(): Error restoring shared element",t,s)})},publish(e){if(!this.auth.can("element:publish")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.items.filter(s=>s._checked&&s.id&&!s.published);t.length&&this.$apollo.mutate({mutation:L`mutation ($id: [ID!]!) {
            pubElement(id: $id) {
              id
            }
          }`,variables:{id:t.map(s=>s.id)}}).then(s=>{if(s.errors)throw s.errors;t.forEach(l=>{l.published=!0,l._checked=!1}),this.invalidate(),this.search()}).catch(s=>{this.messages.add(this.$gettext("Error publishing shared element")+`:
`+s,"error"),this.$log("ElementListItems::publish(): Error publishing shared element",t,s)})},purge(e){if(!this.auth.can("element:purge")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.items.filter(s=>s._checked);t.length&&this.$apollo.mutate({mutation:L`
            mutation($id: [ID!]!) {
              purgeElement(id: $id) {
                id
              }
            }
          `,variables:{id:t.map(s=>s.id)}}).then(s=>{if(s.errors)throw s.errors;this.invalidate(),this.search()}).catch(s=>{this.messages.add(this.$gettext("Error purging shared element")+`:
`+s,"error"),this.$log("ElementListItems::purge(): Error purging shared element",t,s)})},search(){if(!this.auth.can("element:view"))return this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve([]);const e=this.filter.publish||null,t=this.filter.trashed||"WITHOUT",s={...this.filter};return delete s.publish,delete s.trashed,this.term&&(s.any=this.term),this.loading=!0,this.$apollo.query({query:L`
            query($filter: ElementFilter, $sort: [QueryElementsSortOrderByClause!], $limit: Int!, $page: Int!, $trashed: Trashed, $publish: Publish) {
              elements(filter: $filter, sort: $sort, first: $limit, page: $page, trashed: $trashed, publish: $publish) {
                data {
                  id
                  lang
                  name
                  type
                  data
                  editor
                  created_at
                  updated_at
                  deleted_at
                  latest {
                    id
                    published
                    publish_at
                    data
                    editor
                    created_at
                  }
                }
                paginatorInfo {
                  lastPage
                }
              }
            }
          `,variables:{filter:s,page:this.page,limit:this.limit,sort:[this.sort],trashed:t,publish:e}}).then(l=>{var n;if(l.errors)throw l.errors;const o=l.data.elements||{};return this.last=((n=o.paginatorInfo)==null?void 0:n.lastPage)||1,this.items=[...o.data||[]].map(r=>{var a,m,f,C,E,x;const i=(a=r.latest)!=null&&a.data?JSON.parse((m=r.latest)==null?void 0:m.data):{...r,data:JSON.parse(r.data||"{}")};return Object.assign(i,{id:r.id,deleted_at:r.deleted_at,created_at:r.created_at,updated_at:((f=r.latest)==null?void 0:f.created_at)||r.updated_at,editor:((C=r.latest)==null?void 0:C.editor)||r.editor,published:((E=r.latest)==null?void 0:E.published)??!0,publish_at:((x=r.latest)==null?void 0:x.publish_at)||null,latest:r.latest})}),this.checked=!1,this.loading=!1,this.items}).catch(l=>{this.messages.add(this.$gettext("Error fetching shared elements")+`:
`+l,"error"),this.$log("ElementListItems::search(): Error fetching shared element",l)})},title(e){const t=[];return e.publish_at&&t.push("Publish at: "+new Date(e.publish_at).toLocaleDateString()),t.join(`
`)},toggle(){this.items.forEach(e=>{e._checked=!e._checked})}},watch:{filter:{deep:!0,handler(){this.search()}},term(){this.searchd()},page(){this.search()},sort(){this.search()}}},tt={class:"header"},st={class:"bulk"},at={class:"search"},it={class:"layout"},lt={class:"actions"},nt=["onClick","title"],rt={class:"item-text"},dt={class:"item-head"},ot={key:0,class:"item-lang"},ut={class:"item-title"},ht={class:"item-type item-subtitle"},ct={class:"item-aux"},mt={class:"item-editor"},ft={class:"item-modified item-subtitle"},pt={key:0,class:"loading"},gt={key:1,class:"notfound"},vt={key:3,class:"btn-group"};function yt(e,t,s,l,o,n){const r=Ve("SchemaItems");return h(),v($,null,[g("div",tt,[g("div",st,[u(te,{modelValue:o.checked,"onUpdate:modelValue":t[0]||(t[0]=i=>o.checked=i),onClick:t[1]||(t[1]=H(i=>n.toggle(),["stop"]))},null,8,["modelValue"]),u(q,{location:"bottom left"},{activator:d(({props:i})=>[u(y,F(i,{disabled:!n.isChecked,"append-icon":"mdi-menu-down",variant:"text"}),{default:d(()=>[p(c(e.$gettext("Actions")),1)]),_:1},16,["disabled"])]),default:d(()=>[u(T,null,{default:d(()=>[A(u(k,null,{default:d(()=>[u(y,{"prepend-icon":"mdi-publish",variant:"text",onClick:t[2]||(t[2]=i=>n.publish())},{default:d(()=>[p(c(e.$gettext("Publish")),1)]),_:1})]),_:1},512),[[N,n.isChecked&&l.auth.can("element:publish")]]),!this.embed&&l.auth.can("element:add")?(h(),_(k,{key:0},{default:d(()=>[u(y,{"prepend-icon":"mdi-folder-plus",variant:"text",onClick:t[3]||(t[3]=i=>o.vschemas=!0)},{default:d(()=>[p(c(e.$gettext("Add element")),1)]),_:1})]),_:1})):w("",!0),A(u(k,null,{default:d(()=>[u(y,{"prepend-icon":"mdi-delete",variant:"text",onClick:t[4]||(t[4]=i=>n.drop())},{default:d(()=>[p(c(e.$gettext("Delete")),1)]),_:1})]),_:1},512),[[N,n.canTrash&&l.auth.can("element:drop")]]),A(u(k,null,{default:d(()=>[u(y,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:t[5]||(t[5]=i=>n.keep())},{default:d(()=>[p(c(e.$gettext("Restore")),1)]),_:1})]),_:1},512),[[N,n.isTrashed&&l.auth.can("element:keep")]]),A(u(k,null,{default:d(()=>[u(y,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:t[6]||(t[6]=i=>n.purge())},{default:d(()=>[p(c(e.$gettext("Purge")),1)]),_:1})]),_:1},512),[[N,n.isChecked&&l.auth.can("element:purge")]])]),_:1})]),_:1})]),g("div",at,[u(Ce,{modelValue:o.term,"onUpdate:modelValue":t[7]||(t[7]=i=>o.term=i),"prepend-inner-icon":"mdi-magnify",variant:"underlined",label:e.$gettext("Search for"),"hide-details":"",clearable:""},null,8,["modelValue","label"])]),g("div",it,[u(q,{location:"bottom right"},{activator:d(({props:i})=>[u(y,F(i,{title:e.$gettext("Sort by"),"append-icon":"mdi-menu-down","prepend-icon":"mdi-sort",variant:"text"}),{default:d(()=>{var a,m,f;return[p(c(((a=o.sort)==null?void 0:a.column)==="ID"?((m=o.sort)==null?void 0:m.order)==="DESC"?e.$gettext("latest"):e.$gettext("oldest"):((f=o.sort)==null?void 0:f.column)||""),1)]}),_:1},16,["title"])]),default:d(()=>[u(T,null,{default:d(()=>[u(k,null,{default:d(()=>[u(y,{variant:"text",onClick:t[8]||(t[8]=i=>o.sort={column:"ID",order:"DESC"})},{default:d(()=>[p(c(e.$gettext("latest")),1)]),_:1})]),_:1}),u(k,null,{default:d(()=>[u(y,{variant:"text",onClick:t[9]||(t[9]=i=>o.sort={column:"ID",order:"ASC"})},{default:d(()=>[p(c(e.$gettext("oldest")),1)]),_:1})]),_:1}),u(k,null,{default:d(()=>[u(y,{variant:"text",onClick:t[10]||(t[10]=i=>o.sort={column:"NAME",order:"ASC"})},{default:d(()=>[p(c(e.$gettext("name")),1)]),_:1})]),_:1}),u(k,null,{default:d(()=>[u(y,{variant:"text",onClick:t[11]||(t[11]=i=>o.sort={column:"TYPE",order:"ASC"})},{default:d(()=>[p(c(e.$gettext("type")),1)]),_:1})]),_:1}),u(k,null,{default:d(()=>[u(y,{variant:"text",onClick:t[12]||(t[12]=i=>o.sort={column:"EDITOR",order:"ASC"})},{default:d(()=>[p(c(e.$gettext("editor")),1)]),_:1})]),_:1})]),_:1})]),_:1})])]),u(T,{class:"items"},{default:d(()=>[(h(!0),v($,null,V(o.items,(i,a)=>(h(),_(k,{key:a},{default:d(()=>[g("div",lt,[u(te,{modelValue:i._checked,"onUpdate:modelValue":m=>i._checked=m,class:I([{draft:!i.published},"item-check"])},null,8,["modelValue","onUpdate:modelValue","class"]),u(q,null,{activator:d(({props:m})=>[u(y,F({ref_for:!0},m,{title:e.$gettext("Actions"),icon:"mdi-dots-vertical",class:"item-menu",variant:"text",elevation:"0"}),null,16,["title"])]),default:d(()=>[u(T,null,{default:d(()=>[A(u(k,null,{default:d(()=>[u(y,{"prepend-icon":"mdi-publish",variant:"text",onClick:m=>n.publish(i)},{default:d(()=>[p(c(e.$gettext("Publish")),1)]),_:1},8,["onClick"])]),_:2},1536),[[N,!i.deleted_at&&!i.published&&this.auth.can("element:publish")]]),!i.deleted_at&&this.auth.can("element:drop")?(h(),_(k,{key:0},{default:d(()=>[u(y,{"prepend-icon":"mdi-delete",variant:"text",onClick:m=>n.drop(i)},{default:d(()=>[p(c(e.$gettext("Delete")),1)]),_:1},8,["onClick"])]),_:2},1024)):w("",!0),i.deleted_at&&this.auth.can("element:keep")?(h(),_(k,{key:1},{default:d(()=>[u(y,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:m=>n.keep(i)},{default:d(()=>[p(c(e.$gettext("Restore")),1)]),_:1},8,["onClick"])]),_:2},1024)):w("",!0),this.auth.can("element:purge")?(h(),_(k,{key:2},{default:d(()=>[u(y,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:m=>n.purge(i)},{default:d(()=>[p(c(e.$gettext("Purge")),1)]),_:1},8,["onClick"])]),_:2},1024)):w("",!0)]),_:2},1024)]),_:2},1024)]),g("div",{class:I(["item-content",{trashed:i.deleted_at}]),onClick:m=>e.$emit("select",i),title:n.title(i)},[g("div",rt,[g("div",dt,[i.lang?(h(),v("span",ot,c(i.lang),1)):w("",!0),i.publish_at?(h(),_(Ie,{key:1,class:"publish-at",icon:"mdi-clock-outline"})):w("",!0),g("span",ut,c(i.name),1)]),g("div",ht,c(i.type),1)]),g("div",ct,[g("div",mt,c(i.editor),1),g("div",ft,c(new Date(i.updated_at).toLocaleString()),1)])],10,nt)]),_:2},1024))),128))]),_:1}),o.loading?(h(),v("p",pt,[p(c(e.$gettext("Loading"))+" ",1),t[18]||(t[18]=g("svg",{class:"spinner",width:"32",height:"32",fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[g("circle",{class:"spin1",cx:"4",cy:"12",r:"3"}),g("circle",{class:"spin1 spin2",cx:"12",cy:"12",r:"3"}),g("circle",{class:"spin1 spin3",cx:"20",cy:"12",r:"3"})],-1))])):w("",!0),!o.loading&&!o.items.length?(h(),v("p",gt,c(e.$gettext("No entries found")),1)):w("",!0),o.last>1?(h(),_($e,{key:2,modelValue:o.page,"onUpdate:modelValue":t[13]||(t[13]=i=>o.page=i),length:o.last},null,8,["modelValue","length"])):w("",!0),!this.embed&&this.auth.can("element:add")?(h(),v("div",vt,[u(y,{onClick:t[14]||(t[14]=i=>o.vschemas=!0),title:e.$gettext("Add element"),icon:"mdi-view-grid-plus",color:"primary",variant:"flat"},null,8,["title"])])):w("",!0),(h(),_(xe,{to:"body"},[u(se,{modelValue:o.vschemas,"onUpdate:modelValue":t[16]||(t[16]=i=>o.vschemas=i),onAfterLeave:t[17]||(t[17]=i=>o.vschemas=!1),scrollable:"",width:"auto"},{default:d(()=>[u(z,null,{default:d(()=>[u(U,null,{default:d(()=>[u(r,{type:"content",onAdd:t[15]||(t[15]=i=>n.add(i))})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))],64)}const xt=M(et,[["render",yt],["__scopeId","data-v-ea6ab324"]]);export{bt as A,xt as E,wt as F,kt as H,Xe as S,Ct as a,$t as u};
