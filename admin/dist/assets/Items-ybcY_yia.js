import{_ as L,c as p,a as l,d as y,f as b,w as n,a8 as M,F as _,a7 as T,b as k,k as d,a9 as q,aa as z,r as G,o as c,ab as R,ac as W,ad as O,ae as S,af as B,ag as J,l as g,t as h,i as E,j as V,ah as H,m as I,ai as K,n as Q}from"./index-8Ib2nsHy.js";import{l as X}from"./vue-draggable-plus-CW5p0pwT.js";const Y={components:{VueDraggable:X},props:{modelValue:{type:Array},config:{type:Object,default:()=>{}},assets:{type:Object,default:()=>{}},readonly:{type:Boolean,default:!1},context:{type:Object}},emits:["update:modelValue","error","addFile","removeFile"],inject:["write","translate","transcribe","txlocales"],data(){return{translating:{},dictating:{},composing:{},errors:[],items:[],menu:[],panel:[],audio:{}}},setup(){return{clipboard:z()}},computed:{rules(){return[e=>!this.config.max||this.config.max&&e.length<=this.config.max||this.$gettext("Maximum is %{num} entries",{num:this.config.max}),e=>(this.config.min??1)&&e.length>=(this.config.min??1)||this.$gettext("Minimum is %{num} entries",{num:this.config.min??1})]}},methods:{add(){this.items.push({}),this.panel.push(this.items.length-1),this.$emit("update:modelValue",this.items)},change(){this.$emit("update:modelValue",this.items)},writeText(e,t){var a,o,w,f,i,s,m,C,r,N,U,A,D,F,j,P;const u=['generate for field "'+(((o=(a=this.config.item)==null?void 0:a[t])==null?void 0:o.label)||t)+'"','required output format is "'+((f=(w=this.config.item)==null?void 0:w[t])==null?void 0:f.type)+'"',(s=(i=this.config.item)==null?void 0:i[t])!=null&&s.min?"minimum characters: "+((C=(m=this.config.item)==null?void 0:m[t])==null?void 0:C.min):null,(N=(r=this.config.item)==null?void 0:r[t])!=null&&N.max?"maximum characters: "+((A=(U=this.config.item)==null?void 0:U[t])==null?void 0:A.max):null,(F=(D=this.config.item)==null?void 0:D[t])!=null&&F.placeholder?"hint text: "+((P=(j=this.config.item)==null?void 0:j[t])==null?void 0:P.placeholder):null,"context information as JSON: "+JSON.stringify(this.items[e])],v=this.items[e][t]||(this.items[e].title?'Write a sentence about "'+this.items[e].title+'"':"");this.composing[e+t]=!0,this.write(v,u).then(x=>{this.update(e,t,x)}).finally(()=>{this.composing[e+t]=!1})},copy(e){this.clipboard.set("items-content",JSON.parse(JSON.stringify(this.items[e])))},cut(e){this.clipboard.set("items-content",JSON.parse(JSON.stringify(this.items[e]))),this.items.splice(e,1),this.$emit("update:modelValue",this.items)},insert(e){this.items.splice(e,0,{}),this.panel.push(e),this.$emit("update:modelValue",this.items)},paste(e=null){e===null&&(e=this.items.length),this.items.splice(e,0,this.clipboard.get("items-content")),this.$emit("update:modelValue",this.items)},record(e,t){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");if(!this.audio[e+t])return this.audio[e+t]=q().start();this.audio[e+t].then(u=>{this.dictating[e+t]=!0,this.audio[e+t]=null,u.stop().then(v=>{this.transcribe(v).then(a=>{this.update(e,t,a.asText())}).finally(()=>{this.dictating[e+t]=!1})})})},remove(e){this.items.splice(e,1),this.$emit("update:modelValue",this.items)},title(e){return(e.title||e.text||Object.values(e||{}).map(t=>t&&typeof t!="object"&&typeof t!="boolean"?t:null).filter(t=>!!t).join(" - ")).substring(0,100)||""},toName(e){var t;return((t=e==null?void 0:e.charAt(0))==null?void 0:t.toUpperCase())+(e==null?void 0:e.slice(1))},translateText(e,t,u){this.translating[e+t]=!0,this.translate([this.items[e][t]],u).then(v=>{this.update(e,t,v[0]||"")}).finally(()=>{this.translating[e+t]=!1})},update(e,t,u){this.items[e]||(this.items[e]={}),this.items[e][t]=u,this.$emit("update:modelValue",this.items)}},watch:{modelValue:{immediate:!0,handler(e){this.items=Array.isArray(e)?e:this.config.default??[],this.$emit("error",!this.rules.every(t=>t(this.items)===!0))}}}},Z={class:"element-title"},$={class:"label"},ee={key:0,class:"actions"},te={key:0,class:"v-input--error"},ie={class:"v-input__details",role:"alert","aria-live":"polite"},ne={class:"v-messages"},le={class:"btn-group"};function ae(e,t,u,v,a,o){const w=G("VueDraggable");return c(),p(_,null,[l(M,{class:"items",modelValue:a.panel,"onUpdate:modelValue":t[4]||(t[4]=f=>a.panel=f),elevation:"0",multiple:""},{default:n(()=>[l(w,{modelValue:a.items,"onUpdate:modelValue":t[2]||(t[2]=f=>a.items=f),onUpdate:t[3]||(t[3]=f=>o.change()),disabled:u.readonly||e.$vuetify.display.smAndDown,forceFallback:!0,fallbackTolerance:"10",draggable:".item",group:"items",animation:"500"},{default:n(()=>[(c(!0),p(_,null,T(a.items,(f,i)=>(c(),k(R,{key:i,class:"item"},{default:n(()=>[l(W,null,{default:n(()=>[u.readonly?y("",!0):(c(),k(O(e.$vuetify.display.xs?"v-dialog":"v-menu"),{key:0,modelValue:a.menu[i],"onUpdate:modelValue":s=>a.menu[i]=s,transition:"scale-transition",location:"end center","max-width":"300"},{activator:n(({props:s})=>[l(d,I({ref_for:!0},s,{title:e.$gettext("Actions"),icon:"mdi-dots-vertical",variant:"text"}),null,16,["title"])]),default:n(()=>[l(S,null,{default:n(()=>[l(B,{density:"compact"},{default:n(()=>[l(J,null,{default:n(()=>[g(h(e.$gettext("Actions")),1)]),_:1}),l(d,{icon:"mdi-close",onClick:s=>a.menu[i]=!1},null,8,["onClick"])]),_:2},1024),l(E,{onClick:s=>a.menu[i]=!1},{default:n(()=>[l(V,null,{default:n(()=>[l(d,{"prepend-icon":"mdi-content-copy",variant:"text",onClick:s=>o.copy(i)},{default:n(()=>[g(h(e.$gettext("Copy")),1)]),_:1},8,["onClick"])]),_:2},1024),l(V,null,{default:n(()=>[l(d,{"prepend-icon":"mdi-content-cut",variant:"text",onClick:s=>o.cut(i)},{default:n(()=>[g(h(e.$gettext("Cut")),1)]),_:1},8,["onClick"])]),_:2},1024),l(V,null,{default:n(()=>[l(d,{"prepend-icon":"mdi-delete",variant:"text",onClick:s=>o.remove(i)},{default:n(()=>[g(h(e.$gettext("Delete")),1)]),_:1},8,["onClick"])]),_:2},1024),l(H),a.menu[i]&&v.clipboard.get("items-content")?(c(),k(V,{key:0},{default:n(()=>[l(d,{"prepend-icon":"mdi-arrow-up",variant:"text",onClick:s=>o.paste(i)},{default:n(()=>[g(h(e.$gettext("Paste before")),1)]),_:1},8,["onClick"])]),_:2},1024)):y("",!0),a.menu[i]&&v.clipboard.get("items-content")?(c(),k(V,{key:1},{default:n(()=>[l(d,{"prepend-icon":"mdi-arrow-down",variant:"text",onClick:s=>o.paste(i+1)},{default:n(()=>[g(h(e.$gettext("Paste after")),1)]),_:1},8,["onClick"])]),_:2},1024)):y("",!0),l(V,null,{default:n(()=>[l(d,{"prepend-icon":"mdi-arrow-up",variant:"text",onClick:s=>o.insert(i)},{default:n(()=>[g(h(e.$gettext("Insert before")),1)]),_:1},8,["onClick"])]),_:2},1024),l(V,null,{default:n(()=>[l(d,{"prepend-icon":"mdi-arrow-down",variant:"text",onClick:s=>o.insert(i+1)},{default:n(()=>[g(h(e.$gettext("Insert after")),1)]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])),b("div",Z,h(o.title(f)),1)]),_:2},1024),l(K,null,{default:n(()=>[(c(!0),p(_,null,T(u.config.item||{},(s,m)=>{var C;return c(),p("div",{key:m,class:"field"},[b("div",$,[g(h(s.label||m)+" ",1),!u.readonly&&["markdown","plaintext","string","text"].includes(s.type)?(c(),p("div",ee,[(c(),k(O(e.$vuetify.display.xs?"v-dialog":"v-menu"),{modelValue:a.menu[i+m],"onUpdate:modelValue":r=>a.menu[i+m]=r,transition:"scale-transition",location:"end center","max-width":"300"},{activator:n(({props:r})=>[l(d,I({ref_for:!0},r,{title:e.$gettext("Translate"),loading:a.translating[i+m],icon:"mdi-translate",variant:"text"}),null,16,["title","loading"])]),default:n(()=>[l(S,null,{default:n(()=>[l(B,{density:"compact"},{default:n(()=>[l(J,null,{default:n(()=>[g(h(e.$gettext("Translate")),1)]),_:1}),l(d,{icon:"mdi-close",onClick:r=>a.menu[i+m]=!1},null,8,["onClick"])]),_:2},1024),l(E,{onClick:r=>a.menu[i+m]=!1},{default:n(()=>[(c(!0),p(_,null,T(o.txlocales(),r=>(c(),k(V,{key:r.code},{default:n(()=>[l(d,{onClick:N=>o.translateText(m,r.code),"prepend-icon":"mdi-arrow-right-thin",variant:"text"},{default:n(()=>[g(h(r.name),1)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])),l(d,{title:e.$gettext("Generate text"),loading:a.composing[i+m],onClick:r=>o.writeText(i,m),icon:"mdi-creation",variant:"text"},null,8,["title","loading","onClick"]),l(d,{onClick:r=>o.record(i,m),class:Q({dictating:a.audio[i+m]}),icon:a.audio[i+m]?"mdi-microphone-outline":"mdi-microphone",title:e.$gettext("Dictate"),loading:a.dictating[i+m],variant:"text"},null,8,["onClick","class","icon","title","loading"])])):y("",!0)]),(c(),k(O(o.toName(s.type)),{modelValue:(C=a.items[i])==null?void 0:C[m],"onUpdate:modelValue":r=>o.update(i,m,r),onAddFile:t[0]||(t[0]=r=>e.$emit("addFile",r)),onRemoveFile:t[1]||(t[1]=r=>e.$emit("removeFile",r)),readonly:u.readonly,context:a.items[i],assets:u.assets,config:s},null,40,["modelValue","onUpdate:modelValue","readonly","context","assets","config"]))])}),128))]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue","disabled"])]),_:1},8,["modelValue"]),a.errors.length?(c(),p("div",te,[b("div",ie,[b("div",ne,[(c(!0),p(_,null,T(a.errors,(f,i)=>(c(),p("div",{key:i,class:"v-messages__message"},h(f),1))),128))])])])):y("",!0),b("div",le,[!u.readonly&&(!u.config.max||u.config.max&&+a.items.length<+u.config.max)?(c(),k(d,{key:0,title:e.$gettext("Add element"),icon:"mdi-view-grid-plus",onClick:t[5]||(t[5]=f=>o.add())},null,8,["title"])):y("",!0)])],64)}const oe=L(Y,[["render",ae],["__scopeId","data-v-4245a592"]]);export{oe as default};
