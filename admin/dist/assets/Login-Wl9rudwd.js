import{_ as h,b as f,w as t,i as g,n,aK as p,b5 as i,av as w,a1 as V,o as $,a as r,a5 as b,a6 as v,aN as y,E as u,G as C,k as o,t as l,b6 as c,aO as S,aX as k,h as A}from"../index.js";const F={data:()=>({creds:{email:"",password:""},form:null,error:null,loading:!1,login:!1,show:!1}),setup(){const e=w();return{auth:V(),messages:e}},created(){this.auth.isAuthenticated().then(e=>{if(!e)throw e;i.replace(this.next())}).catch(e=>{this.login=!0})},methods:{cmslogin(){if(!this.creds.email||!this.creds.password)return!1;this.error=null,this.loading=!0,this.auth.login(this.creds.email,this.creds.password).then(e=>{Object.values(e.permission||{}).some(s=>s===!0)?i.replace(this.next()):this.error=this.$gettext("Not a CMS editor")}).catch(e=>{this.error=e.message}).finally(()=>{this.loading=!1})},next(){var s;const e=this.auth.intended()||((s=i.getRoutes().find(d=>this.auth.can(d.name)))==null?void 0:s.path);return e||this.messages.add(this.$gettext("Access denied"),"error"),e||"/"}}};function M(e,s,d,N,B,m){return $(),f(p,{class:n(["login",{show:e.login}]),modelValue:e.form,"onUpdate:modelValue":s[4]||(s[4]=a=>e.form=a),onSubmit:s[5]||(s[5]=g(a=>m.cmslogin(),["prevent"]))},{default:t(()=>[r(b,{loading:e.loading,class:n(["elevation-2",{error:e.error}])},{title:t(()=>[o(l(e.$gettext("Login")),1)]),default:t(()=>[r(v,null,{default:t(()=>[r(u,{modelValue:e.creds.email,"onUpdate:modelValue":s[0]||(s[0]=a=>e.creds.email=a),label:e.$gettext("E-Mail"),variant:"underlined","validate-on":"blur",rules:[a=>!!a||e.$gettext("Field is required"),a=>!!a.match(/.+@.+/)||e.$gettext("Invalid e-mail address")],autocomplete:"username",autofocus:""},null,8,["modelValue","label","rules"]),r(u,{modelValue:e.creds.password,"onUpdate:modelValue":s[3]||(s[3]=a=>e.creds.password=a),type:e.show?"text":"password",label:e.$gettext("Password"),variant:"underlined",rules:[a=>!!a||e.$gettext("Field is required")],autocomplete:"current-password"},{"append-inner":t(()=>[r(C,{onClick:s[1]||(s[1]=a=>e.show=!e.show),onKeydown:s[2]||(s[2]=a=>[13,32].includes(a.keyCode)?e.show=!e.show:!1)},{default:t(()=>[o(l(e.show?"mdi-eye-off":"mdi-eye"),1)]),_:1})]),_:1},8,["modelValue","type","label","rules"]),y(r(c,{color:"error",icon:"mdi-alert-octagon"},{default:t(()=>[o(l(e.$gettext("Error")+": "+e.error),1)]),_:1},512),[[S,e.error]])]),_:1}),r(k,null,{default:t(()=>[r(A,{type:"submit",variant:"outlined",disabled:e.form!=!0},{default:t(()=>[o(l(e.$gettext("Login")),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["loading","class"])]),_:1},8,["class","modelValue"])}const L=h(F,[["render",M]]);export{L as default};
